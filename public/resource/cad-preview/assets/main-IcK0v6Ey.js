var n=Object.defineProperty;var o=(i,t,e)=>t in i?n(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>o(i,typeof t!="symbol"?t+"":t,e);import{a as s,i as r}from"./mlightcad-engine-67Yin7gY.js";import"./three-render-D_rTpM3Q.js";import"./vendor-bxYKFQ3X.js";class c{constructor(){a(this,"canvas");a(this,"statusText");a(this,"loadingOverlay");a(this,"btnZoomFit");a(this,"isInitialized",!1);this.canvas=document.getElementById("canvas"),this.statusText=document.getElementById("statusText"),this.loadingOverlay=document.getElementById("loading-overlay"),this.btnZoomFit=document.getElementById("btnZoomFit"),this.initAndLoadUrl()}initialize(){if(!this.isInitialized)try{s.createInstance({canvas:this.canvas,baseUrl:"https://cdn.jsdelivr.net/gh/mlightcad/cad-data@main/"}),this.btnZoomFit.addEventListener("click",()=>{const t=s.instance;t&&t.curView&&t.curView.zoomToFit()}),this.isInitialized=!0}catch(t){console.error("Failed to initialize CAD viewer:",t),this.updateStatus("初始化引擎失败: "+t,!0)}}async initAndLoadUrl(){this.initialize();const e=new URLSearchParams(window.location.search).get("url");if(!e){this.updateStatus("请提供图纸 URL (?url=...)",!0);return}await this.loadRemoteFile(e)}async loadRemoteFile(t){this.updateStatus("正在下载图纸...");try{this.updateStatus("正在解析 CAD 数据...");const e={minimumChunkSize:1e3,readOnly:!0};await s.instance.openUrl(t,e)?(this.loadingOverlay.style.display="none",setTimeout(async()=>{s.instance.curView.zoomToFit(),s.instance.curView.mode=r.PAN},100)):this.updateStatus("文档解析失败 (Unknown Error)",!0)}catch(e){console.error("Error loading file:",e),this.updateStatus(`加载错误: ${e.message||e}`,!0)}}updateStatus(t,e=!1){this.statusText&&(this.statusText.textContent=t,e&&this.statusText.classList.add("error-text"))}}new c;
