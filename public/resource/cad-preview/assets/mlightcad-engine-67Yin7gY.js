import{C as Dr,W as q0,B as Ft,a as ip,S as Y0,b as X0,M as pc,V as ap,c as Zn,L as fc,P as Br,d as Ma,e as Z0,G as lr,f as It,g as Rt,U as K0,h as op,i as ms,j as jt,k as Q0,l as qc,m as Pa,n as en,o as nu,F as J0,O as Yc,p as e1,q as va,r as su,T as t1,s as n1,D as s1,t as ba,R as r1,E as i1,u as lp,v as a1,w as _a,Q as o1,x as l1,y as c1,z as Xc,I as h1,A as u1,H as d1,J as p1,K as f1,N as Ms,X as cp,Y as hp,Z as _l,_ as ru,$ as iu,a0 as au}from"./three-render-D_rTpM3Q.js";import{d as g1}from"./vendor-bxYKFQ3X.js";function m1(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(s,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}const ko={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xl=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215,0];function Qi(s,e,t){return Math.max(e,Math.min(t,s))}const up=class dp{constructor(){this._colorIndex=256,this._color=null,this._colorName=null}get color(){return this._color}set color(e){e==null?this._color=null:(this._color=Math.round(Qi(e,0,256*256*256-1)),this._colorIndex=this.getColorIndexByValue(this._color),this._colorName=this.getColorNameByValue(this._color))}get hexColor(){if(this._color&&this._color>0&&this._color<=16777215){let e=this._color.toString(16).toUpperCase();for(;e.length<6;)e="0"+e;return`0x${e}`}return""}get cssColor(){return`rgb(${this.red},${this.green},${this.blue})`}get red(){return this.color?this.color>>16&255:null}get green(){return this.color?this.color>>8&255:null}get blue(){return this.color?this.color&255:null}get colorIndex(){return this._colorIndex}set colorIndex(e){e==null?this._colorIndex=null:(this._colorIndex=Qi(e,0,256),this._colorIndex>0&&this._colorIndex<256?(this._color=xl[e],this._colorName=this.getColorNameByValue(this._color)):(this._color=null,this._colorName=null))}get colorName(){return this._colorName}set colorName(e){if(e){const t=ko[e.toLowerCase()];t!==void 0?(this._colorName=e,this._color=t,this._colorIndex=this.getColorIndexByValue(this._color)):console.warn("Unknown color: "+e)}else this._colorName=null}get hasColorName(){return this._colorName==null}get hasColorIndex(){return this._colorIndex==null}get isByLayer(){return this.colorIndex==256}setByLayer(){return this.colorIndex=256,this}get isByBlock(){return this.colorIndex==0}setByBlock(){return this.colorIndex=0,this}setScalar(e){return this.setRGB(e,e,e),this}setRGB(e,t,n){const r=Math.round(Qi(e,0,255)),i=Math.round(Qi(t,0,255)),a=Math.round(Qi(n,0,255));return this.color=(r<<16)+(i<<8)+a,this}setColorName(e){const t=ko[e.toLowerCase()];return t!==void 0?this.color=t:console.warn("Unknown color "+e),this}clone(){const e=new dp;return e.colorIndex=this.colorIndex,e.color=this.color,e._colorName=this._colorName,this}copy(e){return this.colorIndex=e.colorIndex,this.color=e.color,this._colorName=e._colorName,this}equals(e){return e.color==this.color&&e.colorIndex==this.colorIndex&&e._colorName==this._colorName}toString(){return this.isByLayer?"ByLayer":this.isByBlock?"ByBlock":this.colorName?this.colorName:this.hexColor}getColorNameByValue(e){for(const[t,n]of Object.entries(ko))if(n===e)return t;return null}getColorIndexByValue(e){const t=xl.length-1;for(let n=1;n<t;++n)if(xl[n]===e)return n;return null}};up.NAMES=ko;let fr=up;const Dn={get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}};let lt=class{constructor(){this.listeners=[]}addEventListener(s){this.listeners.push(s)}removeEventListener(s){this.listeners=this.listeners.filter(e=>e!==s)}replaceEventListener(s){this.removeEventListener(s),this.addEventListener(s)}dispatch(s,...e){for(const t of this.listeners)t.call(null,s,...e)}};var y1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function v1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pp={exports:{}};(function(s){(function(e,t){s.exports?s.exports=t():e.log=t()})(y1,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],i={},a=null;function l(w,C){var E=w[C];if(typeof E.bind=="function")return E.bind(w);try{return Function.prototype.bind.call(E,w)}catch{return function(){return Function.prototype.apply.apply(E,[w,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(w){return w==="debug"&&(w="log"),typeof console===t?!1:w==="trace"&&n?c:console[w]!==void 0?l(console,w):console.log!==void 0?l(console,"log"):e}function p(){for(var w=this.getLevel(),C=0;C<r.length;C++){var E=r[C];this[E]=C<w?e:this.methodFactory(E,w,this.name)}if(this.log=this.debug,typeof console===t&&w<this.levels.SILENT)return"No console available for logging"}function g(w){return function(){typeof console!==t&&(p.call(this),this[w].apply(this,arguments))}}function m(w,C,E){return u(w)||g.apply(this,arguments)}function y(w,C){var E=this,L,O,F,B="loglevel";typeof w=="string"?B+=":"+w:typeof w=="symbol"&&(B=void 0);function Z(ge){var Le=(r[ge]||"silent").toUpperCase();if(!(typeof window===t||!B)){try{window.localStorage[B]=Le;return}catch{}try{window.document.cookie=encodeURIComponent(B)+"="+Le+";"}catch{}}}function W(){var ge;if(!(typeof window===t||!B)){try{ge=window.localStorage[B]}catch{}if(typeof ge===t)try{var Le=window.document.cookie,Je=encodeURIComponent(B),Ge=Le.indexOf(Je+"=");Ge!==-1&&(ge=/^([^;]+)/.exec(Le.slice(Ge+Je.length+1))[1])}catch{}return E.levels[ge]===void 0&&(ge=void 0),ge}}function Q(){if(!(typeof window===t||!B)){try{window.localStorage.removeItem(B)}catch{}try{window.document.cookie=encodeURIComponent(B)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ye(ge){var Le=ge;if(typeof Le=="string"&&E.levels[Le.toUpperCase()]!==void 0&&(Le=E.levels[Le.toUpperCase()]),typeof Le=="number"&&Le>=0&&Le<=E.levels.SILENT)return Le;throw new TypeError("log.setLevel() called with invalid level: "+ge)}E.name=w,E.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},E.methodFactory=C||m,E.getLevel=function(){return F??O??L},E.setLevel=function(ge,Le){return F=ye(ge),Le!==!1&&Z(F),p.call(E)},E.setDefaultLevel=function(ge){O=ye(ge),W()||E.setLevel(ge,!1)},E.resetLevel=function(){F=null,Q(),p.call(E)},E.enableAll=function(ge){E.setLevel(E.levels.TRACE,ge)},E.disableAll=function(ge){E.setLevel(E.levels.SILENT,ge)},E.rebuild=function(){if(a!==E&&(L=ye(a.getLevel())),p.call(E),a===E)for(var ge in i)i[ge].rebuild()},L=ye(a?a.getLevel():"WARN");var Se=W();Se!=null&&(F=ye(Se)),p.call(E)}a=new y,a.getLogger=function(w){if(typeof w!="symbol"&&typeof w!="string"||w==="")throw new TypeError("You must supply a name when creating a logger.");var C=i[w];return C||(C=i[w]=new y(w,a.methodFactory)),C};var A=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=A),a},a.getLoggers=function(){return i},a.default=a,a})})(pp);var fp=pp.exports;const b1=v1(fp),_1=m1({__proto__:null,default:b1},[fp]),x1=_1;x1.setLevel("debug");function qa(s){return s===null||typeof s!="object"?s:Array.isArray(s)?[...s]:{...s}}function La(s,...e){for(const t of e)if(t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&s[n]===void 0&&(s[n]=t[n]);return s}function w1(s,e){return s!=null&&Object.prototype.hasOwnProperty.call(s,e)}function S1(s){return s==null?!0:Array.isArray(s)||typeof s=="string"?s.length===0:s instanceof Map||s instanceof Set?s.size===0:typeof s=="object"?Object.keys(s).length===0:!1}function pa(s,e){if(s===e)return!0;if(s==null||e==null)return s===e;if(typeof s!=typeof e)return!1;if(typeof s!="object")return s===e;if(Array.isArray(s)!==Array.isArray(e))return!1;if(Array.isArray(s)){if(s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(!pa(s[r],e[r]))return!1;return!0}const t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!Object.prototype.hasOwnProperty.call(e,r)||!pa(s[r],e[r]))return!1;return!0}let A1=class gp{constructor(e,t){this.events={attrChanged:new lt,modelChanged:new lt},this._changing=!1,this._previousAttributes={},this._pending=!1;const n=e||{};t&&La(n,t),this.attributes=n,this.changed={}}get(e){return this.attributes[e]}set(e,t,n){if(e==null)return this;let r;typeof e=="object"?(r=e,n=t):(r={},r[e]=t),n||(n={});const i=n.unset,a=n.silent,l=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=qa(this.attributes),this.changed={});const u=this.attributes,p=this.changed,g=this._previousAttributes;for(const m in r)t=r[m],pa(u[m],t)||l.push(m),pa(g[m],t)?delete p[m]:p[m]=t,i?delete u[m]:u[m]=t;if(!a){l.length&&(this._pending=n);for(let m=0;m<l.length;m++)this.events.attrChanged.dispatch({object:this,attrName:l[m],attrValue:u[l[m]],options:n})}if(c)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.events.modelChanged.dispatch({object:this,options:n});return this._pending=!1,this._changing=!1,this}has(e){return this.get(e)!=null}hasChanged(e){return e==null?!S1(this.changed):w1(this.changed,e)}changedAttributes(e){if(!e)return this.hasChanged()?qa(this.changed):{};const t=this._changing?this._previousAttributes:this.attributes,n={};for(const r in e){const i=e[r];pa(t[r],i)||(n[r]=i)}return n}previous(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]}previousAttributes(){return qa(this._previousAttributes)}clone(){const e=qa(this.attributes);return new gp(e)}},Zc=class aa{constructor(){this.entries=new Map}static getInstance(){return aa.instance||(aa.instance=new aa),aa.instance}collect(e){this.entries.set(e.name,e)}printAll(){for(const[e,t]of this.entries)console.log(`${e}:`),console.log(t.format())}clear(){this.entries.clear()}getAll(){return Array.from(this.entries.values())}getEntry(e){return this.entries.get(e)}remove(e){return this.entries.delete(e)}},E1=class{constructor(e){this.name=e}run(e){throw new Error("run() must be implemented by subclass")}},T1=class{constructor(){this.tasks=[],this.onProgress=()=>{},this.onComplete=()=>{},this.onError=()=>!1}scheduleTask(e){return new Promise((t,n)=>{const r=()=>{Promise.resolve(e()).then(t).catch(n)};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(r):setTimeout(r,0)})}addTask(e){this.tasks.push(e)}setProgressCallback(e){this.onProgress=e}setCompleteCallback(e){this.onComplete=e}setErrorCallback(e){this.onError=e}async run(e){const t=this.tasks.length;let n=e;for(let r=0;r<t;r++){const i=this.tasks[r];try{n=await this.scheduleTask(async()=>{const a=await i.run(n);return this.onProgress((r+1)/t,i),a})}catch(a){if(this.onError({error:a,taskIndex:r,task:i}))break}}this.onComplete(n)}},Kc=class{constructor(e,t,n){this._chunkSize=-1,this._minimumChunkSize=50,this._count=e,this._numerOfChunk=t<1?1:t,this._minimumChunkSize=n,this.calculateChunkSize()}get count(){return this._count}get numerOfChunk(){return this._numerOfChunk}get minimumChunkSize(){return this._minimumChunkSize}set minimumChunkSize(e){this._minimumChunkSize=e,this.calculateChunkSize()}get chunkSize(){return this._chunkSize}calculateChunkSize(){let e=this._count/this._numerOfChunk;e<this._minimumChunkSize&&(e=Math.min(this._minimumChunkSize,this._count)),this._chunkSize=e<1?this._count:Math.floor(e)}scheduleTask(e){return new Promise((t,n)=>{const r=()=>{Promise.resolve(e()).then(t).catch(n)};typeof window<"u"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(r):setTimeout(r,0)})}async processChunk(e){let t=0;const n=async()=>{const r=t,i=Math.min(t+this._chunkSize,this._count);await e(r,i),t=i,t<this._count&&await this.scheduleTask(n)};await n()}};var mp=(s=>(s[s.DecimalDegrees=0]="DecimalDegrees",s[s.DegreesMinutesSeconds=1]="DegreesMinutesSeconds",s[s.Gradians=2]="Gradians",s[s.Radians=3]="Radians",s[s.SurveyorsUnits=4]="SurveyorsUnits",s))(mp||{});let fa=class yp{static get instance(){return this._instance||(this._instance=new yp),this._instance}constructor(){this._blocks=new Map}createKey(e,t){return`${e}_${t}`}set(e,t){return t=t.fastDeepClone(),this._blocks.set(e,t),t}get(e){let t=this._blocks.get(e);return t&&(t=t.fastDeepClone()),t}has(e){return this._blocks.has(e)}clear(){this._blocks.clear()}draw(e,t,n,r=!0,i,a){var l;const c=[];if(t!=null){const u=this.createKey(t.name,n);let p;if(this.has(u))p=this.get(u);else{const g=(l=e.basePoint)==null?void 0:l.clone();e.basePoint=void 0;const m=t.newIterator();let y=!0;for(const A of m)if(A.color.isByBlock&&n?(ou.copy(A.color),A.color.color=n,this.addEntity(A,c,e),A.color.copy(ou)):this.addEntity(A,c,e),y){const w=c[0];e.basePoint=w.basePoint,y=!1}p=e.group(c),p&&r&&Zt.name&&!Zt.name.startsWith("*U")&&this.set(u,p),e.basePoint=g}return p&&i&&(p.applyMatrix(i),a&&(a.x!=0||a.y!=0||a.z!=1)&&(i.setFromExtrusionDirection(a),p.applyMatrix(i))),p}else return e.group(c)}addEntity(e,t,n){const r=e.draw(n);r&&(this.attachEntityInfo(r,e),t.push(r))}attachEntityInfo(e,t){e.objectId=t.objectId,e.ownerId=t.ownerId,e.layerName=t.layer,e.visible=t.visibility}};const ou=new fr;var vp=(s=>(s[s.UTF8=0]="UTF8",s[s.US_ASCII=1]="US_ASCII",s[s.ISO_8859_1=2]="ISO_8859_1",s[s.ISO_8859_2=3]="ISO_8859_2",s[s.ISO_8859_3=4]="ISO_8859_3",s[s.ISO_8859_4=5]="ISO_8859_4",s[s.ISO_8859_5=6]="ISO_8859_5",s[s.ISO_8859_6=7]="ISO_8859_6",s[s.ISO_8859_7=8]="ISO_8859_7",s[s.ISO_8859_8=9]="ISO_8859_8",s[s.ISO_8859_9=10]="ISO_8859_9",s[s.CP437=11]="CP437",s[s.CP850=12]="CP850",s[s.CP852=13]="CP852",s[s.CP855=14]="CP855",s[s.CP857=15]="CP857",s[s.CP860=16]="CP860",s[s.CP861=17]="CP861",s[s.CP863=18]="CP863",s[s.CP864=19]="CP864",s[s.CP865=20]="CP865",s[s.CP869=21]="CP869",s[s.CP932=22]="CP932",s[s.MACINTOSH=23]="MACINTOSH",s[s.BIG5=24]="BIG5",s[s.CP949=25]="CP949",s[s.JOHAB=26]="JOHAB",s[s.CP866=27]="CP866",s[s.ANSI_1250=28]="ANSI_1250",s[s.ANSI_1251=29]="ANSI_1251",s[s.ANSI_1252=30]="ANSI_1252",s[s.GB2312=31]="GB2312",s[s.ANSI_1253=32]="ANSI_1253",s[s.ANSI_1254=33]="ANSI_1254",s[s.ANSI_1255=34]="ANSI_1255",s[s.ANSI_1256=35]="ANSI_1256",s[s.ANSI_1257=36]="ANSI_1257",s[s.ANSI_874=37]="ANSI_874",s[s.ANSI_932=38]="ANSI_932",s[s.ANSI_936=39]="ANSI_936",s[s.ANSI_949=40]="ANSI_949",s[s.ANSI_950=41]="ANSI_950",s[s.ANSI_1361=42]="ANSI_1361",s[s.UTF16=43]="UTF16",s[s.ANSI_1258=44]="ANSI_1258",s[s.UNDEFINED=255]="UNDEFINED",s))(vp||{});const I1=["utf-8","utf-8","iso-8859-1","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-9","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","utf-8","shift-jis","macintosh","big5","utf-8","utf-8","ibm866","windows-1250","windows-1251","windows-1252","gbk","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-874","shift-jis","gbk","euc-kr","big5","utf-8","utf-16le","windows-1258"],C1=s=>I1[s],gc="Continuous",wl="ByLayer",k1="ByBlock",qt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let lu=1234567;const bp=Math.PI/180,_p=180/Math.PI;function M1(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(qt[s&255]+qt[s>>8&255]+qt[s>>16&255]+qt[s>>24&255]+"-"+qt[e&255]+qt[e>>8&255]+"-"+qt[e>>16&15|64]+qt[e>>24&255]+"-"+qt[t&63|128]+qt[t>>8&255]+"-"+qt[t>>16&255]+qt[t>>24&255]+qt[n&255]+qt[n>>8&255]+qt[n>>16&255]+qt[n>>24&255]).toLowerCase()}function nr(s,e,t){return Math.max(e,Math.min(t,s))}function xp(s,e){return(s%e+e)%e}function P1(s,e,t,n,r){return n+(s-e)*(r-n)/(t-e)}function L1(s,e,t){return s!==e?(t-s)/(e-s):0}function wp(s,e,t){return(1-t)*s+t*e}function O1(s,e,t,n){return wp(s,e,1-Math.exp(-t*n))}function D1(s,e=1){return e-Math.abs(xp(s,e*2)-e)}function B1(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function N1(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function R1(s,e){return s+Math.floor(Math.random()*(e-s+1))}function F1(s,e){return s+Math.random()*(e-s)}function z1(s){return s*(.5-Math.random())}function U1(s){s!==void 0&&(lu=s);let e=lu+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function G1(s){return s*bp}function V1(s){return s*_p}function j1(s){return(s&s-1)===0&&s!==0}function $1(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function W1(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function Mo(s){const e=Math.PI*2;return(s%e+e)%e}function H1(s,e,t){return s>e&&s<t||s>t&&s<e}function q1(s,e,t,n=!1){return s=Mo(s),e=Mo(e),t=Mo(t),n?e>t?s<=e&&s>=t:s<=e||s>=t:e<t?s>=e&&s<=t:s>=e||s<=t}function Sp(s){return s=Math.abs(s),s<1?0:Math.ceil(Math.log10(Math.abs(s)+1))}function Y1(s,e=1e-7){const t=Sp(s);return Math.max(Math.pow(10,t)*e,e)}const st={DEG2RAD:bp,RAD2DEG:_p,generateUUID:M1,clamp:nr,euclideanModulo:xp,mapLinear:P1,inverseLerp:L1,lerp:wp,damp:O1,pingpong:D1,smoothstep:B1,smootherstep:N1,randInt:R1,randFloat:F1,randFloatSpread:z1,seededRandom:U1,degToRad:G1,radToDeg:V1,isPowerOfTwo:j1,ceilPowerOfTwo:$1,floorPowerOfTwo:W1,normalizeAngle:Mo,isBetween:H1,isBetweenAngle:q1,intPartLength:Sp,relativeEps:Y1},mc=class Ap{constructor(e,t){this.x=0,this.y=0;const n=+(e!==void 0)+ +(t!==void 0);if(n!==0){if(n===1&&e instanceof Array){this.x=e[0],this.y=e[1];return}if(n===1){const{x:r,y:i}=e;this.x=r,this.y=i;return}if(n===2){this.x=e,this.y=t;return}throw Dn.ILLEGAL_PARAMETERS}}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new Ap(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix2d(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Math.max(-1,Math.min(1,n)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}relativeEps(e=1e-7){return Math.min(st.relativeEps(this.x,e),st.relativeEps(this.y,e))}*[Symbol.iterator](){yield this.x,yield this.y}};mc.EMPTY=Object.freeze(new mc(0,0));let xt=mc;const yc=class Ep{constructor(e,t,n,r,i,a,l,c,u){this.elements=[1,0,0,0,1,0,0,0,1],e!=null&&t!=null&&n!=null&&r!=null&&i!=null&&a!=null&&l!=null&&c!=null&&u!=null&&this.set(e,t,n,r,i,a,l,c,u)}set(e,t,n,r,i,a,l,c,u){const p=this.elements;return p[0]=e,p[1]=r,p[2]=l,p[3]=t,p[4]=i,p[5]=c,p[6]=n,p[7]=a,p[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],l=n[3],c=n[6],u=n[1],p=n[4],g=n[7],m=n[2],y=n[5],A=n[8],w=r[0],C=r[3],E=r[6],L=r[1],O=r[4],F=r[7],B=r[2],Z=r[5],W=r[8];return i[0]=a*w+l*L+c*B,i[3]=a*C+l*O+c*Z,i[6]=a*E+l*F+c*W,i[1]=u*w+p*L+g*B,i[4]=u*C+p*O+g*Z,i[7]=u*E+p*F+g*W,i[2]=m*w+y*L+A*B,i[5]=m*C+y*O+A*Z,i[8]=m*E+y*F+A*W,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8];return t*a*p-t*l*u-n*i*p+n*l*c+r*i*u-r*a*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],g=p*a-l*u,m=l*c-p*i,y=u*i-a*c,A=t*g+n*m+r*y;if(A===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/A;return e[0]=g*w,e[1]=(r*u-p*n)*w,e[2]=(l*n-r*a)*w,e[3]=m*w,e[4]=(p*t-r*c)*w,e[5]=(r*i-l*t)*w,e[6]=y*w,e[7]=(n*c-u*t)*w,e[8]=(a*t-n*i)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e.elements[0]=t[0],e.elements[1]=t[3],e.elements[2]=t[6],e.elements[3]=t[1],e.elements[4]=t[4],e.elements[5]=t[7],e.elements[6]=t[2],e.elements[7]=t[5],e.elements[8]=t[8],this}setUvTransform(e,t,n,r,i,a,l){const c=Math.cos(i),u=Math.sin(i);return this.set(n*c,n*u,-n*(c*a+u*l)+a+e,-r*u,r*c,-r*(-u*a+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(Sl.makeScale(e,t)),this}rotate(e){return this.premultiply(Sl.makeRotation(-e)),this}translate(e,t){return this.premultiply(Sl.makeTranslation(e,t)),this}makeTranslation(e,t){return e instanceof xt?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new Ep().fromArray(this.elements)}};yc.IDENTITY=Object.freeze(new yc);let Qc=yc;const Sl=new Qc,ei=1e-6,Bt=2*Math.PI,Tp={x:0,y:0,z:0};let Ip=class{constructor(){this.equalPointTol=ei,this.equalVectorTol=ei}equalPoint2d(e,t){return new xt(e).sub(t).length()<this.equalPointTol}equalPoint3d(e,t){return new oe(e).sub(t).length()<this.equalPointTol}static equalToZero(e,t=ei){return e<t&&e>-t}static equal(e,t,n=ei){return Math.abs(e-t)<n}static great(e,t,n=ei){return e-t>n}static less(e,t,n=ei){return e-t<n}};const Cp=new Ip;function kp(s,e,t=!1){const n=s.x,r=s.y;let i=!1;const a=e.length;for(let l=0,c=a-1;l<a;c=l++){const u=e[l].x,p=e[l].y,g=e[c].x,m=e[c].y;let y=p>r!=m>r;t&&(y=p>=r!=m>=r),y&&n<(g-u)*(r-p)/(m-p)+u&&(i=!i)}return i}function X1(s,e){if(s.length===0||e.length===0)return!1;const t=new Ct().setFromPoints(s),n=new Ct().setFromPoints(e);if(!t.intersectsBox(n))return!1;for(let r=0;r<s.length;){if(kp(s[r],e,!0))return!0;r<s.length-1&&Cp.equalPoint2d(s[r+1],s[r])&&++r,++r}return!1}const Mp={isPointInPolygon:kp,isPolygonIntersect:X1};function Z1(s,e){const t=[],n=e-1,r=s;for(let i=0;i<=r;i++)t.push(0);for(let i=1;i<=n-r;i++)t.push(i);for(let i=0;i<=r;i++)t.push(n-r+1);return t}function K1(s,e){const t=e.length-1,n=s,r=[0];let i=0;for(let l=1;l<=t;l++){const c=e[l][0]-e[l-1][0],u=e[l][1]-e[l-1][1],p=e[l][2]-e[l-1][2],g=Math.sqrt(c*c+u*u+p*p);i+=g,r.push(i)}const a=[];for(let l=0;l<=n;l++)a.push(0);for(let l=1;l<=t-n;l++){const c=r[l]/i;a.push(c*(t-n+1))}for(let l=0;l<=n;l++)a.push(t-n+1);return a}function Q1(s,e){const t=e.length-1,n=s,r=[0];let i=0;for(let l=1;l<=t;l++){const c=e[l][0]-e[l-1][0],u=e[l][1]-e[l-1][1],p=e[l][2]-e[l-1][2],g=Math.sqrt(c*c+u*u+p*p),m=Math.sqrt(g);i+=m,r.push(i)}const a=[];for(let l=0;l<=n;l++)a.push(0);for(let l=1;l<=t-n;l++){const c=r[l]/i;a.push(c*(t-n+1))}for(let l=0;l<=n;l++)a.push(t-n+1);return a}function vc(s,e,t,n){if(e===0)return t>=n[s]&&t<n[s+1]?1:0;const r=n[s+e]-n[s],i=n[s+e+1]-n[s+1],a=r>1e-10?(t-n[s])/r:0,l=i>1e-10?(n[s+e+1]-t)/i:0;return a*vc(s,e-1,t,n)+l*vc(s+1,e-1,t,n)}function Po(s,e,t,n,r){const i=n.length-1,a=e;if(s=Math.max(t[a],Math.min(t[i+1],s)),Math.abs(s-t[i+1])<1e-8)return[...n[i]];if(Math.abs(s-t[a])<1e-8)return[...n[0]];const l=[0,0,0];let c=0;for(let u=0;u<=i;u++){const p=vc(u,a,s,t),g=r[u]*p;l[0]+=n[u][0]*g,l[1]+=n[u][1]*g,l[2]+=n[u][2]*g,c+=g}if(c<1e-10){const u=t[t.length-a-1];if(Math.abs(s-u)<1e-8)return[...n[i]];if(Math.abs(s-t[a])<1e-8)return[...n[0]]}return c>1e-10&&(l[0]/=c,l[1]/=c,l[2]/=c),l}function J1(s,e,t,n){const r=s,i=e[r],a=e[e.length-r-1];let l=0;const c=1e3,u=(a-i)/c;let p=Po(i,s,e,t,n);for(let w=1;w<=c;w++){const C=i+w*u,E=Po(C,s,e,t,n),L=E[0]-p[0],O=E[1]-p[1],F=E[2]-p[2];l+=Math.sqrt(L*L+O*O+F*F),p=E}const g=Po(a,s,e,t,n),m=g[0]-p[0],y=g[1]-p[1],A=g[2]-p[2];return l+=Math.sqrt(m*m+y*y+A*A),l}let xa=class Pp{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,l){let c=n[r+0],u=n[r+1],p=n[r+2],g=n[r+3];const m=i[a+0],y=i[a+1],A=i[a+2],w=i[a+3];if(l===0){e[t+0]=c,e[t+1]=u,e[t+2]=p,e[t+3]=g;return}if(l===1){e[t+0]=m,e[t+1]=y,e[t+2]=A,e[t+3]=w;return}if(g!==w||c!==m||u!==y||p!==A){let C=1-l;const E=c*m+u*y+p*A+g*w,L=E>=0?1:-1,O=1-E*E;if(O>Number.EPSILON){const B=Math.sqrt(O),Z=Math.atan2(B,E*L);C=Math.sin(C*Z)/B,l=Math.sin(l*Z)/B}const F=l*L;if(c=c*C+m*F,u=u*C+y*F,p=p*C+A*F,g=g*C+w*F,C===1-l){const B=1/Math.sqrt(c*c+u*u+p*p+g*g);c*=B,u*=B,p*=B,g*=B}}e[t]=c,e[t+1]=u,e[t+2]=p,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,r,i,a){const l=n[r],c=n[r+1],u=n[r+2],p=n[r+3],g=i[a],m=i[a+1],y=i[a+2],A=i[a+3];return e[t]=l*A+p*g+c*y-u*m,e[t+1]=c*A+p*m+u*g-l*y,e[t+2]=u*A+p*y+l*m-c*g,e[t+3]=p*A-l*g-c*m-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new Pp(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e.x,r=e.y,i=e.z,a=e.order,l=Math.cos,c=Math.sin,u=l(n/2),p=l(r/2),g=l(i/2),m=c(n/2),y=c(r/2),A=c(i/2);switch(a){case"XYZ":this._x=m*p*g+u*y*A,this._y=u*y*g-m*p*A,this._z=u*p*A+m*y*g,this._w=u*p*g-m*y*A;break;case"YXZ":this._x=m*p*g+u*y*A,this._y=u*y*g-m*p*A,this._z=u*p*A-m*y*g,this._w=u*p*g+m*y*A;break;case"ZXY":this._x=m*p*g-u*y*A,this._y=u*y*g+m*p*A,this._z=u*p*A+m*y*g,this._w=u*p*g-m*y*A;break;case"ZYX":this._x=m*p*g-u*y*A,this._y=u*y*g+m*p*A,this._z=u*p*A-m*y*g,this._w=u*p*g+m*y*A;break;case"YZX":this._x=m*p*g+u*y*A,this._y=u*y*g+m*p*A,this._z=u*p*A-m*y*g,this._w=u*p*g-m*y*A;break;case"XZY":this._x=m*p*g-u*y*A,this._y=u*y*g-m*p*A,this._z=u*p*A+m*y*g,this._w=u*p*g+m*y*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],l=t[5],c=t[9],u=t[2],p=t[6],g=t[10],m=n+l+g;if(m>0){const y=.5/Math.sqrt(m+1);this._w=.25/y,this._x=(p-c)*y,this._y=(i-u)*y,this._z=(a-r)*y}else if(n>l&&n>g){const y=2*Math.sqrt(1+n-l-g);this._w=(p-c)/y,this._x=.25*y,this._y=(r+a)/y,this._z=(i+u)/y}else if(l>g){const y=2*Math.sqrt(1+l-n-g);this._w=(i-u)/y,this._x=(r+a)/y,this._y=.25*y,this._z=(c+p)/y}else{const y=2*Math.sqrt(1+g-n-l);this._w=(a-r)/y,this._x=(i+u)/y,this._y=(c+p)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(nr(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,l=t._x,c=t._y,u=t._z,p=t._w;return this._x=n*p+a*l+r*u-i*c,this._y=r*p+a*c+i*l-n*u,this._z=i*p+a*u+n*c-r*l,this._w=a*p-n*l-r*c-i*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let l=a*e._w+n*e._x+r*e._y+i*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const c=1-l*l;if(c<=Number.EPSILON){const y=1-t;return this._w=y*a+t*this._w,this._x=y*n+t*this._x,this._y=y*r+t*this._y,this._z=y*i+t*this._z,this.normalize(),this}const u=Math.sqrt(c),p=Math.atan2(u,l),g=Math.sin((1-t)*p)/u,m=Math.sin(t*p)/u;return this._w=a*g+this._w*m,this._x=n*g+this._x*m,this._y=r*g+this._y*m,this._z=i*g+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};const _n=class Lp{constructor(e,t,n){this.x=0,this.y=0,this.z=0;const r=+(e!==void 0)+ +(t!==void 0)+ +(n!==void 0);if(r!==0){if(r===1&&e instanceof Array){this.x=e[0],this.y=e[1],this.z=e[2];return}if(r===1){const{x:i,y:a,z:l}=e;this.x=i,this.y=a,this.z=l||0;return}if(r===3){this.x=e,this.y=t,this.z=n;return}throw Dn.ILLEGAL_PARAMETERS}}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new Lp(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z||0,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z||0,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(cu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,l=e.z,c=e.w,u=2*(a*r-l*n),p=2*(l*t-i*r),g=2*(i*n-a*t);return this.x=t+c*u+a*g-l*p,this.y=n+c*p+l*u-i*g,this.z=r+c*g+i*p-a*u,this}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isParallelTo(e){const t=this.dot(e),n=this.length(),r=e.length();return Math.abs(t)===n*r}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,l=t.y,c=t.z;return this.x=r*c-i*l,this.y=i*a-n*c,this.z=n*l-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Al.copy(this).projectOnVector(e),this.sub(Al)}reflect(e){return this.sub(Al.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Math.max(-1,Math.min(1,n)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};_n.X_AXIS=Object.freeze(new _n(1,0,0)),_n.NEGATIVE_X_AXIS=Object.freeze(new _n(-1,0,0)),_n.Y_AXIS=Object.freeze(new _n(0,1,0)),_n.NEGATIVE_Y_AXIS=Object.freeze(new _n(0,-1,0)),_n.Z_AXIS=Object.freeze(new _n(0,0,1)),_n.NEGATIVE_Z_AXIS=Object.freeze(new _n(0,0,-1));let oe=_n;const Al=new oe,cu=new xa,bc=class Op{constructor(e,t,n,r,i,a,l,c,u,p,g,m,y,A,w,C){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!=null&&t!=null&&n!=null&&r!=null&&i!=null&&a!=null&&l!=null&&c!=null&&u!=null&&p!=null&&g!=null&&m!=null&&y!=null&&A!=null&&w!=null&&C!=null&&this.set(e,t,n,r,i,a,l,c,u,p,g,m,y,A,w,C)}set(e,t,n,r,i,a,l,c,u,p,g,m,y,A,w,C){const E=this.elements;return E[0]=e,E[4]=t,E[8]=n,E[12]=r,E[1]=i,E[5]=a,E[9]=l,E[13]=c,E[2]=u,E[6]=p,E[10]=g,E[14]=m,E[3]=y,E[7]=A,E[11]=w,E[15]=C,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Op().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}setFromExtrusionDirection(e){if(Cp.equalPoint3d(e,oe.Z_AXIS))this.identity();else{const t=new oe(1,0,0);Math.abs(e.x)<1/64&&Math.abs(e.y)<1/64?t.crossVectors(oe.Y_AXIS,e).normalize():t.crossVectors(oe.Z_AXIS,e).normalize();const n=e.clone().cross(t).normalize();this.set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,e.x,e.y,e.z,0,0,0,0,1)}return this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/ti.setFromMatrixColumn(e,0).length(),i=1/ti.setFromMatrixColumn(e,1).length(),a=1/ti.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ey,e,ty)}lookAt(e,t,n){const r=this.elements;return yn.subVectors(e,t),yn.lengthSq()===0&&(yn.z=1),yn.normalize(),js.crossVectors(n,yn),js.lengthSq()===0&&(Math.abs(n.z)===1?yn.x+=1e-4:yn.z+=1e-4,yn.normalize(),js.crossVectors(n,yn)),js.normalize(),Ya.crossVectors(yn,js),r[0]=js.x,r[4]=Ya.x,r[8]=yn.x,r[1]=js.y,r[5]=Ya.y,r[9]=yn.y,r[2]=js.z,r[6]=Ya.z,r[10]=yn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],l=n[4],c=n[8],u=n[12],p=n[1],g=n[5],m=n[9],y=n[13],A=n[2],w=n[6],C=n[10],E=n[14],L=n[3],O=n[7],F=n[11],B=n[15],Z=r[0],W=r[4],Q=r[8],ye=r[12],Se=r[1],ge=r[5],Le=r[9],Je=r[13],Ge=r[2],Ze=r[6],Fe=r[10],Xe=r[14],ie=r[3],Ee=r[7],et=r[11],Me=r[15];return i[0]=a*Z+l*Se+c*Ge+u*ie,i[4]=a*W+l*ge+c*Ze+u*Ee,i[8]=a*Q+l*Le+c*Fe+u*et,i[12]=a*ye+l*Je+c*Xe+u*Me,i[1]=p*Z+g*Se+m*Ge+y*ie,i[5]=p*W+g*ge+m*Ze+y*Ee,i[9]=p*Q+g*Le+m*Fe+y*et,i[13]=p*ye+g*Je+m*Xe+y*Me,i[2]=A*Z+w*Se+C*Ge+E*ie,i[6]=A*W+w*ge+C*Ze+E*Ee,i[10]=A*Q+w*Le+C*Fe+E*et,i[14]=A*ye+w*Je+C*Xe+E*Me,i[3]=L*Z+O*Se+F*Ge+B*ie,i[7]=L*W+O*ge+F*Ze+B*Ee,i[11]=L*Q+O*Le+F*Fe+B*et,i[15]=L*ye+O*Je+F*Xe+B*Me,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],l=e[5],c=e[9],u=e[13],p=e[2],g=e[6],m=e[10],y=e[14],A=e[3],w=e[7],C=e[11],E=e[15];return A*(+i*c*g-r*u*g-i*l*m+n*u*m+r*l*y-n*c*y)+w*(+t*c*y-t*u*m+i*a*m-r*a*y+r*u*p-i*c*p)+C*(+t*u*g-t*l*y-i*a*g+n*a*y+i*l*p-n*u*p)+E*(-r*l*p-t*c*g+t*l*m+r*a*g-n*a*m+n*c*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e instanceof oe?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],g=e[9],m=e[10],y=e[11],A=e[12],w=e[13],C=e[14],E=e[15],L=g*C*u-w*m*u+w*c*y-l*C*y-g*c*E+l*m*E,O=A*m*u-p*C*u-A*c*y+a*C*y+p*c*E-a*m*E,F=p*w*u-A*g*u+A*l*y-a*w*y-p*l*E+a*g*E,B=A*g*c-p*w*c-A*l*m+a*w*m+p*l*C-a*g*C,Z=t*L+n*O+r*F+i*B;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const W=1/Z;return e[0]=L*W,e[1]=(w*m*i-g*C*i-w*r*y+n*C*y+g*r*E-n*m*E)*W,e[2]=(l*C*i-w*c*i+w*r*u-n*C*u-l*r*E+n*c*E)*W,e[3]=(g*c*i-l*m*i-g*r*u+n*m*u+l*r*y-n*c*y)*W,e[4]=O*W,e[5]=(p*C*i-A*m*i+A*r*y-t*C*y-p*r*E+t*m*E)*W,e[6]=(A*c*i-a*C*i-A*r*u+t*C*u+a*r*E-t*c*E)*W,e[7]=(a*m*i-p*c*i+p*r*u-t*m*u-a*r*y+t*c*y)*W,e[8]=F*W,e[9]=(A*g*i-p*w*i-A*n*y+t*w*y+p*n*E-t*g*E)*W,e[10]=(a*w*i-A*l*i+A*n*u-t*w*u-a*n*E+t*l*E)*W,e[11]=(p*l*i-a*g*i-p*n*u+t*g*u+a*n*y-t*l*y)*W,e[12]=B*W,e[13]=(p*w*r-A*g*r+A*n*m-t*w*m-p*n*C+t*g*C)*W,e[14]=(A*l*r-a*w*r-A*n*c+t*w*c+a*n*C-t*l*C)*W,e[15]=(a*g*r-p*l*r+p*n*c-t*g*c-a*n*m+t*l*m)*W,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e instanceof oe?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,l=e.y,c=e.z,u=i*a,p=i*l;return this.set(u*a+n,u*l-r*c,u*c+r*l,0,u*l+r*c,p*l+n,p*c-r*a,0,u*c-r*l,p*c+r*a,i*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t.x,a=t.y,l=t.z,c=t.w,u=i+i,p=a+a,g=l+l,m=i*u,y=i*p,A=i*g,w=a*p,C=a*g,E=l*g,L=c*u,O=c*p,F=c*g,B=n.x,Z=n.y,W=n.z;return r[0]=(1-(w+E))*B,r[1]=(y+F)*B,r[2]=(A-O)*B,r[3]=0,r[4]=(y-F)*Z,r[5]=(1-(m+E))*Z,r[6]=(C+L)*Z,r[7]=0,r[8]=(A+O)*W,r[9]=(C-L)*W,r[10]=(1-(m+w))*W,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=ti.set(r[0],r[1],r[2]).length();const a=ti.set(r[4],r[5],r[6]).length(),l=ti.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Hn.copy(this);const c=1/i,u=1/a,p=1/l;return Hn.elements[0]*=c,Hn.elements[1]*=c,Hn.elements[2]*=c,Hn.elements[4]*=u,Hn.elements[5]*=u,Hn.elements[6]*=u,Hn.elements[8]*=p,Hn.elements[9]*=p,Hn.elements[10]*=p,t.setFromRotationMatrix(Hn),n.x=i,n.y=a,n.z=l,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};bc.IDENTITY=Object.freeze(new bc);let Nr=bc;const ti=new oe,Hn=new Nr,ey=new oe(0,0,0),ty=new oe(1,1,1),js=new oe,Ya=new oe,yn=new oe;let at=class Dp{constructor(e=void 0,t=void 0){this.min=e==null?new oe(1/0,1/0,1/0):new oe(e.x,e.y,e.z),this.max=t==null?new oe(-1/0,-1/0,-1/0):new oe(t.x,t.y,t.z)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(El.fromArray(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=El.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new Dp().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}get center(){return this.isEmpty()?new oe(0,0,0):new oe(0,0,0).addVectors(this.min,this.max).multiplyScalar(.5)}get size(){return this.isEmpty()?new oe(0,0,0):new oe(0,0,0).subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,El).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(xs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xs),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const xs=[new oe,new oe,new oe,new oe,new oe,new oe,new oe,new oe],El=new oe,hu=new xt;let Ct=class Bp{constructor(e=void 0,t=void 0){this.min=e==null?new xt(1/0,1/0):new xt(e.x,e.y),this.max=t==null?new xt(-1/0,-1/0):new xt(t.x,t.y)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=hu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new Bp().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}get center(){return this.isEmpty()?new xt(0,0):new xt(0,0).addVectors(this.min,this.max).multiplyScalar(.5)}get size(){return this.isEmpty()?new xt(0,0):new xt(0,0).subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hu).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const uu=new oe,ny=new oe,sy=new Qc;let Np=class Rp{constructor(e=new oe(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=uu.subVectors(n,t).cross(ny.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectsBox(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||sy.getNormalMatrix(e),r=this.coplanarPoint(uu).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new Rp().copy(this)}},je=class extends xt{static pointArrayToNumberArray(e){const t=new Array(e.length*2);return e.forEach((n,r)=>{n.toArray(t,r*2)}),t}};class te extends oe{static pointArrayToNumberArray(e,t=!0){const n=t?3:2,r=new Array(e.length*n);return e.forEach((i,a)=>{i.toArray(r,a*n)}),r}}const du=new Nr,pu=new xa,Fp=class _c{constructor(e=0,t=0,n=0,r=_c.DEFAULT_ORDER){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new _c(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],a=r[4],l=r[8],c=r[1],u=r[5],p=r[9],g=r[2],m=r[6],y=r[10];switch(t){case"XYZ":this._y=Math.asin(nr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-p,y),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-nr(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(l,y),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-g,i),this._z=0);break;case"ZXY":this._x=Math.asin(nr(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-g,y),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,i));break;case"ZYX":this._y=Math.asin(-nr(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(m,y),this._z=Math.atan2(c,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(nr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,u),this._y=Math.atan2(-g,i)):(this._x=0,this._y=Math.atan2(l,y));break;case"XZY":this._z=Math.asin(-nr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(l,i)):(this._x=Math.atan2(-p,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n=!0){return du.makeRotationFromQuaternion(e),this.setFromRotationMatrix(du,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return pu.setFromEuler(this),this.setFromQuaternion(pu,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Fp.DEFAULT_ORDER="XYZ";let ry=Fp,zp=class{constructor(){this._boundingBoxNeedsUpdate=!1}get boundingBoxNeedUpdate(){return this._boundingBoxNeedsUpdate}},Up=class extends zp{translate(e){return this.transform(new Qc().makeTranslation(e.x,e.y))}get box(){return(this._box==null||this._boundingBoxNeedsUpdate)&&(this._box=this.calculateBoundingBox(),this._boundingBoxNeedsUpdate=!1),this._box}},Jc=class extends Up{constructor(){super(),this._loops=[]}add(e){this._loops.push(e),this._boundingBoxNeedsUpdate=!0}get loops(){return this._loops}get outter(){if(this._loops.length>0)return this._loops[0]}calculateBoundingBox(){const e=this.outter;return e?e.box:new Ct}transform(e){return this._boundingBoxNeedsUpdate=!0,this}getPoints(e){const t=[];for(let n=0;n<this.loops.length;++n){const r=this.loops[n].getPoints(e);t.push(r)}return t}buildHierarchy(){var e;const t=this.getPoints(100),n=this.calculateBoundaryBoxes(t),r=this.sortBoundaryBoxesByAreas(n),i=new Map,a=r.length;for(let c=0;c<a;c++)i.set(r[c],{index:r[c],children:[]});const l={index:-1,children:[]};for(let c=0;c<a;c++){const u=r[c],p=t[u],g=n[u];let m=c+1;for(;m<a;m++){const y=r[m],A=t[y];if(n[y].containsBox(g)&&Mp.isPointInPolygon(p[st.randInt(0,p.length-1)],A)){(e=i.get(y))==null||e.children.push(i.get(u));break}}m===a&&l.children.push(i.get(u))}return l}calculateBoundaryBoxes(e){const t=[];return e.forEach(n=>{t.push(new Ct().setFromPoints(n))}),t}sortBoundaryBoxesByAreas(e){const t=[];e.forEach((r,i)=>{const a=r.size,l=a.width*a.height;t.push({area:l,index:i})}),t.sort((r,i)=>r.area-i.area);const n=[];return t.forEach(r=>{n.push(r.index)}),n}},Oa=class extends Up{constructor(){super(),this.arcLengthDivisions=100}get startPoint(){return this.getPoint(0)}get endPoint(){return this.getPoint(1)}get length(){return this.getLength()}getPoint(e){throw new Error("AcGeCurve2d: .getPoint() not implemented.")}getPointAt(e){const t=this.getUtoTmapping(e);return this.getPoint(t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return t}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let a;t?a=t:a=e*n[i-1];let l=0,c=i-1,u;for(;l<=c;)if(r=Math.floor(l+(c-l)/2),u=n[r]-a,u<0)l=r+1;else if(u>0)c=r-1;else{c=r;break}if(r=c,n[r]===a)return r/(i-1);const p=n[r],g=n[r+1]-p,m=(a-p)/g;return(r+m)/(i-1)}getTangent(e){let t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);const r=this.getPoint(t),i=this.getPoint(n),a=new je;return a.copy(i).sub(r).normalize(),a}getTangentAt(e){const t=this.getUtoTmapping(e);return this.getTangent(t)}},Vo=class Gp extends Oa{constructor(e,t,n,r,i){super();const a=+(e!==void 0)+ +(t!==void 0)+ +(n!==void 0)+ +(r!==void 0)+ +(i!==void 0);if(a==3)typeof e=="object"&&typeof t=="object"&&typeof n=="object"?this.createByThreePoints(e,t,n):this.createByStartEndPointsAndBulge(e,t,n);else if(a==5){const l=e;this.center=new je(l.x,l.y),this.radius=t,this._clockwise=i,this._startAngle=this._clockwise?this._mirrorAngle(st.normalizeAngle(n)):st.normalizeAngle(n),this._endAngle=this._clockwise?this._mirrorAngle(st.normalizeAngle(r)):st.normalizeAngle(r)}else throw Dn.ILLEGAL_PARAMETERS}createByThreePoints(e,t,n){const r=(W,Q)=>({x:(W.x+Q.x)/2,y:(W.y+Q.y)/2}),i=(W,Q)=>(Q.y-W.y)/(Q.x-W.x),a=W=>-1/W,l=r(e,t),c=r(t,n),u=i(e,t),p=i(t,n),g=a(u),m=a(p),y=(W,Q,ye,Se)=>{const ge=(Se-Q)/(W-ye),Le=W*ge+Q;return{x:ge,y:Le}},A=l.y-g*l.x,w=c.y-m*c.x,C=y(g,A,m,w),E=Math.sqrt(Math.pow(e.x-C.x,2)+Math.pow(e.y-C.y,2)),L=(W,Q)=>Math.atan2(W.y-Q.y,W.x-Q.x),O=L(e,C),F=L(t,C),B=L(n,C),Z=B>O&&B<F||O>B&&O<F||F>B&&F<O;this.center=C,this.radius=E,this._clockwise=!Z,this._startAngle=O,this._endAngle=B}createByStartEndPointsAndBulge(e,t,n){let r,i,a;n<0?(r=Math.atan(-n)*4,i=new xt(e),a=new xt(t)):(r=Math.atan(n)*4,i=new xt(t),a=new xt(e));const l=new xt().subVectors(a,i),c=l.length(),u=new xt().addVectors(i,l.multiplyScalar(.5)),p=Math.abs(c/2/Math.tan(r/2)),g=l.normalize();let m;if(r<Math.PI){const y=new xt(g.x*Math.cos(Math.PI/2)-g.y*Math.sin(Math.PI/2),g.y*Math.cos(Math.PI/2)+g.x*Math.sin(Math.PI/2));m=u.add(y.multiplyScalar(-p))}else{const y=new xt(g.x*Math.cos(Math.PI/2)-g.y*Math.sin(Math.PI/2),g.y*Math.cos(Math.PI/2)+g.x*Math.sin(Math.PI/2));m=u.add(y.multiplyScalar(p))}n<0?(this._startAngle=Math.atan2(i.y-m.y,i.x-m.x),this._endAngle=Math.atan2(a.y-m.y,a.x-m.x)):(this._startAngle=Math.atan2(a.y-m.y,a.x-m.x),this._endAngle=Math.atan2(i.y-m.y,i.x-m.x)),this._clockwise=n<0,this.center=m,this.radius=a.sub(m).length()}get center(){return this._center}set center(e){this._center=new je(e.x,e.y),this._boundingBoxNeedsUpdate=!0}get radius(){return this._radius}set radius(e){this._radius=e,this._boundingBoxNeedsUpdate=!0}get startAngle(){return this._clockwise?this._mirrorAngle(this._startAngle):this._startAngle}set startAngle(e){this._startAngle=this._clockwise?this._mirrorAngle(st.normalizeAngle(e)):st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get endAngle(){return this._clockwise?this._mirrorAngle(this._endAngle):this._endAngle}set endAngle(e){const t=this.startAngle==0&&e==Bt?e:st.normalizeAngle(e);this._endAngle=this._clockwise?this._mirrorAngle(t):t,this._boundingBoxNeedsUpdate=!0}_mirrorAngle(e){return(360-e*180/Math.PI)%360*Math.PI/180}_getInternalAngle(e){return this._clockwise?this._mirrorAngle(e):e}get deltaAngle(){const e=this._getInternalAngle(this.startAngle),t=this._getInternalAngle(this.endAngle);return this.clockwise?st.normalizeAngle(e-t):st.normalizeAngle(t-e)}get clockwise(){return this._clockwise}set clockwise(e){this._clockwise=e,this._boundingBoxNeedsUpdate=!0}get startPoint(){return this.getPointAtAngle(this.startAngle)}get endPoint(){return this.getPointAtAngle(this.endAngle)}get midPoint(){const e=this._getInternalAngle(this.startAngle),t=this._getInternalAngle(this.endAngle),n=st.normalizeAngle((e+t)/2),r=this._clockwise?this._mirrorAngle(n):n;return this.getPointAtAngle(r)}get closed(){const e=this._getInternalAngle(this.startAngle),t=this._getInternalAngle(this.endAngle);return Math.abs(t-e)/Math.PI%2==0}calculateBoundingBox(){const e=[this.startPoint,this.endPoint],t=[0,Math.PI/2,Math.PI,3*Math.PI/2];for(const i of t){const a=this._getInternalAngle(i);st.isBetweenAngle(a,this._getInternalAngle(this.startAngle),this._getInternalAngle(this.endAngle),this.clockwise)&&e.push(this.getPointAtAngle(i))}const n=e.map(i=>i.x),r=e.map(i=>i.y);return new Ct(new je(Math.min(...n),Math.min(...r)),new je(Math.max(...n),Math.max(...r)))}get length(){return Math.abs(this.deltaAngle*this.radius)}transform(e){return this._boundingBoxNeedsUpdate=!0,this}clone(){return new Gp(this.center.clone(),this.radius,this._startAngle,this._endAngle,this.clockwise)}getPointAtAngle(e){const t=this._getInternalAngle(e),n=this.center.x+this.radius*Math.cos(t),r=this.center.y+this.radius*Math.sin(t);return new je(n,r)}getPoints(e=100){const t=[];let n=this.deltaAngle,r=this._getInternalAngle(this.startAngle);if(this.closed&&(n=Bt,r=0),this.clockwise)for(let i=0;i<=e;i++){const a=r-n*(i/e),l=this._clockwise?this._mirrorAngle(a):a,c=this.getPointAtAngle(l);t.push(new je(c.x,c.y))}else for(let i=0;i<=e;i++){const a=r+n*(i/e),l=this._clockwise?this._mirrorAngle(a):a,c=this.getPointAtAngle(l);t.push(new je(c.x,c.y))}return t}},iy=class extends zp{translate(e){return this.transform(new Nr().makeTranslation(e.x,e.y,e.z))}get box(){return(this._box==null||this._boundingBoxNeedsUpdate)&&(this._box=this.calculateBoundingBox(),this._boundingBoxNeedsUpdate=!1),this._box}},Da=class extends iy{},wa=class Vp extends Da{constructor(e,t){super(),this._start=new te(e),this._end=new te(t)}get startPoint(){return this._start}set startPoint(e){this._start.copy(e),this._boundingBoxNeedsUpdate=!0}get endPoint(){return this._end}set endPoint(e){this._end.copy(e),this._boundingBoxNeedsUpdate=!0}get direction(){return new oe().subVectors(this.endPoint,this.startPoint).normalize()}get midPoint(){return new te((this._start.x+this._end.x)/2,(this._start.y+this._end.y)/2,(this._start.z+this._end.z)/2)}get length(){return this.startPoint.distanceTo(this.endPoint)}isPointOnLine(e){return this.project(e).distanceTo(e)<1e-6}at(e,t){return this.delta(t).multiplyScalar(e).add(this._start)}atLength(e,t=!1){if(t){const n=this.delta(xr).normalize();return new te(this._start).addScaledVector(n,e)}else{const n=this.delta(xr).normalize();return new te(this._end).addScaledVector(n,e)}}extend(e,t=!1){if(t){const n=xr.subVectors(this._start,this._end).normalize();this._start=new te(this._start).addScaledVector(n,e)}else{const n=this.delta(xr).normalize();this._end=new te(this._end).addScaledVector(n,e)}return this._boundingBoxNeedsUpdate=!0,this}closestPointToPointParameter(e,t){fu.subVectors(e,this._start),Xa.subVectors(this.endPoint,this.startPoint);const n=Xa.dot(Xa);let r=Xa.dot(fu)/n;return t&&(r=st.clamp(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this._start)}delta(e){return e.subVectors(this._end,this._start)}distanceSq(){return this._start.distanceToSquared(this._end)}distance(){return this._start.distanceTo(this._end)}project(e){const t=this.direction,n=xr.subVectors(e,this.startPoint).dot(t);return new te().copy(t).multiplyScalar(n).add(this.startPoint)}perpPoint(e){const t=this.direction,n=this.startPoint,r=xr.subVectors(e,n).dot(t),i=xr.copy(t).multiplyScalar(r);return new te().addVectors(n,i)}calculateBoundingBox(){const e=new te(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.min(this._start.z,this._end.z)),t=new te(Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y),Math.max(this._start.z,this._end.z));return new at(e,t)}transform(e){return this._start.applyMatrix4(e),this._end.applyMatrix4(e),this._boundingBoxNeedsUpdate=!0,this}get closed(){return!1}copy(e){return this.startPoint=e.startPoint,this.endPoint=e.endPoint,this._boundingBoxNeedsUpdate=!0,this}clone(){return new Vp(this._start.clone(),this._end.clone())}};const xr=new oe,fu=new oe,Xa=new oe;let jp=class Lo extends Da{static computeCenterPoint(e,t,n){const r=new oe().addVectors(e,t).multiplyScalar(.5),i=new oe().addVectors(e,n).multiplyScalar(.5),a=new oe().subVectors(t,e),l=new oe().subVectors(n,e),c=new oe().crossVectors(a,l).normalize();if(c.lengthSq()===0)return console.error("Points are collinear and cannot form a valid arc."),null;const u=new oe().crossVectors(a,c).normalize(),p=new oe().crossVectors(l,c).normalize(),g=u.clone().multiplyScalar(Number.MAX_SAFE_INTEGER),m=p.clone().multiplyScalar(Number.MAX_SAFE_INTEGER),y=new wa(r,r.clone().add(g)),A=new wa(i,i.clone().add(m)),w=new oe;return y.closestPointToPoint(A.startPoint,!0,w)?w:(console.error("Cannot find a valid center for the arc."),null)}static createByThreePoints(e,t,n){const r=Lo.computeCenterPoint(e,t,n);if(r){const i=r.distanceTo(e),a=new oe().subVectors(e,r),l=new oe().subVectors(t,r),c=Math.atan2(a.y,a.x),u=Math.atan2(l.y,l.x);return new Lo(r,i,c,u,oe.Z_AXIS)}}constructor(e,t,n,r,i,a=oe.X_AXIS){super(),this.center=e,this.radius=t,this.startAngle=n,this.endAngle=r,this.normal=i,this.refVec=a,(r-n)%Bt==0?(this.startAngle=0,this.endAngle=Bt):(this.startAngle=n,this.endAngle=r)}get center(){return this._center}set center(e){this._center=new te(e.x,e.y,e.z||0),this._boundingBoxNeedsUpdate=!0}get radius(){return this._radius}set radius(e){if(e<0)throw Dn.ILLEGAL_PARAMETERS;this._radius=e,this._boundingBoxNeedsUpdate=!0}get startAngle(){return this._startAngle}set startAngle(e){this._startAngle=st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get endAngle(){return this._endAngle}set endAngle(e){this._endAngle=this.startAngle==0&&e==Bt?e:st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get deltaAngle(){return st.normalizeAngle(this.endAngle-this.startAngle)}get isLargeArc(){return Math.abs(this.deltaAngle)>Math.PI?1:0}get clockwise(){return this.deltaAngle<=0}get normal(){return this._normal}set normal(e){this._normal=new oe(e.x,e.y,e.z),this._normal.normalize(),this._boundingBoxNeedsUpdate=!0}get refVec(){return this._refVec}set refVec(e){this._refVec=new oe(e.x,e.y,e.z),this._refVec.normalize(),this._boundingBoxNeedsUpdate=!0}get startPoint(){return this.getPointAtAngle(this._startAngle)}get endPoint(){return this.getPointAtAngle(this._endAngle)}get length(){return Math.abs(this.deltaAngle*this.radius)}calculateBoundingBox(){const e=[this.startAngle,this.endAngle];for(let c=0;c<2*Math.PI;c+=Math.PI/2)st.isBetweenAngle(c,this.startAngle,this.endAngle)&&e.push(c);let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,l=-1/0;for(const c of e){const u=this.getPointAtAngle(c);u.x<t&&(t=u.x),u.y<n&&(n=u.y),u.z<r&&(r=u.z),u.x>i&&(i=u.x),u.y>a&&(a=u.y),u.z>l&&(l=u.z)}return new at({x:t,y:n,z:r},{x:i,y:a,z:l})}get closed(){return Math.abs(this.endAngle-this.startAngle)/Math.PI%2==0}getPoints(e){const t=[];let n=this.deltaAngle,r=this.startAngle;this.closed&&(n=Bt,r=0);for(let i=0;i<=e;i++){const a=r+n*(i/e),l=this.getPointAtAngle(a);t.push(l)}return t}transform(e){const t=Tl.copy(this.refVec).applyAxisAngle(this.normal,this.startAngle).multiplyScalar(this.radius),n=Tl.copy(this.refVec).applyAxisAngle(this.normal,this.endAngle).multiplyScalar(this.radius);return this.center.applyMatrix4(e),t.applyMatrix4(e),n.applyMatrix4(e),this.normal.applyMatrix4(e).normalize(),this.refVec.applyMatrix4(e).normalize(),this.startAngle=this.getAngle(t),this.endAngle=this.getAngle(n),this._boundingBoxNeedsUpdate=!0,this}copy(e){return this.center=e.center,this.radius=e.radius,this.startAngle=e.startAngle,this.endAngle=e.endAngle,this.normal=e.normal,this.refVec=e.refVec,this._boundingBoxNeedsUpdate=!0,this}clone(){return new Lo(this.center.clone(),this.radius,this.startAngle,this.endAngle,this.normal,this.refVec)}getAngle(e){return e.sub(this.center),Math.atan2(e.dot(Tl.crossVectors(this.refVec,this.normal)),e.dot(this.refVec))}getPointAtAngle(e){const t=this.normal,n=this.refVec,r={x:t.y*n.z-t.z*n.y,y:t.z*n.x-t.x*n.z,z:t.x*n.y-t.y*n.x},i=this.center,a=this.radius;return new te(i.x+a*(n.x*Math.cos(e)+r.x*Math.sin(e)),i.y+a*(n.y*Math.cos(e)+r.y*Math.sin(e)),i.z+a*(n.z*Math.cos(e)+r.z*Math.sin(e)))}get plane(){const e=new oe(this.center).distanceTo(Tp);return new Np(this.normal,e)}};const Tl=new oe;let $p=class Wp extends Oa{constructor(e,t,n,r=0,i=Bt,a=!1,l=0){super(),this.center=e,this.majorAxisRadius=t,this.minorAxisRadius=n,(i-r)%Bt==0?(this.startAngle=0,this.endAngle=Bt):(this.startAngle=r,this.endAngle=i),this.clockwise=a,this.rotation=l}get center(){return this._center}set center(e){this._center=new te(e.x,e.y,e.z||0),this._boundingBoxNeedsUpdate=!0}get majorAxisRadius(){return this._majorAxisRadius}set majorAxisRadius(e){if(e<0)throw Dn.ILLEGAL_PARAMETERS;this._majorAxisRadius=e,this._boundingBoxNeedsUpdate=!0}get minorAxisRadius(){return this._minorAxisRadius}set minorAxisRadius(e){if(e<0)throw Dn.ILLEGAL_PARAMETERS;this._minorAxisRadius=e,this._boundingBoxNeedsUpdate=!0}get startAngle(){return this._startAngle}set startAngle(e){this._startAngle=st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get endAngle(){return this._endAngle}set endAngle(e){this._endAngle=this.startAngle==0&&e==Bt?e:st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get clockwise(){return this._clockwise}set clockwise(e){this._clockwise=e,this._boundingBoxNeedsUpdate=!0}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._boundingBoxNeedsUpdate=!0}get deltaAngle(){return st.normalizeAngle(this.endAngle-this.startAngle)}get isLargeArc(){return Math.abs(this.deltaAngle)>Math.PI?1:0}calculateBoundingBox(){let e=1/0,t=1/0,n=-1/0,r=-1/0;for(let i=0;i<=100;i++){const a=this.getPoint(i/100);e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x),r=Math.max(r,a.y)}return new Ct({x:e,y:t},{x:n,y:r})}get closed(){return this.deltaAngle==0}getPoint(e){const t=Math.PI*2;let n=this.endAngle-this.startAngle;const r=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=t;for(;n>t;)n-=t;n<Number.EPSILON&&(r?n=0:n=t),this.clockwise===!0&&!r&&(n===t?n=-t:n=n-t);const i=this.startAngle+e*n;let a=this.center.x+this.majorAxisRadius*Math.cos(i),l=this.center.y+this.minorAxisRadius*Math.sin(i);if(this.rotation!==0){const c=Math.cos(this.rotation),u=Math.sin(this.rotation),p=a-this.center.x,g=l-this.center.y;a=p*c-g*u+this.center.x,l=p*u+g*c+this.center.y}return new je(a,l)}transform(e){return this._boundingBoxNeedsUpdate=!0,this}copy(e){return this.center=e.center,this.majorAxisRadius=e.majorAxisRadius,this.minorAxisRadius=e.minorAxisRadius,this.startAngle=e.startAngle,this.endAngle=e.endAngle,this.clockwise=e.clockwise,this.rotation=e.rotation,this}clone(){return new Wp(this.center,this.majorAxisRadius,this.minorAxisRadius,this.startAngle,this.endAngle,this.clockwise,this.rotation)}},ay=class Hp extends Da{constructor(e,t,n,r,i,a=0,l=Bt){super(),this.center=e,this.normal=t,this.majorAxis=n,this.majorAxisRadius=r,this.minorAxisRadius=i;const c=Math.abs(l-a);Math.abs(c-Bt)<1e-10||Math.abs(c-2*Bt)<1e-10?(this.startAngle=0,this.endAngle=Bt):(this.startAngle=a,this.endAngle=l)}get center(){return this._center}set center(e){this._center=new te(e.x,e.y,e.z||0),this._boundingBoxNeedsUpdate=!0}get majorAxisRadius(){return this._majorAxisRadius}set majorAxisRadius(e){if(e<0)throw Dn.ILLEGAL_PARAMETERS;this._majorAxisRadius=e,this._boundingBoxNeedsUpdate=!0}get minorAxisRadius(){return this._minorAxisRadius}set minorAxisRadius(e){if(e<0)throw Dn.ILLEGAL_PARAMETERS;this._minorAxisRadius=e,this._boundingBoxNeedsUpdate=!0}get startAngle(){return this._startAngle}set startAngle(e){this._startAngle=st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get endAngle(){return this._endAngle}set endAngle(e){this._endAngle=this.startAngle==0&&e==Bt?e:st.normalizeAngle(e),this._boundingBoxNeedsUpdate=!0}get deltaAngle(){const e=this.endAngle-this.startAngle;return Math.abs(e-Bt)<1e-10?Bt:st.normalizeAngle(e)}get isLargeArc(){return Math.abs(this.deltaAngle)>Math.PI?1:0}get clockwise(){return this.deltaAngle<=0}get normal(){return this._normal}set normal(e){this._normal=new oe(e.x,e.y,e.z),this._normal.normalize(),this._boundingBoxNeedsUpdate=!0}get majorAxis(){return this._majorAxis}set majorAxis(e){this._majorAxis=new oe(e.x,e.y,e.z),this._majorAxis.normalize(),this._boundingBoxNeedsUpdate=!0}get minorAxis(){return new oe().crossVectors(this.normal,this.majorAxis).normalize()}get startPoint(){return this.getPointAtAngle(this._startAngle)}get endPoint(){return this.getPointAtAngle(this._endAngle)}get isCircular(){return Ip.equal(this.majorAxisRadius,this.minorAxisRadius)}get length(){if(this.isCircular)return this.majorAxisRadius*Math.abs(this.deltaAngle);const e=1e3,t=this.deltaAngle/e;let n=0,r=this.getPointAtAngle(this.startAngle);for(let i=1;i<=e;i++){const a=this.startAngle+i*t,l=this.getPointAtAngle(a),c=l.x-r.x,u=l.y-r.y,p=l.z-r.z;n+=Math.sqrt(c*c+u*u+p*p),r=l}return n}calculateBoundingBox(){if(this.majorAxis.equals(oe.X_AXIS)||this.majorAxis.equals(oe.Y_AXIS)||this.majorAxis.isParallelTo(oe.X_AXIS)||this.majorAxis.isParallelTo(oe.Y_AXIS)){const e=[this.startAngle,this.endAngle];for(let c=0;c<2*Math.PI;c+=Math.PI/2)st.isBetweenAngle(c,this.startAngle,this.endAngle)&&e.push(c);let t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,l=-1/0;for(const c of e){const u=this.getPointAtAngle(c);u.x<t&&(t=u.x),u.y<n&&(n=u.y),u.z<r&&(r=u.z),u.x>i&&(i=u.x),u.y>a&&(a=u.y),u.z>l&&(l=u.z)}return new at({x:t,y:n,z:r},{x:i,y:a,z:l})}else{let e=1/0,t=1/0,n=1/0,r=-1/0,i=-1/0,a=-1/0;for(let l=0;l<=100;l++){const c=this.startAngle+this.deltaAngle*(l/100),u=this.getPointAtAngle(c);e=Math.min(e,u.x),t=Math.min(t,u.y),n=Math.min(n,u.z),r=Math.max(r,u.x),i=Math.max(i,u.y),a=Math.max(a,u.z)}return new at({x:e,y:t,z:n},{x:r,y:i,z:a})}}get closed(){return this.deltaAngle==0}getPoints(e=100){const t=[];let n=this.deltaAngle,r=this.startAngle;this.closed&&(n=Bt,r=0);for(let i=0;i<=e;i++){const a=r+n*(i/e),l=this.getPointAtAngle(a);t.push(l)}return t}getPointAtAngle(e){const t=Math.cos(e),n=Math.sin(e),r=this.minorAxis.clone().multiplyScalar(this.minorAxisRadius).multiplyScalar(n),i=this.majorAxis.clone().multiplyScalar(t*this.majorAxisRadius).add(r);return new te(this.center.x+i.x,this.center.y+i.y,this.center.z+i.z)}contains(e){const t=new oe(e).sub(this.center),n=t.dot(this.majorAxis),r=t.dot(this.minorAxis),i=n/this.majorAxisRadius,a=r/this.minorAxisRadius;return i*i+a*a<=1}transform(e){return this._boundingBoxNeedsUpdate=!0,this}copy(e){return this.center=e.center,this.normal=e.normal,this.majorAxis=e.majorAxis,this.majorAxisRadius=e.majorAxisRadius,this.minorAxisRadius=e.minorAxisRadius,this.startAngle=e.startAngle,this.endAngle=e.endAngle,this._boundingBoxNeedsUpdate=!0,this}clone(){return new Hp(this.center,this.normal,this.majorAxis,this.majorAxisRadius,this.minorAxisRadius,this.startAngle,this.endAngle)}get plane(){const e=new oe(this.center).distanceTo(Tp);return new Np(this.normal,e)}},Gr=class extends Oa{constructor(e=null,t=!1){super(),this._vertices=e||new Array,this._closed=t}get numberOfVertices(){return this._vertices.length}get closed(){return this._closed}get startPoint(){if(this.numberOfVertices>0){const e=this._vertices[0];return new je(e.x,e.y)}throw new Error("Start point does not exist in an empty polyline.")}get endPoint(){const e=this.numberOfVertices;if(e>0)if(this.closed){const t=this._vertices[0];return new je(t.x,t.y)}else{const t=this._vertices[e-1];return new je(t.x,t.y)}throw new Error("End point does not exist in an empty polyline.")}get length(){let e=0;const t=this._vertices.length;for(let n=0;n<t;++n){const r=this._vertices[n];let i=null;if(n<t-1?i=this._vertices[n+1]:n==t-1&&this.closed&&(i=this._vertices[0]),i)if(r.bulge){const a=new Vo(r,i,r.bulge);e+=a.length}else e+=new je(r.x,r.y).distanceTo(i)}return e}set closed(e){this._closed=e,this._boundingBoxNeedsUpdate=!0}addVertexAt(e,t){e<=0?this._vertices.unshift(t):this._vertices.splice(e,0,t),this._boundingBoxNeedsUpdate=!0}getPointAt(e){const t=this._vertices[e];return new je(t.x,t.y)}calculateBoundingBox(){const e=this.getPoints(100);return new Ct().setFromPoints(e)}transform(e){return this._boundingBoxNeedsUpdate=!0,this}getPoints3d(e,t){const n=[];return this.getPoints(e).forEach(r=>n.push(new te().set(r.x,r.y,t))),n}getPoints(e){const t=[],n=this._vertices.length;for(let r=0;r<n;++r){const i=this._vertices[r];if(i.bulge){let a=null;if(r<n-1?a=this._vertices[r+1]:r==n-1&&this.closed&&(a=this._vertices[0]),a){const l=new Vo(i,a,i.bulge).getPoints(e),c=l.length;for(let u=0;u<c;++u){const p=l[u];t.push(new je(p.x,p.y))}}}else t.push(new je(i.x,i.y)),r==n-1&&this.closed&&t.push(t[0])}return t}},ga=class qp extends Oa{constructor(e,t){super(),this._start=new je(e),this._end=new je(t)}get startPoint(){return this._start}set startPoint(e){this._start.copy(e),this._boundingBoxNeedsUpdate=!0}get endPoint(){return this._end}set endPoint(e){this._end.copy(e),this._boundingBoxNeedsUpdate=!0}getPoints(){return[this.startPoint,this.endPoint]}get length(){return this.startPoint.distanceTo(this.endPoint)}calculateBoundingBox(){const e=new je(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y)),t=new je(Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));return new Ct(e,t)}transform(e){return this._start.applyMatrix2d(e),this._end.applyMatrix2d(e),this._boundingBoxNeedsUpdate=!0,this}get closed(){return!1}copy(e){return this.startPoint=e.startPoint,this.endPoint=e.endPoint,this._boundingBoxNeedsUpdate=!0,this}clone(){return new qp(this._start.clone(),this._end.clone())}},eh=class extends Oa{constructor(e=[]){super(),this._curves=e}get curves(){return this._curves}add(e){this._curves.push(e),this._boundingBoxNeedsUpdate=!0}get numberOfEdges(){return this._curves.length}get startPoint(){if(this._curves.length>0){const e=this._curves[0].startPoint;return new je(e.x,e.y)}throw new Error("Start point does not exist in an empty loop.")}get endPoint(){return this.startPoint}get length(){let e=0;return this._curves.forEach(t=>{e+=t.length}),e}calculateBoundingBox(){const e=this.getPoints(100),t=new Ct;return t.setFromPoints(e),t}transform(e){return this._boundingBoxNeedsUpdate=!0,this}get closed(){return!0}getPoints(e){const t=[];return this.curves.forEach(n=>{n.getPoints(e).forEach(r=>{t.push(new je(r.x,r.y))})}),t}};function oy(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Yp={exports:{}};(function(s,e){(function(t){s.exports=t()})(function(){var t={},n=this;new Function("try {return this===window;}catch(e){ return false;}");var r=new Function("try {return this===global;}catch(e){return false;}"),i=new Function("try {return typeof importScripts === 'function';}catch(e){return false;}");if(r()&&i(),r()||i()){var a=n;if(i()){var l=function(c,u){var p=n;return c.split(".").forEach(function(g){p&&(p=p[g])}),p?p[u]:null};onmessage=function(c){if(!(!c.data.className||!c.data.methodName)){var u=l(c.data.className,c.data.methodName);if(!u)return console.error("could not find "+c.data.className+"."+c.data.methodName);postMessage({result:u.apply(null,c.data.args),id:c.data.id})}}}}return function(c,u,p){u.geom=u.geom||{},u.exe=u.exe||{},u.eval=u.eval||{},u.core=u.core||{},u.promhx=u.promhx||{};var g={},m=function(){return Ee.__string_rec(this,"")};function y(o,h){function d(){}d.prototype=o;var f=new d;for(var v in h)f[v]=h[v];return h.toString!==Object.prototype.toString&&(f.toString=h.toString),f}var A=function(){};g.HxOverrides=A,A.__name__=["HxOverrides"],A.strDate=function(o){var h=o.length;switch(h){case 8:var d=o.split(":"),f=new Date;return f.setTime(0),f.setUTCHours(d[0]),f.setUTCMinutes(d[1]),f.setUTCSeconds(d[2]),f;case 10:var v=o.split("-");return new Date(v[0],v[1]-1,v[2],0,0,0);case 19:var b=o.split(" "),S=b[0].split("-"),I=b[1].split(":");return new Date(S[0],S[1]-1,S[2],I[0],I[1],I[2]);default:throw new ie("Invalid date format : "+o)}},A.cca=function(o,h){var d=o.charCodeAt(h);if(d==d)return d},A.substr=function(o,h,d){return h!=null&&h!=0&&d!=null&&d<0?"":(d==null&&(d=o.length),h<0?(h=o.length+h,h<0&&(h=0)):d<0&&(d=o.length+d-h),o.substr(h,d))},A.iter=function(o){return{cur:0,arr:o,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var w=function(){};g.Lambda=w,w.__name__=["Lambda"],w.fold=function(o,h,d){for(var f=Gn(o)();f.hasNext();){var v=f.next();d=h(v,d)}return d};var C=function(){this.length=0};g.List=C,C.__name__=["List"],C.prototype={add:function(o){var h=[o];this.h==null?this.h=h:this.q[1]=h,this.q=h,this.length++},pop:function(){if(this.h==null)return null;var o=this.h[0];return this.h=this.h[1],this.h==null&&(this.q=null),this.length--,o},isEmpty:function(){return this.h==null},__class__:C},Math.__name__=["Math"];var E=function(){};g.Reflect=E,E.__name__=["Reflect"],E.field=function(o,h){try{return o[h]}catch(d){return d instanceof ie&&(d=d.val),null}},E.callMethod=function(o,h,d){return h.apply(o,d)},E.fields=function(o){var h=[];if(o!=null){var d=Object.prototype.hasOwnProperty;for(var f in o)f!="__id__"&&f!="hx__closures__"&&d.call(o,f)&&h.push(f)}return h},E.isFunction=function(o){return typeof o=="function"&&!(o.__name__||o.__ename__)},E.deleteField=function(o,h){return Object.prototype.hasOwnProperty.call(o,h)?(delete o[h],!0):!1};var L=function(){};g.Std=L,L.__name__=["Std"],L.string=function(o){return Ee.__string_rec(o,"")},L.parseFloat=function(o){return parseFloat(o)};var O=function(){this.b=""};g.StringBuf=O,O.__name__=["StringBuf"],O.prototype={add:function(o){this.b+=L.string(o)},__class__:O};var F=function(){};g.StringTools=F,F.__name__=["StringTools"],F.fastCodeAt=function(o,h){return o.charCodeAt(h)};var B=g.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};B.TNull=["TNull",0],B.TNull.toString=m,B.TNull.__enum__=B,B.TInt=["TInt",1],B.TInt.toString=m,B.TInt.__enum__=B,B.TFloat=["TFloat",2],B.TFloat.toString=m,B.TFloat.__enum__=B,B.TBool=["TBool",3],B.TBool.toString=m,B.TBool.__enum__=B,B.TObject=["TObject",4],B.TObject.toString=m,B.TObject.__enum__=B,B.TFunction=["TFunction",5],B.TFunction.toString=m,B.TFunction.__enum__=B,B.TClass=function(o){var h=["TClass",6,o];return h.__enum__=B,h.toString=m,h},B.TEnum=function(o){var h=["TEnum",7,o];return h.__enum__=B,h.toString=m,h},B.TUnknown=["TUnknown",8],B.TUnknown.toString=m,B.TUnknown.__enum__=B;var Z=function(){};g.Type=Z,Z.__name__=["Type"],Z.getClassName=function(o){var h=o.__name__;return h==null?null:h.join(".")},Z.getEnumName=function(o){var h=o.__ename__;return h.join(".")},Z.resolveClass=function(o){var h=g[o];return h==null||!h.__name__?null:h},Z.resolveEnum=function(o){var h=g[o];return h==null||!h.__ename__?null:h},Z.createEmptyInstance=function(o){function h(){}return h.prototype=o.prototype,new h},Z.createEnum=function(o,h,d){var f=E.field(o,h);if(f==null)throw new ie("No such constructor "+h);if(E.isFunction(f)){if(d==null)throw new ie("Constructor "+h+" need parameters");return E.callMethod(o,f,d)}if(d!=null&&d.length!=0)throw new ie("Constructor "+h+" does not need parameters");return f},Z.getEnumConstructs=function(o){var h=o.__constructs__;return h.slice()},Z.typeof=function(o){var h=typeof o;switch(h){case"boolean":return B.TBool;case"string":return B.TClass(String);case"number":return Math.ceil(o)==o%2147483648?B.TInt:B.TFloat;case"object":if(o==null)return B.TNull;var d=o.__enum__;if(d!=null)return B.TEnum(d);var f=Ee.getClass(o);return f!=null?B.TClass(f):B.TObject;case"function":return o.__name__||o.__ename__?B.TObject:B.TFunction;case"undefined":return B.TNull;default:return B.TUnknown}};var W=function(){};g["haxe.IMap"]=W,W.__name__=["haxe","IMap"];var Q=function(o,h){this.high=o,this.low=h};g["haxe._Int64.___Int64"]=Q,Q.__name__=["haxe","_Int64","___Int64"],Q.prototype={__class__:Q};var ye=function(){this.buf=new O,this.cache=[],this.useCache=ye.USE_CACHE,this.useEnumIndex=ye.USE_ENUM_INDEX,this.shash=new Ge,this.scount=0};g["haxe.Serializer"]=ye,ye.__name__=["haxe","Serializer"],ye.prototype={toString:function(){return this.buf.b},serializeString:function(o){var h=this.shash.get(o);if(h!=null){this.buf.b+="R",h==null?this.buf.b+="null":this.buf.b+=""+h;return}this.shash.set(o,this.scount++),this.buf.b+="y",o=encodeURIComponent(o),o.length==null?this.buf.b+="null":this.buf.b+=""+o.length,this.buf.b+=":",o==null?this.buf.b+="null":this.buf.b+=""+o},serializeRef:function(o){for(var h=typeof o,d=0,f=this.cache.length;d<f;){var v=d++,b=this.cache[v];if(typeof b==h&&b==o)return this.buf.b+="r",v==null?this.buf.b+="null":this.buf.b+=""+v,!0}return this.cache.push(o),!1},serializeFields:function(o){for(var h=0,d=E.fields(o);h<d.length;){var f=d[h];++h,this.serializeString(f),this.serialize(E.field(o,f))}this.buf.b+="g"},serialize:function(o){{var h=Z.typeof(o);switch(h[1]){case 0:this.buf.b+="n";break;case 1:var d=o;if(d==0){this.buf.b+="z";return}this.buf.b+="i",d==null?this.buf.b+="null":this.buf.b+=""+d;break;case 2:var f=o;isNaN(f)?this.buf.b+="k":isFinite(f)?(this.buf.b+="d",f==null?this.buf.b+="null":this.buf.b+=""+f):f<0?this.buf.b+="m":this.buf.b+="p";break;case 3:o?this.buf.b+="t":this.buf.b+="f";break;case 6:var v=h[2];if(v==String){this.serializeString(o);return}if(this.useCache&&this.serializeRef(o))return;switch(v){case Array:var b=0;this.buf.b+="a";for(var S=o.length,I=0;I<S;){var k=I++;o[k]==null?b++:(b>0&&(b==1?this.buf.b+="n":(this.buf.b+="u",b==null?this.buf.b+="null":this.buf.b+=""+b),b=0),this.serialize(o[k]))}b>0&&(b==1?this.buf.b+="n":(this.buf.b+="u",b==null?this.buf.b+="null":this.buf.b+=""+b)),this.buf.b+="h";break;case C:this.buf.b+="l";for(var D=o,R=D.h,N=null;R!=null;){var z;N=R[0],R=R[1],z=N,this.serialize(z)}this.buf.b+="h";break;case Date:var U=o;this.buf.b+="v",this.buf.add(U.getTime());break;case Ge:this.buf.b+="b";for(var V=o,H=V.keys();H.hasNext();){var $=H.next();this.serializeString($),this.serialize(fl[$]!=null?V.getReserved($):V.h[$])}this.buf.b+="h";break;case ge:this.buf.b+="q";for(var K=o,X=K.keys();X.hasNext();){var J=X.next();this.buf.b+=":",J==null?this.buf.b+="null":this.buf.b+=""+J,this.serialize(K.h[J])}this.buf.b+="h";break;case Le:this.buf.b+="M";for(var ee=o,le=ee.keys();le.hasNext();){var de=le.next(),ae=E.field(de,"__id__");E.deleteField(de,"__id__"),this.serialize(de),de.__id__=ae,this.serialize(ee.h[de.__id__])}this.buf.b+="h";break;case Ze:for(var se=o,ue=0,me=se.length-2,xe=new O,Te=ye.BASE64;ue<me;){var ke=se.get(ue++),Ie=se.get(ue++),Pe=se.get(ue++);xe.add(Te.charAt(ke>>2)),xe.add(Te.charAt((ke<<4|Ie>>4)&63)),xe.add(Te.charAt((Ie<<2|Pe>>6)&63)),xe.add(Te.charAt(Pe&63))}if(ue==me){var we=se.get(ue++),Oe=se.get(ue++);xe.add(Te.charAt(we>>2)),xe.add(Te.charAt((we<<4|Oe>>4)&63)),xe.add(Te.charAt(Oe<<2&63))}else if(ue==me+1){var he=se.get(ue++);xe.add(Te.charAt(he>>2)),xe.add(Te.charAt(he<<4&63))}var Be=xe.b;this.buf.b+="s",Be.length==null?this.buf.b+="null":this.buf.b+=""+Be.length,this.buf.b+=":",Be==null?this.buf.b+="null":this.buf.b+=""+Be;break;default:this.useCache&&this.cache.pop(),o.hxSerialize!=null?(this.buf.b+="C",this.serializeString(Z.getClassName(v)),this.useCache&&this.cache.push(o),o.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(Z.getClassName(v)),this.useCache&&this.cache.push(o),this.serializeFields(o))}break;case 4:if(Ee.__instanceof(o,Vh)){var tt=Z.getClassName(o);this.buf.b+="A",this.serializeString(tt)}else if(Ee.__instanceof(o,jh))this.buf.b+="B",this.serializeString(Z.getEnumName(o));else{if(this.useCache&&this.serializeRef(o))return;this.buf.b+="o",this.serializeFields(o)}break;case 7:var bt=h[2];if(this.useCache){if(this.serializeRef(o))return;this.cache.pop()}this.useEnumIndex?this.buf.b+="j":this.buf.b+="w",this.serializeString(Z.getEnumName(bt)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=L.string(o[1])):this.serializeString(o[0]),this.buf.b+=":";var Et=o.length;this.buf.b+=L.string(Et-2);for(var gt=2;gt<Et;){var Tt=gt++;this.serialize(o[Tt])}this.useCache&&this.cache.push(o);break;case 5:throw new ie("Cannot serialize function");default:throw new ie("Cannot serialize "+L.string(o))}}},__class__:ye};var Se=function(o){this.buf=o,this.length=o.length,this.pos=0,this.scache=[],this.cache=[];var h=Se.DEFAULT_RESOLVER;h==null&&(h=Z,Se.DEFAULT_RESOLVER=h),this.setResolver(h)};g["haxe.Unserializer"]=Se,Se.__name__=["haxe","Unserializer"],Se.initCodes=function(){for(var o=[],h=0,d=Se.BASE64.length;h<d;){var f=h++;o[Se.BASE64.charCodeAt(f)]=f}return o},Se.prototype={setResolver:function(o){o==null?this.resolver={resolveClass:function(h){return null},resolveEnum:function(h){return null}}:this.resolver=o},get:function(o){return this.buf.charCodeAt(o)},readDigits:function(){for(var o=0,h=!1,d=this.pos;;){var f=this.buf.charCodeAt(this.pos);if(f!=f)break;if(f==45){if(this.pos!=d)break;h=!0,this.pos++;continue}if(f<48||f>57)break;o=o*10+(f-48),this.pos++}return h&&(o*=-1),o},readFloat:function(){for(var o=this.pos;;){var h=this.buf.charCodeAt(this.pos);if(h>=43&&h<58||h==101||h==69)this.pos++;else break}return L.parseFloat(A.substr(this.buf,o,this.pos-o))},unserializeObject:function(o){for(;;){if(this.pos>=this.length)throw new ie("Invalid object");if(this.buf.charCodeAt(this.pos)==103)break;var h=this.unserialize();if(typeof h!="string")throw new ie("Invalid object key");var d=this.unserialize();o[h]=d}this.pos++},unserializeEnum:function(o,h){if(this.get(this.pos++)!=58)throw new ie("Invalid enum format");var d=this.readDigits();if(d==0)return Z.createEnum(o,h);for(var f=[];d-- >0;)f.push(this.unserialize());return Z.createEnum(o,h,f)},unserialize:function(){var o=this.get(this.pos++);switch(o){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var h=this.readDigits();if(this.get(this.pos++)!=58||this.length-this.pos<h)throw new ie("Invalid string length");var d=A.substr(this.buf,this.pos,h);return this.pos+=h,d=decodeURIComponent(d.split("+").join(" ")),this.scache.push(d),d;case 107:return NaN;case 109:return-1/0;case 112:return 1/0;case 97:this.buf;var f=[];for(this.cache.push(f);;){var v=this.buf.charCodeAt(this.pos);if(v==104){this.pos++;break}if(v==117){this.pos++;var b=this.readDigits();f[f.length+b-1]=null}else f.push(this.unserialize())}return f;case 111:var S={};return this.cache.push(S),this.unserializeObject(S),S;case 114:var I=this.readDigits();if(I<0||I>=this.cache.length)throw new ie("Invalid reference");return this.cache[I];case 82:var k=this.readDigits();if(k<0||k>=this.scache.length)throw new ie("Invalid string reference");return this.scache[k];case 120:throw new ie(this.unserialize());case 99:var D=this.unserialize(),R=this.resolver.resolveClass(D);if(R==null)throw new ie("Class not found "+D);var N=Z.createEmptyInstance(R);return this.cache.push(N),this.unserializeObject(N),N;case 119:var z=this.unserialize(),U=this.resolver.resolveEnum(z);if(U==null)throw new ie("Enum not found "+z);var V=this.unserializeEnum(U,this.unserialize());return this.cache.push(V),V;case 106:var H=this.unserialize(),$=this.resolver.resolveEnum(H);if($==null)throw new ie("Enum not found "+H);this.pos++;var K=this.readDigits(),X=Z.getEnumConstructs($)[K];if(X==null)throw new ie("Unknown enum index "+H+"@"+K);var J=this.unserializeEnum($,X);return this.cache.push(J),J;case 108:var ee=new C;for(this.cache.push(ee),this.buf;this.buf.charCodeAt(this.pos)!=104;)ee.add(this.unserialize());return this.pos++,ee;case 98:var le=new Ge;for(this.cache.push(le),this.buf;this.buf.charCodeAt(this.pos)!=104;){var de=this.unserialize();le.set(de,this.unserialize())}return this.pos++,le;case 113:var ae=new ge;this.cache.push(ae),this.buf;for(var se=this.get(this.pos++);se==58;){var ue=this.readDigits();ae.set(ue,this.unserialize()),se=this.get(this.pos++)}if(se!=104)throw new ie("Invalid IntMap format");return ae;case 77:var me=new Le;for(this.cache.push(me),this.buf;this.buf.charCodeAt(this.pos)!=104;){var xe=this.unserialize();me.set(xe,this.unserialize())}return this.pos++,me;case 118:var Te;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&this.buf.charCodeAt(this.pos+4)==45){var ke=A.substr(this.buf,this.pos,19);Te=A.strDate(ke),this.pos+=19}else{var Ie=this.readFloat(),Pe=new Date;Pe.setTime(Ie),Te=Pe}return this.cache.push(Te),Te;case 115:var we=this.readDigits(),Oe=this.buf;if(this.get(this.pos++)!=58||this.length-this.pos<we)throw new ie("Invalid bytes length");var he=Se.CODES;he==null&&(he=Se.initCodes(),Se.CODES=he);var Be=this.pos,tt=we&3,bt;bt=(we>>2)*3+(tt>=2?tt-1:0);for(var Et=Be+(we-tt),gt=Ze.alloc(bt),Tt=0;Be<Et;){var sn=he[F.fastCodeAt(Oe,Be++)],En=he[F.fastCodeAt(Oe,Be++)];gt.set(Tt++,sn<<2|En>>4);var Kt=he[F.fastCodeAt(Oe,Be++)];gt.set(Tt++,En<<4|Kt>>2);var Ht=he[F.fastCodeAt(Oe,Be++)];gt.set(Tt++,Kt<<6|Ht)}if(tt>=2){var rn=he[F.fastCodeAt(Oe,Be++)],mn=he[F.fastCodeAt(Oe,Be++)];if(gt.set(Tt++,rn<<2|mn>>4),tt==3){var Vn=he[F.fastCodeAt(Oe,Be++)];gt.set(Tt++,mn<<4|Vn>>2)}}return this.pos+=we,this.cache.push(gt),gt;case 67:var as=this.unserialize(),jn=this.resolver.resolveClass(as);if(jn==null)throw new ie("Class not found "+as);var $n=Z.createEmptyInstance(jn);if(this.cache.push($n),$n.hxUnserialize(this),this.get(this.pos++)!=103)throw new ie("Invalid custom data");return $n;case 65:var Wn=this.unserialize(),bs=this.resolver.resolveClass(Wn);if(bs==null)throw new ie("Class not found "+Wn);return bs;case 66:var Qr=this.unserialize(),vr=this.resolver.resolveEnum(Qr);if(vr==null)throw new ie("Enum not found "+Qr);return vr}throw this.pos--,new ie("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:Se};var ge=function(){this.h={}};g["haxe.ds.IntMap"]=ge,ge.__name__=["haxe","ds","IntMap"],ge.__interfaces__=[W],ge.prototype={set:function(o,h){this.h[o]=h},remove:function(o){return this.h.hasOwnProperty(o)?(delete this.h[o],!0):!1},keys:function(){var o=[];for(var h in this.h)this.h.hasOwnProperty(h)&&o.push(h|0);return A.iter(o)},__class__:ge};var Le=function(){this.h={},this.h.__keys__={}};g["haxe.ds.ObjectMap"]=Le,Le.__name__=["haxe","ds","ObjectMap"],Le.__interfaces__=[W],Le.prototype={set:function(o,h){var d=o.__id__||(o.__id__=++Le.count);this.h[d]=h,this.h.__keys__[d]=o},keys:function(){var o=[];for(var h in this.h.__keys__)this.h.hasOwnProperty(h)&&o.push(this.h.__keys__[h]);return A.iter(o)},__class__:Le};var Je=g["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};Je.Some=function(o){var h=["Some",0,o];return h.__enum__=Je,h.toString=m,h},Je.None=["None",1],Je.None.toString=m,Je.None.__enum__=Je;var Ge=function(){this.h={}};g["haxe.ds.StringMap"]=Ge,Ge.__name__=["haxe","ds","StringMap"],Ge.__interfaces__=[W],Ge.prototype={set:function(o,h){fl[o]!=null?this.setReserved(o,h):this.h[o]=h},get:function(o){return fl[o]!=null?this.getReserved(o):this.h[o]},setReserved:function(o,h){this.rh==null&&(this.rh={}),this.rh["$"+o]=h},getReserved:function(o){return this.rh==null?null:this.rh["$"+o]},keys:function(){var o=this.arrayKeys();return A.iter(o)},arrayKeys:function(){var o=[];for(var h in this.h)this.h.hasOwnProperty(h)&&o.push(h);if(this.rh!=null)for(var h in this.rh)h.charCodeAt(0)==36&&o.push(h.substr(1));return o},__class__:Ge};var Ze=function(o){this.length=o.byteLength,this.b=new gl(o),this.b.bufferValue=o,o.hxBytes=this,o.bytes=this.b};g["haxe.io.Bytes"]=Ze,Ze.__name__=["haxe","io","Bytes"],Ze.alloc=function(o){return new Ze(new Ha(o))},Ze.prototype={get:function(o){return this.b[o]},set:function(o,h){this.b[o]=h&255},__class__:Ze};var Fe=g["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};Fe.Blocked=["Blocked",0],Fe.Blocked.toString=m,Fe.Blocked.__enum__=Fe,Fe.Overflow=["Overflow",1],Fe.Overflow.toString=m,Fe.Overflow.__enum__=Fe,Fe.OutsideBounds=["OutsideBounds",2],Fe.OutsideBounds.toString=m,Fe.OutsideBounds.__enum__=Fe,Fe.Custom=function(o){var h=["Custom",3,o];return h.__enum__=Fe,h.toString=m,h};var Xe=function(){};g["haxe.io.FPHelper"]=Xe,Xe.__name__=["haxe","io","FPHelper"],Xe.i32ToFloat=function(o){var h=1-(o>>>31<<1),d=o>>>23&255,f=o&8388607;return f==0&&d==0?0:h*(1+Math.pow(2,-23)*f)*Math.pow(2,d-127)},Xe.floatToI32=function(o){if(o==0)return 0;var h;o<0?h=-o:h=o;var d=Math.floor(Math.log(h)/.6931471805599453);d<-127?d=-127:d>128&&(d=128);var f=Math.round((h/Math.pow(2,d)-1)*8388608)&8388607;return(o<0?-2147483648:0)|d+127<<23|f},Xe.i64ToDouble=function(o,h){var d=1-(h>>>31<<1),f=(h>>20&2047)-1023,v=(h&1048575)*4294967296+(o>>>31)*2147483648+(o&2147483647);return v==0&&f==-1023?0:d*(1+Math.pow(2,-52)*v)*Math.pow(2,f)},Xe.doubleToI64=function(o){var h=Xe.i64tmp;if(o==0)h.low=0,h.high=0;else{var d;o<0?d=-o:d=o;var f=Math.floor(Math.log(d)/.6931471805599453),v,b=(d/Math.pow(2,f)-1)*4503599627370496;v=Math.round(b);var S=v|0,I=v/4294967296|0;h.low=S,h.high=(o<0?-2147483648:0)|f+1023<<20|I}return h};var ie=function(o){Error.call(this),this.val=o,this.message=String(o),Error.captureStackTrace&&Error.captureStackTrace(this,ie)};g["js._Boot.HaxeError"]=ie,ie.__name__=["js","_Boot","HaxeError"],ie.__super__=Error,ie.prototype=y(Error.prototype,{__class__:ie});var Ee=function(){};g["js.Boot"]=Ee,Ee.__name__=["js","Boot"],Ee.getClass=function(o){if(o instanceof Array&&o.__enum__==null)return Array;var h=o.__class__;if(h!=null)return h;var d=Ee.__nativeClassName(o);return d!=null?Ee.__resolveNativeClass(d):null},Ee.__string_rec=function(o,h){if(o==null)return"null";if(h.length>=5)return"<...>";var d=typeof o;switch(d=="function"&&(o.__name__||o.__ename__)&&(d="object"),d){case"object":if(o instanceof Array){if(o.__enum__){if(o.length==2)return o[0];var f=o[0]+"(";h+="	";for(var v=2,b=o.length;v<b;){var S=v++;S!=2?f+=","+Ee.__string_rec(o[S],h):f+=Ee.__string_rec(o[S],h)}return f+")"}var I=o.length,k="[";h+="	";for(var D=0;D<I;){var R=D++;k+=(R>0?",":"")+Ee.__string_rec(o[R],h)}return k+="]",k}var N;try{N=o.toString}catch($){return $ instanceof ie&&($=$.val),"???"}if(N!=null&&N!=Object.toString&&typeof N=="function"){var z=o.toString();if(z!="[object Object]")return z}var U=null,V=`{
`;h+="	";var H=o.hasOwnProperty!=null;for(var U in o)H&&!o.hasOwnProperty(U)||U=="prototype"||U=="__class__"||U=="__super__"||U=="__interfaces__"||U=="__properties__"||(V.length!=2&&(V+=`, 
`),V+=h+U+" : "+Ee.__string_rec(o[U],h));return h=h.substring(1),V+=`
`+h+"}",V;case"function":return"<function>";case"string":return o;default:return String(o)}},Ee.__interfLoop=function(o,h){if(o==null)return!1;if(o==h)return!0;var d=o.__interfaces__;if(d!=null)for(var f=0,v=d.length;f<v;){var b=f++,S=d[b];if(S==h||Ee.__interfLoop(S,h))return!0}return Ee.__interfLoop(o.__super__,h)},Ee.__instanceof=function(o,h){if(h==null)return!1;switch(h){case L0:return(o|0)===o;case Uh:return typeof o=="number";case Gh:return typeof o=="boolean";case String:return typeof o=="string";case Array:return o instanceof Array&&o.__enum__==null;case O0:return!0;default:if(o!=null){if(typeof h=="function"){if(o instanceof h||Ee.__interfLoop(Ee.getClass(o),h))return!0}else if(typeof h=="object"&&Ee.__isNativeObj(h)&&o instanceof h)return!0}else return!1;return h==Vh&&o.__name__!=null||h==jh&&o.__ename__!=null?!0:o.__enum__==h}},Ee.__nativeClassName=function(o){var h=Ee.__toStr.call(o).slice(8,-1);return h=="Object"||h=="Function"||h=="Math"||h=="JSON"?null:h},Ee.__isNativeObj=function(o){return Ee.__nativeClassName(o)!=null},Ee.__resolveNativeClass=function(o){return p[o]};var et=function(o){if(o instanceof Array&&o.__enum__==null)this.a=o,this.byteLength=o.length;else{var h=o;this.a=[];for(var d=0;d<h;){var f=d++;this.a[f]=0}this.byteLength=h}};g["js.html.compat.ArrayBuffer"]=et,et.__name__=["js","html","compat","ArrayBuffer"],et.sliceImpl=function(o,h){var d=new gl(this,o,h==null?null:h-o),f=new Ha(d.byteLength),v=new gl(f);return v.set(d),f},et.prototype={slice:function(o,h){return new et(this.a.slice(o,h))},__class__:et};var Me=function(o,h,d){if(this.buf=o,h==null?this.offset=0:this.offset=h,d==null?this.length=o.byteLength-this.offset:this.length=d,this.offset<0||this.length<0||this.offset+this.length>o.byteLength)throw new ie(Fe.OutsideBounds)};g["js.html.compat.DataView"]=Me,Me.__name__=["js","html","compat","DataView"],Me.prototype={getInt8:function(o){var h=this.buf.a[this.offset+o];return h>=128?h-256:h},getUint8:function(o){return this.buf.a[this.offset+o]},getInt16:function(o,h){var d=this.getUint16(o,h);return d>=32768?d-65536:d},getUint16:function(o,h){return h?this.buf.a[this.offset+o]|this.buf.a[this.offset+o+1]<<8:this.buf.a[this.offset+o]<<8|this.buf.a[this.offset+o+1]},getInt32:function(o,h){var d=this.offset+o,f=this.buf.a[d++],v=this.buf.a[d++],b=this.buf.a[d++],S=this.buf.a[d++];return h?f|v<<8|b<<16|S<<24:S|b<<8|v<<16|f<<24},getUint32:function(o,h){var d=this.getInt32(o,h);return d<0?d+4294967296:d},getFloat32:function(o,h){return Xe.i32ToFloat(this.getInt32(o,h))},getFloat64:function(o,h){var d=this.getInt32(o,h),f=this.getInt32(o+4,h);return Xe.i64ToDouble(h?d:f,h?f:d)},setInt8:function(o,h){h<0?this.buf.a[o+this.offset]=h+128&255:this.buf.a[o+this.offset]=h&255},setUint8:function(o,h){this.buf.a[o+this.offset]=h&255},setInt16:function(o,h,d){this.setUint16(o,h<0?h+65536:h,d)},setUint16:function(o,h,d){var f=o+this.offset;d?(this.buf.a[f]=h&255,this.buf.a[f++]=h>>8&255):(this.buf.a[f++]=h>>8&255,this.buf.a[f]=h&255)},setInt32:function(o,h,d){this.setUint32(o,h,d)},setUint32:function(o,h,d){var f=o+this.offset;d?(this.buf.a[f++]=h&255,this.buf.a[f++]=h>>8&255,this.buf.a[f++]=h>>16&255,this.buf.a[f++]=h>>>24):(this.buf.a[f++]=h>>>24,this.buf.a[f++]=h>>16&255,this.buf.a[f++]=h>>8&255,this.buf.a[f++]=h&255)},setFloat32:function(o,h,d){this.setUint32(o,Xe.floatToI32(h),d)},setFloat64:function(o,h,d){var f=Xe.doubleToI64(h);d?(this.setUint32(o,f.low),this.setUint32(o,f.high)):(this.setUint32(o,f.high),this.setUint32(o,f.low))},__class__:Me};var He=function(){};g["js.html.compat.Uint8Array"]=He,He.__name__=["js","html","compat","Uint8Array"],He._new=function(o,h,d){var f;if(typeof o=="number"){f=[];for(var v=0;v<o;){var b=v++;f[b]=0}f.byteLength=f.length,f.byteOffset=0,f.buffer=new et(f)}else if(Ee.__instanceof(o,et)){var S=o;h==null&&(h=0),d==null&&(d=S.byteLength-h),h==0?f=S.a:f=S.a.slice(h,h+d),f.byteLength=f.length,f.byteOffset=h,f.buffer=S}else if(o instanceof Array&&o.__enum__==null)f=o.slice(),f.byteLength=f.length,f.byteOffset=0,f.buffer=new et(f);else throw new ie("TODO "+L.string(o));return f.subarray=He._subarray,f.set=He._set,f},He._set=function(o,h){var d=this;if(Ee.__instanceof(o.buffer,et)){var f=o;if(o.byteLength+h>d.byteLength)throw new ie("set() outside of range");for(var v=0,b=o.byteLength;v<b;){var S=v++;d[S+h]=f[S]}}else if(o instanceof Array&&o.__enum__==null){var I=o;if(I.length+h>d.byteLength)throw new ie("set() outside of range");for(var k=0,D=I.length;k<D;){var R=k++;d[R+h]=I[R]}}else throw new ie("TODO")},He._subarray=function(o,h){var d=this,f=He._new(d.slice(o,h));return f.byteOffset=o,f};var qe=function(o){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,o!=null&&qe.link(o,this,function(h){return h})};g["promhx.base.AsyncBase"]=qe,qe.__name__=["promhx","base","AsyncBase"],qe.link=function(o,h,d){o._update.push({async:h,linkf:function(f){h.handleResolve(d(f))}}),qe.immediateLinkUpdate(o,h,d)},qe.immediateLinkUpdate=function(o,h,d){if(o._errored&&!o._errorPending&&!(o._error.length>0)&&h.handleError(o._errorVal),o._resolved&&!o._pending)try{h.handleResolve(d(o._val))}catch(f){f instanceof ie&&(f=f.val),h.handleError(f)}},qe.linkAll=function(o,h){for(var d=function(b,S,I){if(b.length==0||qe.allFulfilled(b)){for(var k,D=[],R=Gn(o)();R.hasNext();){var N=R.next();D.push(N==S?I:N._val)}k=D,h.handleResolve(k)}},f=Gn(o)();f.hasNext();){var v=f.next();v._update.push({async:h,linkf:function(b,S,I){return function(k){b(S,I,k)}}(d,function(b){for(var S,I=[],k=Gn(o)();k.hasNext();){var D=k.next();D!=v&&I.push(D)}return S=I,S}(),v)})}qe.allFulfilled(o)&&h.handleResolve(function(b){for(var S,I=[],k=Gn(o)();k.hasNext();){var D=k.next();I.push(D._val)}return S=I,S}())},qe.pipeLink=function(o,h,d){var f=!1,v=function(b){if(!f){f=!0;var S=d(b);S._update.push({async:h,linkf:gn(h,h.handleResolve)}),qe.immediateLinkUpdate(S,h,function(I){return I})}};if(o._update.push({async:h,linkf:v}),o._resolved&&!o._pending)try{v(o._val)}catch(b){b instanceof ie&&(b=b.val),h.handleError(b)}},qe.allResolved=function(o){for(var h=Gn(o)();h.hasNext();){var d=h.next();if(!d._resolved)return!1}return!0},qe.allFulfilled=function(o){for(var h=Gn(o)();h.hasNext();){var d=h.next();if(!d._fulfilled)return!1}return!0},qe.prototype={catchError:function(o){return this._error.push(o),this},errorThen:function(o){return this._errorMap=o,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return this._error.length>0},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(o){this._resolve(o)},_resolve:function(o){var h=this;this._pending?Re.enqueue(function(d,f){return function(){d(f)}}(gn(this,this._resolve),o)):(this._resolved=!0,this._pending=!0,Re.queue.add(function(){h._val=o;for(var d=0,f=h._update;d<f.length;){var v=f[d];++d;try{v.linkf(o)}catch(b){b instanceof ie&&(b=b.val),v.async.handleError(b)}}h._fulfilled=!0,h._pending=!1}),Re.continueOnNextLoop())},handleError:function(o){this._handleError(o)},_handleError:function(o){var h=this,d=function(f){if(h._error.length>0)for(var v=0,b=h._error;v<b.length;){var S=b[v];++v,S(f)}else if(h._update.length>0)for(var I=0,k=h._update;I<k.length;){var D=k[I];++I,D.async.handleError(f)}else throw new ie(f);h._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=o,Re.queue.add(function(){if(h._errorMap!=null)try{h._resolve(h._errorMap(o))}catch(f){f instanceof ie&&(f=f.val),d(f)}else d(o)}),Re.continueOnNextLoop())},then:function(o){var h=new qe(null);return qe.link(this,h,o),h},unlink:function(o){var h=this;Re.queue.add(function(){h._update=h._update.filter(function(d){return d.async!=o})}),Re.continueOnNextLoop()},isLinked:function(o){for(var h=!1,d=0,f=this._update;d<f.length;){var v=f[d];if(++d,v.async==o)return!0}return h},__class__:qe};var zn=u.promhx.Deferred=function(){qe.call(this)};g["promhx.Deferred"]=zn,zn.__name__=["promhx","Deferred"],zn.__super__=qe,zn.prototype=y(qe.prototype,{resolve:function(o){this.handleResolve(o)},throwError:function(o){this.handleError(o)},promise:function(){return new Mt(this)},stream:function(){return new pt(this)},publicStream:function(){return new pn(this)},__class__:zn});var Mt=u.promhx.Promise=function(o){qe.call(this,o),this._rejected=!1};g["promhx.Promise"]=Mt,Mt.__name__=["promhx","Promise"],Mt.whenAll=function(o){var h=new Mt(null);return qe.linkAll(o,h),h},Mt.promise=function(o){var h=new Mt;return h.handleResolve(o),h},Mt.__super__=qe,Mt.prototype=y(qe.prototype,{isRejected:function(){return this._rejected},reject:function(o){this._rejected=!0,this.handleError(o)},handleResolve:function(o){if(this._resolved){var h="Promise has already been resolved";throw new ie(Ls.AlreadyResolved(h))}this._resolve(o)},then:function(o){var h=new Mt(null);return qe.link(this,h,o),h},unlink:function(o){var h=this;Re.queue.add(function(){if(h._fulfilled)h._update=h._update.filter(function(f){return f.async!=o});else{var d="Downstream Promise is not fullfilled";h.handleError(Ls.DownstreamNotFullfilled(d))}}),Re.continueOnNextLoop()},handleError:function(o){this._rejected=!0,this._handleError(o)},pipe:function(o){var h=new Mt(null);return qe.pipeLink(this,h,o),h},errorPipe:function(o){var h=new Mt;return this.catchError(function(d){var f=o(d);f.then(gn(h,h._resolve))}),this.then(gn(h,h._resolve)),h},__class__:Mt});var pt=u.promhx.Stream=function(o){qe.call(this,o),this._end_promise=new Mt};g["promhx.Stream"]=pt,pt.__name__=["promhx","Stream"],pt.foreach=function(o){for(var h=new pt(null),d=Gn(o)();d.hasNext();){var f=d.next();h.handleResolve(f)}return h.end(),h},pt.wheneverAll=function(o){var h=new pt(null);return qe.linkAll(o,h),h},pt.concatAll=function(o){for(var h=new pt(null),d=Gn(o)();d.hasNext();){var f=d.next();h.concat(f)}return h},pt.mergeAll=function(o){for(var h=new pt(null),d=Gn(o)();d.hasNext();){var f=d.next();h.merge(f)}return h},pt.stream=function(o){var h=new pt(null);return h.handleResolve(o),h},pt.__super__=qe,pt.prototype=y(qe.prototype,{then:function(o){var h=new pt(null);return qe.link(this,h,o),this._end_promise._update.push({async:h._end_promise,linkf:function(d){h.end()}}),h},detachStream:function(o){for(var h=[],d=!1,f=0,v=this._update;f<v.length;){var b=v[f];++f,b.async==o?(this._end_promise._update=this._end_promise._update.filter(function(S){return S.async!=o._end_promise}),d=!0):h.push(b)}return this._update=h,d},first:function(){var o=new Mt(null);return this.then(function(h){o._resolved||o.handleResolve(h)}),o},handleResolve:function(o){!this._end&&!this._pause&&this._resolve(o)},pause:function(o){o==null&&(o=!this._pause),this._pause=o},pipe:function(o){var h=new pt(null);return qe.pipeLink(this,h,o),this._end_promise.then(function(d){h.end()}),h},errorPipe:function(o){var h=new pt(null);return this.catchError(function(d){var f=o(d);f.then(gn(h,h._resolve)),f._end_promise.then((pl=h._end_promise,gn(pl,pl._resolve)))}),this.then(gn(h,h._resolve)),this._end_promise.then(function(d){h.end()}),h},handleEnd:function(){if(this._pending)Re.queue.add(gn(this,this.handleEnd)),Re.continueOnNextLoop();else{if(this._end_promise._resolved)return;this._end=!0;var o;this._resolved?o=Je.Some(this._val):o=Je.None,this._end_promise.handleResolve(o),this._update=[],this._error=[]}},end:function(){return Re.queue.add(gn(this,this.handleEnd)),Re.continueOnNextLoop(),this},endThen:function(o){return this._end_promise.then(o)},filter:function(o){var h=new pt(null);return this._update.push({async:h,linkf:function(d){o(d)&&h.handleResolve(d)}}),qe.immediateLinkUpdate(this,h,function(d){return d}),h},concat:function(o){var h=new pt(null);return this._update.push({async:h,linkf:gn(h,h.handleResolve)}),qe.immediateLinkUpdate(this,h,function(d){return d}),this._end_promise.then(function(d){o.pipe(function(f){return h.handleResolve(f),h}),o._end_promise.then(function(f){h.end()})}),h},merge:function(o){var h=new pt(null);return this._update.push({async:h,linkf:gn(h,h.handleResolve)}),o._update.push({async:h,linkf:gn(h,h.handleResolve)}),qe.immediateLinkUpdate(this,h,function(d){return d}),qe.immediateLinkUpdate(o,h,function(d){return d}),h},__class__:pt});var pn=u.promhx.PublicStream=function(o){pt.call(this,o)};g["promhx.PublicStream"]=pn,pn.__name__=["promhx","PublicStream"],pn.publicstream=function(o){var h=new pn(null);return h.handleResolve(o),h},pn.__super__=pt,pn.prototype=y(pt.prototype,{resolve:function(o){this.handleResolve(o)},throwError:function(o){this.handleError(o)},update:function(o){this.handleResolve(o)},__class__:pn});var Re=function(){};g["promhx.base.EventLoop"]=Re,Re.__name__=["promhx","base","EventLoop"],Re.enqueue=function(o){Re.queue.add(o),Re.continueOnNextLoop()},Re.set_nextLoop=function(o){if(Re.nextLoop!=null)throw new ie("nextLoop has already been set");return Re.nextLoop=o,Re.nextLoop},Re.queueEmpty=function(){return Re.queue.isEmpty()},Re.finish=function(o){o==null&&(o=1e3);for(var h=null;o-- >0&&(h=Re.queue.pop())!=null;)h();return Re.queue.isEmpty()},Re.clear=function(){Re.queue=new C},Re.f=function(){var o=Re.queue.pop();o!=null&&o(),Re.queue.isEmpty()||Re.continueOnNextLoop()},Re.continueOnNextLoop=function(){Re.nextLoop!=null?Re.nextLoop(Re.f):setImmediate(Re.f)};var Ls=g["promhx.error.PromiseError"]={__ename__:["promhx","error","PromiseError"],__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};Ls.AlreadyResolved=function(o){var h=["AlreadyResolved",0,o];return h.__enum__=Ls,h.toString=m,h},Ls.DownstreamNotFullfilled=function(o){var h=["DownstreamNotFullfilled",1,o];return h.__enum__=Ls,h.toString=m,h};var jr=function(){};g["verb.Verb"]=jr,jr.__name__=["verb","Verb"],jr.main=function(){c.log("verb 2.1.0")};var ce=function(){};g["verb.core.ArrayExtensions"]=ce,ce.__name__=["verb","core","ArrayExtensions"],ce.alloc=function(o,h){if(!(h<0))for(;o.length<h;)o.push(null)},ce.reversed=function(o){var h=o.slice();return h.reverse(),h},ce.last=function(o){return o[o.length-1]},ce.first=function(o){return o[0]},ce.spliceAndInsert=function(o,h,d,f){o.splice(h,d),o.splice(h,0,f)},ce.left=function(o){if(o.length==0)return[];var h=Math.ceil(o.length/2);return o.slice(0,h)},ce.right=function(o){if(o.length==0)return[];var h=Math.ceil(o.length/2);return o.slice(h)},ce.rightWithPivot=function(o){if(o.length==0)return[];var h=Math.ceil(o.length/2);return o.slice(h-1)},ce.unique=function(o,h){if(o.length==0)return[];for(var d=[o.pop()];o.length>0;){for(var f=o.pop(),v=!0,b=0;b<d.length;){var S=d[b];if(++b,h(f,S)){v=!1;break}}v&&d.push(f)}return d};var rt=function(){};g["verb.core.Binomial"]=rt,rt.__name__=["verb","core","Binomial"],rt.get=function(o,h){if(h==0)return 1;if(o==0||h>o)return 0;if(h>o-h&&(h=o-h),rt.memo_exists(o,h))return rt.get_memo(o,h);for(var d=1,f=o,v=1,b=h+1;v<b;){var S=v++;if(rt.memo_exists(f,S)){o--,d=rt.get_memo(f,S);continue}d*=o--,d/=S,rt.memoize(f,S,d)}return d},rt.get_no_memo=function(o,h){if(h==0)return 1;if(o==0||h>o)return 0;h>o-h&&(h=o-h);for(var d=1,f=1,v=h+1;f<v;){var b=f++;d*=o--,d/=b}return d},rt.memo_exists=function(o,h){return rt.memo.h.hasOwnProperty(o)&&rt.memo.h[o].h.hasOwnProperty(h)},rt.get_memo=function(o,h){return rt.memo.h[o].h[h]},rt.memoize=function(o,h,d){rt.memo.h.hasOwnProperty(o)||rt.memo.set(o,new ge),rt.memo.h[o].h[h]=d};var wt=u.core.BoundingBox=function(o){this.max=null,this.min=null,this.dim=3,this.initialized=!1,o!=null&&this.addRange(o)};g["verb.core.BoundingBox"]=wt,wt.__name__=["verb","core","BoundingBox"],wt.intervalsOverlap=function(o,h,d,f,v){v==null&&(v=-1);var b;v<-.5?b=ve.TOLERANCE:b=v;var S=Math.min(o,h)-b,I=Math.max(o,h)+b,k=Math.min(d,f)-b,D=Math.max(d,f)+b;return S>=k&&S<=D||I>=k&&I<=D||k>=S&&k<=I||D>=S&&D<=I},wt.prototype={fromPoint:function(o){return new wt([o])},add:function(o){if(!this.initialized)return this.dim=o.length,this.min=o.slice(0),this.max=o.slice(0),this.initialized=!0,this;for(var h=0,d=this.dim;h<d;){var f=h++;o[f]>this.max[f]&&(this.max[f]=o[f]),o[f]<this.min[f]&&(this.min[f]=o[f])}return this},addRange:function(o){for(var h=o.length,d=0;d<h;){var f=d++;this.add(o[f])}return this},contains:function(o,h){return h==null&&(h=-1),this.initialized?this.intersects(new wt([o]),h):!1},intersects:function(o,h){if(h==null&&(h=-1),!this.initialized||!o.initialized)return!1;for(var d=this.min,f=this.max,v=o.min,b=o.max,S=0,I=this.dim;S<I;){var k=S++;if(!wt.intervalsOverlap(d[k],f[k],v[k],b[k],h))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var o=0,h=0,d=0,f=this.dim;d<f;){var v=d++,b=this.getAxisLength(v);b>o&&(o=b,h=v)}return h},getAxisLength:function(o){return o<0||o>this.dim-1?0:Math.abs(this.min[o]-this.max[o])},intersect:function(o,h){if(!this.initialized)return null;var d=this.min,f=this.max,v=o.min,b=o.max;if(!this.intersects(o,h))return null;for(var S=[],I=[],k=0,D=this.dim;k<D;){var R=k++;S.push(Math.min(f[R],b[R])),I.push(Math.max(d[R],v[R]))}return new wt([I,S])},__class__:wt};var ve=u.core.Constants=function(){};g["verb.core.Constants"]=ve,ve.__name__=["verb","core","Constants"];var St=u.core.SerializableBase=function(){};g["verb.core.SerializableBase"]=St,St.__name__=["verb","core","SerializableBase"],St.prototype={serialize:function(){var o=new ye;return o.serialize(this),o.toString()},__class__:St};var _=u.core.Plane=function(o,h){this.origin=o,this.normal=h};g["verb.core.Plane"]=_,_.__name__=["verb","core","Plane"],_.__super__=St,_.prototype=y(St.prototype,{__class__:_});var T=u.core.Ray=function(o,h){this.origin=o,this.dir=h};g["verb.core.Ray"]=T,T.__name__=["verb","core","Ray"],T.__super__=St,T.prototype=y(St.prototype,{__class__:T});var P=u.core.NurbsCurveData=function(o,h,d){this.degree=o,this.controlPoints=d,this.knots=h};g["verb.core.NurbsCurveData"]=P,P.__name__=["verb","core","NurbsCurveData"],P.__super__=St,P.prototype=y(St.prototype,{__class__:P});var G=u.core.NurbsSurfaceData=function(o,h,d,f,v){this.degreeU=o,this.degreeV=h,this.knotsU=d,this.knotsV=f,this.controlPoints=v};g["verb.core.NurbsSurfaceData"]=G,G.__name__=["verb","core","NurbsSurfaceData"],G.__super__=St,G.prototype=y(St.prototype,{__class__:G});var Y=u.core.MeshData=function(o,h,d,f){this.faces=o,this.points=h,this.normals=d,this.uvs=f};g["verb.core.MeshData"]=Y,Y.__name__=["verb","core","MeshData"],Y.empty=function(){return new Y([],[],[],[])},Y.__super__=St,Y.prototype=y(St.prototype,{__class__:Y});var ne=u.core.PolylineData=function(o,h){this.points=o,this.params=h};g["verb.core.PolylineData"]=ne,ne.__name__=["verb","core","PolylineData"],ne.__super__=St,ne.prototype=y(St.prototype,{__class__:ne});var Ae=u.core.VolumeData=function(o,h,d,f,v,b,S){this.degreeU=o,this.degreeV=h,this.degreeW=d,this.knotsU=f,this.knotsV=v,this.knotsW=b,this.controlPoints=S};g["verb.core.VolumeData"]=Ae,Ae.__name__=["verb","core","VolumeData"],Ae.__super__=St,Ae.prototype=y(St.prototype,{__class__:Ae});var ze=u.core.Pair=function(o,h){this.item0=o,this.item1=h};g["verb.core.Pair"]=ze,ze.__name__=["verb","core","Pair"],ze.prototype={__class__:ze};var ct=u.core.Interval=function(o,h){this.min=o,this.max=h};g["verb.core.Interval"]=ct,ct.__name__=["verb","core","Interval"],ct.prototype={__class__:ct};var ht=u.core.CurveCurveIntersection=function(o,h,d,f){this.point0=o,this.point1=h,this.u0=d,this.u1=f};g["verb.core.CurveCurveIntersection"]=ht,ht.__name__=["verb","core","CurveCurveIntersection"],ht.prototype={__class__:ht};var vt=u.core.CurveSurfaceIntersection=function(o,h,d,f){this.u=o,this.uv=h,this.curvePoint=d,this.surfacePoint=f};g["verb.core.CurveSurfaceIntersection"]=vt,vt.__name__=["verb","core","CurveSurfaceIntersection"],vt.prototype={__class__:vt};var At=u.core.MeshIntersectionPoint=function(o,h,d,f,v){this.visited=!1,this.adj=null,this.opp=null,this.uv0=o,this.uv1=h,this.point=d,this.faceIndex0,this.faceIndex1};g["verb.core.MeshIntersectionPoint"]=At,At.__name__=["verb","core","MeshIntersectionPoint"],At.prototype={__class__:At};var ns=u.core.PolylineMeshIntersection=function(o,h,d,f,v){this.point=o,this.u=h,this.uv=d,this.polylineIndex=f,this.faceIndex=v};g["verb.core.PolylineMeshIntersection"]=ns,ns.__name__=["verb","core","PolylineMeshIntersection"],ns.prototype={__class__:ns};var Os=u.core.SurfaceSurfaceIntersectionPoint=function(o,h,d,f){this.uv0=o,this.uv1=h,this.point=d,this.dist=f};g["verb.core.SurfaceSurfaceIntersectionPoint"]=Os,Os.__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],Os.prototype={__class__:Os};var Ds=u.core.TriSegmentIntersection=function(o,h,d,f){this.point=o,this.s=h,this.t=d,this.p=f};g["verb.core.TriSegmentIntersection"]=Ds,Ds.__name__=["verb","core","TriSegmentIntersection"],Ds.prototype={__class__:Ds};var $r=u.core.CurveTriPoint=function(o,h,d){this.u=o,this.point=h,this.uv=d};g["verb.core.CurveTriPoint"]=$r,$r.__name__=["verb","core","CurveTriPoint"],$r.prototype={__class__:$r};var Sn=function(o,h,d,f,v){v==null&&(v=!1),f==null&&(f=-1),this.uv=d,this.point=o,this.normal=h,this.id=f,this.degen=v};g["verb.core.SurfacePoint"]=Sn,Sn.__name__=["verb","core","SurfacePoint"],Sn.fromUv=function(o,h){return new Sn(null,null,[o,h])},Sn.prototype={__class__:Sn};var Wa=u.core.CurvePoint=function(o,h){this.u=o,this.pt=h};g["verb.core.CurvePoint"]=Wa,Wa.__name__=["verb","core","CurvePoint"],Wa.prototype={__class__:Wa};var Fi=u.core.KdTree=function(o,h){this.dim=3,this.points=o,this.distanceFunction=h,this.dim=o[0].point.length,this.root=this.buildTree(o,0,null)};g["verb.core.KdTree"]=Fi,Fi.__name__=["verb","core","KdTree"],Fi.prototype={buildTree:function(o,h,d){var f=h%this.dim,v,b;return o.length==0?null:o.length==1?new Hr(o[0],f,d):(o.sort(function(S,I){var k=S.point[f]-I.point[f];return k==0?0:k>0?1:-1}),v=Math.floor(o.length/2),b=new Hr(o[v],f,d),b.left=this.buildTree(o.slice(0,v),h+1,b),b.right=this.buildTree(o.slice(v+1),h+1,b),b)},nearest:function(o,h,d){var f=this,v=new zi(function(N){return-N.item1}),b,S=null;S=function(N){for(var z,U=N.dimension,V=f.distanceFunction(o,N.kdPoint.point),H,$=[],K=0,X=f.dim;K<X;)K++,$.push(0);H=$;for(var J,ee,le=function(ue,me){v.push(new ze(ue,me)),v.size()>h&&v.pop()},de=0,ae=f.dim;de<ae;){var se=de++;se==N.dimension?H[se]=o[se]:H[se]=N.kdPoint.point[se]}if(J=f.distanceFunction(H,N.kdPoint.point),N.right==null&&N.left==null){(v.size()<h||V<v.peek().item1)&&le(N,V);return}N.right==null?z=N.left:N.left==null?z=N.right:o[U]<N.kdPoint.point[U]?z=N.left:z=N.right,S(z),(v.size()<h||V<v.peek().item1)&&le(N,V),(v.size()<h||Math.abs(J)<v.peek().item1)&&(z==N.left?ee=N.right:ee=N.left,ee!=null&&S(ee))},b=S;for(var I=0;I<h;)I++,v.push(new ze(null,d));b(this.root);for(var k=[],D=0;D<h;){var R=D++;v.content[R].item0!=null&&k.push(new ze(v.content[R].item0.kdPoint,v.content[R].item1))}return k},__class__:Fi};var zi=function(o){this.content=[],this.scoreFunction=o};g["verb.core.BinaryHeap"]=zi,zi.__name__=["verb","core","BinaryHeap"],zi.prototype={push:function(o){this.content.push(o),this.bubbleUp(this.content.length-1)},pop:function(){var o=this.content[0],h=this.content.pop();return this.content.length>0&&(this.content[0]=h,this.sinkDown(0)),o},peek:function(){return this.content[0]},remove:function(o){for(var h=this.content.length,d=0;d<h;){var f=d++;if(this.content[f]==o){var v=this.content.pop();f!=h-1&&(this.content[f]=v,this.scoreFunction(v)<this.scoreFunction(o)?this.bubbleUp(f):this.sinkDown(f));return}}throw new ie("Node not found.")},size:function(){return this.content.length},bubbleUp:function(o){for(var h=this.content[o];o>0;){var d=Math.floor((o+1)/2)-1,f=this.content[d];if(this.scoreFunction(h)<this.scoreFunction(f))this.content[d]=h,this.content[o]=f,o=d;else break}},sinkDown:function(o){for(var h=this.content.length,d=this.content[o],f=this.scoreFunction(d);;){var v=(o+1)*2,b=v-1,S=-1,I=0;if(b<h){var k=this.content[b];I=this.scoreFunction(k),I<f&&(S=b)}if(v<h){var D=this.content[v],R=this.scoreFunction(D);R<(S==-1?f:I)&&(S=v)}if(S!=-1)this.content[o]=this.content[S],this.content[S]=d,o=S;else break}},__class__:zi};var Wr=u.core.KdPoint=function(o,h){this.point=o,this.obj=h};g["verb.core.KdPoint"]=Wr,Wr.__name__=["verb","core","KdPoint"],Wr.prototype={__class__:Wr};var Hr=u.core.KdNode=function(o,h,d){this.kdPoint=o,this.left=null,this.right=null,this.parent=d,this.dimension=h};g["verb.core.KdNode"]=Hr,Hr.__name__=["verb","core","KdNode"],Hr.prototype={__class__:Hr};var ys=function(){};g["verb.eval.IBoundingBoxTree"]=ys,ys.__name__=["verb","eval","IBoundingBoxTree"],ys.prototype={__class__:ys};var ss=function(o,h){this._boundingBox=null,this._curve=o,h==null&&(h=x.domain(this._curve.knots)/64),this._knotTol=h};g["verb.core.LazyCurveBoundingBoxTree"]=ss,ss.__name__=["verb","core","LazyCurveBoundingBoxTree"],ss.__interfaces__=[ys],ss.prototype={split:function(){var o=ce.first(this._curve.knots),h=ce.last(this._curve.knots),d=h-o,f=$t.curveSplit(this._curve,(h+o)/2+d*.1*Math.random());return new ze(new ss(f[0],this._knotTol),new ss(f[1],this._knotTol))},boundingBox:function(){return this._boundingBox==null&&(this._boundingBox=new wt(j.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(o){return x.domain(this._curve.knots)<this._knotTol},empty:function(){return!1},__class__:ss};var rs=function(o,h){if(this._boundingBox=null,this._mesh=o,h==null){for(var d=[],f=0,v=o.faces.length;f<v;){var b=f++;d.push(b)}h=d}this._faceIndices=h};g["verb.core.LazyMeshBoundingBoxTree"]=rs,rs.__name__=["verb","core","LazyMeshBoundingBoxTree"],rs.__interfaces__=[ys],rs.prototype={split:function(){var o=Lt.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),h=ce.left(o),d=ce.right(o);return new ze(new rs(this._mesh,h),new rs(this._mesh,d))},boundingBox:function(){return this._boundingBox==null&&(this._boundingBox=Lt.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(o){return this._faceIndices.length==1},empty:function(){return this._faceIndices.length==0},__class__:rs};var is=function(o,h){this._boundingBox=null,this._polyline=o,h==null&&(h=new ct(0,o.points.length!=0?o.points.length-1:0)),this._interval=h};g["verb.core.LazyPolylineBoundingBoxTree"]=is,is.__name__=["verb","core","LazyPolylineBoundingBoxTree"],is.__interfaces__=[ys],is.prototype={split:function(){var o=this._interval.min,h=this._interval.max,d=o+Math.ceil((h-o)/2),f=new ct(o,d),v=new ct(d,h);return new ze(new is(this._polyline,f),new is(this._polyline,v))},boundingBox:function(){return this._boundingBox==null&&(this._boundingBox=new wt(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(o){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:is};var Bs=function(o,h,d,f){h==null&&(h=!1),this._boundingBox=null,this._surface=o,this._splitV=h,d==null&&(d=x.domain(o.knotsU)/16),f==null&&(f=x.domain(o.knotsV)/16),this._knotTolU=d,this._knotTolV=f};g["verb.core.LazySurfaceBoundingBoxTree"]=Bs,Bs.__name__=["verb","core","LazySurfaceBoundingBoxTree"],Bs.__interfaces__=[ys],Bs.prototype={split:function(){var o,h;this._splitV?(o=ce.first(this._surface.knotsV),h=ce.last(this._surface.knotsV)):(o=ce.first(this._surface.knotsU),h=ce.last(this._surface.knotsU));var d=(o+h)/2,f=$t.surfaceSplit(this._surface,d,this._splitV);return new ze(new Bs(f[0],!this._splitV,this._knotTolU,this._knotTolV),new Bs(f[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(this._boundingBox==null){this._boundingBox=new wt;for(var o=0,h=this._surface.controlPoints;o<h.length;){var d=h[o];++o,this._boundingBox.addRange(j.dehomogenize1d(d))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(o){return x.domain(this._surface.knotsV)<this._knotTolV&&x.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1},__class__:Bs};var ot=u.core.Mat=function(){};g["verb.core.Mat"]=ot,ot.__name__=["verb","core","Mat"],ot.mul=function(o,h){for(var d=[],f=0,v=h.length;f<v;){var b=f++;d.push(x.mul(o,h[b]))}return d},ot.mult=function(o,h){var d,f,v,b,S,I,k,D;d=o.length,f=h.length,v=h[0].length,b=[];for(var R=d-1,N=0,z=0;R>=0;){for(S=[],I=o[R],z=v-1;z>=0;){for(k=I[f-1]*h[f-1][z],N=f-2;N>=1;)D=N-1,k+=I[N]*h[N][z]+I[D]*h[D][z],N-=2;N==0&&(k+=I[0]*h[0][z]),S[z]=k,z--}b[R]=S,R--}return b},ot.add=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(x.add(o[b],h[b]))}return d},ot.div=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(x.div(o[b],h))}return d},ot.sub=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(x.sub(o[b],h[b]))}return d},ot.dot=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(x.dot(o[b],h))}return d},ot.identity=function(o){for(var h=x.zeros2d(o,o),d=0;d<o;){var f=d++;h[f][f]=1}return h},ot.transpose=function(o){if(o.length==0)return[];for(var h=[],d=0,f=o[0].length;d<f;){var v=d++;h.push(function(b){for(var S,I=[],k=0,D=o.length;k<D;){var R=k++;I.push(o[R][v])}return S=I,S}())}return h},ot.solve=function(o,h){return ot.LUsolve(ot.LU(o),h)},ot.LUsolve=function(o,h){var d,f,v=o.LU,b=v.length,S=h.slice(),I=o.P,k,D,R;for(d=b-1;d!=-1;)S[d]=h[d],--d;for(d=0;d<b;){for(k=I[d],I[d]!=d&&(R=S[d],S[d]=S[k],S[k]=R),D=v[d],f=0;f<d;)S[d]-=S[f]*D[f],++f;++d}for(d=b-1;d>=0;){for(D=v[d],f=d+1;f<b;)S[d]-=S[f]*D[f],++f;S[d]/=D[d],--d}return S},ot.LU=function(o){for(var h,d,f,v,b,S,I,k,D,R=[],N=0,z=o.length;N<z;){var U=N++;R.push(o[U].slice())}o=R;var V=o.length,H=V-1,$=[];for(f=0;f<V;){for(I=f,S=o[f],D=Math.abs(S[f]),d=f+1;d<V;)v=Math.abs(o[d][f]),D<v&&(D=v,I=d),++d;for($[f]=I,I!=f&&(o[f]=o[I],o[I]=S,S=o[f]),b=S[f],h=f+1;h<V;)o[h][f]/=b,++h;for(h=f+1;h<V;){for(k=o[h],d=f+1;d<H;)k[d]-=k[f]*S[d],++d,k[d]-=k[f]*S[d],++d;d==H&&(k[d]-=k[f]*S[d]),++h}++f}return new Ui(o,$)};var Ui=function(o,h){this.LU=o,this.P=h};g["verb.core._Mat.LUDecomp"]=Ui,Ui.__name__=["verb","core","_Mat","LUDecomp"],Ui.prototype={__class__:Ui};var Lt=u.core.Mesh=function(){};g["verb.core.Mesh"]=Lt,Lt.__name__=["verb","core","Mesh"],Lt.getTriangleNorm=function(o,h){var d=o[h[0]],f=o[h[1]],v=o[h[2]],b=x.sub(f,d),S=x.sub(v,d),I=x.cross(b,S);return x.mul(1/x.norm(I),I)},Lt.makeMeshAabb=function(o,h){for(var d=new wt,f=0;f<h.length;){var v=h[f];++f,d.add(o.points[o.faces[v][0]]),d.add(o.points[o.faces[v][1]]),d.add(o.points[o.faces[v][2]])}return d},Lt.sortTrianglesOnLongestAxis=function(o,h,d){for(var f=o.getLongestAxis(),v=[],b=0;b<d.length;){var S=d[b];++b;var I=Lt.getMinCoordOnAxis(h.points,h.faces[S],f);v.push(new ze(I,S))}v.sort(function(z,U){var V=z.item0,H=U.item0;return V==H?0:V>H?1:-1});for(var k=[],D=0,R=v.length;D<R;){var N=D++;k.push(v[N].item1)}return k},Lt.getMinCoordOnAxis=function(o,h,d){for(var f=1/0,v=0;v<3;){var b=v++,S=o[h[b]][d];S<f&&(f=S)}return f},Lt.getTriangleCentroid=function(o,h){for(var d=[0,0,0],f=0;f<3;)for(var v=f++,b=0;b<3;){var S=b++;d[S]+=o[h[v]][S]}for(var I=0;I<3;){var k=I++;d[k]/=3}return d},Lt.triangleUVFromPoint=function(o,h,d){var f=o.faces[h],v=o.points[f[0]],b=o.points[f[1]],S=o.points[f[2]],I=o.uvs[f[0]],k=o.uvs[f[1]],D=o.uvs[f[2]],R=x.sub(v,d),N=x.sub(b,d),z=x.sub(S,d),U=x.norm(x.cross(x.sub(v,b),x.sub(v,S))),V=x.norm(x.cross(N,z))/U,H=x.norm(x.cross(z,R))/U,$=x.norm(x.cross(R,N))/U;return x.add(x.mul(V,I),x.add(x.mul(H,k),x.mul($,D)))};var Ns=function(o,h){if(this._empty=!1,this._face=-1,h==null){for(var d=[],f=0,v=o.faces.length;f<v;){var b=f++;d.push(b)}h=d}if(this._boundingBox=Lt.makeMeshAabb(o,h),h.length<1){this._empty=!0;return}else if(h.length<2){this._face=h[0];return}var S=Lt.sortTrianglesOnLongestAxis(this._boundingBox,o,h),I=ce.left(S),k=ce.right(S);this._children=new ze(new Ns(o,I),new Ns(o,k))};g["verb.core.MeshBoundingBoxTree"]=Ns,Ns.__name__=["verb","core","MeshBoundingBoxTree"],Ns.__interfaces__=[ys],Ns.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(o){return this._children==null},empty:function(){return this._empty},__class__:Ns};var Un=u.core.Minimizer=function(){};g["verb.core.Minimizer"]=Un,Un.__name__=["verb","core","Minimizer"],Un.uncmin=function(o,h,d,f,v){d==null&&(d=1e-8),f==null&&(f=function(de){return Un.numericalGradient(o,de)}),v==null&&(v=1e3),h=h.slice(0);var b=h.length,S=o(h),I=S,k;if(isNaN(S))throw new ie("uncmin: f(x0) is a NaN!");d=Math.max(d,ve.EPSILON);var D,R,N,z=ot.identity(b),U=0,V=[],H,$,K,X,J,ee,le="";for(R=f(h);U<v;){if(!x.all(x.finite(R))){le="Gradient has Infinity or NaN";break}if(D=x.neg(ot.dot(z,R)),!x.all(x.finite(D))){le="Search direction has Infinity or NaN";break}if(ee=x.norm(D),ee<d){le="Newton step smaller than tol";break}for(J=1,k=x.dot(R,D),H=h;U<v&&!(J*ee<d);){if(V=x.mul(J,D),H=x.add(h,V),I=o(H),I-S>=.1*J*k||isNaN(I)){J*=.5,++U;continue}break}if(J*ee<d){le="Line search step size smaller than tol";break}if(U==v){le="maxit reached during line search";break}N=f(H),$=x.sub(N,R),X=x.dot($,V),K=ot.dot(z,$),z=ot.sub(ot.add(z,ot.mul((X+x.dot($,K))/(X*X),Un.tensor(V,V))),ot.div(ot.add(Un.tensor(K,V),Un.tensor(V,K)),X)),h=H,S=I,R=N,++U}return new Gi(h,S,R,z,U,le)},Un.numericalGradient=function(o,h){var d=h.length,f=o(h);if(f==NaN)throw new ie("gradient: f(x) is a NaN!");for(var v=h.slice(0),b,S,I=[],k,D=.001,R,N,z,U=0,V,H,$,K=0;K<d;)for(var X=K++,J=Math.max(1e-6*f,1e-8);;){if(++U,U>20)throw new ie("Numerical gradient fails");if(v[X]=h[X]+J,b=o(v),v[X]=h[X]-J,S=o(v),v[X]=h[X],isNaN(b)||isNaN(S)){J/=16;continue}if(I[X]=(b-S)/(2*J),R=h[X]-J,N=h[X],z=h[X]+J,V=(b-f)/J,H=(f-S)/J,$=x.max([Math.abs(I[X]),Math.abs(f),Math.abs(b),Math.abs(S),Math.abs(R),Math.abs(N),Math.abs(z),1e-8]),k=Math.min(x.max([Math.abs(V-I[X]),Math.abs(H-I[X]),Math.abs(V-H)])/$,J/$),k>D)J/=16;else break}return I},Un.tensor=function(o,h){for(var d=o.length,f=h.length,v=[],b,S,I=d-1;I>=0;){b=[],S=o[I];for(var k=f-1;k>=3;)b[k]=S*h[k],--k,b[k]=S*h[k],--k,b[k]=S*h[k],--k,b[k]=S*h[k],--k;for(;k>=0;)b[k]=S*h[k],--k;v[I]=b,I--}return v};var Gi=function(o,h,d,f,v,b){this.solution=o,this.value=h,this.gradient=d,this.invHessian=f,this.iterations=v,this.message=b};g["verb.core.MinimizationResult"]=Gi,Gi.__name__=["verb","core","MinimizationResult"],Gi.prototype={__class__:Gi};var qr=function(){};g["verb.core.ISerializable"]=qr,qr.__name__=["verb","core","ISerializable"],qr.prototype={__class__:qr};var dl=u.core.Deserializer=function(){};g["verb.core.Deserializer"]=dl,dl.__name__=["verb","core","Deserializer"],dl.deserialize=function(o){var h=new Se(o),d=h.unserialize();return d};var fn=u.core.Trig=function(){};g["verb.core.Trig"]=fn,fn.__name__=["verb","core","Trig"],fn.isPointInPlane=function(o,h,d){return Math.abs(x.dot(x.sub(o,h.origin),h.normal))<d},fn.distToSegment=function(o,h,d){var f=fn.segmentClosestPoint(h,o,d,0,1);return x.dist(h,f.pt)},fn.rayClosestPoint=function(o,h,d){var f=x.sub(o,h),v=x.dot(f,d),b=x.add(h,x.mul(v,d));return b},fn.distToRay=function(o,h,d){var f=fn.rayClosestPoint(o,h,d),v=x.sub(f,o);return x.norm(v)},fn.threePointsAreFlat=function(o,h,d,f){var v=x.sub(h,o),b=x.sub(d,o),S=x.cross(v,b),I=x.dot(S,S);return I<f},fn.segmentClosestPoint=function(o,h,d,f,v){var b=x.sub(d,h),S=x.norm(b);if(S<ve.EPSILON)return{u:f,pt:h};var I=h,k=x.mul(1/S,b),D=x.sub(o,I),R=x.dot(D,k);return R<0?{u:f,pt:h}:R>S?{u:v,pt:d}:{u:f+(v-f)*R/S,pt:x.add(I,x.mul(R,k))}};var x=u.core.Vec=function(){};g["verb.core.Vec"]=x,x.__name__=["verb","core","Vec"],x.angleBetween=function(o,h){return Math.acos(x.dot(o,h)/(x.norm(o)*x.norm(h)))},x.positiveAngleBetween=function(o,h,d){var f=x.cross(o,h),v=x.norm(o),b=x.norm(h),S=v*b,I=x.dot(o,h),k=x.norm(f)/S,D=I/S,R=Math.atan2(k,D),N=x.dot(d,f);return Math.abs(N)<ve.EPSILON||N>0?R:-R},x.signedAngleBetween=function(o,h,d){var f=x.cross(o,h),v=x.norm(o),b=x.norm(h),S=v*b,I=x.dot(o,h),k=x.norm(f)/S,D=I/S,R=Math.atan2(k,D),N=x.dot(d,f);return N>0?R:2*Math.PI-R},x.angleBetweenNormalized2d=function(o,h){var d=o[0]*h[1]-o[1]*h[0];return Math.atan2(d,x.dot(o,h))},x.domain=function(o){return ce.last(o)-ce.first(o)},x.range=function(o){for(var h=[],d=0,f=0;f<o;)f++,h.push(d),d+=1;return h},x.span=function(o,h,d){if(d==null)return[];if(d<ve.EPSILON)return[];if(o>h&&d>0)return[];if(h>o&&d<0)return[];for(var f=[],v=o;v<=h;)f.push(v),v+=d;return f},x.neg=function(o){return o.map(function(h){return-h})},x.min=function(o){return w.fold(o,function(h,d){return Math.min(h,d)},1/0)},x.max=function(o){return w.fold(o,function(h,d){return Math.max(h,d)},-1/0)},x.all=function(o){return w.fold(o,function(h,d){return d&&h},!0)},x.finite=function(o){return o.map(function(h){return isFinite(h)})},x.onRay=function(o,h,d){return x.add(o,x.mul(d,h))},x.lerp=function(o,h,d){return x.add(x.mul(o,h),x.mul(1-o,d))},x.normalized=function(o){return x.div(o,x.norm(o))},x.cross=function(o,h){return[o[1]*h[2]-o[2]*h[1],o[2]*h[0]-o[0]*h[2],o[0]*h[1]-o[1]*h[0]]},x.dist=function(o,h){return x.norm(x.sub(o,h))},x.distSquared=function(o,h){return x.normSquared(x.sub(o,h))},x.sum=function(o){return w.fold(o,function(h,d){return d+h},0)},x.addAll=function(o){var h=Gn(o)();if(!h.hasNext())return null;var d=h.next().length;return w.fold(o,function(f,v){return x.add(v,f)},x.rep(d,0))},x.addAllMutate=function(o){for(var h=o[0],d=1,f=o.length;d<f;){var v=d++;x.addMutate(h,o[v])}},x.addMulMutate=function(o,h,d){for(var f=0,v=o.length;f<v;){var b=f++;o[b]=o[b]+h*d[b]}},x.subMulMutate=function(o,h,d){for(var f=0,v=o.length;f<v;){var b=f++;o[b]=o[b]-h*d[b]}},x.addMutate=function(o,h){for(var d=0,f=o.length;d<f;){var v=d++;o[v]=o[v]+h[v]}},x.subMutate=function(o,h){for(var d=0,f=o.length;d<f;){var v=d++;o[v]=o[v]-h[v]}},x.mulMutate=function(o,h){for(var d=0,f=h.length;d<f;){var v=d++;h[v]=h[v]*o}},x.norm=function(o){var h=x.normSquared(o);return h!=0?Math.sqrt(h):h},x.normSquared=function(o){return w.fold(o,function(h,d){return d+h*h},0)},x.rep=function(o,h){for(var d=[],f=0;f<o;)f++,d.push(h);return d},x.zeros1d=function(o){for(var h=[],d=0;d<o;)d++,h.push(0);return h},x.zeros2d=function(o,h){for(var d=[],f=0;f<o;)f++,d.push(x.zeros1d(h));return d},x.zeros3d=function(o,h,d){for(var f=[],v=0;v<o;)v++,f.push(x.zeros2d(h,d));return f},x.dot=function(o,h){for(var d=0,f=0,v=o.length;f<v;){var b=f++;d+=o[b]*h[b]}return d},x.add=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(o[b]+h[b])}return d},x.mul=function(o,h){for(var d=[],f=0,v=h.length;f<v;){var b=f++;d.push(o*h[b])}return d},x.div=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(o[b]/h)}return d},x.sub=function(o,h){for(var d=[],f=0,v=o.length;f<v;){var b=f++;d.push(o[b]-h[b])}return d},x.isZero=function(o){for(var h=0,d=o.length;h<d;){var f=h++;if(Math.abs(o[f])>ve.TOLERANCE)return!1}return!0},x.sortedSetUnion=function(o,h){for(var d=[],f=0,v=0;f<o.length||v<h.length;){if(f>=o.length){d.push(h[v]),v++;continue}else if(v>=h.length){d.push(o[f]),f++;continue}var b=o[f]-h[v];if(Math.abs(b)<ve.EPSILON){d.push(o[f]),f++,v++;continue}if(b>0){d.push(h[v]),v++;continue}d.push(o[f]),f++}return d},x.sortedSetSub=function(o,h){for(var d=[],f=0,v=0;f<o.length;){if(v>=h.length){d.push(o[f]),f++;continue}if(Math.abs(o[f]-h[v])<ve.EPSILON){f++,v++;continue}d.push(o[f]),f++}return d};var $e=u.eval.Analyze=function(){};g["verb.eval.Analyze"]=$e,$e.__name__=["verb","eval","Analyze"],$e.knotMultiplicities=function(o){for(var h=[new Yr(o[0],0)],d=h[0],f=0;f<o.length;){var v=o[f];++f,Math.abs(v-d.knot)>ve.EPSILON&&(d=new Yr(v,0),h.push(d)),d.inc()}return h},$e.isRationalSurfaceClosed=function(o,h){h==null&&(h=!0);var d;h?d=o.controlPoints:d=ot.transpose(o.controlPoints);for(var f=0,v=d[0].length;f<v;){var b=f++,S=x.dist(ce.first(d)[b],ce.last(d)[b])<ve.EPSILON;if(!S)return!1}return!0},$e.rationalSurfaceClosestPoint=function(o,h){var d=$e.rationalSurfaceClosestParam(o,h);return j.rationalSurfacePoint(o,d[0],d[1])},$e.rationalSurfaceClosestParam=function(o,h){for(var d=5,f=0,v,b=1e-4,S=5e-4,I,k=o.knotsU[0],D=ce.last(o.knotsU),R=o.knotsV[0],N=ce.last(o.knotsV),z=$e.isRationalSurfaceClosed(o),U=$e.isRationalSurfaceClosed(o,!1),V,H=ut.rationalSurfaceAdaptive(o,new Rs),$=1/0,K=0,X=H.points.length;K<X;){var J=K++,ee=H.points[J],le=x.normSquared(x.sub(h,ee));le<$&&($=le,V=H.uvs[J])}for(var de=function(bt){return j.rationalSurfaceDerivatives(o,bt[0],bt[1],2)},ae=function(bt,Et,gt){var Tt=Et[1][0],sn=Et[0][1],En=Et[2][0],Kt=Et[0][2],Ht=Et[1][1],rn=Et[1][1],mn=x.dot(Tt,gt),Vn=x.dot(sn,gt),as=[-mn,-Vn],jn=x.dot(Tt,Tt)+x.dot(En,gt),$n=x.dot(Tt,sn)+x.dot(Ht,gt),Wn=x.dot(Tt,sn)+x.dot(rn,gt),bs=x.dot(sn,sn)+x.dot(Kt,gt),Qr=[[jn,$n],[Wn,bs]],vr=ot.solve(Qr,as);return x.add(vr,bt)};f<d;){v=de(V),I=x.sub(v[0][0],h);var se=x.norm(I),ue=x.dot(v[1][0],I),me=x.norm(v[1][0])*se,xe=x.dot(v[0][1],I),Te=x.norm(v[0][1])*se,ke=ue/me,Ie=xe/Te,Pe=se<b,we=ke<S,Oe=Ie<S;if(Pe&&we&&Oe)return V;var he=ae(V,v,I);he[0]<k?z?he=[D-(he[0]-k),he[1]]:he=[k+ve.EPSILON,he[1]]:he[0]>D&&(z?he=[k+(he[0]-D),he[1]]:he=[D-ve.EPSILON,he[1]]),he[1]<R?U?he=[he[0],N-(he[1]-R)]:he=[he[0],R+ve.EPSILON]:he[1]>N&&(U?he=[he[0],R+(he[0]-N)]:he=[he[0],N-ve.EPSILON]);var Be=x.norm(x.mul(he[0]-V[0],v[1][0])),tt=x.norm(x.mul(he[1]-V[1],v[0][1]));if(Be+tt<b)return V;V=he,f++}return V},$e.rationalCurveClosestPoint=function(o,h){return j.rationalCurvePoint(o,$e.rationalCurveClosestParam(o,h))},$e.rationalCurveClosestParam=function(o,h){for(var d=1/0,f=0,v=ut.rationalCurveRegularSample(o,o.controlPoints.length*o.degree,!0),b=0,S=v.length-1;b<S;){var I=b++,k=v[I][0],D=v[I+1][0],R=v[I].slice(1),N=v[I+1].slice(1),z=fn.segmentClosestPoint(h,R,N,k,D),U=x.norm(x.sub(h,z.pt));U<d&&(d=U,f=z.u)}for(var V=5,H=0,$,K=1e-4,X=5e-4,J,ee=o.knots[0],le=ce.last(o.knots),de=x.normSquared(x.sub(o.controlPoints[0],ce.last(o.controlPoints)))<ve.EPSILON,ae=f,se=function(he){return j.rationalCurveDerivatives(o,he,2)},ue=function(he,Be,tt){var bt=x.dot(Be[1],tt),Et=x.dot(Be[2],tt),gt=x.dot(Be[1],Be[1]),Tt=Et+gt;return he-bt/Tt};H<V;){$=se(ae),J=x.sub($[0],h);var me=x.norm(J),xe=x.dot($[1],J),Te=x.norm($[1])*me,ke=xe/Te,Ie=me<K,Pe=Math.abs(ke)<X;if(Ie&&Pe)return ae;var we=ue(ae,$,J);we<ee?de?we=le-(we-ee):we=ee:we>le&&(de?we=ee+(we-le):we=le);var Oe=x.norm(x.mul(we-ae,$[1]));if(Oe<K)return ae;ae=we,H++}return ae},$e.rationalCurveParamAtArcLength=function(o,h,d,f,v){if(d==null&&(d=.001),h<ve.EPSILON)return o.knots[0];var b;f!=null?b=f:b=Ve.decomposeCurveIntoBeziers(o);var S=0;b[S];var I=-ve.EPSILON,k;for(v!=null?k=v:k=[];I<h&&S<b.length;){if(S<k.length?k[S]=k[S]:k[S]=$e.rationalBezierCurveArcLength(o),I+=k[S],h<I+ve.EPSILON)return $e.rationalBezierCurveParamAtArcLength(o,h,d,k[S]);S++}return-1},$e.rationalBezierCurveParamAtArcLength=function(o,h,d,f){if(h<0)return o.knots[0];var v;if(f!=null?v=f:v=$e.rationalBezierCurveArcLength(o),h>v)return ce.last(o.knots);var b=o.knots[0],S=0,I=ce.last(o.knots),k=v,D=0,R=0,N;for(d!=null?N=d:N=ve.TOLERANCE*2;k-S>N;)D=(b+I)/2,R=$e.rationalBezierCurveArcLength(o,D),R>h?(I=D,k=R):(b=D,S=R);return(b+I)/2},$e.rationalCurveArcLength=function(o,h,d){d==null&&(d=16),h==null?h=ce.last(o.knots):h=h;for(var f=Ve.decomposeCurveIntoBeziers(o),v=0,b=f[0],S=0;v<f.length&&b.knots[0]+ve.EPSILON<h;){var I=Math.min(ce.last(b.knots),h);S+=$e.rationalBezierCurveArcLength(b,I,d),b=f[++v]}return S},$e.rationalBezierCurveArcLength=function(o,h,d){d==null&&(d=16);var f;h==null?f=ce.last(o.knots):f=h;for(var v=(f-o.knots[0])/2,b=0,S=o.degree+d,I,k,D=0;D<S;){var R=D++;I=v*$e.Tvalues[S][R]+v+o.knots[0],k=j.rationalCurveDerivatives(o,I,1),b+=$e.Cvalues[S][R]*x.norm(k[1])}return v*b};var Yr=u.eval.KnotMultiplicity=function(o,h){this.knot=o,this.mult=h};g["verb.eval.KnotMultiplicity"]=Yr,Yr.__name__=["verb","eval","KnotMultiplicity"],Yr.prototype={inc:function(){this.mult++},__class__:Yr};var An=u.eval.Check=function(){};g["verb.eval.Check"]=An,An.__name__=["verb","eval","Check"],An.isValidKnotVector=function(o,h){if(o.length==0||o.length<(h+1)*2)return!1;for(var d=ce.first(o),f=0,v=h+1;f<v;){var b=f++;if(Math.abs(o[b]-d)>ve.EPSILON)return!1}d=ce.last(o);for(var S=o.length-h-1,I=o.length;S<I;){var k=S++;if(Math.abs(o[k]-d)>ve.EPSILON)return!1}return An.isNonDecreasing(o)},An.isNonDecreasing=function(o){for(var h=ce.first(o),d=0,f=o.length;d<f;){var v=d++;if(o[v]<h-ve.EPSILON)return!1;h=o[v]}return!0},An.isValidNurbsCurveData=function(o){if(o.controlPoints==null)throw new ie("Control points array cannot be null!");if(o.degree==null)throw new ie("Degree cannot be null!");if(o.degree<1)throw new ie("Degree must be greater than 1!");if(o.knots==null)throw new ie("Knots cannot be null!");if(o.knots.length!=o.controlPoints.length+o.degree+1)throw new ie("controlPoints.length + degree + 1 must equal knots.length!");if(!An.isValidKnotVector(o.knots,o.degree))throw new ie("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return o},An.isValidNurbsSurfaceData=function(o){if(o.controlPoints==null)throw new ie("Control points array cannot be null!");if(o.degreeU==null)throw new ie("DegreeU cannot be null!");if(o.degreeV==null)throw new ie("DegreeV cannot be null!");if(o.degreeU<1)throw new ie("DegreeU must be greater than 1!");if(o.degreeV<1)throw new ie("DegreeV must be greater than 1!");if(o.knotsU==null)throw new ie("KnotsU cannot be null!");if(o.knotsV==null)throw new ie("KnotsV cannot be null!");if(o.knotsU.length!=o.controlPoints.length+o.degreeU+1)throw new ie("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(o.knotsV.length!=o.controlPoints[0].length+o.degreeV+1)throw new ie("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!An.isValidKnotVector(o.knotsU,o.degreeU)||!An.isValidKnotVector(o.knotsV,o.degreeV))throw new ie("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return o};var $t=u.eval.Divide=function(){};g["verb.eval.Divide"]=$t,$t.__name__=["verb","eval","Divide"],$t.surfaceSplit=function(o,h,d){d==null&&(d=!1);var f,v,b;d?(b=o.controlPoints,f=o.knotsV,v=o.degreeV):(b=ot.transpose(o.controlPoints),f=o.knotsU,v=o.degreeU);for(var S,I=[],k=0,D=v+1;k<D;)k++,I.push(h);S=I;for(var R=[],N=[],z=j.knotSpan(v,h,f),U=null,V=0;V<b.length;){var H=b[V];++V,U=Ve.curveKnotRefine(new P(v,f,H),S),R.push(U.controlPoints.slice(0,z+1)),N.push(U.controlPoints.slice(z+1))}var $=U.knots.slice(0,z+v+2),K=U.knots.slice(z+1);return d?[new G(o.degreeU,v,o.knotsU.slice(),$,R),new G(o.degreeU,v,o.knotsU.slice(),K,N)]:(R=ot.transpose(R),N=ot.transpose(N),[new G(v,o.degreeV,$,o.knotsV.slice(),R),new G(v,o.degreeV,K,o.knotsV.slice(),N)])},$t.curveSplit=function(o,h){var d=o.degree;o.controlPoints;for(var f=o.knots,v,b=[],S=0,I=d+1;S<I;)S++,b.push(h);v=b;var k=Ve.curveKnotRefine(o,v),D=j.knotSpan(d,h,f),R=k.knots.slice(0,D+d+2),N=k.knots.slice(D+1),z=k.controlPoints.slice(0,D+1),U=k.controlPoints.slice(D+1);return[new P(d,R,z),new P(d,N,U)]},$t.rationalCurveByEqualArcLength=function(o,h){var d=$e.rationalCurveArcLength(o),f=d/h;return $t.rationalCurveByArcLength(o,f)},$t.rationalCurveByArcLength=function(o,h){var d=Ve.decomposeCurveIntoBeziers(o),f=d.map(function(z){return $e.rationalBezierCurveArcLength(z)}),v=x.sum(f),b=[new Xr(o.knots[0],0)];if(h>v)return b;for(var S=h,I=0,k=S,D=0,R=0,N;I<d.length;){for(D+=f[I];k<D+ve.EPSILON;)N=$e.rationalBezierCurveParamAtArcLength(d[I],k-R,ve.TOLERANCE,f[I]),b.push(new Xr(N,k)),k+=S;R+=f[I],I++}return b};var Xr=u.eval.CurveLengthSample=function(o,h){this.u=o,this.len=h};g["verb.eval.CurveLengthSample"]=Xr,Xr.__name__=["verb","eval","CurveLengthSample"],Xr.prototype={__class__:Xr};var j=u.eval.Eval=function(){};g["verb.eval.Eval"]=j,j.__name__=["verb","eval","Eval"],j.rationalCurveTangent=function(o,h){var d=j.rationalCurveDerivatives(o,h,1);return d[1]},j.rationalSurfaceNormal=function(o,h,d){var f=j.rationalSurfaceDerivatives(o,h,d,1);return x.cross(f[1][0],f[0][1])},j.rationalSurfaceDerivatives=function(o,h,d,f){f==null&&(f=1);for(var v=j.surfaceDerivatives(o,h,d,f),b=j.rational2d(v),S=j.weight2d(v),I=[],k=b[0][0].length,D=0,R=f+1;D<R;){var N=D++;I.push([]);for(var z=0,U=f-N+1;z<U;){for(var V=z++,H=b[N][V],$=1,K=V+1;$<K;){var X=$++;x.subMulMutate(H,rt.get(V,X)*S[0][X],I[N][V-X])}for(var J=1,ee=N+1;J<ee;){var le=J++;x.subMulMutate(H,rt.get(N,le)*S[le][0],I[N-le][V]);for(var de=x.zeros1d(k),ae=1,se=V+1;ae<se;){var ue=ae++;x.addMulMutate(de,rt.get(V,ue)*S[le][ue],I[N-le][V-ue])}x.subMulMutate(H,rt.get(N,le),de)}x.mulMutate(1/S[0][0],H),I[N].push(H)}}return I},j.rationalSurfacePoint=function(o,h,d){return j.dehomogenize(j.surfacePoint(o,h,d))},j.rationalCurveDerivatives=function(o,h,d){d==null&&(d=1);for(var f=j.curveDerivatives(o,h,d),v=j.rational1d(f),b=j.weight1d(f),S=[],I=0,k=d+1;I<k;){for(var D=I++,R=v[D],N=1,z=D+1;N<z;){var U=N++;x.subMulMutate(R,rt.get(D,U)*b[U],S[D-U])}x.mulMutate(1/b[0],R),S.push(R)}return S},j.rationalCurvePoint=function(o,h){return j.dehomogenize(j.curvePoint(o,h))},j.surfaceDerivatives=function(o,h,d,f){var v=o.knotsU.length-o.degreeU-2,b=o.knotsV.length-o.degreeV-2;return j.surfaceDerivativesGivenNM(v,b,o,h,d,f)},j.surfaceDerivativesGivenNM=function(o,h,d,f,v,b){var S=d.degreeU,I=d.degreeV,k=d.controlPoints,D=d.knotsU,R=d.knotsV;if(!j.areValidRelations(S,k.length,D.length)||!j.areValidRelations(I,k[0].length,R.length))throw new ie("Invalid relations between control points, knot vector, and n");var N=k[0][0].length,z;b<S?z=b:z=S;var U;b<I?U=b:U=I;for(var V=x.zeros3d(b+1,b+1,N),H=j.knotSpanGivenN(o,S,f,D),$=j.knotSpanGivenN(h,I,v,R),K=j.derivativeBasisFunctionsGivenNI(H,f,S,o,D),X=j.derivativeBasisFunctionsGivenNI($,v,I,h,R),J=x.zeros2d(I+1,N),ee=0,le=0,de=z+1;le<de;){for(var ae=le++,se=0,ue=I+1;se<ue;){var me=se++;J[me]=x.zeros1d(N);for(var xe=0,Te=S+1;xe<Te;){var ke=xe++;x.addMulMutate(J[me],K[ae][ke],k[H-S+ke][$-I+me])}}var Ie=b-ae;Ie<U?ee=Ie:ee=U;for(var Pe=0,we=ee+1;Pe<we;){var Oe=Pe++;V[ae][Oe]=x.zeros1d(N);for(var he=0,Be=I+1;he<Be;){var tt=he++;x.addMulMutate(V[ae][Oe],X[Oe][tt],J[tt])}}}return V},j.surfacePoint=function(o,h,d){var f=o.knotsU.length-o.degreeU-2,v=o.knotsV.length-o.degreeV-2;return j.surfacePointGivenNM(f,v,o,h,d)},j.surfacePointGivenNM=function(o,h,d,f,v){var b=d.degreeU,S=d.degreeV,I=d.controlPoints,k=d.knotsU,D=d.knotsV;if(!j.areValidRelations(b,I.length,k.length)||!j.areValidRelations(S,I[0].length,D.length))throw new ie("Invalid relations between control points, knot vector, and n");for(var R=I[0][0].length,N=j.knotSpanGivenN(o,b,f,k),z=j.knotSpanGivenN(h,S,v,D),U=j.basisFunctionsGivenKnotSpanIndex(N,f,b,k),V=j.basisFunctionsGivenKnotSpanIndex(z,v,S,D),H=N-b,$=z,K=x.zeros1d(R),X=x.zeros1d(R),J=0,ee=S+1;J<ee;){var le=J++;X=x.zeros1d(R),$=z-S+le;for(var de=0,ae=b+1;de<ae;){var se=de++;x.addMulMutate(X,U[se],I[H+se][$])}x.addMulMutate(K,V[le],X)}return K},j.curveRegularSamplePoints=function(o,h){for(var d=j.curveDerivatives(o,o.knots[0],o.degree),f=1/h,v=f*f,b=d[0],S=x.mul(f,d[1]),I=x.mul(v*.5,d[2]),k=x.mul(v*f*.5,d[3]),D=x.add(I,I),R=x.add(k,k),N=x.mul(.3333333333333333,k),z=[],U=0,V=h+1;U<V;)U++,z.push(j.dehomogenize(b)),x.addAllMutate([b,S,I,N]),x.addAllMutate([S,D,k]),x.addAllMutate([D,R]),x.addAllMutate([I,k]);return z},j.curveRegularSamplePoints2=function(o,h){for(var d=j.curveDerivatives(o,o.knots[0],o.degree),f=1/h,v=f*f,b=d[0],S=x.mul(f,d[1]),I=x.mul(v*.5,d[2]),k=x.mul(v*f*.5,d[3]),D=x.add(I,I),R=x.add(k,k),N=x.mul(.3333333333333333,k),z=[],U=0,V=h+1;U<V;)U++,z.push(j.dehomogenize(b)),x.addAllMutate([b,S,I,N]),x.addAllMutate([S,D,k]),x.addAllMutate([D,R]),x.addAllMutate([I,k]);return z},j.rationalSurfaceRegularSampleDerivatives=function(o,h,d,f){for(var v=j.surfaceRegularSampleDerivatives(o,h,d,f),b=[],S=h+1,I=d+1,k=f+1,D=0;D<S;){var R=D++,N=[];b.push(N);for(var z=0;z<I;){for(var U=z++,V=v[R][U],H=j.rational2d(V),$=j.weight2d(V),K=[],X=H[0][0].length,J=0;J<k;){var ee=J++;K.push([]);for(var le=0,de=k-ee;le<de;){for(var ae=le++,se=H[ee][ae],ue=1,me=ae+1;ue<me;){var xe=ue++;x.subMulMutate(se,rt.get(ae,xe)*$[0][xe],K[ee][ae-xe])}for(var Te=1,ke=ee+1;Te<ke;){var Ie=Te++;x.subMulMutate(se,rt.get(ee,Ie)*$[Ie][0],K[ee-Ie][ae]);for(var Pe=x.zeros1d(X),we=1,Oe=ae+1;we<Oe;){var he=we++;x.addMulMutate(Pe,rt.get(ae,he)*$[Ie][he],K[ee-Ie][ae-he])}x.subMulMutate(se,rt.get(ee,Ie),Pe)}x.mulMutate(1/$[0][0],se),K[ee].push(se)}}N.push(K)}}return b},j.surfaceRegularSampleDerivatives=function(o,h,d,f){var v=o.degreeU,b=o.degreeV,S=o.controlPoints,I=o.knotsU,k=o.knotsV,D=S[0][0].length;(ce.last(I)-I[0])/h,(ce.last(k)-k[0])/d;for(var R=j.regularlySpacedDerivativeBasisFunctions(v,I,h),N=R.item0,z=R.item1,U=j.regularlySpacedDerivativeBasisFunctions(b,k,d),V=U.item0,H=U.item1,$=[],K=h+1,X=d+1,J=0;J<K;){var ee=J++,le=[];$.push(le);for(var de=0;de<X;){var ae=de++;le.push(j.surfaceDerivativesGivenBasesKnotSpans(v,b,S,N[ee],V[ae],z[ee],H[ae],D,f))}}return $},j.rationalSurfaceRegularSamplePoints=function(o,h,d){return j.dehomogenize2d(j.surfaceRegularSamplePoints(o,h,d))},j.surfaceRegularSamplePoints=function(o,h,d){var f=o.degreeU,v=o.degreeV,b=o.controlPoints,S=o.knotsU,I=o.knotsV,k=b[0][0].length;(ce.last(S)-S[0])/h,(ce.last(I)-I[0])/d;for(var D=j.regularlySpacedBasisFunctions(f,S,h),R=D.item0,N=D.item1,z=j.regularlySpacedBasisFunctions(v,I,d),U=z.item0,V=z.item1,H=[],$=h+1,K=d+1,X=0;X<$;){var J=X++,ee=[];H.push(ee);for(var le=0;le<K;){var de=le++;ee.push(j.surfacePointGivenBasesKnotSpans(f,v,b,R[J],U[de],N[J],V[de],k))}}return H},j.regularlySpacedBasisFunctions=function(o,h,d){for(var f=h.length-o-2,v=(ce.last(h)-h[0])/d,b=[],S=[],I=h[0],k=j.knotSpanGivenN(f,o,I,h),D=d+1,R=0;R<D;){for(R++;I>=h[k+1];)k++;S.push(k),b.push(j.basisFunctionsGivenKnotSpanIndex(k,I,o,h)),I+=v}return new ze(S,b)},j.regularlySpacedDerivativeBasisFunctions=function(o,h,d){for(var f=h.length-o-2,v=(ce.last(h)-h[0])/d,b=[],S=[],I=h[0],k=j.knotSpanGivenN(f,o,I,h),D=d+1,R=0;R<D;){for(R++;I>=h[k+1];)k++;S.push(k),b.push(j.derivativeBasisFunctionsGivenNI(k,I,o,f,h)),I+=v}return new ze(S,b)},j.surfacePointGivenBasesKnotSpans=function(o,h,d,f,v,b,S,I){for(var k=x.zeros1d(I),D,R=f-o,N=v-h,z=0,U=h+1;z<U;){var V=z++;D=x.zeros1d(I);for(var H=0,$=o+1;H<$;){var K=H++;x.addMulMutate(D,b[K],d[R+K][N])}N++,x.addMulMutate(k,S[V],D)}return k},j.surfaceDerivativesGivenBasesKnotSpans=function(o,h,d,f,v,b,S,I,k){var D=d[0][0].length,R;k<o?R=k:R=o;var N;k<h?N=k:N=h;for(var z=x.zeros3d(R+1,N+1,D),U=x.zeros2d(h+1,D),V=0,H=0,$=R+1;H<$;){for(var K=H++,X=0,J=h+1;X<J;){var ee=X++;U[ee]=x.zeros1d(D);for(var le=0,de=o+1;le<de;){var ae=le++;x.addMulMutate(U[ee],b[K][ae],d[f-o+ae][v-h+ee])}}var se=k-K;se<N?V=se:V=N;for(var ue=0,me=V+1;ue<me;){var xe=ue++;z[K][xe]=x.zeros1d(D);for(var Te=0,ke=h+1;Te<ke;){var Ie=Te++;x.addMulMutate(z[K][xe],S[xe][Ie],U[Ie])}}}return z},j.curveDerivatives=function(o,h,d){var f=o.knots.length-o.degree-2;return j.curveDerivativesGivenN(f,o,h,d)},j.curveDerivativesGivenN=function(o,h,d,f){var v=h.degree,b=h.controlPoints,S=h.knots;if(!j.areValidRelations(v,b.length,S.length))throw new ie("Invalid relations between control points, knot vector, and n");var I=b[0].length,k;f<v?k=f:k=v;for(var D=x.zeros2d(f+1,I),R=j.knotSpanGivenN(o,v,d,S),N=j.derivativeBasisFunctionsGivenNI(R,d,v,k,S),z=0,U=k+1;z<U;)for(var V=z++,H=0,$=v+1;H<$;){var K=H++;x.addMulMutate(D[V],N[V][K],b[R-v+K])}return D},j.curvePoint=function(o,h){var d=o.knots.length-o.degree-2;return j.curvePointGivenN(d,o,h)},j.areValidRelations=function(o,h,d){return h+o+1-d==0},j.curvePointGivenN=function(o,h,d){var f=h.degree,v=h.controlPoints,b=h.knots;if(!j.areValidRelations(f,v.length,b.length))throw new ie("Invalid relations between control points, knot Array, and n");for(var S=j.knotSpanGivenN(o,f,d,b),I=j.basisFunctionsGivenKnotSpanIndex(S,d,f,b),k=x.zeros1d(v[0].length),D=0,R=f+1;D<R;){var N=D++;x.addMulMutate(k,I[N],v[S-f+N])}return k},j.volumePoint=function(o,h,d,f){var v=o.knotsU.length-o.degreeU-2,b=o.knotsV.length-o.degreeV-2,S=o.knotsW.length-o.degreeW-2;return j.volumePointGivenNML(o,v,b,S,h,d,f)},j.volumePointGivenNML=function(o,h,d,f,v,b,S){if(!j.areValidRelations(o.degreeU,o.controlPoints.length,o.knotsU.length)||!j.areValidRelations(o.degreeV,o.controlPoints[0].length,o.knotsV.length)||!j.areValidRelations(o.degreeW,o.controlPoints[0][0].length,o.knotsW.length))throw new ie("Invalid relations between control points and knot vector");for(var I=o.controlPoints,k=o.degreeU,D=o.degreeV,R=o.degreeW,N=o.knotsU,z=o.knotsV,U=o.knotsW,V=I[0][0][0].length,H=j.knotSpanGivenN(h,k,v,N),$=j.knotSpanGivenN(d,D,b,z),K=j.knotSpanGivenN(f,R,S,U),X=j.basisFunctionsGivenKnotSpanIndex(H,v,k,N),J=j.basisFunctionsGivenKnotSpanIndex($,b,D,z),ee=j.basisFunctionsGivenKnotSpanIndex(K,S,R,U),le=H-k,de=x.zeros1d(V),ae=x.zeros1d(V),se=x.zeros1d(V),ue=0,me=R+1;ue<me;){var xe=ue++;se=x.zeros1d(V);for(var Te=K-R+xe,ke=0,Ie=D+1;ke<Ie;){var Pe=ke++;ae=x.zeros1d(V);for(var we=$-D+Pe,Oe=0,he=k+1;Oe<he;){var Be=Oe++;x.addMulMutate(ae,X[Be],I[le+Be][we][Te])}x.addMulMutate(se,J[Pe],ae)}x.addMulMutate(de,ee[xe],se)}return de},j.derivativeBasisFunctions=function(o,h,d){var f=j.knotSpan(h,o,d),v=d.length-1,b=v-h-1;return j.derivativeBasisFunctionsGivenNI(f,o,h,b,d)},j.derivativeBasisFunctionsGivenNI=function(o,h,d,f,v){var b=x.zeros2d(d+1,d+1),S=x.zeros1d(d+1),I=x.zeros1d(d+1),k=0,D=0;b[0][0]=1;for(var R=1,N=d+1;R<N;){var z=R++;S[z]=h-v[o+1-z],I[z]=v[o+z]-h,k=0;for(var U=0;U<z;){var V=U++;b[z][V]=I[V+1]+S[z-V],D=b[V][z-1]/b[z][V],b[V][z]=k+I[V+1]*D,k=S[z-V]*D}b[z][z]=k}for(var H=x.zeros2d(f+1,d+1),$=x.zeros2d(2,d+1),K=0,X=1,J=0,ee=0,le=0,de=0,ae=0,se=0,ue=d+1;se<ue;){var me=se++;H[0][me]=b[me][d]}for(var xe=0,Te=d+1;xe<Te;){var ke=xe++;K=0,X=1,$[0][0]=1;for(var Ie=1,Pe=f+1;Ie<Pe;){var we=Ie++;J=0,ee=ke-we,le=d-we,ke>=we&&($[X][0]=$[K][0]/b[le+1][ee],J=$[X][0]*b[ee][le]),ee>=-1?de=1:de=-ee,ke-1<=le?ae=we-1:ae=d-ke;for(var Oe=de,he=ae+1;Oe<he;){var Be=Oe++;$[X][Be]=($[K][Be]-$[K][Be-1])/b[le+1][ee+Be],J+=$[X][Be]*b[ee+Be][le]}ke<=le&&($[X][we]=-$[K][we-1]/b[le+1][ke],J+=$[X][we]*b[ke][le]),H[we][ke]=J;var tt=K;K=X,X=tt}}for(var bt=d,Et=1,gt=f+1;Et<gt;){for(var Tt=Et++,sn=0,En=d+1;sn<En;){var Kt=sn++;H[Tt][Kt]*=bt}bt*=d-Tt}return H},j.basisFunctions=function(o,h,d){var f=j.knotSpan(h,o,d);return j.basisFunctionsGivenKnotSpanIndex(f,o,h,d)},j.basisFunctionsGivenKnotSpanIndex=function(o,h,d,f){var v=x.zeros1d(d+1),b=x.zeros1d(d+1),S=x.zeros1d(d+1),I=0,k=0;v[0]=1;for(var D=1,R=d+1;D<R;){var N=D++;b[N]=h-f[o+1-N],S[N]=f[o+N]-h,I=0;for(var z=0;z<N;){var U=z++;k=v[U]/(S[U+1]+b[N-U]),v[U]=I+S[U+1]*k,I=b[N-U]*k}v[N]=I}return v},j.knotSpan=function(o,h,d){return j.knotSpanGivenN(d.length-o-2,o,h,d)},j.knotSpanGivenN=function(o,h,d,f){if(d>f[o+1]-ve.EPSILON)return o;if(d<f[h]+ve.EPSILON)return h;for(var v=h,b=o+1,S=Math.floor((v+b)/2);d<f[S]||d>=f[S+1];)d<f[S]?b=S:v=S,S=Math.floor((v+b)/2);return S},j.dehomogenize=function(o){for(var h=o.length,d=[],f=o[h-1],v=o.length-1,b=0;b<v;){var S=b++;d.push(o[S]/f)}return d},j.rational1d=function(o){var h=o[0].length-1;return o.map(function(d){return d.slice(0,h)})},j.rational2d=function(o){return o.map(j.rational1d)},j.weight1d=function(o){var h=o[0].length-1;return o.map(function(d){return d[h]})},j.weight2d=function(o){return o.map(j.weight1d)},j.dehomogenize1d=function(o){return o.map(j.dehomogenize)},j.dehomogenize2d=function(o){return o.map(j.dehomogenize1d)},j.homogenize1d=function(o,h){var d=o.length,f=o[0].length,v=[],b=0,S=[],I;h!=null?I=h:I=x.rep(o.length,1);for(var k=0;k<d;){var D=k++,R=[];S=o[D],b=I[D];for(var N=0;N<f;){var z=N++;R.push(S[z]*b)}R.push(b),v.push(R)}return v},j.homogenize2d=function(o,h){var d=o.length,f=[],v;if(h!=null)v=h;else{for(var b=[],S=0;S<d;)S++,b.push(x.rep(o[0].length,1));v=b}for(var I=0;I<d;){var k=I++;f.push(j.homogenize1d(o[k],v[k]))}return f};var Ce=u.eval.Intersect=function(){};g["verb.eval.Intersect"]=Ce,Ce.__name__=["verb","eval","Intersect"],Ce.surfaces=function(o,h,d){var f=ut.rationalSurfaceAdaptive(o),v=ut.rationalSurfaceAdaptive(h),b=Ce.meshes(f,v),S=b.map(function(I){return I.map(function(k){return Ce.surfacesAtPointWithEstimate(o,h,k.uv0,k.uv1,d)})});return S.map(function(I){return De.rationalInterpCurve(I.map(function(k){return k.point}),3)})},Ce.surfacesAtPointWithEstimate=function(o,h,d,f,v){var b,S,I,k,D,R,N,z,U,V,H,$,K,X=5,J=0;do{if(b=j.rationalSurfaceDerivatives(o,d[0],d[1],1),S=b[0][0],k=b[1][0],D=b[0][1],I=x.normalized(x.cross(k,D)),R=x.dot(I,S),N=j.rationalSurfaceDerivatives(h,f[0],f[1],1),z=N[0][0],V=N[1][0],H=N[0][1],U=x.normalized(x.cross(V,H)),$=x.dot(U,z),K=x.distSquared(S,z),K<v*v)break;var ee=x.normalized(x.cross(I,U)),le=x.dot(ee,S),de=Ce.threePlanes(I,R,U,$,ee,le);if(de==null)throw new ie("panic!");var ae=x.sub(de,S),se=x.sub(de,z),ue=x.cross(k,I),me=x.cross(D,I),xe=x.cross(V,U),Te=x.cross(H,U),ke=x.dot(me,ae)/x.dot(me,k),Ie=x.dot(ue,ae)/x.dot(ue,D),Pe=x.dot(Te,se)/x.dot(Te,V),we=x.dot(xe,se)/x.dot(xe,H);d=x.add([ke,Ie],d),f=x.add([Pe,we],f),J++}while(J<X);return new Os(d,f,S,K)},Ce.meshes=function(o,h,d,f){d==null&&(d=new rs(o)),f==null&&(f=new rs(h));var v=Ce.boundingBoxTrees(d,f,0),b=ce.unique(v.map(function(S){return Ce.triangles(o,S.item0,h,S.item1)}).filter(function(S){return S!=null}).filter(function(S){return x.distSquared(S.min.point,S.max.point)>ve.EPSILON}),function(S,I){var k=x.sub(S.min.uv0,I.min.uv0),D=x.dot(k,k),R=x.sub(S.max.uv0,I.max.uv0),N=x.dot(R,R),z=x.sub(S.min.uv0,I.max.uv0),U=x.dot(z,z),V=x.sub(S.max.uv0,I.min.uv0),H=x.dot(V,V);return D<ve.EPSILON&&N<ve.EPSILON||U<ve.EPSILON&&H<ve.EPSILON});return Ce.makeMeshIntersectionPolylines(b)},Ce.meshSlices=function(o,h,d,f){for(var v=new Ns(o),b=v.boundingBox(),S=b.min[0],I=b.min[1],k=b.max[0],D=b.max[1],R=x.span(h,d,f),N=[],z=0;z<R.length;){var U=R[z];++z;var V=[[S,I,U],[k,I,U],[k,D,U],[S,D,U]],H=[[0,0],[1,0],[1,1],[0,1]],$=[[0,1,2],[0,2,3]],K=new Y($,V,null,H);N.push(Ce.meshes(o,K,v))}return N},Ce.makeMeshIntersectionPolylines=function(o){if(o.length==0)return[];for(var h=0;h<o.length;){var d=o[h];++h,d.max.opp=d.min,d.min.opp=d.max}for(var f=Ce.kdTreeFromSegments(o),v=[],b=0;b<o.length;){var S=o[b];++b,v.push(S.min),v.push(S.max)}for(var I=0;I<v.length;){var k=v[I];if(++I,k.adj==null){var D=Ce.lookupAdjacentSegment(k,f,o.length);D!=null&&D.adj==null&&(k.adj=D,D.adj=k)}}var R=v.filter(function(X){return X.adj==null});R.length==0&&(R=v);for(var N=[],z=0,U=!1;R.length!=0;){var V=R.pop();if(!V.visited){for(var H=[],$=V;$!=null&&!($.visited||($.visited=!0,$.opp.visited=!0,H.push($),z+=2,$=$.opp.adj,$==V)););H.length>0&&(H.push(H[H.length-1].opp),N.push(H))}if(R.length==0&&v.length>0&&(U||z<v.length)){U=!0;var K=v.pop();R.push(K)}}return N},Ce.kdTreeFromSegments=function(o){for(var h=[],d=0;d<o.length;){var f=o[d];++d,h.push(new Wr(f.min.point,f.min)),h.push(new Wr(f.max.point,f.max))}return new Fi(h,x.distSquared)},Ce.lookupAdjacentSegment=function(o,h,d){var f=h.nearest(o.point,d,ve.EPSILON).filter(function(v){return o!=v.item0.obj}).map(function(v){return v.item0.obj});return f.length==1?f[0]:null},Ce.curveAndSurface=function(o,h,d,f,v){d==null&&(d=.001),f!=null?f=f:f=new ss(o),v!=null?v=v:v=new Bs(h);var b=Ce.boundingBoxTrees(f,v,d);return ce.unique(b.map(function(S){var I=S.item0,k=S.item1,D=ce.first(I.knots),R=ce.last(I.knots),N=(D+R)/2,z=ce.first(k.knotsU),U=ce.last(k.knotsU),V=ce.first(k.knotsV),H=ce.last(k.knotsV),$=[(z+U)/2,(V+H)/2];return Ce.curveAndSurfaceWithEstimate(I,k,[N].concat($),d)}).filter(function(S){return x.distSquared(S.curvePoint,S.surfacePoint)<d*d}),function(S,I){return Math.abs(S.u-I.u)<.5*d})},Ce.curveAndSurfaceWithEstimate=function(o,h,d,f){f==null&&(f=.001);var v=function(k){var D=j.rationalCurvePoint(o,k[0]),R=j.rationalSurfacePoint(h,k[1],k[2]),N=x.sub(D,R);return x.dot(N,N)},b=function(k){var D=j.rationalCurveDerivatives(o,k[0],1),R=j.rationalSurfaceDerivatives(h,k[1],k[2],1),N=x.sub(R[0][0],D[0]),z=x.mul(-1,D[1]),U=R[1][0],V=R[0][1];return[2*x.dot(z,N),2*x.dot(U,N),2*x.dot(V,N)]},S=Un.uncmin(v,d,f*f,b),I=S.solution;return new vt(I[0],[I[1],I[2]],j.rationalCurvePoint(o,I[0]),j.rationalSurfacePoint(h,I[1],I[2]))},Ce.polylineAndMesh=function(o,h,d){for(var f=Ce.boundingBoxTrees(new is(o),new rs(h),d),v=[],b=0;b<f.length;){var S=f[b];++b;var I=S.item0,k=S.item1,D=Ce.segmentWithTriangle(o.points[I],o.points[I+1],h.points,h.faces[k]);if(D!=null){var R=D.point,N=x.lerp(D.p,[o.params[I]],[o.params[I+1]])[0],z=Lt.triangleUVFromPoint(h,k,R);v.push(new ns(R,N,z,I,k))}}return v},Ce.boundingBoxTrees=function(o,h,d){d==null&&(d=1e-9);var f=[],v=[];f.push(o),v.push(h);for(var b=[];f.length>0;){var S=f.pop(),I=v.pop();if(!(S.empty()||I.empty())&&S.boundingBox().intersects(I.boundingBox(),d)){var k=S.indivisible(d),D=I.indivisible(d);if(k&&D){b.push(new ze(S.yield(),I.yield()));continue}else if(k&&!D){var R=I.split();f.push(S),v.push(R.item1),f.push(S),v.push(R.item0);continue}else if(!k&&D){var N=S.split();f.push(N.item1),v.push(I),f.push(N.item0),v.push(I);continue}var z=S.split(),U=I.split();f.push(z.item1),v.push(U.item1),f.push(z.item1),v.push(U.item0),f.push(z.item0),v.push(U.item1),f.push(z.item0),v.push(U.item0)}}return b},Ce.curves=function(o,h,d){var f=Ce.boundingBoxTrees(new ss(o),new ss(h),0);return ce.unique(f.map(function(v){return Ce.curvesWithEstimate(o,h,ce.first(v.item0.knots),ce.first(v.item1.knots),d)}).filter(function(v){return x.distSquared(v.point0,v.point1)<d}),function(v,b){return Math.abs(v.u0-b.u0)<d*5})},Ce.curvesWithEstimate=function(o,h,d,f,v){var b=function(z){var U=j.rationalCurvePoint(o,z[0]),V=j.rationalCurvePoint(h,z[1]),H=x.sub(U,V);return x.dot(H,H)},S=function(z){var U=j.rationalCurveDerivatives(o,z[0],1),V=j.rationalCurveDerivatives(h,z[1],1),H=x.sub(U[0],V[0]),$=U[1],K=x.mul(-1,V[1]);return[2*x.dot($,H),2*x.dot(K,H)]},I=Un.uncmin(b,[d,f],v*v,S),k=I.solution[0],D=I.solution[1],R=j.rationalCurvePoint(o,k),N=j.rationalCurvePoint(h,D);return new ht(R,N,k,D)},Ce.triangles=function(o,h,d,f){var v=o.faces[h],b=d.faces[f],S=Lt.getTriangleNorm(o.points,v),I=Lt.getTriangleNorm(d.points,b),k=o.points[v[0]],D=d.points[b[0]],R=Ce.planes(k,S,D,I);if(R==null)return null;var N=Ce.clipRayInCoplanarTriangle(R,o,h);if(N==null)return null;var z=Ce.clipRayInCoplanarTriangle(R,d,f);if(z==null)return null;var U=Ce.mergeTriangleClipIntervals(N,z,o,h,d,f);return U==null?null:new ct(new At(U.min.uv0,U.min.uv1,U.min.point,h,f),new At(U.max.uv0,U.max.uv1,U.max.point,h,f))},Ce.clipRayInCoplanarTriangle=function(o,h,d){for(var f=h.faces[d],v=[h.points[f[0]],h.points[f[1]],h.points[f[2]]],b=[h.uvs[f[0]],h.uvs[f[1]],h.uvs[f[2]]],S=[x.sub(b[1],b[0]),x.sub(b[2],b[1]),x.sub(b[0],b[2])],I=[x.sub(v[1],v[0]),x.sub(v[2],v[1]),x.sub(v[0],v[2])],k=I.map(x.normalized),D=I.map(x.norm),R=null,N=null,z=0;z<3;){var U=z++,V=v[U],H=k[U],$=Ce.rays(V,H,o.origin,o.dir);if($!=null){var K=$.u0,X=$.u1;K<-ve.EPSILON||K>D[U]+ve.EPSILON||((R==null||X<R.u)&&(R=new $r(X,x.onRay(o.origin,o.dir,X),x.onRay(b[U],S[U],K/D[U]))),(N==null||X>N.u)&&(N=new $r(X,x.onRay(o.origin,o.dir,X),x.onRay(b[U],S[U],K/D[U]))))}}return N==null||R==null?null:new ct(R,N)},Ce.mergeTriangleClipIntervals=function(o,h,d,f,v,b){if(h.min.u>o.max.u+ve.EPSILON||o.min.u>h.max.u+ve.EPSILON)return null;var S;o.min.u>h.min.u?S=new ze(o.min,0):S=new ze(h.min,1);var I;o.max.u<h.max.u?I=new ze(o.max,0):I=new ze(h.max,1);var k=new ct(new At(null,null,S.item0.point,f,b),new At(null,null,I.item0.point,f,b));return S.item1==0?(k.min.uv0=S.item0.uv,k.min.uv1=Lt.triangleUVFromPoint(v,b,S.item0.point)):(k.min.uv0=Lt.triangleUVFromPoint(d,f,S.item0.point),k.min.uv1=S.item0.uv),I.item1==0?(k.max.uv0=I.item0.uv,k.max.uv1=Lt.triangleUVFromPoint(v,b,I.item0.point)):(k.max.uv0=Lt.triangleUVFromPoint(d,f,I.item0.point),k.max.uv1=I.item0.uv),k},Ce.planes=function(o,h,d,f){var v=x.cross(h,f);if(x.dot(v,v)<ve.EPSILON)return null;var b=0,S=Math.abs(v[0]),I=Math.abs(v[1]),k=Math.abs(v[2]);I>S&&(b=1,S=I),k>S&&(b=2,S=k);var D,R,N,z;b==0?(D=h[1],R=h[2],N=f[1],z=f[2]):b==1?(D=h[0],R=h[2],N=f[0],z=f[2]):(D=h[0],R=h[1],N=f[0],z=f[1]);var U=-x.dot(o,h),V=-x.dot(d,f),H=D*z-R*N,$=(R*V-U*z)/H,K=(U*N-D*V)/H,X;return b==0?X=[0,$,K]:b==1?X=[$,0,K]:X=[$,K,0],new T(X,x.normalized(v))},Ce.threePlanes=function(o,h,d,f,v,b){var S=x.cross(d,v),I=x.dot(o,S);if(Math.abs(I)<ve.EPSILON)return null;var k=x.sub(x.mul(b,d),x.mul(f,v)),D=x.add(x.mul(h,S),x.cross(o,k));return x.mul(1/I,D)},Ce.polylines=function(o,h,d){for(var f=Ce.boundingBoxTrees(new is(o),new is(h),d),v=[],b=0;b<f.length;){var S=f[b];++b;var I=S.item0,k=S.item1,D=Ce.segments(o.points[I],o.points[I+1],h.points[k],h.points[k+1],d);D!=null&&(D.u0=x.lerp(D.u0,[o.params[I]],[o.params[I+1]])[0],D.u1=x.lerp(D.u1,[h.params[k]],[h.params[k+1]])[0],v.push(D))}return v},Ce.segments=function(o,h,d,f,v){var b=x.sub(h,o),S=Math.sqrt(x.dot(b,b)),I=x.mul(1/S,b),k=x.sub(f,d),D=Math.sqrt(x.dot(k,k)),R=x.mul(1/D,k),N=Ce.rays(o,I,d,R);if(N!=null){var z=Math.min(Math.max(0,N.u0/S),1),U=Math.min(Math.max(0,N.u1/D),1),V=x.onRay(o,b,z),H=x.onRay(d,k,U),$=x.distSquared(V,H);if($<v*v)return new ht(V,H,z,U)}return null},Ce.rays=function(o,h,d,f){var v=x.dot(h,f),b=x.dot(h,d),S=x.dot(h,o),I=x.dot(f,d),k=x.dot(f,o),D=x.dot(h,h),R=x.dot(f,f),N=D*R-v*v;if(Math.abs(N)<ve.EPSILON)return null;var z=v*(b-S)-D*(I-k),U=z/N,V=(b-S+U*v)/D,H=x.onRay(o,h,V),$=x.onRay(d,f,U);return new ht(H,$,V,U)},Ce.segmentWithTriangle=function(o,h,d,f){var v=d[f[0]],b=d[f[1]],S=d[f[2]],I=x.sub(b,v),k=x.sub(S,v),D=x.cross(I,k),R=x.sub(h,o),N=x.sub(o,v),z=-x.dot(D,N),U=x.dot(D,R);if(Math.abs(U)<ve.EPSILON)return null;var V=z/U;if(V<0||V>1)return null;var H=x.add(o,x.mul(V,R)),$=x.dot(I,k),K=x.dot(I,I),X=x.dot(k,k),J=x.sub(H,v),ee=x.dot(J,I),le=x.dot(J,k),de=$*$-K*X;if(Math.abs(de)<ve.EPSILON)return null;var ae=($*le-X*ee)/de,se=($*ee-K*le)/de;return ae>1+ve.EPSILON||se>1+ve.EPSILON||se<-ve.EPSILON||ae<-ve.EPSILON||ae+se>1+ve.EPSILON?null:new Ds(H,ae,se,V)},Ce.segmentAndPlane=function(o,h,d,f){var v=x.dot(f,x.sub(h,o));if(Math.abs(v)<ve.EPSILON)return null;var b=x.dot(f,x.sub(d,o)),S=b/v;return S>1+ve.EPSILON||S<-ve.EPSILON?null:{p:S}};var De=u.eval.Make=function(){};g["verb.eval.Make"]=De,De.__name__=["verb","eval","Make"],De.rationalTranslationalSurface=function(o,h){for(var d=j.rationalCurvePoint(h,ce.first(h.knots)),f=ce.first(h.knots),v=ce.last(h.knots),b=2*h.controlPoints.length,S=(v-f)/(b-1),I=[],k=0;k<b;){var D=k++,R=x.sub(j.rationalCurvePoint(h,f+D*S),d),N=Ve.rationalCurveTransform(o,[[1,0,0,R[0]],[0,1,0,R[1]],[0,0,1,R[2]],[0,0,0,1]]);I.push(N)}return De.loftedSurface(I)},De.surfaceBoundaryCurves=function(o){var h=De.surfaceIsocurve(o,ce.first(o.knotsU),!1),d=De.surfaceIsocurve(o,ce.last(o.knotsU),!1),f=De.surfaceIsocurve(o,ce.first(o.knotsV),!0),v=De.surfaceIsocurve(o,ce.last(o.knotsV),!0);return[h,d,f,v]},De.surfaceIsocurve=function(o,h,d){d==null&&(d=!1);var f;d?f=o.knotsV:f=o.knotsU;var v;d?v=o.degreeV:v=o.degreeU;for(var b=$e.knotMultiplicities(f),S=-1,I=0,k=b.length;I<k;){var D=I++;if(Math.abs(h-b[D].knot)<ve.EPSILON){S=D;break}}var R=v+1;S>=0&&(R=R-b[S].mult);var N;R>0?N=Ve.surfaceKnotRefine(o,x.rep(R,h),d):N=o;var z=j.knotSpan(v,h,f);return Math.abs(h-ce.first(f))<ve.EPSILON?z=0:Math.abs(h-ce.last(f))<ve.EPSILON&&(z=(d?N.controlPoints[0].length:N.controlPoints.length)-1),d?new P(N.degreeU,N.knotsU,function(U){for(var V,H=[],$=0,K=N.controlPoints;$<K.length;){var X=K[$];++$,H.push(X[z])}return V=H,V}()):new P(N.degreeV,N.knotsV,N.controlPoints[z])},De.loftedSurface=function(o,h){o=Ve.unifyCurveKnotVectors(o);var d=o[0].degree;h==null&&(h=3),h>o.length-1&&(h=o.length-1);for(var f=o[0].knots,v=[],b=[],S=0,I=o[0].controlPoints.length;S<I;){var k=[S++],D=o.map(function(N){return function(z){return z.controlPoints[N[0]]}}(k)),R=De.rationalInterpCurve(D,h,!0);b.push(R.controlPoints),v=R.knots}return new G(d,h,f,v,b)},De.clonedCurve=function(o){return new P(o.degree,o.knots.slice(),o.controlPoints.map(function(h){return h.slice()}))},De.rationalBezierCurve=function(o,h){for(var d=o.length-1,f=[],v=0,b=d+1;v<b;)v++,f.push(0);for(var S=0,I=d+1;S<I;)S++,f.push(1);return h==null&&(h=x.rep(o.length,1)),new P(d,f,j.homogenize1d(o,h))},De.fourPointSurface=function(o,h,d,f,v){v==null&&(v=3);for(var b=v,S=[],I=0,k=v+1;I<k;){for(var D=I++,R=[],N=0,z=v+1;N<z;){var U=N++,V=1-D/b,H=x.lerp(V,o,h),$=x.lerp(V,f,d),K=x.lerp(1-U/b,H,$);K.push(1),R.push(K)}S.push(R)}var X=x.rep(v+1,0),J=x.rep(v+1,1);return new G(v,v,X.concat(J),X.concat(J),S)},De.ellipseArc=function(o,h,d,f,v){var b=x.norm(h),S=x.norm(d);h=x.normalized(h),d=x.normalized(d),v<f&&(v=2*Math.PI+f);var I=v-f,k=0;I<=Math.PI/2?k=1:I<=Math.PI?k=2:I<=3*Math.PI/2?k=3:k=4;var D=I/k,R=Math.cos(D/2),N=x.add(o,x.add(x.mul(b*Math.cos(f),h),x.mul(S*Math.sin(f),d))),z=x.sub(x.mul(Math.cos(f),d),x.mul(Math.sin(f),h)),U=[],V=x.zeros1d(2*k+3),H=0,$=f,K=x.zeros1d(k*2);U[0]=N,K[0]=1;for(var X=1,J=k+1;X<J;){var ee=X++;$+=D;var le=x.add(o,x.add(x.mul(b*Math.cos($),h),x.mul(S*Math.sin($),d)));K[H+2]=1,U[H+2]=le;var de=x.sub(x.mul(Math.cos($),d),x.mul(Math.sin($),h)),ae=Ce.rays(N,x.mul(1/x.norm(z),z),le,x.mul(1/x.norm(de),de)),se=x.add(N,x.mul(ae.u0,z));K[H+1]=R,U[H+1]=se,H+=2,ee<k&&(N=le,z=de)}for(var ue=2*k+1,me=0;me<3;){var xe=me++;V[xe]=0,V[xe+ue]=1}switch(k){case 2:V[3]=V[4]=.5;break;case 3:V[3]=V[4]=.3333333333333333,V[5]=V[6]=.6666666666666666;break;case 4:V[3]=V[4]=.25,V[5]=V[6]=.5,V[7]=V[8]=.75;break}return new P(2,V,j.homogenize1d(U,K))},De.arc=function(o,h,d,f,v,b){return De.ellipseArc(o,x.mul(f,x.normalized(h)),x.mul(f,x.normalized(d)),v,b)},De.polyline=function(o){for(var h=[0,0],d=0,f=0,v=o.length-1;f<v;){var b=f++;d+=x.dist(o[b],o[b+1]),h.push(d)}h.push(d),h=x.mul(1/d,h);for(var S,I=[],k=0,D=o.length;k<D;)k++,I.push(1);return S=I,new P(1,h,j.homogenize1d(o.slice(0),S))},De.extrudedSurface=function(o,h,d){for(var f=[[],[],[]],v=[[],[],[]],b=j.dehomogenize1d(d.controlPoints),S=j.weight1d(d.controlPoints),I=x.mul(h,o),k=x.mul(.5*h,o),D=0,R=b.length;D<R;){var N=D++;f[2][N]=b[N],f[1][N]=x.add(k,b[N]),f[0][N]=x.add(I,b[N]),v[0][N]=S[N],v[1][N]=S[N],v[2][N]=S[N]}return new G(2,d.degree,[0,0,0,1,1,1],d.knots,j.homogenize2d(f,v))},De.cylindricalSurface=function(o,h,d,f,v){var b=x.cross(o,h),S=De.arc(d,h,b,v,0,2*Math.PI);return De.extrudedSurface(o,f,S)},De.revolvedSurface=function(o,h,d,f){var v=j.dehomogenize1d(o.controlPoints),b=j.weight1d(o.controlPoints),S,I;f<=Math.PI/2?(S=1,I=x.zeros1d(6+2*(S-1))):f<=Math.PI?(S=2,I=x.zeros1d(6+2*(S-1)),I[3]=I[4]=.5):f<=3*Math.PI/2?(S=3,I=x.zeros1d(6+2*(S-1)),I[3]=I[4]=.3333333333333333,I[5]=I[6]=.6666666666666666):(S=4,I=x.zeros1d(6+2*(S-1)),I[3]=I[4]=.25,I[5]=I[6]=.5,I[7]=I[8]=.75);for(var k=f/S,D=3+2*(S-1),R=0;R<3;){var N=R++;I[N]=0,I[D+N]=1}for(var z=Math.cos(k/2),U=0,V=x.zeros1d(S+1),H=x.zeros1d(S+1),$=x.zeros3d(2*S+1,v.length,3),K=x.zeros2d(2*S+1,v.length),X=1,J=S+1;X<J;){var ee=X++;U+=k,H[ee]=Math.cos(U),V[ee]=Math.sin(U)}for(var le=0,de=v.length;le<de;){var ae=le++,se=fn.rayClosestPoint(v[ae],h,d),ue=x.sub(v[ae],se),me=x.norm(ue),xe=x.cross(d,ue);me>ve.EPSILON&&(ue=x.mul(1/me,ue),xe=x.mul(1/me,xe)),$[0][ae]=v[ae];var Te=v[ae];K[0][ae]=b[ae];for(var ke=xe,Ie=0,Pe=1,we=S+1;Pe<we;){var Oe=Pe++,he;me==0?he=se:he=x.add(se,x.add(x.mul(me*H[Oe],ue),x.mul(me*V[Oe],xe))),$[Ie+2][ae]=he,K[Ie+2][ae]=b[ae];var Be=x.sub(x.mul(H[Oe],xe),x.mul(V[Oe],ue));if(me==0)$[Ie+1][ae]=se;else{var tt=Ce.rays(Te,x.mul(1/x.norm(ke),ke),he,x.mul(1/x.norm(Be),Be)),bt=x.add(Te,x.mul(tt.u0,ke));$[Ie+1][ae]=bt}K[Ie+1][ae]=z*b[ae],Ie+=2,Oe<S&&(Te=he,ke=Be)}}return new G(2,o.degree,I,o.knots,j.homogenize2d($,K))},De.sphericalSurface=function(o,h,d,f){var v=De.arc(o,x.mul(-1,h),d,f,0,Math.PI);return De.revolvedSurface(v,o,h,2*Math.PI)},De.conicalSurface=function(o,h,d,f,v){var b=2*Math.PI,S=1,I=[x.add(d,x.mul(f,o)),x.add(d,x.mul(v,h))],k=[0,0,1,1],D=[1,1],R=new P(S,k,j.homogenize1d(I,D));return De.revolvedSurface(R,d,o,b)},De.rationalInterpCurve=function(o,h,d,f,v){if(d==null&&(d=!1),h==null&&(h=3),o.length<h+1)throw new ie("You need to supply at least degree + 1 points! You only supplied "+o.length+" points.");for(var b=[0],S=1,I=o.length;S<I;){var k=S++,D=x.norm(x.sub(o[k],o[k-1])),R=b[b.length-1];b.push(R+D)}for(var N=b[b.length-1],z=0,U=b.length;z<U;){var V=z++;b[V]=b[V]/N}var H=x.rep(h+1,0),$=f!=null&&v!=null,K;$?K=0:K=1;var X;$?X=b.length-h+1:X=b.length-h;for(var J=K;J<X;){for(var ee=J++,le=0,de=0;de<h;){var ae=de++;le+=b[ee+ae]}H.push(1/h*le)}var se=H.concat(x.rep(h+1,1)),ue=[],me;$?me=o.length+1:me=o.length-1;var xe;$?xe=o.length-(h-1):xe=o.length-(h+1);for(var Te=0;Te<b.length;){var ke=b[Te];++Te;var Ie=j.knotSpanGivenN(me,h,ke,se),Pe=j.basisFunctionsGivenKnotSpanIndex(Ie,ke,h,se),we=Ie-h,Oe=x.zeros1d(we),he=x.zeros1d(xe-we);ue.push(Oe.concat(Pe).concat(he))}if($){var Be=ue[0].length-2,tt=[-1,1].concat(x.zeros1d(Be)),bt=x.zeros1d(Be).concat([-1,1]);ce.spliceAndInsert(ue,1,0,tt),ce.spliceAndInsert(ue,ue.length-1,0,bt)}for(var Et=o[0].length,gt=[],Tt=(1-se[se.length-h-2])/h,sn=se[h+1]/h,En=0;En<Et;){var Kt=[En++],Ht;if(!$)Ht=o.map(function(Wn){return function(bs){return bs[Wn[0]]}}(Kt));else{Ht=[o[0][Kt[0]]],Ht.push(sn*f[Kt[0]]);for(var rn=1,mn=o.length-1;rn<mn;){var Vn=rn++;Ht.push(o[Vn][Kt[0]])}Ht.push(Tt*v[Kt[0]]),Ht.push(ce.last(o)[Kt[0]])}var as=ot.solve(ue,Ht);gt.push(as)}var jn=ot.transpose(gt);if(!d){var $n=x.rep(jn.length,1);jn=j.homogenize1d(jn,$n)}return new P(h,se,jn)};var Ve=u.eval.Modify=function(){};g["verb.eval.Modify"]=Ve,Ve.__name__=["verb","eval","Modify"],Ve.curveReverse=function(o){return new P(o.degree,Ve.knotsReverse(o.knots),ce.reversed(o.controlPoints))},Ve.surfaceReverse=function(o,h){return h==null&&(h=!1),h?new G(o.degreeU,o.degreeV,o.knotsU,Ve.knotsReverse(o.knotsV),function(d){for(var f,v=[],b=0,S=o.controlPoints;b<S.length;){var I=S[b];++b,v.push(ce.reversed(I))}return f=v,f}()):new G(o.degreeU,o.degreeV,Ve.knotsReverse(o.knotsU),o.knotsV,ce.reversed(o.controlPoints))},Ve.knotsReverse=function(o){var h=ce.first(o);ce.last(o);for(var d=[h],f=o.length,v=1;v<f;){var b=v++;d.push(d[b-1]+(o[f-b]-o[f-b-1]))}return d},Ve.unifyCurveKnotVectors=function(o){o=o.map(De.clonedCurve);for(var h=w.fold(o,function(se,ue){return Ve.imax(se.degree,ue)},0),d=0,f=o.length;d<f;){var v=d++;o[v].degree<h&&(o[v]=Ve.curveElevateDegree(o[v],h))}for(var b,S=[],I=0;I<o.length;){var k=o[I];++I,S.push(new ct(ce.first(k.knots),ce.last(k.knots)))}b=S;for(var D=0,R=o.length;D<R;){var N=D++,z=[b[N].min];o[N].knots=o[N].knots.map(function(se){return function(ue){return ue-se[0]}}(z))}for(var U=b.map(function(se){return se.max-se.min}),V=w.fold(U,function(se,ue){return Math.max(se,ue)},0),H=0,$=o.length;H<$;){var K=H++,X=[V/U[K]];o[K].knots=o[K].knots.map(function(se){return function(ue){return ue*se[0]}}(X))}for(var J=w.fold(o,function(se,ue){return x.sortedSetUnion(se.knots,ue)},[]),ee=0,le=o.length;ee<le;){var de=ee++,ae=x.sortedSetSub(J,o[de].knots);ae.length==0&&(o[de]=o[de]),o[de]=Ve.curveKnotRefine(o[de],ae)}return o},Ve.imin=function(o,h){return o<h?o:h},Ve.imax=function(o,h){return o>h?o:h},Ve.curveElevateDegree=function(o,h){if(h<=o.degree)return o;var d=o.knots.length-o.degree-2,f=o.degree,v=o.knots,b=o.controlPoints,S=h-o.degree,I=o.controlPoints[0].length,k=x.zeros2d(f+S+1,f+1),D=[],R=[],N=[],z=d+f+1,U=h,V=Math.floor(U/2),H=[],$=[];k[0][0]=1,k[U][f]=1;for(var K=1,X=V+1;K<X;)for(var J=K++,ee=1/rt.get(U,J),le=Ve.imin(f,J),de=Ve.imax(0,J-S),ae=le+1;de<ae;){var se=de++;k[J][se]=ee*rt.get(f,se)*rt.get(S,J-se)}for(var ue=V+1;ue<U;)for(var me=ue++,xe=Ve.imin(f,me),Te=Ve.imax(0,me-S),ke=xe+1;Te<ke;){var Ie=Te++;k[me][Ie]=k[U-me][f-Ie]}var Pe=U+1,we=-1,Oe=f,he=f+1,Be=1,tt=v[0];H[0]=b[0];for(var bt=0,Et=U+1;bt<Et;){var gt=bt++;$[gt]=tt}for(var Tt=0,sn=f+1;Tt<sn;){var En=Tt++;D[En]=b[En]}for(;he<z;){for(var Kt=he;he<z&&v[he]==v[he+1];)he=he+1;var Ht=he-Kt+1,rn=v[he],mn=we;we=f-Ht;var Vn;mn>0?Vn=Math.floor((mn+2)/2):Vn=1;var as;if(we>0?as=Math.floor(U-(we+1)/2):as=U,we>0){for(var jn=rn-tt,$n=[],Wn=f;Wn>Ht;)$n[Wn-Ht-1]=jn/(v[Oe+Wn]-tt),Wn--;for(var bs=1,Qr=we+1;bs<Qr;){for(var vr=bs++,D0=we-vr,ml=Ht+vr,br=f;br>=ml;)D[br]=x.add(x.mul($n[br-ml],D[br]),x.mul(1-$n[br-ml],D[br-1])),br--;N[D0]=D[f]}}for(var $h=Vn,B0=U+1;$h<B0;){var Jr=$h++;R[Jr]=x.zeros1d(I);for(var N0=Ve.imin(f,Jr),Wh=Ve.imax(0,Jr-S),R0=N0+1;Wh<R0;){var Hh=Wh++;R[Jr]=x.add(R[Jr],x.mul(k[Jr][Hh],D[Hh]))}}if(mn>1)for(var yl=Pe-2,vl=Pe,qh=rn-tt,F0=(rn-$[Pe-1])/qh,Yh=1;Yh<mn;){for(var bl=Yh++,_s=yl,_r=vl,Vs=_r-Pe+1;_r-_s>bl;){if(_s<Be){var z0=(rn-$[_s])/(tt-$[_s]);H[_s]=x.lerp(z0,H[_s],H[_s-1])}if(_r>=Vn){if(_r-bl<=Pe-U+mn){var U0=(rn-$[_r-bl])/qh;R[Vs]=x.lerp(U0,R[Vs],R[Vs+1])}}else R[Vs]=x.lerp(F0,R[Vs],R[Vs+1]);_s=_s+1,_r=_r-1,Vs=Vs-1}yl=yl-1,vl=vl+1}if(Oe!=f)for(var Xh=0,G0=U-mn;Xh<G0;)Xh++,$[Pe]=tt,Pe=Pe+1;for(var Zh=Vn,V0=as+1;Zh<V0;){var j0=Zh++;H[Be]=R[j0],Be=Be+1}if(he<z){for(var Kh=0;Kh<we;){var Qh=Kh++;D[Qh]=N[Qh]}for(var Jh=we,$0=f+1;Jh<$0;){var eu=Jh++;D[eu]=b[he-f+eu]}Oe=he,he=he+1,tt=rn}else for(var tu=0,W0=U+1;tu<W0;){var H0=tu++;$[Pe+H0]=rn}}return new P(h,$,H)},Ve.rationalSurfaceTransform=function(o,h){for(var d=j.dehomogenize2d(o.controlPoints),f=0,v=d.length;f<v;)for(var b=f++,S=0,I=d[b].length;S<I;){var k=S++,D=d[b][k];D.push(1),d[b][k]=ot.dot(h,D).slice(0,D.length-1)}return new G(o.degreeU,o.degreeV,o.knotsU.slice(),o.knotsV.slice(),j.homogenize2d(d,j.weight2d(o.controlPoints)))},Ve.rationalCurveTransform=function(o,h){for(var d=j.dehomogenize1d(o.controlPoints),f=0,v=d.length;f<v;){var b=f++,S=d[b];S.push(1),d[b]=ot.dot(h,S).slice(0,S.length-1)}return new P(o.degree,o.knots.slice(),j.homogenize1d(d,j.weight1d(o.controlPoints)))},Ve.surfaceKnotRefine=function(o,h,d){var f=[],v,b,S;d?(S=o.controlPoints,v=o.knotsV,b=o.degreeV):(S=ot.transpose(o.controlPoints),v=o.knotsU,b=o.degreeU);for(var I=null,k=0;k<S.length;){var D=S[k];++k,I=Ve.curveKnotRefine(new P(b,v,D),h),f.push(I.controlPoints)}var R=I.knots;return d?new G(o.degreeU,o.degreeV,o.knotsU.slice(),R,f):(f=ot.transpose(f),new G(o.degreeU,o.degreeV,R,o.knotsV.slice(),f))},Ve.decomposeCurveIntoBeziers=function(o){for(var h=o.degree,d=o.controlPoints,f=o.knots,v=$e.knotMultiplicities(f),b=h+1,S=0;S<v.length;){var I=v[S];if(++S,I.mult<b){var k=x.rep(b-I.mult,I.knot),D=Ve.curveKnotRefine(new P(h,f,d),k);f=D.knots,d=D.controlPoints}}f.length/b-1;for(var R=b*2,N=[],z=0;z<d.length;){var U=f.slice(z,z+R),V=d.slice(z,z+b);N.push(new P(h,U,V)),z+=b}return N},Ve.curveKnotRefine=function(o,h){if(h.length==0)return De.clonedCurve(o);for(var d=o.degree,f=o.controlPoints,v=o.knots,b=f.length-1,S=b+d+1,I=h.length-1,k=j.knotSpan(d,h[0],v),D=j.knotSpan(d,h[I],v),R=[],N=[],z=0,U=k-d+1;z<U;){var V=z++;R[V]=f[V]}for(var H=D-1,$=b+1;H<$;){var K=H++;R[K+I+1]=f[K]}for(var X=0,J=k+1;X<J;){var ee=X++;N[ee]=v[ee]}for(var le=D+d,de=S+1;le<de;){var ae=le++;N[ae+I+1]=v[ae]}for(var se=D+d-1,ue=D+d+I,me=I;me>=0;){for(;h[me]<=v[se]&&se>k;)R[ue-d-1]=f[se-d-1],N[ue]=v[se],ue=ue-1,se=se-1;R[ue-d-1]=R[ue-d];for(var xe=1,Te=d+1;xe<Te;){var ke=xe++,Ie=ue-d+ke,Pe=N[ue+ke]-h[me];Math.abs(Pe)<ve.EPSILON?R[Ie-1]=R[Ie]:(Pe=Pe/(N[ue+ke]-v[se-d+ke]),R[Ie-1]=x.add(x.mul(Pe,R[Ie-1]),x.mul(1-Pe,R[Ie])))}N[ue]=h[me],ue=ue-1,me--}return new P(d,N,R)},Ve.curveKnotInsert=function(o,h,d){for(var f=o.degree,v=o.controlPoints,b=o.knots,S=0,I=v.length,k=j.knotSpan(f,h,b),D=[],R=[],N=[],z=1,U=k+1;z<U;){var V=z++;R[V]=b[V]}for(var H=1,$=d+1;H<$;){var K=H++;R[k+K]=h}for(var X=k+1,J=b.length;X<J;){var ee=X++;R[ee+d]=b[ee]}for(var le=0,de=k-f+1;le<de;){var ae=le++;N[ae]=v[ae]}for(var se=k-S;se<I;){var ue=se++;N[ue+d]=v[ue]}for(var me=0,xe=f-S+1;me<xe;){var Te=me++;D[Te]=v[k-f+Te]}for(var ke=0,Ie=0,Pe=1,we=d+1;Pe<we;){var Oe=Pe++;ke=k-f+Oe;for(var he=0,Be=f-Oe-S+1;he<Be;){var tt=he++;Ie=(h-b[ke+tt])/(b[tt+k+1]-b[ke+tt]),D[tt]=x.add(x.mul(Ie,D[tt+1]),x.mul(1-Ie,D[tt]))}N[ke]=D[0],N[k+d-Oe-S]=D[f-Oe-S]}for(var bt=ke+1,Et=k-S;bt<Et;){var gt=bt++;N[gt]=D[gt-ke]}return new P(f,R,N)};var ut=u.eval.Tess=function(){};g["verb.eval.Tess"]=ut,ut.__name__=["verb","eval","Tess"],ut.rationalCurveRegularSample=function(o,h,d){return ut.rationalCurveRegularSampleRange(o,o.knots[0],ce.last(o.knots),h,d)},ut.rationalCurveRegularSampleRange=function(o,h,d,f,v){f<1&&(f=2);for(var b=[],S=(d-h)/(f-1),I=0,k=0;k<f;){var D=k++;I=h+S*D,v?b.push([I].concat(j.rationalCurvePoint(o,I))):b.push(j.rationalCurvePoint(o,I))}return b},ut.rationalCurveAdaptiveSample=function(o,h,d){if(d==null&&(d=!1),h==null&&(h=1e-6),o.degree==1)if(d){for(var f=[],v=0,b=o.controlPoints.length;v<b;){var S=v++;f.push([o.knots[S+1]].concat(j.dehomogenize(o.controlPoints[S])))}return f}else return o.controlPoints.map(j.dehomogenize);return ut.rationalCurveAdaptiveSampleRange(o,o.knots[0],ce.last(o.knots),h,d)},ut.rationalCurveAdaptiveSampleRange=function(o,h,d,f,v){var b=j.rationalCurvePoint(o,h),S=j.rationalCurvePoint(o,d),I=.5+.2*Math.random(),k=h+(d-h)*I,D=j.rationalCurvePoint(o,k),R=x.sub(b,S),N=x.sub(b,D);if(x.dot(R,R)<f&&x.dot(N,N)>f||!fn.threePointsAreFlat(b,D,S,f)){var z=h+(d-h)*.5,U=ut.rationalCurveAdaptiveSampleRange(o,h,z,f,v),V=ut.rationalCurveAdaptiveSampleRange(o,z,d,f,v);return U.slice(0,-1).concat(V)}else return v?[[h].concat(b),[d].concat(S)]:[b,S]},ut.rationalSurfaceNaive=function(o,h,d){h<1&&(h=1),d<1&&(d=1),o.degreeU,o.degreeV,o.controlPoints;for(var f=o.knotsU,v=o.knotsV,b=ce.last(f)-f[0],S=ce.last(v)-v[0],I=b/h,k=S/d,D=[],R=[],N=[],z=0,U=h+1;z<U;)for(var V=z++,H=0,$=d+1;H<$;){var K=H++,X=V*I,J=K*k;R.push([X,J]);var ee=j.rationalSurfaceDerivatives(o,X,J,1),le=ee[0][0];D.push(le);var de=x.normalized(x.cross(ee[1][0],ee[0][1]));N.push(de)}for(var ae=[],se=0;se<h;)for(var ue=se++,me=0;me<d;){var xe=me++,Te=ue*(d+1)+xe,ke=(ue+1)*(d+1)+xe,Ie=ke+1,Pe=Te+1,we=[Te,ke,Ie],Oe=[Te,Ie,Pe];ae.push(we),ae.push(Oe)}return new Y(ae,D,N,R)},ut.divideRationalSurfaceAdaptive=function(o,h){h==null&&(h=new Rs),h.minDivsU!=null?h.minDivsU=h.minDivsU:h.minDivsU=1,h.minDivsV!=null?h.minDivsU=h.minDivsV:h.minDivsU=1,h.refine!=null?h.refine=h.refine:h.refine=!0;var d=(o.controlPoints.length-1)*2,f=(o.controlPoints[0].length-1)*2,v;h.minDivsU>d?v=h.minDivsU=h.minDivsU:v=h.minDivsU=d;var b;h.minDivsV>f?b=h.minDivsV=h.minDivsV:b=h.minDivsV=f;for(var S=ce.last(o.knotsU),I=o.knotsU[0],k=ce.last(o.knotsV),D=o.knotsV[0],R=(S-I)/v,N=(k-D)/b,z=[],U=[],V=0,H=b+1;V<H;){for(var $=V++,K=[],X=0,J=v+1;X<J;){var ee=X++,le=I+R*ee,de=D+N*$,ae=j.rationalSurfaceDerivatives(o,le,de,1),se=x.normalized(x.cross(ae[0][1],ae[1][0]));K.push(new Sn(ae[0][0],se,[le,de],-1,x.isZero(se)))}U.push(K)}for(var ue=0;ue<b;)for(var me=ue++,xe=0;xe<v;){var Te=xe++,ke=[U[b-me-1][Te],U[b-me-1][Te+1],U[b-me][Te+1],U[b-me][Te]];z.push(new vs(o,ke))}if(!h.refine)return z;for(var Ie=0;Ie<b;)for(var Pe=Ie++,we=0;we<v;){var Oe=we++,he=Pe*v+Oe,Be=ut.north(he,Pe,Oe,v,b,z),tt=ut.east(he,Pe,Oe,v,b,z),bt=ut.south(he,Pe,Oe,v,b,z),Et=ut.west(he,Pe,Oe,v,b,z);z[he].neighbors=[bt,tt,Be,Et],z[he].divide(h)}return z},ut.north=function(o,h,d,f,v,b){return h==0?null:b[o-f]},ut.south=function(o,h,d,f,v,b){return h==v-1?null:b[o+f]},ut.east=function(o,h,d,f,v,b){return d==f-1?null:b[o+1]},ut.west=function(o,h,d,f,v,b){return d==0?null:b[o-1]},ut.triangulateAdaptiveRefinementNodeTree=function(o){for(var h=Y.empty(),d=0;d<o.length;){var f=o[d];++d,f.triangulate(h)}return h},ut.rationalSurfaceAdaptive=function(o,h){h!=null?h=h:h=new Rs;var d=ut.divideRationalSurfaceAdaptive(o,h);return ut.triangulateAdaptiveRefinementNodeTree(d)};var Rs=u.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};g["verb.eval.AdaptiveRefinementOptions"]=Rs,Rs.__name__=["verb","eval","AdaptiveRefinementOptions"],Rs.prototype={__class__:Rs};var vs=u.core.AdaptiveRefinementNode=function(o,h,d){if(this.srf=o,d==null?this.neighbors=[null,null,null,null]:this.neighbors=d,this.corners=h,this.corners==null){var f=o.knotsU[0],v=ce.last(o.knotsU),b=o.knotsV[0],S=ce.last(o.knotsV);this.corners=[Sn.fromUv(f,b),Sn.fromUv(v,b),Sn.fromUv(v,S),Sn.fromUv(f,S)]}};g["verb.eval.AdaptiveRefinementNode"]=vs,vs.__name__=["verb","eval","AdaptiveRefinementNode"],vs.prototype={isLeaf:function(){return this.children==null},center:function(){return this.centerPoint!=null?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var o=0;o<4;){var h=o++;if(this.corners[h].point==null){var d=this.corners[h];this.evalSrf(d.uv[0],d.uv[1],d)}}},evalSrf:function(o,h,d){var f=j.rationalSurfaceDerivatives(this.srf,o,h,1),v=f[0][0],b=x.cross(f[0][1],f[1][0]),S=x.isZero(b);return S||(b=x.normalized(b)),d!=null?(d.degen=S,d.point=v,d.normal=b,d):new Sn(v,b,[o,h],-1,S)},getEdgeCorners:function(o){if(this.isLeaf())return[this.corners[o]];if(this.horizontal)switch(o){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(o){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(o){var h=[this.corners[o]];if(this.neighbors[o]==null)return h;var d=this.neighbors[o].getEdgeCorners((o+2)%4),f=o%2,v=ve.EPSILON,b=this,S=[function(k){return k.uv[0]>b.corners[0].uv[0]+v&&k.uv[0]<b.corners[2].uv[0]-v},function(k){return k.uv[1]>b.corners[0].uv[1]+v&&k.uv[1]<b.corners[2].uv[1]-v}],I=d.filter(S[f]);return I.reverse(),h.concat(I)},midpoint:function(o){if(this.midPoints==null&&(this.midPoints=[null,null,null,null]),this.midPoints[o]!=null)return this.midPoints[o];switch(o){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05);break}return this.midPoints[o]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var o=this.corners.length,h=0;h<o;){var d=h++;if(this.corners[d],this.corners[d].degen){var f=this.corners[(d+1)%o],v=this.corners[(d+3)%o];f.degen?this.corners[d].normal=v.normal:this.corners[d].normal=f.normal}}},shouldDivide:function(o,h){if(h<o.minDepth)return!0;if(h>=o.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=x.normSquared(x.sub(this.corners[0].normal,this.corners[1].normal))>o.normTol||x.normSquared(x.sub(this.corners[2].normal,this.corners[3].normal))>o.normTol,this.splitHoriz=x.normSquared(x.sub(this.corners[1].normal,this.corners[2].normal))>o.normTol||x.normSquared(x.sub(this.corners[3].normal,this.corners[0].normal))>o.normTol,this.splitVert||this.splitHoriz)return!0;var d=this.center();return x.normSquared(x.sub(d.normal,this.corners[0].normal))>o.normTol||x.normSquared(x.sub(d.normal,this.corners[1].normal))>o.normTol||x.normSquared(x.sub(d.normal,this.corners[2].normal))>o.normTol||x.normSquared(x.sub(d.normal,this.corners[3].normal))>o.normTol},divide:function(o){o==null&&(o=new Rs),o.normTol==null&&(o.normTol=.085),o.minDepth==null&&(o.minDepth=0),o.maxDepth==null&&(o.maxDepth=10),this._divide(o,0,!0)},_divide:function(o,h,d){if(this.evalCorners(),!!this.shouldDivide(o,h)){if(h++,this.splitVert&&!this.splitHoriz?d=!1:!this.splitVert&&this.splitHoriz&&(d=!0),this.horizontal=d,this.horizontal){var f=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],v=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new vs(this.srf,f),new vs(this.srf,v)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var b=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],S=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new vs(this.srf,b),new vs(this.srf,S)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var I=0,k=this.children;I<k.length;){var D=k[I];++I,D._divide(o,h,!d)}}},triangulate:function(o){if(o==null&&(o=Y.empty()),this.isLeaf())return this.triangulateLeaf(o);for(var h=0,d=this.children;h<d.length;){var f=d[h];if(++h,f==null)break;f.triangulate(o)}return o},triangulateLeaf:function(o){for(var h=o.points.length,d=[],f=[],v=0,b=0;b<4;){var S=b++,I=this.getAllCorners(S);I.length==2&&(v=S+1);for(var k=0,D=I.length;k<D;){var R=k++;d.push(I[R])}}for(var N=0;N<d.length;){var z=d[N];if(++N,z.id!=-1){f.push(z.id);continue}o.uvs.push(z.uv),o.points.push(z.point),o.normals.push(z.normal),z.id=h,f.push(h),h++}if(d.length==4)return o.faces.push([f[0],f[3],f[1]]),o.faces.push([f[3],f[2],f[1]]),o;if(d.length==5){var U=f.length;return o.faces.push([f[v],f[(v+2)%U],f[(v+1)%U]]),o.faces.push([f[(v+4)%U],f[(v+3)%U],f[v]]),o.faces.push([f[v],f[(v+3)%U],f[(v+2)%U]]),o}var V=this.center();o.uvs.push(V.uv),o.points.push(V.point),o.normals.push(V.normal);for(var H=o.points.length-1,$=0,K=d.length-1;$<d.length;)o.faces.push([H,f[$],f[K]]),K=$++;return o},__class__:vs};var Ke=u.exe.Dispatcher=function(){};g["verb.exe.Dispatcher"]=Ke,Ke.__name__=["verb","exe","Dispatcher"],Ke.init=function(){Ke._init||(Ke._workerPool=new Fs(Ke.THREADS),Ke._init=!0)},Ke.dispatchMethod=function(o,h,d){Ke.init();var f=new zn,v=function(b){f.resolve(b)};return Ke._workerPool.addWork(Z.getClassName(o),h,d,v),new Mt(f)};var Fs=u.exe.WorkerPool=function(o,h){h==null&&(h="verb.js"),o==null&&(o=1),this._callbacks=new ge,this._working=new ge,this._pool=[],this._queue=[];for(var d=0;d<o;){d++;var f;try{f=new Worker(Fs.basePath+h)}catch(v){v instanceof ie&&(v=v.val),f=new Worker(Fs.basePath+h.substring(0,-3)+".min.js")}this._pool.push(f)}};g["verb.exe.WorkerPool"]=Fs,Fs.__name__=["verb","exe","WorkerPool"],Fs.prototype={addWork:function(o,h,d,f){var v=new yr(o,h,d);this._callbacks.set(v.id,f),this._queue.push(v),this.processQueue()},processQueue:function(){for(var o=this;this._queue.length>0&&this._pool.length>0;){var h=this._queue.shift(),d=[h.id],f=[this._pool.shift()];this._working.h[d[0]]=f[0],f[0].onmessage=function(v,b){return function(S){o._working.remove(b[0]),o._pool.push(v[0]);try{o._callbacks.h.hasOwnProperty(b[0])&&(o._callbacks.h[b[0]](S.data.result),o._callbacks.remove(b[0]))}catch(I){I instanceof ie&&(I=I.val),c.log(I)}o.processQueue()}}(f,d),f[0].postMessage(h)}},__class__:Fs};var yr=function(o,h,d){this.className=o,this.methodName=h,this.args=d,this.id=yr.uuid++};g["verb.exe._WorkerPool.Work"]=yr,yr.__name__=["verb","exe","_WorkerPool","Work"],yr.prototype={__class__:yr};var Zr=function(){};g["verb.geom.ICurve"]=Zr,Zr.__name__=["verb","geom","ICurve"],Zr.__interfaces__=[qr],Zr.prototype={__class__:Zr};var it=u.geom.NurbsCurve=function(o){this._data=An.isValidNurbsCurveData(o)};g["verb.geom.NurbsCurve"]=it,it.__name__=["verb","geom","NurbsCurve"],it.__interfaces__=[Zr],it.byKnotsControlPointsWeights=function(o,h,d,f){return new it(new P(o,h.slice(),j.homogenize1d(d,f)))},it.byPoints=function(o,h){return h==null&&(h=3),new it(De.rationalInterpCurve(o,h))},it.__super__=St,it.prototype=y(St.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return j.dehomogenize1d(this._data.controlPoints)},weights:function(){return j.weight1d(this._data.controlPoints)},asNurbs:function(){return new P(this.degree(),this.knots(),j.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new it(this._data)},domain:function(){return new ct(ce.first(this._data.knots),ce.last(this._data.knots))},transform:function(o){return new it(Ve.rationalCurveTransform(this._data,o))},transformAsync:function(o){return Ke.dispatchMethod(Ve,"rationalCurveTransform",[this._data,o]).then(function(h){return new it(h)})},point:function(o){return j.rationalCurvePoint(this._data,o)},pointAsync:function(o){return Ke.dispatchMethod(j,"rationalCurvePoint",[this._data,o])},tangent:function(o){return j.rationalCurveTangent(this._data,o)},tangentAsync:function(o){return Ke.dispatchMethod(j,"rationalCurveTangent",[this._data,o])},derivatives:function(o,h){return h==null&&(h=1),j.rationalCurveDerivatives(this._data,o,h)},derivativesAsync:function(o,h){return h==null&&(h=1),Ke.dispatchMethod(j,"rationalCurveDerivatives",[this._data,o,h])},closestPoint:function(o){return $e.rationalCurveClosestPoint(this._data,o)},closestPointAsync:function(o){return Ke.dispatchMethod($e,"rationalCurveClosestPoint",[this._data,o])},closestParam:function(o){return $e.rationalCurveClosestParam(this._data,o)},closestParamAsync:function(o){return Ke.dispatchMethod($e,"rationalCurveClosestParam",[this._data,o])},length:function(){return $e.rationalCurveArcLength(this._data)},lengthAsync:function(){return Ke.dispatchMethod($e,"rationalCurveArcLength",[this._data])},lengthAtParam:function(o){return $e.rationalCurveArcLength(this._data,o)},lengthAtParamAsync:function(){return Ke.dispatchMethod($e,"rationalCurveArcLength",[this._data])},paramAtLength:function(o,h){return $e.rationalCurveParamAtArcLength(this._data,o,h)},paramAtLengthAsync:function(o,h){return Ke.dispatchMethod($e,"rationalCurveParamAtArcLength",[this._data,o,h])},divideByEqualArcLength:function(o){return $t.rationalCurveByEqualArcLength(this._data,o)},divideByEqualArcLengthAsync:function(o){return Ke.dispatchMethod($t,"rationalCurveByEqualArcLength",[this._data,o])},divideByArcLength:function(o){return $t.rationalCurveByArcLength(this._data,o)},divideByArcLengthAsync:function(o){return Ke.dispatchMethod($t,"rationalCurveByArcLength",[this._data,o])},split:function(o){return $t.curveSplit(this._data,o).map(function(h){return new it(h)})},splitAsync:function(o){return Ke.dispatchMethod($t,"curveSplit",[this._data,o]).then(function(h){return h.map(function(d){return new it(d)})})},reverse:function(){return new it(Ve.curveReverse(this._data))},reverseAsync:function(){return Ke.dispatchMethod(Ve,"curveReverse",[this._data]).then(function(o){return new it(o)})},tessellate:function(o){return ut.rationalCurveAdaptiveSample(this._data,o,!1)},tessellateAsync:function(o){return Ke.dispatchMethod(ut,"rationalCurveAdaptiveSample",[this._data,o,!1])},__class__:it});var zs=u.geom.Arc=function(o,h,d,f,v,b){it.call(this,De.arc(o,h,d,f,v,b)),this._center=o,this._xaxis=h,this._yaxis=d,this._radius=f,this._minAngle=v,this._maxAngle=b};g["verb.geom.Arc"]=zs,zs.__name__=["verb","geom","Arc"],zs.__super__=it,zs.prototype=y(it.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:zs});var Vi=u.geom.BezierCurve=function(o,h){it.call(this,De.rationalBezierCurve(o,h))};g["verb.geom.BezierCurve"]=Vi,Vi.__name__=["verb","geom","BezierCurve"],Vi.__super__=it,Vi.prototype=y(it.prototype,{__class__:Vi});var ji=u.geom.Circle=function(o,h,d,f){zs.call(this,o,h,d,f,0,Math.PI*2)};g["verb.geom.Circle"]=ji,ji.__name__=["verb","geom","Circle"],ji.__super__=zs,ji.prototype=y(zs.prototype,{__class__:ji});var Kr=function(){};g["verb.geom.ISurface"]=Kr,Kr.__name__=["verb","geom","ISurface"],Kr.__interfaces__=[qr],Kr.prototype={__class__:Kr};var nt=u.geom.NurbsSurface=function(o){this._data=An.isValidNurbsSurfaceData(o)};g["verb.geom.NurbsSurface"]=nt,nt.__name__=["verb","geom","NurbsSurface"],nt.__interfaces__=[Kr],nt.byKnotsControlPointsWeights=function(o,h,d,f,v,b){return new nt(new G(o,h,d,f,j.homogenize2d(v,b)))},nt.byCorners=function(o,h,d,f){return new nt(De.fourPointSurface(o,h,d,f))},nt.byLoftingCurves=function(o,h){return new nt(De.loftedSurface(function(d){for(var f,v=[],b=0;b<o.length;){var S=o[b];++b,v.push(S.asNurbs())}return f=v,f}(),h))},nt.__super__=St,nt.prototype=y(St.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return j.dehomogenize2d(this._data.controlPoints)},weights:function(){return j.weight2d(this._data.controlPoints)},asNurbs:function(){return new G(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),j.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new nt(this.asNurbs())},domainU:function(){return new ct(ce.first(this._data.knotsU),ce.last(this._data.knotsU))},domainV:function(){return new ct(ce.first(this._data.knotsV),ce.last(this._data.knotsV))},point:function(o,h){return j.rationalSurfacePoint(this._data,o,h)},pointAsync:function(o,h){return Ke.dispatchMethod(j,"rationalSurfacePoint",[this._data,o,h])},normal:function(o,h){return j.rationalSurfaceNormal(this._data,o,h)},normalAsync:function(o,h){return Ke.dispatchMethod(j,"rationalSurfaceNormal",[this._data,o,h])},derivatives:function(o,h,d){return d==null&&(d=1),j.rationalSurfaceDerivatives(this._data,o,h,d)},derivativesAsync:function(o,h,d){return d==null&&(d=1),Ke.dispatchMethod(j,"rationalSurfaceDerivatives",[this._data,o,h,d])},closestParam:function(o){return $e.rationalSurfaceClosestParam(this._data,o)},closestParamAsync:function(o){return Ke.dispatchMethod($e,"rationalSurfaceClosestParam",[this._data,o])},closestPoint:function(o){return $e.rationalSurfaceClosestPoint(this._data,o)},closestPointAsync:function(o){return Ke.dispatchMethod($e,"rationalSurfaceClosestPoint",[this._data,o])},split:function(o,h){return h==null&&(h=!1),$t.surfaceSplit(this._data,o,h).map(function(d){return new nt(d)})},splitAsync:function(o,h){return h==null&&(h=!1),Ke.dispatchMethod($t,"surfaceSplit",[this._data,o,h]).then(function(d){return d.map(function(f){return new nt(f)})})},reverse:function(o){return o==null&&(o=!1),new nt(Ve.surfaceReverse(this._data,o))},reverseAsync:function(o){return o==null&&(o=!1),Ke.dispatchMethod(Ve,"surfaceReverse",[this._data,o]).then(function(h){return new nt(h)})},isocurve:function(o,h){return h==null&&(h=!1),new it(De.surfaceIsocurve(this._data,o,h))},isocurveAsync:function(o,h){return h==null&&(h=!1),Ke.dispatchMethod(De,"surfaceIsocurve",[this._data,o,h]).then(function(d){return new it(d)})},boundaries:function(o){return De.surfaceBoundaryCurves(this._data).map(function(h){return new it(h)})},boundariesAsync:function(o){return Ke.dispatchMethod(De,"surfaceBoundaryCurves",[this._data]).then(function(h){return h.map(function(d){return new it(d)})})},tessellate:function(o){return ut.rationalSurfaceAdaptive(this._data,o)},tessellateAsync:function(o){return Ke.dispatchMethod(ut,"rationalSurfaceAdaptive",[this._data,o])},transform:function(o){return new nt(Ve.rationalSurfaceTransform(this._data,o))},transformAsync:function(o){return Ke.dispatchMethod(Ve,"rationalSurfaceTransform",[this._data,o]).then(function(h){return new nt(h)})},__class__:nt});var $i=u.geom.ConicalSurface=function(o,h,d,f,v){nt.call(this,De.conicalSurface(o,h,d,f,v)),this._axis=o,this._xaxis=h,this._base=d,this._height=f,this._radius=v};g["verb.geom.ConicalSurface"]=$i,$i.__name__=["verb","geom","ConicalSurface"],$i.__super__=nt,$i.prototype=y(nt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:$i});var Wi=u.geom.CylindricalSurface=function(o,h,d,f,v){nt.call(this,De.cylindricalSurface(o,h,d,f,v)),this._axis=o,this._xaxis=h,this._base=d,this._height=f,this._radius=v};g["verb.geom.CylindricalSurface"]=Wi,Wi.__name__=["verb","geom","CylindricalSurface"],Wi.__super__=nt,Wi.prototype=y(nt.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Wi});var Us=u.geom.EllipseArc=function(o,h,d,f,v){it.call(this,De.ellipseArc(o,h,d,f,v)),this._center=o,this._xaxis=h,this._yaxis=d,this._minAngle=f,this._maxAngle=v};g["verb.geom.EllipseArc"]=Us,Us.__name__=["verb","geom","EllipseArc"],Us.__super__=it,Us.prototype=y(it.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Us});var Hi=u.geom.Ellipse=function(o,h,d){Us.call(this,o,h,d,0,Math.PI*2)};g["verb.geom.Ellipse"]=Hi,Hi.__name__=["verb","geom","Ellipse"],Hi.__super__=Us,Hi.prototype=y(Us.prototype,{__class__:Hi});var qi=u.geom.ExtrudedSurface=function(o,h){nt.call(this,De.extrudedSurface(x.normalized(h),x.norm(h),o.asNurbs())),this._profile=o,this._direction=h};g["verb.geom.ExtrudedSurface"]=qi,qi.__name__=["verb","geom","ExtrudedSurface"],qi.__super__=nt,qi.prototype=y(nt.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:qi});var Gs=u.geom.Intersect=function(){};g["verb.geom.Intersect"]=Gs,Gs.__name__=["verb","geom","Intersect"],Gs.curves=function(o,h,d){return d==null&&(d=.001),Ce.curves(o.asNurbs(),h.asNurbs(),d)},Gs.curvesAsync=function(o,h,d){return d==null&&(d=.001),Ke.dispatchMethod(Ce,"curves",[o.asNurbs(),h.asNurbs(),d])},Gs.curveAndSurface=function(o,h,d){return d==null&&(d=.001),Ce.curveAndSurface(o.asNurbs(),h.asNurbs(),d)},Gs.curveAndSurfaceAsync=function(o,h,d){return d==null&&(d=.001),Ke.dispatchMethod(Ce,"curveAndSurface",[o.asNurbs(),h.asNurbs(),d])},Gs.surfaces=function(o,h,d){return d==null&&(d=.001),Ce.surfaces(o.asNurbs(),h.asNurbs(),d).map(function(f){return new it(f)})},Gs.surfacesAsync=function(o,h,d){return d==null&&(d=.001),Ke.dispatchMethod(Ce,"surfaces",[o.asNurbs(),h.asNurbs(),d]).then(function(f){return f.map(function(v){return new it(v)})})};var Yi=u.geom.Line=function(o,h){it.call(this,De.polyline([o,h])),this._start=o,this._end=h};g["verb.geom.Line"]=Yi,Yi.__name__=["verb","geom","Line"],Yi.__super__=it,Yi.prototype=y(it.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:Yi});var Xi=u.geom.RevolvedSurface=function(o,h,d,f){nt.call(this,De.revolvedSurface(o.asNurbs(),h,d,f)),this._profile=o,this._center=h,this._axis=d,this._angle=f};g["verb.geom.RevolvedSurface"]=Xi,Xi.__name__=["verb","geom","RevolvedSurface"],Xi.__super__=nt,Xi.prototype=y(nt.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:Xi});var Zi=u.geom.SphericalSurface=function(o,h){nt.call(this,De.sphericalSurface(o,[0,0,1],[1,0,0],h)),this._center=o,this._radius=h};g["verb.geom.SphericalSurface"]=Zi,Zi.__name__=["verb","geom","SphericalSurface"],Zi.__super__=nt,Zi.prototype=y(nt.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:Zi});var Ki=u.geom.SweptSurface=function(o,h){nt.call(this,De.rationalTranslationalSurface(o.asNurbs(),h.asNurbs())),this._profile=o,this._rail=h};g["verb.geom.SweptSurface"]=Ki,Ki.__name__=["verb","geom","SweptSurface"],Ki.__super__=nt,Ki.prototype=y(nt.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:Ki});function Gn(o){return o instanceof Array?function(){return A.iter(o)}:typeof o.iterator=="function"?gn(o,o.iterator):o.iterator}var pl,P0=0;function gn(o,h){if(h==null)return null;h.__id__==null&&(h.__id__=P0++);var d;return o.hx__closures__==null?o.hx__closures__={}:d=o.hx__closures__[h.__id__],d==null&&(d=function(){return d.method.apply(d.scope,arguments)},d.scope=o,d.method=h,o.hx__closures__[h.__id__]=d),d}g.Math=Math,String.prototype.__class__=g.String=String,String.__name__=["String"],g.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=g.Date=Date,Date.__name__=["Date"];var L0=g.Int={__name__:["Int"]},O0=g.Dynamic={__name__:["Dynamic"]},Uh=g.Float=Number;Uh.__name__=["Float"];var Gh=g.Bool=Boolean;Gh.__ename__=["Bool"];var Vh=g.Class={__name__:["Class"]},jh={};Array.prototype.map==null&&(Array.prototype.map=function(o){for(var h=[],d=0,f=this.length;d<f;){var v=d++;h[v]=o(this[v])}return h}),Array.prototype.filter==null&&(Array.prototype.filter=function(o){for(var h=[],d=0,f=this.length;d<f;){var v=d++,b=this[v];o(b)&&h.push(b)}return h});var fl={},Ha=p.ArrayBuffer||et;Ha.prototype.slice==null&&(Ha.prototype.slice=et.sliceImpl),p.DataView;var gl=p.Uint8Array||He._new;(function(o,h){if(o.setImmediate)return;var d=1,f={},v=!1,b=o.document,S;function I(X){return f[d]=k.apply(h,X),d++}function k(X){var J=[].slice.call(arguments,1);return function(){typeof X=="function"?X.apply(h,J):new Function(""+X)()}}function D(X){if(v)setTimeout(k(D,X),0);else{var J=f[X];if(J){v=!0;try{J()}finally{R(X),v=!1}}}}function R(X){delete f[X]}function N(){S=function(){var X=I(arguments);return process.nextTick(k(D,X)),X}}function z(){if(o.postMessage&&!o.importScripts){var X=!0,J=o.onmessage;return o.onmessage=function(){X=!1},o.postMessage("","*"),o.onmessage=J,X}}function U(){var X="setImmediate$"+Math.random()+"$",J=function(ee){ee.source===o&&typeof ee.data=="string"&&ee.data.indexOf(X)===0&&D(+ee.data.slice(X.length))};o.addEventListener?o.addEventListener("message",J,!1):o.attachEvent("onmessage",J),S=function(){var ee=I(arguments);return o.postMessage(X+ee,"*"),ee}}function V(){var X=new MessageChannel;X.port1.onmessage=function(J){var ee=J.data;D(ee)},S=function(){var J=I(arguments);return X.port2.postMessage(J),J}}function H(){var X=b.documentElement;S=function(){var J=I(arguments),ee=b.createElement("script");return ee.onreadystatechange=function(){D(J),ee.onreadystatechange=null,X.removeChild(ee),ee=null},X.appendChild(ee),J}}function $(){S=function(){var X=I(arguments);return setTimeout(k(D,X),0),X}}var K=Object.getPrototypeOf&&Object.getPrototypeOf(o);K=K&&K.setTimeout?K:o,{}.toString.call(o.process)==="[object process]"?N():z()?U():o.MessageChannel?V():b&&"onreadystatechange"in b.createElement("script")?H():$(),K.setImmediate=S,K.clearImmediate=R})(new Function("return this")()),ye.USE_CACHE=!1,ye.USE_ENUM_INDEX=!1,ye.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",Se.DEFAULT_RESOLVER=Z,Se.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",Le.count=0,Xe.i64tmp=function(o){var h,d=new Q(0,0);return h=d,h}(),Ee.__toStr={}.toString,He.BYTES_PER_ELEMENT=1,Re.queue=new C,rt.memo=new ge,ve.TOLERANCE=1e-6,ve.EPSILON=1e-10,ve.VERSION="2.0.0",$e.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],$e.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Ke.THREADS=1,Ke._init=!1,Fs.basePath="",yr.uuid=0,jr.main()}(typeof console<"u"?console:{log:function(){}},t,typeof a<"u"?a:typeof n<"u"?n:typeof self<"u"?self:this),t})})(Yp);var ly=Yp.exports;const ni=oy(ly);let Il=class{constructor(){this.c0=0,this.c1=0,this.c2=0,this.c3=0}init(e,t,n,r){this.c0=e,this.c1=n,this.c2=-3*e+3*t-2*n-r,this.c3=2*e-2*t+n+r}initCatmullRom(e,t,n,r,i){this.init(t,n,i*(n-e),i*(r-t))}initNonuniformCatmullRom(e,t,n,r,i,a,l){let c=(t-e)/i-(n-e)/(i+a)+(n-t)/a,u=(n-t)/a-(r-t)/(a+l)+(r-n)/l;c*=a,u*=a,this.init(t,n,c,u)}calc(e){const t=e*e,n=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*n}},cy=class extends Da{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3d=!0,this.type="CatmullRomCurve3d",this._tmp=new oe,this._px=new Il,this._py=new Il,this._pz=new Il,this._points=e.map(i=>new te(i)),this._closed=t,this._curveType=n,this._tension=r}get points(){return this._points}get closed(){return this._closed}get curveType(){return this._curveType}get tension(){return this._tension}get startPoint(){return this._points.length>0?this._points[0]:new te}get endPoint(){return this._points.length>0?this._points[this._points.length-1]:new te}get length(){if(this._points.length<2)return 0;let e=0;for(let t=1;t<this._points.length;t++)e+=this._points[t-1].distanceTo(this._points[t]);return this._closed&&this._points.length>2&&(e+=this._points[this._points.length-1].distanceTo(this._points[0])),e}getPoint(e,t=new te){const n=t,r=this._points,i=r.length;if(i===0)return n.set(0,0,0);if(i===1)return n.copy(r[0]);const a=(i-(this._closed?0:1))*e;let l=Math.floor(a),c=a-l;this._closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:c===0&&l===i-1&&(l=i-2,c=1);let u,p;this._closed||l>0?u=r[(l-1)%i]:(this._tmp.subVectors(r[0],r[1]).add(r[0]),u=new te(this._tmp.x,this._tmp.y,this._tmp.z));const g=r[l%i],m=r[(l+1)%i];if(this._closed||l+2<i?p=r[(l+2)%i]:(this._tmp.subVectors(r[i-1],r[i-2]).add(r[i-1]),p=new te(this._tmp.x,this._tmp.y,this._tmp.z)),this._curveType==="centripetal"||this._curveType==="chordal"){const y=this._curveType==="chordal"?.5:.25;let A=Math.pow(u.distanceToSquared(g),y),w=Math.pow(g.distanceToSquared(m),y),C=Math.pow(m.distanceToSquared(p),y);w<1e-4&&(w=1),A<1e-4&&(A=w),C<1e-4&&(C=w),this._px.initNonuniformCatmullRom(u.x,g.x,m.x,p.x,A,w,C),this._py.initNonuniformCatmullRom(u.y,g.y,m.y,p.y,A,w,C),this._pz.initNonuniformCatmullRom(u.z,g.z,m.z,p.z,A,w,C)}else this._curveType==="catmullrom"&&(this._px.initCatmullRom(u.x,g.x,m.x,p.x,this._tension),this._py.initCatmullRom(u.y,g.y,m.y,p.y,this._tension),this._pz.initCatmullRom(u.z,g.z,m.z,p.z,this._tension));return n.set(this._px.calc(c),this._py.calc(c),this._pz.calc(c)),n}getPoints(e){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}setPoints(e){this._points=e.map(t=>new te(t)),this._boundingBoxNeedsUpdate=!0}setClosed(e){this._closed!==e&&(this._closed=e,this._boundingBoxNeedsUpdate=!0)}setCurveType(e){this._curveType=e}setTension(e){this._tension=e}transform(e){return this._points=this._points.map(t=>{const n=new te;return n.copy(t),n.applyMatrix4(e),n}),this._boundingBoxNeedsUpdate=!0,this}calculateBoundingBox(){if(this._points.length===0)return new at;const e=new at;return this._points.forEach(t=>{e.expandByPoint(t)}),e}};class Ei{constructor(e,t,n,r){this._degree=e,this._knots=[...t],this._controlPoints=n.map(i=>({x:i.x,y:i.y,z:i.z})),this._weights=r?[...r]:new Array(n.length).fill(1)}degree(){return this._degree}knots(){return[...this._knots]}controlPoints(){return this._controlPoints.map(e=>({x:e.x,y:e.y,z:e.z}))}weights(){return[...this._weights]}point(e){const t=this._controlPoints.map(n=>[n.x,n.y,n.z]);return Po(e,this._degree,this._knots,t,this._weights)}length(){const e=this._controlPoints.map(t=>[t.x,t.y,t.z]);return J1(this._degree,this._knots,e,this._weights)}static byKnotsControlPointsWeights(e,t,n,r){return new Ei(e,t,n,r)}static byPoints(e,t,n="Uniform"){let r;switch(n){case"Chord":r=K1(t,e);break;case"SqrtChord":r=Q1(t,e);break;case"Uniform":default:r=Z1(t,e.length);break}const i=e.map(l=>({x:l[0],y:l[1],z:l[2]})),a=new Array(i.length).fill(1);return new Ei(t,r,i,a)}getParameterRange(){const e=this._knots[this._degree],t=this._knots[this._knots.length-this._degree-1];return{start:e,end:t}}getPoints(e){const t=[],{start:n,end:r}=this.getParameterRange();for(let i=0;i<=e;i++){const a=n+(r-n)*(i/e);t.push(this.point(a))}return t}isClosed(e=1e-6){const{start:t,end:n}=this.getParameterRange(),r=this.point(t),i=this.point(n),a=r[0]-i[0],l=r[1]-i[1],c=r[2]-i[2];return Math.sqrt(a*a+l*l+c*c)<e}static createFitPointsForClosedCurve(e){if(e.length<4)throw new Error("At least 4 points are required for a closed NURBS curve");const t=new cy(e,!0,"centripetal"),n=Math.max(50,e.length*2);return t.getPoints(n)}static createClosedCurve(e,t,n="Chord"){const r=this.createFitPointsForClosedCurve(e).map(i=>[i.x,i.y,i.z]);return Ei.byPoints(r,t,n)}}let Rr=class Xp extends Da{constructor(e,t,n,r,i){super();const a=arguments.length;if(a<2||a>5)throw Dn.ILLEGAL_PARAMETERS;if(this._degree=3,this._closed=!1,Array.isArray(t)){this._controlPoints=e;let l,c=3,u=!1;if(a>=3&&(Array.isArray(n)?(l=n,a>=4&&(c=r||3),a>=5&&(u=i)):n!==void 0&&(c=n||3,a>=4&&(u=r))),n===void 0&&a>=4&&(c=r||3,a>=5&&(u=i)),this._degree=c,this._closed=u,this._controlPoints.length<this._degree+1)throw Dn.ILLEGAL_PARAMETERS;const p=this.toVerbPoints(this._controlPoints);this._nurbsCurve=ni.geom.NurbsCurve.byKnotsControlPointsWeights(this._degree,t,p,l)}else{if(this._fitPoints=e,this._knotParameterization=t,a>=3&&(this._degree=n||3),a>=4&&(this._closed=r),this._fitPoints.length<this._degree+1)throw Dn.ILLEGAL_PARAMETERS;const l=this.toNurbsPoints(this._fitPoints);this._nurbsCurve=ni.geom.NurbsCurve.byPoints(l,this._degree),this._controlPoints=this.toGePoints(this._nurbsCurve.controlPoints())}}buildCurve(){if(this._fitPoints&&this._knotParameterization){if(this._closed){const e=Ei.createFitPointsForClosedCurve(this._fitPoints),t=this.toNurbsPoints(e);this._nurbsCurve=ni.geom.NurbsCurve.byPoints(t,this._degree)}else{const e=this.toNurbsPoints(this._fitPoints);this._nurbsCurve=ni.geom.NurbsCurve.byPoints(e,this._degree)}this._controlPoints=this.toGePoints(this._nurbsCurve.controlPoints())}else if(this._controlPoints)if(this._closed){const e=Ei.createFitPointsForClosedCurve(this._controlPoints),t=this.toNurbsPoints(e);this._nurbsCurve=ni.geom.NurbsCurve.byPoints(t,this._degree),this._controlPoints=this.toGePoints(this._nurbsCurve.controlPoints())}else{const e=this._nurbsCurve.knots(),t=this._nurbsCurve.weights(),n=this.toVerbPoints(this._controlPoints);this._nurbsCurve=ni.geom.NurbsCurve.byKnotsControlPointsWeights(this._degree,e,n,t)}}setClosed(e){this._closed!==e&&(this._closed=e,this._boundingBoxNeedsUpdate=!0,this.buildCurve())}get degree(){return this._degree}get knotParameterization(){return this._knotParameterization}get startPoint(){const e=this._nurbsCurve.knots(),t=this._nurbsCurve.degree(),n=e[t],r=this._nurbsCurve.point(n);return new te(r[0],r[1],r[2])}get endPoint(){const e=this._nurbsCurve.knots(),t=this._nurbsCurve.degree(),n=e[e.length-t-1],r=this._nurbsCurve.point(n);return new te(r[0],r[1],r[2])}get length(){return this._nurbsCurve.length()}getFitPointAt(e){if(!this._fitPoints)throw new Error("No fit points in this spline");const t=this._fitPoints.length,n=e<0||e>=t?t-1:e,r=this._fitPoints[n];return{x:r.x,y:r.y,z:r.z||0}}getControlPointAt(e){const t=this._controlPoints.length,n=e<0||e>=t?t-1:e;return this._controlPoints[n]}getPoints(e=100){const t=this._nurbsCurve,n=[],r=t.knots(),i=this._nurbsCurve.degree(),a=r[i],l=r[r.length-i-1],c=(l-a)/(e-1);for(let u=0;u<e;u++){const p=u===e-1?l:a+u*c,g=t.point(p);n.push(new te(g[0],g[1],g[2]))}return n}getCurvePoints(e,t){const n=[],r=e.knots(),i=r[3],a=(r[r.length-4]-i)/(t-1);for(let l=0;l<t;l++){const c=i+l*a;n.push(e.point(c))}return n}calculateBoundingBox(){const e=this.getPoints(100);return new at().setFromPoints(e)}get closed(){return this._closed}set closed(e){this.setClosed(e)}transform(e){return this._boundingBoxNeedsUpdate=!0,this}toNurbsPoints(e){const t=new Array(e.length);return e.forEach((n,r)=>{t[r]=[n.x,n.y,n.z||0]}),t}toVerbPoints(e){const t=new Array(e.length);return e.forEach((n,r)=>{t[r]=[n.x,n.y,n.z||0]}),t}toGePoints(e){const t=new Array(e.length);return e.forEach((n,r)=>{t[r]={x:n[0],y:n[1],z:n[2]}}),t}static createClosedSpline(e,t="Uniform",n=3){if(e.length<n+1)throw new Error(`At least ${n+1} points are required for a degree ${n} closed spline`);return new Xp(e,t,n,!0)}};var Mr=256,Zp=[],gu=256,Za;for(;Mr--;)Zp[Mr]=(Mr+256).toString(16).substring(1);function hy(s){var e=0,t=11;if(!Za||Mr+t>gu*2)for(Za="",Mr=0;e<gu;e++)Za+=Zp[Math.random()*256|0];return Za.substring(Mr,Mr+++t)}let Vr=class{constructor(e,t){e=e||{},La(e,{objectId:hy()}),this._attrs=new A1(e,t)}get attrs(){return this._attrs}getAttr(e){const t=this._attrs.get(e);if(t===void 0)throw new Error(`[AcDbObject] Attribute name '${e}' does't exist in this object!`);return t}getAttrWithoutException(e){return this._attrs.get(e)}setAttr(e,t){this._attrs.set(e,t)}get objectId(){return this.getAttr("objectId")}set objectId(e){this._attrs.set("objectId",e)}get ownerId(){return this.getAttr("ownerId")}set ownerId(e){this._attrs.set("ownerId",e)}get database(){return this._database?this._database:Na().workingDatabase}set database(e){this._database=e}close(){}};const Kp=class extends Vr{constructor(){super(...arguments),this._layer="0",this._color=new fr,this._lineType=wl,this._lineWeight=1,this._linetypeScale=-1,this._visibility=!0,this._transparency=0}get type(){return this.constructor.typeName}get layer(){return this._layer}set layer(e){this._layer=e}get color(){return this._color}set color(e){this._color.copy(e)}get rgbColor(){let e=this.database.cecolor;if(this.color.isByLayer){const t=this.getLayerColor();t&&t.color&&(e=t)}else this.color.isByBlock||this.color.color!=null&&(e=this.color);return e.color==null?16777215:e.color}get lineType(){return this._lineType}set lineType(e){this._lineType=e||wl}get lineWeight(){return this._lineWeight}set lineWeight(e){this._lineWeight=e}get linetypeScale(){return this._linetypeScale}set linetypeScale(e){this._linetypeScale=e}get visibility(){return this._visibility}set visibility(e){this._visibility=e}get transparency(){return this._transparency}set transparency(e){this._transparency=e}get properties(){return{type:this.type,groups:[this.getGeneralProperties()]}}subGetGripPoints(){return new Array}subGetOsnapPoints(e,t,n,r){}transformBy(e){return this}triggerModifiedEvent(){this.database.events.entityModified.dispatch({database:this.database,entity:this})}getGeneralProperties(){return{groupName:"general",properties:[{name:"handle",type:"int",editable:!1,accessor:{get:()=>this.objectId}},{name:"layer",type:"string",editable:!0,accessor:{get:()=>this.layer,set:e=>{this.layer=e}}}]}}get lineStyle(){var e;const t=this.getLineType(),n=(e=this.database)==null?void 0:e.tables.linetypeTable.getAt(t);return n?{...n.linetype,color:this.rgbColor}:{name:t,standardFlag:0,color:this.rgbColor,description:"",totalPatternLength:0}}getLineType(){if(this.lineType==wl){const e=this.database.tables.layerTable.getAt(this.layer);if(e&&e.linetype)return e.linetype}else return this.lineType==k1?gc:this.lineType;return gc}getLayerColor(){const e=this.database.tables.layerTable.getAt(this.layer);if(e==null)console.error(`The layer with name '${this.layer}' not found in drawing database!`);else return e.color;return null}attachEntityInfo(e){e&&(e.objectId=this.objectId,this.attrs.has("ownerId")&&(e.ownerId=this.ownerId),e.layerName=this.layer,e.visible=this.visibility)}};Kp.typeName="Entity";let Bn=Kp;const Qp=class extends Bn{};Qp.typeName="Curve";let Nn=Qp;var Cs=(s=>(s[s.SimplePoly=0]="SimplePoly",s[s.FitCurvePoly=1]="FitCurvePoly",s[s.QuadSplinePoly=2]="QuadSplinePoly",s[s.CubicSplinePoly=3]="CubicSplinePoly",s))(Cs||{});const Jp=class extends Nn{constructor(e,t,n=0,r=!1,i=0,a=0,l=null){super(),this._polyType=e,this._elevation=n;const c=l&&(l==null?void 0:l.length)===t.length,u=t.map((p,g)=>({x:p.x,y:p.y,bulge:c?l[g]:void 0}));this._geo=new Gr(u,r)}get polyType(){return this._polyType}set polyType(e){this._polyType=e}get elevation(){return this._elevation}set elevation(e){this._elevation=e}get closed(){return this._geo.closed}set closed(e){this._geo.closed=e}get geometricExtents(){const e=this._geo.box;return new at({x:e.min.x,y:e.min.y,z:this._elevation},{x:e.max.x,y:e.max.y,z:this._elevation})}subGetGripPoints(){return new Array}draw(e){const t=[];return this._geo.getPoints(100).forEach(n=>t.push(new te().set(n.x,n.y,this.elevation))),e.lines(t,this.lineStyle)}};Jp.typeName="2dPolyline";let ef=Jp;const uy=class extends Bn{constructor(){super(),this._position=new te,this._bulge=0,this._startWidth=0,this._endWidth=0,this._vertexType=0}get position(){return this._position}set position(e){this._position.copy(e)}get bulge(){return this._bulge}set bulge(e){this._bulge=e}get startWidth(){return this._startWidth}set startWidth(e){this._startWidth=e}get endWidth(){return this._endWidth}set endWidth(e){this._endWidth=e}get vertexType(){return this._vertexType}set vertexType(e){this._vertexType=e}get geometricExtents(){return new at().expandByPoint(this._position)}subGetGripPoints(){const e=new Array;return e.push(this._position),e}transformBy(e){return this._position.applyMatrix4(e),this}draw(e){}};uy.typeName="2dVertex";var Pr=(s=>(s[s.SimplePoly=0]="SimplePoly",s[s.QuadSplinePoly=1]="QuadSplinePoly",s[s.CubicSplinePoly=2]="CubicSplinePoly",s))(Pr||{});const tf=class extends Nn{constructor(e,t,n=!1){super(),this._polyType=e,this._geo=new Gr(t,n)}get polyType(){return this._polyType}set polyType(e){this._polyType=e}get closed(){return this._geo.closed}set closed(e){this._geo.closed=e}get geometricExtents(){const e=this._geo.box;return new at({x:e.min.x,y:e.min.y,z:0},{x:e.max.x,y:e.max.y,z:0})}subGetGripPoints(){return new Array}draw(e){const t=[];return this._geo.getPoints(100).forEach(n=>t.push(new te().set(n.x,n.y,0))),e.lines(t,this.lineStyle)}};tf.typeName="3dPolyline";let nf=tf;const dy=class extends Bn{constructor(){super(),this._position=new te,this._vertexType=0}get position(){return this._position}set position(e){this._position.copy(e)}get vertexType(){return this._vertexType}set vertexType(e){this._vertexType=e}get geometricExtents(){return new at().expandByPoint(this._position)}subGetGripPoints(){const e=new Array;return e.push(this._position),e}transformBy(e){return this._position.applyMatrix4(e),this}draw(e){}};dy.typeName="3dVertex";const sf=class extends Nn{constructor(e,t,n,r,i=oe.Z_AXIS){super(),this._geo=new jp(e,t,n,r,i,oe.X_AXIS)}get center(){return this._geo.center}set center(e){this._geo.center=e}get radius(){return this._geo.radius}set radius(e){this._geo.radius=e}get startAngle(){return this._geo.startAngle}set startAngle(e){this._geo.startAngle=e}get endAngle(){return this._geo.endAngle}set endAngle(e){this._geo.endAngle=e}get normal(){return this._geo.normal}set normal(e){this._geo.normal=e}get startPoint(){return this._geo.startPoint}get endPoint(){return this._geo.endPoint}get geometricExtents(){return this._geo.box}get closed(){return this._geo.closed}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"centerX",type:"float",editable:!0,accessor:{get:()=>this.center.x,set:e=>{this.center.x=e}}},{name:"centerY",type:"float",editable:!0,accessor:{get:()=>this.center.y,set:e=>{this.center.y=e}}},{name:"centerZ",type:"float",editable:!0,accessor:{get:()=>this.center.z,set:e=>{this.center.z=e}}},{name:"radius",type:"float",editable:!0,accessor:{get:()=>this.radius,set:e=>{this.radius=e}}},{name:"startAngle",type:"float",editable:!0,accessor:{get:()=>this.startAngle,set:e=>{this.startAngle=e}}},{name:"endAngle",type:"float",editable:!0,accessor:{get:()=>this.endAngle,set:e=>{this.endAngle=e}}},{name:"normalX",type:"float",editable:!0,accessor:{get:()=>this.normal.x,set:e=>{this.normal.x=e}}},{name:"normalY",type:"float",editable:!0,accessor:{get:()=>this.normal.y,set:e=>{this.normal.y=e}}},{name:"normalZ",type:"float",editable:!0,accessor:{get:()=>this.normal.z,set:e=>{this.normal.z=e}}}]}]}}subGetGripPoints(){const e=new Array;return e.push(this.center),e.push(this.startPoint),e.push(this.endPoint),e}transformBy(e){return this._geo.transform(e),this}draw(e){return e.circularArc(this._geo,this.lineStyle)}};sf.typeName="Arc";let rf=sf;const af=class extends Bn{constructor(e){super(),this._blockName=e,this._position=new te,this._rotation=0,this._normal=new oe(0,0,1),this._scaleFactors=new te(1,1,1)}get position(){return this._position}set position(e){this._position.copy(e)}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get scaleFactors(){return this._scaleFactors}set scaleFactors(e){this._scaleFactors.copy(e)}get normal(){return this._normal}set normal(e){this._normal.copy(e).normalize()}get blockTableRecord(){return this.database.tables.blockTable.getAt(this._blockName)}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"blockName",type:"float",editable:!1,accessor:{get:()=>this._blockName}},{name:"positionX",type:"float",editable:!0,accessor:{get:()=>this.position.x,set:e=>{this.position.x=e}}},{name:"positionY",type:"float",editable:!0,accessor:{get:()=>this.position.y,set:e=>{this.position.y=e}}},{name:"positionZ",type:"float",editable:!0,accessor:{get:()=>this.position.z,set:e=>{this.position.z=e}}},{name:"rotation",type:"float",editable:!0,accessor:{get:()=>this.rotation,set:e=>{this.rotation=e}}},{name:"scaleFactorsX",type:"float",editable:!0,accessor:{get:()=>this.scaleFactors.x,set:e=>{this.scaleFactors.x=e}}},{name:"scaleFactorsY",type:"float",editable:!0,accessor:{get:()=>this.scaleFactors.y,set:e=>{this.scaleFactors.y=e}}},{name:"scaleFactorsZ",type:"float",editable:!0,accessor:{get:()=>this.scaleFactors.z,set:e=>{this.scaleFactors.z=e}}},{name:"normalX",type:"float",editable:!0,accessor:{get:()=>this.normal.x,set:e=>{this.normal.x=e}}},{name:"normalY",type:"float",editable:!0,accessor:{get:()=>this.normal.y,set:e=>{this.normal.y=e}}},{name:"normalZ",type:"float",editable:!0,accessor:{get:()=>this.normal.z,set:e=>{this.normal.z=e}}}]}]}}get geometricExtents(){const e=new at,t=this.blockTableRecord;if(t!=null){const i=t.newIterator();for(const a of i)e.union(a.geometricExtents)}const n=new xa().setFromEuler(new ry(this.rotation,0,0)),r=new Nr;return r.compose(this.position,n,this.scaleFactors),e.applyMatrix4(r),e}draw(e){const t=[],n=this.blockTableRecord;if(n!=null){const r=this.computeTransformMatrix(),i=fa.instance.draw(e,n,this.rgbColor,!0,r,this.normal);return this.attachEntityInfo(i),i}else{const r=e.group(t);return this.attachEntityInfo(r),r}}computeTransformMatrix(){const e=new xa;return e.setFromAxisAngle(oe.Z_AXIS,this.rotation),new Nr().compose(this._position,e,this._scaleFactors)}};af.typeName="BlockReference";let th=af;const of=class extends Nn{constructor(e,t,n=oe.Z_AXIS){super(),this._geo=new jp(e,t,0,Bt,n,oe.X_AXIS)}get center(){return this._geo.center}set center(e){this._geo.center=e}get radius(){return this._geo.radius}set radius(e){this._geo.radius=e}get normal(){return this._geo.normal}get geometricExtents(){return this._geo.box}get closed(){return this._geo.closed}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"centerX",type:"float",editable:!0,accessor:{get:()=>this.center.x,set:e=>{this.center.x=e}}},{name:"centerY",type:"float",editable:!0,accessor:{get:()=>this.center.y,set:e=>{this.center.y=e}}},{name:"centerZ",type:"float",editable:!0,accessor:{get:()=>this.center.z,set:e=>{this.center.z=e}}},{name:"radius",type:"float",editable:!0,accessor:{get:()=>this.radius,set:e=>{this.radius=e}}},{name:"normalX",type:"float",editable:!0,accessor:{get:()=>this.normal.x,set:e=>{this.normal.x=e}}},{name:"normalY",type:"float",editable:!0,accessor:{get:()=>this.normal.y,set:e=>{this.normal.y=e}}},{name:"normalZ",type:"float",editable:!0,accessor:{get:()=>this.normal.z,set:e=>{this.normal.z=e}}}]}]}}subGetGripPoints(){const e=new Array;return e.push(this.center),e}transformBy(e){return this._geo.transform(e),this}draw(e){return e.circularArc(this._geo,this.lineStyle)}};of.typeName="Circle";let el=of;const lf=class extends Nn{constructor(e,t,n,r,i,a,l){super(),this._geo=new ay(e,t,n,r,i,a,l)}get center(){return this._geo.center}set center(e){this._geo.center=e}get majorAxisRadius(){return this._geo.majorAxisRadius}set majorAxisRadius(e){this._geo.majorAxisRadius=e}get minorAxisRadius(){return this._geo.minorAxisRadius}set minorAxisRadius(e){this._geo.minorAxisRadius=e}get startAngle(){return this._geo.startAngle}set startAngle(e){this._geo.startAngle=e}get endAngle(){return this._geo.endAngle}set endAngle(e){this._geo.endAngle=e}get normal(){return this._geo.normal}set normal(e){this._geo.normal=e}get geometricExtents(){return this._geo.box}get closed(){return this._geo.closed}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"centerX",type:"float",editable:!0,accessor:{get:()=>this.center.x,set:e=>{this.center.x=e}}},{name:"centerY",type:"float",editable:!0,accessor:{get:()=>this.center.y,set:e=>{this.center.y=e}}},{name:"centerZ",type:"float",editable:!0,accessor:{get:()=>this.center.z,set:e=>{this.center.z=e}}},{name:"majorAxisRadius",type:"float",editable:!0,accessor:{get:()=>this.majorAxisRadius,set:e=>{this.center.x=e}}},{name:"minorAxisRadius",type:"float",editable:!0,accessor:{get:()=>this.minorAxisRadius,set:e=>{this.minorAxisRadius=e}}},{name:"startAngle",type:"float",editable:!0,accessor:{get:()=>this.startAngle,set:e=>{this.startAngle=e}}},{name:"endAngle",type:"float",editable:!0,accessor:{get:()=>this.endAngle,set:e=>{this.endAngle=e}}},{name:"normalX",type:"float",editable:!0,accessor:{get:()=>this.normal.x,set:e=>{this.normal.x=e}}},{name:"normalY",type:"float",editable:!0,accessor:{get:()=>this.normal.y,set:e=>{this.normal.y=e}}},{name:"normalZ",type:"float",editable:!0,accessor:{get:()=>this.normal.z,set:e=>{this.normal.z=e}}}]}]}}draw(e){return e.ellipticalArc(this._geo,this.lineStyle)}};lf.typeName="Ellipse";let cf=lf;const hf=class extends Bn{constructor(){super(),this._vertices=[new te,new te,new te],this._edgeInvisibilities=0}getVertexAt(e){return e<0?this._vertices[0]:e>this._vertices.length?this._vertices[this._vertices.length-1]:this._vertices[e]}setVertexAt(e,t){if(e<0&&this._vertices[0].copy(t),e>=3)return this._vertices.length===3&&this._vertices.push(new te),this._vertices[3].copy(t);this._vertices[e].copy(t)}setEdgeInvisibilities(e){this._edgeInvisibilities=e}isEdgeVisibleAt(e){if(e<0||e>3)throw new Error("Index out of range");return(this._edgeInvisibilities&1<<e)===0}makeEdgeInvisibleAt(e){if(e<0||e>3)throw new Error("Index out of range");this._edgeInvisibilities=this._edgeInvisibilities|1<<e}get geometricExtents(){return new at().setFromPoints(this._vertices)}subGetGripPoints(){const e=new Array;for(let t=0;t<this._vertices.length;++t)e.push(this.getVertexAt(t));return e}draw(e){const t=this._vertices.length,n=new Float32Array(t*3),r=new Uint16Array(t*2);for(let i=0;i<t;i++)n[i*3]=this._vertices[i].x,n[i*3+1]=this._vertices[i].y,n[i*3+2]=this._vertices[i].z,this.isEdgeVisibleAt(i)&&(r[i*2]=i,r[i*2+1]=(i+1)%4);return e.lineSegments(n,3,r,this.lineStyle)}};hf.typeName="Face";let uf=hf;const df=class extends Bn{constructor(){super(),this._elevation=0,this._geo=new Jc,this._definitionLines=[],this._patternName="",this._patternType=1,this._patternAngle=0,this._patternScale=1,this._hatchStyle=0}get definitionLines(){return this._definitionLines}get patternName(){return this._patternName}set patternName(e){this._patternName=e}get patternType(){return this._patternType}set patternType(e){this._patternType=e}get patternAngle(){return this._patternAngle}set patternAngle(e){this._patternAngle=e}get patternScale(){return this._patternScale}set patternScale(e){this._patternScale=e}get hatchStyle(){return this._hatchStyle}set hatchStyle(e){this._hatchStyle=e}add(e){this._geo.add(e)}get geometricExtents(){const e=this._geo.box;return new at({x:e.min.x,y:e.min.y,z:this._elevation},{x:e.max.x,y:e.max.y,z:this._elevation})}draw(e){return e.area(this._geo,{color:this.rgbColor,solidFill:!1,patternAngle:this.patternAngle,patternLines:this.definitionLines})}};df.typeName="Hatch";let nh=df;const pf=class extends Nn{constructor(){super(),this._isSplined=!1,this._updated=!1,this._hasArrowHead=!1,this._vertices=[],this._dimensionStyle="",this._hasHookLine=!1,this._annoType=3}get isSplined(){return this._isSplined}set isSplined(e){this._isSplined=e}get hasArrowHead(){return this._hasArrowHead}set hasArrowHead(e){this._hasArrowHead=e}get hasHookLine(){return this._hasHookLine}set hasHookLine(e){this._hasHookLine=e}get numVertices(){return this._vertices.length}get dimensionStyle(){return this._dimensionStyle}set dimensionStyle(e){this._dimensionStyle=e}get annoType(){return this._annoType}set annoType(e){this._annoType=e}appendVertex(e){this._vertices.push(new te().copy(e)),this._updated=!0}setVertexAt(e,t){throw(e<0||e>=this._vertices.length)&&(this._vertices[e].copy(t),this._updated=!0),new Error("The vertex index is out of range!")}vertexAt(e){throw(e<0||e>=this._vertices.length)&&this._vertices[e],new Error("The vertex index is out of range!")}get geometricExtents(){return this._isSplined&&this.splineGeo?this.splineGeo.calculateBoundingBox():new at().setFromPoints(this._vertices)}get closed(){return!1}set closed(e){}draw(e){if(this.isSplined&&this.splineGeo){const t=this.splineGeo.getPoints(100);return e.lines(t,this.lineStyle)}else return e.lines(this._vertices,this.lineStyle)}get splineGeo(){return this.createSplineIfNeeded(),this._splineGeo}createSplineIfNeeded(){this.isSplined&&this.numVertices>=2&&(this._splineGeo==null||this._updated)&&(this._splineGeo=new Rr(this._vertices,"Uniform"),this._updated=!1)}};pf.typeName="Leader";let ff=pf;var Tr=(s=>(s[s.EndPoint=1]="EndPoint",s[s.MidPoint=2]="MidPoint",s[s.Center=3]="Center",s[s.Node=4]="Node",s[s.Quadrant=5]="Quadrant",s[s.Insertion=7]="Insertion",s[s.Perpendicular=8]="Perpendicular",s[s.Tangent=9]="Tangent",s[s.Nearest=10]="Nearest",s[s.Centroid=11]="Centroid",s))(Tr||{});const gf=class extends Nn{constructor(e,t){super(),this._geo=new wa(e,t)}get startPoint(){return this._geo.startPoint}set startPoint(e){this._geo.startPoint=e}get endPoint(){return this._geo.endPoint}set endPoint(e){this._geo.endPoint=e}get midPoint(){return this._geo.midPoint}get geometricExtents(){return this._geo.box}get closed(){return!1}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"startX",type:"float",editable:!0,accessor:{get:()=>this.startPoint.x,set:e=>{this.startPoint.x=e}}},{name:"startY",type:"float",editable:!0,accessor:{get:()=>this.startPoint.y,set:e=>{this.startPoint.y=e}}},{name:"startZ",type:"float",editable:!0,accessor:{get:()=>this.startPoint.z,set:e=>{this.startPoint.z=e}}},{name:"endX",type:"float",editable:!0,accessor:{get:()=>this.endPoint.x,set:e=>{this.endPoint.x=e}}},{name:"endY",type:"float",editable:!0,accessor:{get:()=>this.endPoint.y,set:e=>{this.endPoint.y=e}}},{name:"endZ",type:"float",editable:!0,accessor:{get:()=>this.endPoint.z,set:e=>{this.endPoint.z=e}}}]}]}}subGetGripPoints(){const e=new Array;return e.push(this.midPoint),e.push(this.startPoint),e.push(this.endPoint),e}subGetOsnapPoints(e,t,n,r){const i=this.startPoint,a=this.endPoint;switch(e){case Tr.EndPoint:r.push(i),r.push(a);break;case Tr.MidPoint:r.push(this.midPoint);break;case Tr.Nearest:{const l=this._geo.project(t);r.push(l)}break;case Tr.Perpendicular:{const l=this._geo.perpPoint(t);r.push(l)}break;case Tr.Tangent:r.push(i);break}}transformBy(e){return this._geo.transform(e),this}draw(e){const t=this.startPoint,n=this.endPoint,r=[new te(t.x,t.y,0),new te(n.x,n.y,0)];return e.lines(r,this.lineStyle)}};gf.typeName="Line";let sh=gf;var mf=(s=>(s.ClosedFilled="",s.Dot="_DOT",s.DotSmall="_DOTSMALL",s.DotBlank="_DOTBLANK",s.Origin="_ORIGIN",s.Origin2="_ORIGIN2",s.Open="_OPEN",s.Open90="_OPEN90",s.Open30="_OPEN30",s.Closed="_CLOSED",s.Small="_SMALL",s.None="_NONE",s.Oblique="_OBLIQUE",s.BoxFilled="_BOXFILLED",s.Box="_BOXBLANK",s.ClosedBlank="_CLOSEDBLANK",s.DatumBlank="_DATUMBLANK",s.DatumFilled="_DATUMFILLED",s.Integral="_INTEGRAL",s.ArchTick="_ARCHTICK",s))(mf||{}),sr=(s=>(s[s.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",s[s.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT",s[s.TOP_TO_BOTTOM=3]="TOP_TO_BOTTOM",s[s.BOTTOM_TO_TOP=4]="BOTTOM_TO_TOP",s[s.BY_STYLE=5]="BY_STYLE",s))(sr||{}),cn=(s=>(s[s.TopLeft=1]="TopLeft",s[s.TopCenter=2]="TopCenter",s[s.TopRight=3]="TopRight",s[s.MiddleLeft=4]="MiddleLeft",s[s.MiddleCenter=5]="MiddleCenter",s[s.MiddleRight=6]="MiddleRight",s[s.BottomLeft=7]="BottomLeft",s[s.BottomCenter=8]="BottomCenter",s[s.BottomRight=9]="BottomRight",s))(cn||{}),yf=(s=>(s[s.OPTIMIZED_2D=0]="OPTIMIZED_2D",s[s.WIREFRAME=1]="WIREFRAME",s[s.HIDDEN_LINE=2]="HIDDEN_LINE",s[s.FLAT_SHADED=3]="FLAT_SHADED",s[s.GOURAUD_SHADED=4]="GOURAUD_SHADED",s[s.FLAT_SHADED_WITH_WIREFRAME=5]="FLAT_SHADED_WITH_WIREFRAME",s[s.GOURAUD_SHADED_WITH_WIREFRAME=6]="GOURAUD_SHADED_WITH_WIREFRAME",s))(yf||{}),vf=(s=>(s[s.NON_ORTHOGRAPHIC=0]="NON_ORTHOGRAPHIC",s[s.TOP=1]="TOP",s[s.BOTTOM=2]="BOTTOM",s[s.FRONT=3]="FRONT",s[s.BACK=4]="BACK",s[s.LEFT=5]="LEFT",s[s.RIGHT=6]="RIGHT",s))(vf||{}),bf=(s=>(s[s.ONE_DISTANT_LIGHT=0]="ONE_DISTANT_LIGHT",s[s.TWO_DISTANT_LIGHTS=1]="TWO_DISTANT_LIGHTS",s))(bf||{});let py=class _f{constructor(){this._number=-1,this._id="",this._groupId="",this._centerPoint=new te,this._height=0,this._width=0,this._viewCenter=new te,this._viewHeight=0}get number(){return this._number}set number(e){this._number=e}get id(){return this._id}set id(e){this._id=e}get groupId(){return this._groupId}set groupId(e){this._groupId=e}get centerPoint(){return this._centerPoint}set centerPoint(e){this._centerPoint.copy(e)}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}get box(){const e=new Ct;return e.setFromCenterAndSize(this.centerPoint,{x:this.width,y:this.height}),e}get viewCenter(){return this._viewCenter}set viewCenter(e){this._viewCenter.copy(e)}get viewHeight(){return this._viewHeight}set viewHeight(e){this._viewHeight=e}get viewWidth(){return this.viewHeight*(this.width/this.height)}get viewBox(){const e=new Ct;return e.setFromCenterAndSize(this.viewCenter,{x:this.viewWidth,y:this.viewHeight}),e}clone(){const e=new _f;return e.id=this.id,e.groupId=this.groupId,e.number=this.number,e.centerPoint.copy(this.centerPoint),e.height=this.height,e.width=this.width,e.viewCenter.copy(this.viewCenter),e.viewHeight=this.viewHeight,e}copy(e){return this.id=e.id,this.groupId=e.groupId,this.number=e.number,this.centerPoint.copy(e.centerPoint),this.height=e.height,this.width=e.width,this.viewCenter.copy(e.viewCenter),this.viewHeight=e.viewHeight,this}};const xf=class extends Bn{constructor(){super(),this._contents="",this._height=0,this._width=0,this._lineSpacingFactor=.25,this._lineSpacingStyle=0,this._backgroundFill=!1,this._backgroundFillColor=13158600,this._backgroundFillTransparency=1,this._backgroundScaleFactor=1,this._rotation=0,this._styleName="",this._location=new te,this._attachmentPoint=cn.TopLeft,this._direction=new oe(1,0,0),this._drawingDirection=sr.LEFT_TO_RIGHT}get contents(){return this._contents}set contents(e){this._contents=e}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get lineSpacingFactor(){return this._lineSpacingFactor}set lineSpacingFactor(e){this._lineSpacingFactor=e}get lineSpacingStyle(){return this._lineSpacingStyle}set lineSpacingStyle(e){this._lineSpacingStyle=e}get backgroundFill(){return this._backgroundFill}set backgroundFill(e){this._backgroundFill=e,this._backgroundFillColor=13158600}get backgroundFillColor(){return this._backgroundFillColor}set backgroundFillColor(e){this._backgroundFillColor=e}get backgroundFillTransparency(){return this._backgroundFillTransparency}set backgroundFillTransparency(e){this._backgroundFillTransparency=e}get backgroundScaleFactor(){return this._backgroundScaleFactor}set backgroundScaleFactor(e){this._backgroundScaleFactor=e}get styleName(){return this._styleName}set styleName(e){this._styleName=e}get location(){return this._location}set location(e){this._location.copy(e)}get attachmentPoint(){return this._attachmentPoint}set attachmentPoint(e){this._attachmentPoint=e}get direction(){return this._direction}set direction(e){this._direction.copy(e)}get drawingDirection(){return this._drawingDirection}set drawingDirection(e){this._drawingDirection=e}get geometricExtents(){return new at}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"text",properties:[{name:"contents",type:"string",editable:!0,accessor:{get:()=>this.contents,set:e=>{this.contents=e}}},{name:"styleName",type:"string",editable:!0,accessor:{get:()=>this.styleName,set:e=>{this.styleName=e}}},{name:"attachmentPoint",type:"enum",editable:!0,options:[{label:cn[1],value:1},{label:cn[2],value:2},{label:cn[3],value:3},{label:cn[4],value:4},{label:cn[5],value:5},{label:cn[6],value:6},{label:cn[7],value:7},{label:cn[8],value:8},{label:cn[9],value:9}],accessor:{get:()=>this.attachmentPoint,set:e=>{this.attachmentPoint=e}}},{name:"drawingDirection",type:"enum",editable:!0,options:[{label:sr[1],value:1},{label:sr[2],value:2},{label:sr[3],value:3},{label:sr[4],value:4},{label:sr[5],value:5}],accessor:{get:()=>this.drawingDirection,set:e=>{this.drawingDirection=e}}},{name:"textHeight",type:"float",editable:!0,accessor:{get:()=>this.height,set:e=>{this.height=e}}},{name:"rotation",type:"float",editable:!0,accessor:{get:()=>this.rotation,set:e=>{this.rotation=e}}},{name:"lineSpacingFactor",type:"float",editable:!0,accessor:{get:()=>this.lineSpacingFactor,set:e=>{this.lineSpacingFactor=e}}},{name:"definedWidth",type:"float",editable:!0,accessor:{get:()=>this.width,set:e=>{this.width=e}}},{name:"directionX",type:"float",editable:!0,accessor:{get:()=>this.direction.x,set:e=>{this.direction.x=e}}},{name:"directionY",type:"float",editable:!0,accessor:{get:()=>this.direction.y,set:e=>{this.direction.y=e}}},{name:"directionZ",type:"float",editable:!0,accessor:{get:()=>this.direction.z,set:e=>{this.direction.z=e}}}]},{groupName:"geometry",properties:[{name:"locationX",type:"float",editable:!0,accessor:{get:()=>this.location.x,set:e=>{this.location.x=e}}},{name:"locationY",type:"float",editable:!0,accessor:{get:()=>this.location.y,set:e=>{this.location.y=e}}},{name:"locationZ",type:"float",editable:!0,accessor:{get:()=>this.location.z,set:e=>{this.location.z=e}}}]}]}}getTextStyle(){const e=this.database.tables.textStyleTable;let t=e.getAt(this.styleName);return t||(t=e.getAt("STANDARD")||e.getAt("Standard")),t.textStyle}draw(e,t){const n={text:this.contents,height:this.height,width:this.width,position:this.location,rotation:this.rotation,directionVector:this.direction,attachmentPoint:this.attachmentPoint,drawingDirection:this.drawingDirection,lineSpaceFactor:this.lineSpacingFactor},r={...this.getTextStyle(),color:this.rgbColor};return e.mtext(n,r,t)}};xf.typeName="MText";let wf=xf;const Sf=class extends Nn{constructor(e,t,n,r,i){super();const a=+(e!==void 0)+ +(t!==void 0)+ +(n!==void 0)+ +(r!==void 0)+ +(i!==void 0);if(a<2||a>5)throw Dn.ILLEGAL_PARAMETERS;Array.isArray(t)?this._geo=new Rr(e,t,n,r,i):this._geo=new Rr(e,t,n,r)}get geometricExtents(){return this._geo.box}get closed(){return this._geo.closed}set closed(e){this._geo.closed=e}draw(e){const t=this._geo.getPoints(100);return e.lines(t,this.lineStyle)}};Sf.typeName="Spline";let jo=Sf;const fy=new oe,Af=class extends th{constructor(e,t,n){super(e),this._attachmentPoint=cn.TopLeft,this._numColumns=n,this._numRows=t,this._columnWidth=new Array(n),this._rowHeight=new Array(t),this._cells=new Array(t*n)}get attachmentPoint(){return this._attachmentPoint}set attachmentPoint(e){this._attachmentPoint=e}get numRows(){return this._numRows}set numRows(e){this._numRows=e}get numColumns(){return this._numColumns}set numColumns(e){this._numColumns=e}numContents(e,t){return 1}rowHeight(e){return this._rowHeight[e]}setRowHeight(e,t){this._rowHeight[e]=t}setUniformRowHeight(e){this._rowHeight.fill(e)}columnWidth(e){return this._columnWidth[e]}setUniformColumnWidth(e){this._columnWidth.fill(e)}setColumnWidth(e,t){this._columnWidth[e]=t}cell(e){if(!(e<0||e>=this._cells.length))return this._cells[e]}setCell(e,t){this._cells[e]=t}textString(e,t,n){return this._cells[e*t].text}setTextString(e,t,n){this._cells[e*t].text=n}isEmpty(e,t){return!this._cells[e*t].text}get geometricExtents(){return new at}draw(e){let t=0,n=0;const r=new Uint16Array(this.numColumns*this.numRows*8),i=new Float32Array((this.numColumns+1)*(this.numRows+1)*3);let a=0;for(let m=0;m<=this.numRows;m++){t-=m>0?this.rowHeight(m-1):0,n=0;for(let y=0;y<=this.numColumns;y++)n+=y>0?this.columnWidth(y-1):0,i[a++]=n,i[a++]=t,i[a++]=0}const l=[],c=new Array(this.numRows*this.numColumns).fill(!1);n=0,a=0;let u=0;for(let m=0;m<this.numColumns;m++){n+=m>0?this.columnWidth(m-1):0,t=0;for(let y=0;y<this.numRows;y++){t+=y>0?this.rowHeight(y-1):0;const A=this.cell(y*this.numColumns+m);if(u=y*this.numColumns+m,A&&!c[u]){const w=A.borderWidth??1,C=A.borderHeight??1;this.fillVisited(c,u,this.numColumns,w,C),r[a++]=m+y*(this.numColumns+1),r[a++]=m+y*(this.numColumns+1)+w;const E=i[r[a-1]*3]-n,L=m+(y+C)*(this.numColumns+1)+w;m+w==this.numColumns&&(r[a++]=m+y*(this.numColumns+1)+w,r[a++]=L);const O=-i[L*3+1]-t;if(y+C==this.numRows&&(r[a++]=m+(y+C)*(this.numColumns+1)+C,r[a++]=m+(y+C)*(this.numColumns+1)),r[a++]=m+(y+C)*(this.numColumns+1),r[a++]=m+y*(this.numColumns+1),A.text){const F=A.attachmentPoint||this.attachmentPoint||cn.MiddleCenter,B=this.getTableTextOffset(F,E,O),Z={text:A.text,height:A.textHeight,width:E,position:fy.set(n,-t,0).clone().add(B),rotation:this.rotation,attachmentPoint:F},W={...this.getTextStyle(A),color:this.color.color};l.push(e.mtext(Z,W))}}}}l.push(e.lineSegments(i,3,r,this.lineStyle));const p=e.group(l),g=new xa;return g.setFromAxisAngle(oe.Z_AXIS,this.rotation),mu.compose(this.position,g,this.scaleFactors),p.applyMatrix(mu),this.attachEntityInfo(p),p}fillVisited(e,t,n,r,i){if(i==1&&r==1)e[t]=!0;else for(let a=0;a<r;++a)for(let l=0;l<i;++l)e[t+a+l*n]=!0}getTextStyle(e){const t=this.database.tables.textStyleTable;let n;return e.textStyle&&(n=t.getAt(e.textStyle)),n||(n=t.getAt("STANDARD")||t.getAt("Standard")),n.textStyle}getTableTextOffset(e,t,n){const r=new oe;switch(e){case 1:break;case 2:r.setX(t/2);break;case 3:r.setX(t);break;case 4:r.setY(-n/2);break;case 5:r.set(t/2,-n/2,0);break;case 6:r.set(t,-n/2,0);break;case 7:r.setY(-n);break;case 8:r.set(t/2,-n,0);break;case 9:r.set(t,-n,0);break}return r}};Af.typeName="Table";let Ef=Af;const mu=new Nr,Tf=class extends Bn{constructor(){super(),this._textString="",this._height=0,this._thickness=1,this._position=new te,this._rotation=0,this._oblique=0,this._horizontalMode=0,this._verticalModel=2,this._styleName="",this._widthFactor=1}get textString(){return this._textString}set textString(e){this._textString=e}get thickness(){return this._thickness}set thickness(e){this._thickness=e}get height(){return this._height}set height(e){this._height=e}get position(){return this._position}set position(e){this._position.copy(e)}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get oblique(){return this._oblique}set oblique(e){this._oblique=e}get horizontalMode(){return this._horizontalMode}set horizontalMode(e){this._horizontalMode=e}get verticalMode(){return this._verticalModel}set verticalMode(e){this._verticalModel=e}get styleName(){return this._styleName}set styleName(e){this._styleName=e}get widthFactor(){return this._widthFactor}set widthFactor(e){this._widthFactor=e}get geometricExtents(){return new at}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"text",properties:[{name:"contents",type:"string",editable:!0,accessor:{get:()=>this.textString,set:e=>{this.textString=e}}},{name:"styleName",type:"string",editable:!0,accessor:{get:()=>this.styleName,set:e=>{this.styleName=e}}},{name:"textHeight",type:"float",editable:!0,accessor:{get:()=>this.height,set:e=>{this.height=e}}},{name:"rotation",type:"float",editable:!0,accessor:{get:()=>this.rotation,set:e=>{this.rotation=e}}},{name:"widthFactor",type:"float",editable:!0,accessor:{get:()=>this.widthFactor,set:e=>{this.widthFactor=e}}},{name:"oblique",type:"float",editable:!0,accessor:{get:()=>this.oblique,set:e=>{this.oblique=e}}}]},{groupName:"geometry",properties:[{name:"positionX",type:"float",editable:!0,accessor:{get:()=>this.position.x,set:e=>{this.position.x=e}}},{name:"positionY",type:"float",editable:!0,accessor:{get:()=>this.position.y,set:e=>{this.position.y=e}}},{name:"positionZ",type:"float",editable:!0,accessor:{get:()=>this.position.z,set:e=>{this.position.z=e}}}]}]}}getTextStyle(){const e=this.database.tables.textStyleTable;let t=e.getAt(this.styleName);return t||(t=e.getAt("STANDARD")||e.getAt("Standard")),t.textStyle}draw(e,t){const n={text:this.textString,height:this.height,width:1/0,widthFactor:this.widthFactor,position:this.position,rotation:this.rotation,drawingDirection:sr.BOTTOM_TO_TOP,attachmentPoint:cn.BottomLeft},r={...this.getTextStyle(),color:this.rgbColor};return e.mtext(n,r,t)}};Tf.typeName="Text";let If=Tf;const Cf=class extends Nn{constructor(){super(),this._elevation=0,this._thickness=1,this._vertices=[new te,new te,new te,new te]}get elevation(){return this._elevation}set elevation(e){this._elevation=e}get closed(){return!0}get thickness(){return this._thickness}set thickness(e){this._thickness=e}getPointAt(e){return e<0?this._vertices[0]:e>3?this._vertices[3]:this._vertices[e]}setPointAt(e,t){if(e<0&&this._vertices[0].copy(t),e>3)return this._vertices[3].copy(t);this._vertices[e].copy(t)}get geometricExtents(){return new at().setFromPoints(this._vertices)}subGetGripPoints(){const e=new Array;for(let t=0;t<4;++t)e.push(this.getPointAt(t));return e}draw(e){const t=new Gr(this._vertices,!0),n=new Jc;return n.add(t),e.area(n,{color:this.rgbColor,solidFill:!0,patternAngle:0,patternLines:[]})}};Cf.typeName="Trace";let kf=Cf;const Mf=class extends Nn{constructor(){super(),this._elevation=0,this._geo=new Gr}get numberOfVertices(){return this._geo.numberOfVertices}get elevation(){return this._elevation}set elevation(e){this._elevation=e}get closed(){return this._geo.closed}set closed(e){this._geo.closed=e}addVertexAt(e,t,n=0,r=-1,i=-1){const a=r<0?void 0:r,l=i<0?void 0:i,c={x:t.x,y:t.y,bulge:n,startWidth:a,endWidth:l};this._geo.addVertexAt(e,c)}getPoint2dAt(e){return this._geo.getPointAt(e)}getPoint3dAt(e){const t=this.getPoint2dAt(e);return new te(t.x,t.y,this._elevation)}get geometricExtents(){const e=this._geo.box;return new at({x:e.min.x,y:e.min.y,z:this._elevation},{x:e.max.x,y:e.max.y,z:this._elevation})}subGetGripPoints(){const e=new Array;for(let t=0;t<this.numberOfVertices;++t)e.push(this.getPoint3dAt(t));return e}draw(e){const t=[];return this._geo.getPoints(100).forEach(n=>t.push(new te().set(n.x,n.y,this.elevation))),e.lines(t,this.lineStyle)}};Mf.typeName="Polyline";let Pf=Mf;const Lf=class extends Bn{constructor(){super(),this._geo=new te}get position(){return this._geo}set position(e){this._geo.set(e.x,e.y,e.z||0)}get geometricExtents(){return new at().expandByPoint(this._geo)}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"positionX",type:"float",editable:!0,accessor:{get:()=>this.position.x,set:e=>{this.position.x=e}}},{name:"positionY",type:"float",editable:!0,accessor:{get:()=>this.position.y,set:e=>{this.position.y=e}}},{name:"positionZ",type:"float",editable:!0,accessor:{get:()=>this.position.z,set:e=>{this.position.z=e}}}]}]}}transformBy(e){return this._geo.applyMatrix4(e),this}draw(e){return e.point(this._geo,{displayMode:this.database.pdmode,displaySize:this.database.pdsize,color:this.rgbColor})}};Lf.typeName="Point";let Of=Lf;const Df=class extends Bn{constructor(){super(),this._brightness=50,this._contrast=50,this._fade=0,this._width=0,this._height=0,this._position=new te,this._scale=new xt(1,1),this._rotation=0,this._clipBoundaryType=1,this._clipBoundary=[],this._isClipped=!1,this._isShownClipped=!1,this._isImageShown=!0,this._isImageTransparent=!1,this._imageDefId=""}get brightness(){return this._brightness}set brightness(e){this._brightness=e}get contrast(){return this._contrast}set contrast(e){this._contrast=e}get fade(){return this._fade}set fade(e){this._fade=e}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}get position(){return this._position}set position(e){this._position=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get scale(){return this._scale}set scale(e){this._scale.copy(e)}get clipBoundaryType(){return this._clipBoundaryType}set clipBoundaryType(e){this._clipBoundaryType=e}get clipBoundary(){return this._clipBoundary}set clipBoundary(e){this._clipBoundary=[],this._clipBoundary.push(...e)}get isClipped(){return this._isClipped}set isClipped(e){this._isClipped=e}get isShownClipped(){return this._isShownClipped}set isShownClipped(e){this._isShownClipped=e}get isImageShown(){return this._isImageShown}set isImageShown(e){this._isImageShown=e}get isImageTransparent(){return this._isImageTransparent}set isImageTransparent(e){this._isImageTransparent=e}get image(){return this._image}set image(e){this._image=e}get imageDefId(){return this._imageDefId}set imageDefId(e){this._imageDefId=e}get imageFileName(){if(this._imageDefId){const e=this.database.dictionaries.imageDefs.getIdAt(this._imageDefId);if(e)return e.sourceFileName}return""}get geometricExtents(){const e=new at;return e.min.copy(this._position),e.max.set(this._position.x+this._width,this._position.y+this._height,0),e}subGetGripPoints(){return this.boundaryPath()}draw(e){const t=this.boundaryPath();return this._image?e.image(this._image,{boundary:t,roation:this._rotation}):e.lines(t,this.lineStyle)}boundaryPath(){const e=[];if(this.isClipped&&this._clipBoundary.length>3){const t=this._width,n=this._height,r=new Ct;r.setFromPoints(this._clipBoundary);const i=new je;i.setX(this._position.x-r.min.x*t),i.setY(this._position.y-r.min.y*n),this._clipBoundary.forEach(a=>{const l=a.x*t+i.x,c=a.y*n+i.y;e.push(new te(l,c,this._position.z))})}else{if(e.push(this._position),e.push(this._position.clone().setX(this._position.x+this._width)),e.push(this._position.clone().set(this._position.x+this._width,this._position.y+this._height,this._position.z)),e.push(this._position.clone().setY(this._position.y+this._height)),this._rotation>0){yu.copy(e[1]);for(let t=1;t<4;t++)Ka.copy(e[t]),Ka.rotateAround(yu,this._rotation),e[t].setX(Ka.x),e[t].setY(Ka.y)}e.push(e[0])}return e}};Df.typeName="RasterImage";let tl=Df;const yu=new je,Ka=new je,Bf=class extends Nn{constructor(){super(),this._basePoint=new te,this._unitDir=new oe}get basePoint(){return this._basePoint}set basePoint(e){this._basePoint.copy(e)}get unitDir(){return this._unitDir}set unitDir(e){this._unitDir.copy(e)}get closed(){return!1}get geometricExtents(){const e=new at;return e.expandByPoint(this._unitDir.clone().multiplyScalar(10).add(this._basePoint)),e.expandByPoint(this._unitDir.clone().multiplyScalar(-10).add(this._basePoint)),e}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"basePointX",type:"float",editable:!0,accessor:{get:()=>this.basePoint.x,set:e=>{this.basePoint.x=e}}},{name:"basePointY",type:"float",editable:!0,accessor:{get:()=>this.basePoint.y,set:e=>{this.basePoint.y=e}}},{name:"basePointZ",type:"float",editable:!0,accessor:{get:()=>this.basePoint.z,set:e=>{this.basePoint.z=e}}},{name:"unitDirX",type:"float",editable:!0,accessor:{get:()=>this.unitDir.x,set:e=>{this.unitDir.x=e}}},{name:"unitDirY",type:"float",editable:!0,accessor:{get:()=>this.unitDir.y,set:e=>{this.unitDir.y=e}}},{name:"unitDirZ",type:"float",editable:!0,accessor:{get:()=>this.unitDir.z,set:e=>{this.unitDir.z=e}}}]}]}}subGetGripPoints(){const e=new Array;return e.push(this.basePoint),e}draw(e){const t=[];return t.push(this.basePoint),t.push(this._unitDir.clone().multiplyScalar(1e6).add(this._basePoint)),e.lines(t,this.lineStyle)}};Bf.typeName="Ray";let rh=Bf;const Nf=class extends Bn{constructor(){super(),this._centerPoint=new te,this._height=0,this._width=0,this._viewCenter=new te,this._viewHeight=0,this._number=-1}get number(){return this._number}set number(e){this._number=e}get centerPoint(){return this._centerPoint}set centerPoint(e){this._centerPoint=e}get height(){return this._height}set height(e){this._height=e}get width(){return this._width}set width(e){this._width=e}get viewCenter(){return this._viewCenter}set viewCenter(e){this._viewCenter=e}get viewHeight(){return this._viewHeight}set viewHeight(e){this._viewHeight=e}get geometricExtents(){return new at}draw(e){if(this._number>1&&this.ownerId!=this.database.tables.blockTable.modelSpace.objectId){const t=this.toGiViewport(),n=e.group(this.createViewportRect(t,e));return this.attachEntityInfo(n),n}}toGiViewport(){const e=new py;return e.id=this.objectId,e.groupId=this.ownerId,e.number=this.number,e.centerPoint=this.centerPoint,e.width=this.width,e.height=this.height,e.viewHeight=this.viewHeight,e.viewCenter=this.viewCenter,e}createViewportRect(e,t){const n=[];return n.push(t.lines([new te(e.centerPoint.x-e.width/2,e.centerPoint.y-e.height/2,0),new te(e.centerPoint.x+e.width/2,e.centerPoint.y-e.height/2,0)],this.lineStyle)),n.push(t.lines([new te(e.centerPoint.x+e.width/2,e.centerPoint.y-e.height/2,0),new te(e.centerPoint.x+e.width/2,e.centerPoint.y+e.height/2,0)],this.lineStyle)),n.push(t.lines([new te(e.centerPoint.x+e.width/2,e.centerPoint.y+e.height/2,0),new te(e.centerPoint.x-e.width/2,e.centerPoint.y+e.height/2,0)],this.lineStyle)),n.push(t.lines([new te(e.centerPoint.x-e.width/2,e.centerPoint.y+e.height/2,0),new te(e.centerPoint.x-e.width/2,e.centerPoint.y-e.height/2,0)],this.lineStyle)),n}};Nf.typeName="Viewport";let ih=Nf;const Rf=class extends tl{draw(e){const t=this.boundaryPath(),n=new Jc;return n.add(new Gr(t)),e.area(n,{color:0,solidFill:!0,patternAngle:0,patternLines:[]})}};Rf.typeName="Wipeout";let Ff=Rf;const zf=class extends Nn{constructor(){super(),this._basePoint=new te,this._unitDir=new oe}get basePoint(){return this._basePoint}set basePoint(e){this._basePoint.copy(e)}get unitDir(){return this._unitDir}set unitDir(e){this._unitDir.copy(e)}get closed(){return!1}get geometricExtents(){const e=new at;return e.expandByPoint(this._unitDir.clone().multiplyScalar(10).add(this._basePoint)),e.expandByPoint(this._unitDir.clone().multiplyScalar(-10).add(this._basePoint)),e}get properties(){return{type:this.type,groups:[this.getGeneralProperties(),{groupName:"geometry",properties:[{name:"basePointX",type:"float",editable:!0,accessor:{get:()=>this.basePoint.x,set:e=>{this.basePoint.x=e}}},{name:"basePointY",type:"float",editable:!0,accessor:{get:()=>this.basePoint.y,set:e=>{this.basePoint.y=e}}},{name:"basePointZ",type:"float",editable:!0,accessor:{get:()=>this.basePoint.z,set:e=>{this.basePoint.z=e}}},{name:"unitDirX",type:"float",editable:!0,accessor:{get:()=>this.unitDir.x,set:e=>{this.unitDir.x=e}}},{name:"unitDirY",type:"float",editable:!0,accessor:{get:()=>this.unitDir.y,set:e=>{this.unitDir.y=e}}},{name:"unitDirZ",type:"float",editable:!0,accessor:{get:()=>this.unitDir.z,set:e=>{this.unitDir.z=e}}}]}]}}subGetGripPoints(){const e=new Array;return e.push(this.basePoint),e}draw(e){const t=[];return t.push(this._unitDir.clone().multiplyScalar(-1e6).add(this._basePoint)),t.push(this._unitDir.clone().multiplyScalar(1e6).add(this._basePoint)),e.lines(t,this.lineStyle)}};zf.typeName="Xline";let ah=zf;const Uf=class extends Bn{constructor(){super(),this._dimBlockId=null,this._dimBlockPosition=new te,this._dimensionStyleName=null,this._dimensionText=null,this._textLineSpacingFactor=1,this._textLineSpacingStyle=1,this._textPosition=new te,this._textRotation=0,this._normal=new oe(0,0,1)}get dimBlockId(){return this._dimBlockId}set dimBlockId(e){this._dimBlockId=e}get dimBlockPosition(){return this._dimBlockPosition}set dimBlockPosition(e){this._dimBlockPosition.copy(e)}get dimensionStyleName(){return this._dimensionStyleName}set dimensionStyleName(e){this._dimensionStyleName=e}get dimensionStyle(){if(this._dimStyle==null){let e;this.dimensionStyleName&&(e=this.database.tables.dimStyleTable.getAt(this.dimensionStyleName)),e==null&&(e=new rl),this._dimStyle=e}return this._dimStyle}get dimensionText(){return this._dimensionText}set dimensionText(e){this._dimensionText=e}get measurement(){return this._measurement}set measurement(e){this._measurement=e}get textLineSpacingFactor(){return this._textLineSpacingFactor}set textLineSpacingFactor(e){this._textLineSpacingFactor=e}get textLineSpacingStyle(){return this._textLineSpacingStyle}set textLineSpacingStyle(e){this._textLineSpacingStyle=e}get textPosition(){return this._textPosition}set textPosition(e){this._textPosition.copy(e)}get textRotation(){return this._textRotation}set textRotation(e){this._textRotation=e}get normal(){return this._normal}set normal(e){this._normal.copy(e).normalize()}draw(e){if(this.dimBlockId){const n=this.database.tables.blockTable.getAt(this.dimBlockId);if(n){const r=new Nr().makeTranslation(this.dimBlockPosition),i=fa.instance.draw(e,n,this.rgbColor,!1,r,this.normal);return this.attachEntityInfo(i),i}}const t=e.group([]);return this.attachEntityInfo(t),t}drawFirstArrow(e){const t=this.database.tables.blockTable.getAt(this.firstArrowType);if(t)return fa.instance.draw(e,t,this.rgbColor,!1)}drawSecondArrow(e){const t=this.database.tables.blockTable.getAt(this.secondArrowType);if(t)return fa.instance.draw(e,t,this.rgbColor,!1)}get arrowScaleFactor(){return this.dimensionStyle.dimasz}get firstArrowStyle(){return{type:this.firstArrowType,scale:this.arrowScaleFactor,appended:this.isAppendArrow,visible:this.dimensionStyle.dimse1==0}}get secondArrowStyle(){return{type:this.secondArrowType,scale:this.arrowScaleFactor,appended:this.isAppendArrow,visible:this.dimensionStyle.dimse2==0}}get isAppendArrow(){return!0}get firstArrowTypeBtrId(){const e=this.dimensionStyle;return e.dimsah==0?e.dimblk:e.dimblk1}get firstArrowType(){const e=this.firstArrowTypeBtrId;return this.getArrowName(e)}get secondArrowTypeBtrId(){const e=this.dimensionStyle;return e.dimsah==0?e.dimblk:e.dimblk2}get secondArrowType(){const e=this.secondArrowTypeBtrId;return this.getArrowName(e)}get arrowLineCount(){return 1}getLineArrowStyle(e){}findPointOnLine1(e,t,n){const r=new te().subVectors(t,e).normalize();return new te(t).addScaledVector(r,n)}findPointOnLine2(e,t,n){const r=e.x+n*Math.cos(t),i=e.y+n*Math.sin(t);return{x:r,y:i}}adjustExtensionLine(e){const t=this.dimensionStyle;e.extend(t.dimexe),e.extend(-t.dimexo,!0)}getArrowName(e){const t=this.database.tables.blockTable.getIdAt(e);return t?t.name.toUpperCase():mf.Closed}};Uf.typeName="Dimension";let Li=Uf;const Gf=class extends Li{constructor(e,t,n,r,i=null,a=null){super(),this._centerPoint=new te().copy(e),this._xLine1Point=new te().copy(t),this._xLine2Point=new te().copy(n),this._arcPoint=new te().copy(r),this.dimensionText=i,this.dimensionStyleName=a}get arcPoint(){return this._arcPoint}set arcPoint(e){this._arcPoint.copy(e)}get centerPoint(){return this._centerPoint}set centerPoint(e){this._centerPoint.copy(e)}get xLine1Point(){return this._xLine1Point}set xLine1Point(e){this._xLine1Point.copy(e)}get xLine2Point(){return this._xLine2Point}set xLine2Point(e){this._xLine2Point.copy(e)}get geometricExtents(){return new at}};Gf.typeName="3PointAngularDimension";let Vf=Gf;const jf=class extends Li{constructor(e,t,n,r=null,i=null){super(),this._dimLinePoint=new te().copy(n),this._xLine1Point=new te().copy(e),this._xLine2Point=new te().copy(t),this._oblique=0,this._rotation=0,this.dimensionText=r,this.dimensionStyleName=i}get dimLinePoint(){return this._dimLinePoint}set dimLinePoint(e){this._dimLinePoint.copy(e)}get xLine1Point(){return this._xLine1Point}set xLine1Point(e){this._xLine1Point.copy(e)}get xLine2Point(){return this._xLine2Point}set xLine2Point(e){this._xLine2Point.copy(e)}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get oblique(){return this._oblique}set oblique(e){this._oblique=e}get geometricExtents(){return new at}get isAppendArrow(){return!1}};jf.typeName="AlignedDimension";let oh=jf;const gy=class extends Li{constructor(e,t,n,r,i=null,a=null){super(),this._arcPoint=new te().copy(r),this._xLine1Point=new te().copy(t),this._xLine2Point=new te().copy(n),this._centerPoint=new te().copy(e),this.dimensionText=i,this.dimensionStyleName=a}get arcPoint(){return this._arcPoint}set arcPoint(e){this._arcPoint.copy(e)}get centerPoint(){return this._centerPoint}set centerPoint(e){this._centerPoint.copy(e)}get xLine1Point(){return this._xLine1Point}set xLine1Point(e){this._xLine1Point.copy(e)}get xLine2Point(){return this._xLine2Point}set xLine2Point(e){this._xLine2Point.copy(e)}get geometricExtents(){return new at}};gy.typeName="ArcDimension";const $f=class extends Li{constructor(e,t,n=0,r=null,i=null){super(),this._chordPoint=new te().copy(e),this._farChordPoint=new te().copy(t),this._extArcStartAngle=0,this._extArcEndAngle=0,this._leaderLength=n,this.dimensionText=r,this.dimensionStyleName=i}get chordPoint(){return this._chordPoint}set chordPoint(e){this._chordPoint.copy(e)}get farChordPoint(){return this._farChordPoint}set farChordPoint(e){this._farChordPoint.copy(e)}get extArcStartAngle(){return this._extArcStartAngle}set extArcStartAngle(e){this._extArcStartAngle=e}get extArcEndAngle(){return this._extArcEndAngle}set extArcEndAngle(e){this._extArcEndAngle=e}get leaderLength(){return this._leaderLength}get geometricExtents(){return new at}drawLines(e,t){const n=[],r=t.length;return r==1?n.push(this.drawLine(e,t[0],{firstArrow:this.firstArrowStyle})):r==3?(this.sortLines(t),n.push(this.drawLine(e,t[0],{firstArrow:this.firstArrowStyle})),n.push(this.drawLine(e,t[1])),n.push(this.drawLine(e,t[2],{firstArrow:this.firstArrowStyle}))):t.forEach(i=>{n.push(this.drawLine(e,i))}),n}drawLine(e,t,n){if(n){const r=[t.startPoint,t.endPoint];return e.lines(r,{...this.lineStyle,arrows:n})}else return t.draw(e)}sortLines(e){const t=(n,r)=>n.x!==r.x?n.x-r.x:n.y!==r.y?n.y-r.y:n.z-r.z;e.sort((n,r)=>{const i=t(n.startPoint,r.startPoint);return i!==0?i:t(n.endPoint,r.endPoint)})}};$f.typeName="DiametricDimension";let Wf=$f;const Hf=class extends Li{constructor(e,t,n=null,r=null){super(),this._definingPoint=new te().copy(e),this._leaderEndPoint=new te().copy(t),this.dimensionText=n,this.dimensionStyleName=r}get definingPoint(){return this._definingPoint}set definingPoint(e){this._definingPoint.copy(e)}get leaderEndPoint(){return this._leaderEndPoint}set leaderEndPoint(e){this._leaderEndPoint.copy(e)}get geometricExtents(){return new at}get arrowLineCount(){return 0}};Hf.typeName="OrdinateDimension";let qf=Hf;const Yf=class extends Li{constructor(e,t,n,r=null,i=null){super(),this._center=new te().copy(e),this._chordPoint=new te().copy(t),this._leaderLength=n,this._extArcStartAngle=0,this._extArcEndAngle=0,this.dimensionText=r,this.dimensionStyleName=i}get center(){return this._center}set center(e){this._center.copy(e)}get chordPoint(){return this._chordPoint}set chordPoint(e){this._chordPoint.copy(e)}get extArcStartAngle(){return this._extArcStartAngle}set extArcStartAngle(e){this._extArcStartAngle=e}get extArcEndAngle(){return this._extArcEndAngle}set extArcEndAngle(e){this._extArcEndAngle=e}get leaderLength(){return this._leaderLength}set leaderLenght(e){this._leaderLength=e}get geometricExtents(){return new at}getLineArrowStyle(e){return{secondArrow:this.secondArrowStyle}}};Yf.typeName="RadialDimension";let Xf=Yf,Ba=class extends Vr{constructor(){super(),this._tabOrder=-1,this._tabSelected=!1,this._blockTableRecordId="",this._layoutName="",this._limits=new Ct,this._extents=new at}get layoutName(){return this._layoutName}set layoutName(e){this._layoutName=e.length>256?e.slice(0,256):e}get tabOrder(){return this._tabOrder}set tabOrder(e){this._tabOrder=e}get tabSelected(){return this._tabSelected}set tabSelected(e){this._tabSelected=e}get blockTableRecordId(){return this._blockTableRecordId}set blockTableRecordId(e){this._blockTableRecordId=e}get limits(){return this._limits}set limits(e){this._limits.copy(e)}get extents(){return this._extents}set extents(e){this._extents.copy(e)}},Zf=class extends Vr{constructor(e){super(),this.database=e,this._recordsByName=new Map,this._recordsById=new Map}get numEntries(){return this._recordsByName.size}setAt(e,t){t.database=this.database,this._recordsByName.set(e,t),this._recordsById.set(t.objectId,t),this.database.events.dictObjetSet.dispatch({database:this.database,object:t,key:e})}remove(e){const t=this.getAt(e);return t?(this._recordsByName.delete(e.toUpperCase()),this._recordsById.delete(this.objectId),this.database.events.dictObjectErased.dispatch({database:this.database,object:t,key:e}),!0):!1}removeId(e){const t=this.getIdAt(e);return t?(this._recordsById.delete(this.objectId),this._recordsByName.forEach((n,r)=>{n===t&&(this._recordsByName.delete(r),this.database.events.dictObjectErased.dispatch({database:this.database,object:t,key:r}))}),!0):!1}removeAll(){this._recordsByName.forEach((e,t)=>{this.database.events.dictObjectErased.dispatch({database:this.database,object:e,key:t})}),this._recordsByName.clear(),this._recordsById.clear()}has(e){return this._recordsByName.has(e.toUpperCase())}hasId(e){return this._recordsById.has(e)}getAt(e){return this._recordsByName.get(e)}getIdAt(e){return this._recordsById.get(e)}newIterator(){return new lh(this._recordsByName)}};class my extends Zf{getBtrIdAt(e){for(const[t,n]of this._recordsByName)if(n.blockTableRecordId==e)return n}get maxTabOrder(){let e=-1;return this._recordsByName.forEach(t=>{t.tabOrder>e&&(e=t.tabOrder)}),e}}class Kf extends Vr{constructor(){super(),this._sourceFileName=""}get sourceFileName(){return this._sourceFileName}set sourceFileName(e){this._sourceFileName=e}}class yy{constructor(e){this.db=e}createDefaultLayer(){const e=new fr;return e.colorIndex=7,this.db.tables.layerTable.add(new sl({name:"0",standardFlags:0,linetype:"Continuous",lineWeight:0,isOff:!1,color:e,isPlottable:!0}))}createDefaultLineType(){this.db.tables.linetypeTable.add(new ma({name:"ByBlock",standardFlag:0,description:"",totalPatternLength:0})),this.db.tables.linetypeTable.add(new ma({name:"ByLayer",standardFlag:0,description:"",totalPatternLength:0})),this.db.tables.linetypeTable.add(new ma({name:"Continuous",standardFlag:0,description:"Solid line",totalPatternLength:0}))}createDefaultTextStyle(){this.db.tables.textStyleTable.add(new gh({name:"Standard",standardFlag:0,fixedTextHeight:0,widthFactor:1,obliqueAngle:0,textGenerationFlag:0,lastHeight:.2,font:"SimKai",bigFont:"",extendedFont:"SimKai"}))}createDefaultDimStyle(){this.db.tables.dimStyleTable.add(new rl({name:"Standard",dimtxsty:"Standard"}))}createDefaultLayout(){const e=new Ba;e.layoutName="Model",e.tabOrder=0,e.blockTableRecordId=this.db.tables.blockTable.modelSpace.objectId,e.limits.min.copy({x:0,y:0}),e.limits.max.copy({x:1e6,y:1e6}),e.extents.min.copy({x:0,y:0,z:0}),e.extents.max.copy({x:1e6,y:1e6,z:0}),this.db.dictionaries.layouts.setAt(e.layoutName,e),this.db.tables.blockTable.modelSpace.layoutId=e.objectId}createArrowBlock(){if(!this.db.tables.blockTable.getAt("_CAXARROW")){const e=new nh;e.patternName="SOLID";const t=new eh;t.add(new ga({x:0,y:0},{x:-1,y:.125})),t.add(new ga({x:-1,y:.125},{x:-1,y:-.125})),t.add(new ga({x:-1,y:-.125},{x:0,y:0})),e.add(t);const n=new Zt;n.name="_CAXARROW",n.appendEntity(e),this.db.tables.blockTable.add(n)}}}var Qf=(s=>(s[s.Undefined=0]="Undefined",s[s.Inches=1]="Inches",s[s.Feet=2]="Feet",s[s.Miles=3]="Miles",s[s.Millimeters=4]="Millimeters",s[s.Centimeters=5]="Centimeters",s[s.Meters=6]="Meters",s[s.Kilometers=7]="Kilometers",s[s.Microinches=8]="Microinches",s[s.Mils=9]="Mils",s[s.Yards=10]="Yards",s[s.Angstroms=11]="Angstroms",s[s.Nanometers=12]="Nanometers",s[s.Microns=13]="Microns",s[s.Decimeters=14]="Decimeters",s[s.Dekameters=15]="Dekameters",s[s.Hectometers=16]="Hectometers",s[s.Gigameters=17]="Gigameters",s[s.Astronomical=18]="Astronomical",s[s.LightYears=19]="LightYears",s[s.Parsecs=20]="Parsecs",s[s.USSurveyFeet=21]="USSurveyFeet",s[s.USSurveyInch=22]="USSurveyInch",s[s.USSurveyYard=23]="USSurveyYard",s[s.USSurveyMile=24]="USSurveyMile",s[s.Max=24]="Max",s))(Qf||{});let lh=class{constructor(e){this.i=0,this._records=e,this._keys=Array.from(e.keys())}get count(){return this._records.size}toArray(){return Array.from(this._records.values())}[Symbol.iterator](){return this}next(){for(;this.i<this._keys.length;){const e=this._records.get(this._keys[this.i]);return this.i+=1,{value:e,done:!1}}return{value:null,done:!0}}};const Jf="Load Database";class an extends E1{constructor(e,t){super(e.stage),this.data=e,this.progress=t}async run(e){const t=Zc.getInstance().getEntry(Jf),n=Date.now();this.progress&&await this.progress(this.data.progress.value,this.data.stage,"START");const r=await this.data.task(e);return this.progress&&(await this.progress(this.data.progress.value,this.data.stage,"END",r?r.data:null),this.data.progress.value+=this.data.step,this.data.progress.value>100&&(this.data.progress.value=100)),t&&(t.data[this.name]=Date.now()-n),r}}let ch=class{constructor(e={}){this.config=e}async read(e,t,n,r){const i={name:Jf,data:{total:0},format(){let u="";return Object.keys(this.data).forEach(p=>{p!=="total"&&(u+=`- ${p}: ${this.data[p]} ms
`)}),u+=`- total: ${this.data.total} ms`,u}};Zc.getInstance().collect(i),this.progress=r;const a={value:0},l=new T1;l.setCompleteCallback(()=>this.onFinished()),l.setErrorCallback(u=>this.onError(u)),l.addTask(new an({stage:"START",step:1,progress:a,task:async u=>u},r)),l.addTask(new an({stage:"PARSE",step:5,progress:a,task:async u=>await this.parse(u)},r)),l.addTask(new an({stage:"FONT",step:5,progress:a,task:async u=>{const p=this.getFonts(u.model);return{model:u.model,data:p}}},r)),l.addTask(new an({stage:"LTYPE",step:1,progress:a,task:async u=>(this.processLineTypes(u.model,t),u)},r)),l.addTask(new an({stage:"STYLE",step:1,progress:a,task:async u=>(this.processTextStyles(u.model,t),u)},r)),l.addTask(new an({stage:"DIMSTYLE",step:1,progress:a,task:async u=>(this.processDimStyles(u.model,t),u)},r)),l.addTask(new an({stage:"LAYER",step:1,progress:a,task:async u=>(this.processLayers(u.model,t),t.tables.layerTable.numEntries===0&&t.createDefaultData({layer:!0}),u)},r)),l.addTask(new an({stage:"VPORT",step:1,progress:a,task:async u=>(this.processViewports(u.model,t),u)},r)),l.addTask(new an({stage:"HEADER",step:1,progress:a,task:async u=>(this.processHeader(u.model,t),u)},r)),l.addTask(new an({stage:"BLOCK_RECORD",step:5,progress:a,task:async u=>(this.processBlockTables(u.model,t),u)},r)),l.addTask(new an({stage:"OBJECT",step:5,progress:a,task:async u=>(this.processObjects(u.model,t),t.dictionaries.layouts.numEntries===0&&t.createDefaultData({layout:!0}),u)},r)),l.addTask(new an({stage:"BLOCK",step:5,progress:a,task:async u=>(await this.processBlocks(u.model,t),u)},r)),l.addTask(new an({stage:"ENTITY",step:100,progress:a,task:async u=>(await this.processEntities(u.model,t,n,a,r),u)},r)),l.addTask(new an({stage:"END",step:0,progress:a,task:async u=>u},r));const c=Date.now();await l.run(e),i.data.total=Date.now()-c}onError(e){if(this.progress){const t=e.task;this.progress(t.data.progress.value,t.data.stage,"ERROR",void 0,e)}return console.error(`Error occurred in conversion stage '${e.task.name}': `,e.error),e.task.name==="ENTITY"?!1:(this.onFinished(),!0)}onFinished(){this.progress&&(this.progress(100,"END","END"),fa.instance.clear())}async parse(e,t){throw new Error("Not impelemented yet!")}getFonts(e){throw new Error("Not impelemented yet!")}processLineTypes(e,t){throw new Error("Not impelemented yet!")}processTextStyles(e,t){throw new Error("Not impelemented yet!")}processDimStyles(e,t){throw new Error("Not impelemented yet!")}processLayers(e,t){throw new Error("Not impelemented yet!")}processViewports(e,t){throw new Error("Not impelemented yet!")}processHeader(e,t){throw new Error("Not impelemented yet!")}processBlockTables(e,t){throw new Error("Not impelemented yet!")}processObjects(e,t){throw new Error("Not impelemented yet!")}processBlocks(e,t){throw new Error("Not impelemented yet!")}processEntities(e,t,n,r,i){throw new Error("Not impelemented yet!")}};var Yt,Qa,Ot,Ut,Ja,qn,Qt,ws,Yn,wr,eo,to,si,ri,no,so,ro,vn,Ss,_t,ii,io,We,on,ao,ln,oo,$s,Ws,os,lo,ai,bn,As,oi,Cl,kl,Hs,qs,co,ho,Ys,uo,Ml,Pl,Xt,Es,Wt,Tn,Ll,Ol,Dl,Bl,Xs,In,li,po,ci,Cn,Zs,kn,Ks;(Yt={})[Yt.None=0]="None",Yt[Yt.Anonymous=1]="Anonymous",Yt[Yt.NonConstant=2]="NonConstant",Yt[Yt.Xref=4]="Xref",Yt[Yt.XrefOverlay=8]="XrefOverlay",Yt[Yt.ExternallyDependent=16]="ExternallyDependent",Yt[Yt.ResolvedOrDependent=32]="ResolvedOrDependent",Yt[Yt.ReferencedXref=64]="ReferencedXref";(Qa={})[Qa.BYBLOCK=0]="BYBLOCK",Qa[Qa.BYLAYER=256]="BYLAYER";(Ot={})[Ot.Rotated=0]="Rotated",Ot[Ot.Aligned=1]="Aligned",Ot[Ot.Angular=2]="Angular",Ot[Ot.Diameter=3]="Diameter",Ot[Ot.Radius=4]="Radius",Ot[Ot.Angular3Point=5]="Angular3Point",Ot[Ot.Ordinate=6]="Ordinate",Ot[Ot.ReferenceIsExclusive=32]="ReferenceIsExclusive",Ot[Ot.IsOrdinateXTypeFlag=64]="IsOrdinateXTypeFlag",Ot[Ot.IsCustomTextPositionFlag=128]="IsCustomTextPositionFlag";(Ut={})[Ut.TopLeft=1]="TopLeft",Ut[Ut.TopCenter=2]="TopCenter",Ut[Ut.TopRight=3]="TopRight",Ut[Ut.MiddleLeft=4]="MiddleLeft",Ut[Ut.MiddleCenter=5]="MiddleCenter",Ut[Ut.MiddleRight=6]="MiddleRight",Ut[Ut.BottomLeft=7]="BottomLeft",Ut[Ut.BottomCenter=8]="BottomCenter",Ut[Ut.BottomRight=9]="BottomRight";(Ja={})[Ja.AtLeast=1]="AtLeast",Ja[Ja.Exact=2]="Exact";var vu=((qn={})[qn.Center=0]="Center",qn[qn.Above=1]="Above",qn[qn.Outside=2]="Outside",qn[qn.JIS=3]="JIS",qn[qn.Below=4]="Below",qn),hi=((Qt={})[Qt.Feet=0]="Feet",Qt[Qt.None=1]="None",Qt[Qt.Inch=2]="Inch",Qt[Qt.FeetAndInch=3]="FeetAndInch",Qt[Qt.Leading=4]="Leading",Qt[Qt.Trailing=8]="Trailing",Qt[Qt.LeadingAndTrailing=12]="LeadingAndTrailing",Qt),vy=((ws={})[ws.None=0]="None",ws[ws.Leading=1]="Leading",ws[ws.Trailing=2]="Trailing",ws[ws.LeadingAndTrailing=3]="LeadingAndTrailing",ws),by=((Yn={})[Yn.Center=0]="Center",Yn[Yn.Left=1]="Left",Yn[Yn.Right=2]="Right",Yn[Yn.OverFirst=3]="OverFirst",Yn[Yn.OverSecond=4]="OverSecond",Yn),_y=((wr={})[wr.Bottom=0]="Bottom",wr[wr.Center=1]="Center",wr[wr.Top=2]="Top",wr);(eo={})[eo.PatternFill=0]="PatternFill",eo[eo.SolidFill=1]="SolidFill";(to={})[to.NonAssociative=0]="NonAssociative",to[to.Associative=1]="Associative";(si={})[si.Normal=0]="Normal",si[si.Outer=1]="Outer",si[si.Ignore=2]="Ignore";(ri={})[ri.UserDefined=0]="UserDefined",ri[ri.Predefined=1]="Predefined",ri[ri.Custom=2]="Custom";(no={})[no.NotAnnotated=0]="NotAnnotated",no[no.Annotated=1]="Annotated";(so={})[so.Solid=0]="Solid",so[so.Gradient=1]="Gradient";(ro={})[ro.TwoColor=0]="TwoColor",ro[ro.OneColor=1]="OneColor";var xy=((vn={})[vn.Default=0]="Default",vn[vn.External=1]="External",vn[vn.Polyline=2]="Polyline",vn[vn.Derived=4]="Derived",vn[vn.Textbox=8]="Textbox",vn[vn.Outermost=16]="Outermost",vn),fo=((Ss={})[Ss.Line=1]="Line",Ss[Ss.Circular=2]="Circular",Ss[Ss.Elliptic=3]="Elliptic",Ss[Ss.Spline=4]="Spline",Ss),wy=((_t={})[_t.Off=0]="Off",_t[_t.Solid=1]="Solid",_t[_t.Dashed=2]="Dashed",_t[_t.Dotted=3]="Dotted",_t[_t.ShotDash=4]="ShotDash",_t[_t.MediumDash=5]="MediumDash",_t[_t.LongDash=6]="LongDash",_t[_t.DoubleShortDash=7]="DoubleShortDash",_t[_t.DoubleMediumDash=8]="DoubleMediumDash",_t[_t.DoubleLongDash=9]="DoubleLongDash",_t[_t.DoubleMediumLongDash=10]="DoubleMediumLongDash",_t[_t.SparseDot=11]="SparseDot",_t);wy.Off;(ii={})[ii.Standard=-3]="Standard",ii[ii.ByLayer=-2]="ByLayer",ii[ii.ByBlock=-1]="ByBlock";(io={})[io.English=0]="English",io[io.Metric=1]="Metric";(We={})[We.PERSPECTIVE_MODE=1]="PERSPECTIVE_MODE",We[We.FRONT_CLIPPING=2]="FRONT_CLIPPING",We[We.BACK_CLIPPING=4]="BACK_CLIPPING",We[We.UCS_FOLLOW=8]="UCS_FOLLOW",We[We.FRONT_CLIP_NOT_AT_EYE=16]="FRONT_CLIP_NOT_AT_EYE",We[We.UCS_ICON_VISIBILITY=32]="UCS_ICON_VISIBILITY",We[We.UCS_ICON_AT_ORIGIN=64]="UCS_ICON_AT_ORIGIN",We[We.FAST_ZOOM=128]="FAST_ZOOM",We[We.SNAP_MODE=256]="SNAP_MODE",We[We.GRID_MODE=512]="GRID_MODE",We[We.ISOMETRIC_SNAP_STYLE=1024]="ISOMETRIC_SNAP_STYLE",We[We.HIDE_PLOT_MODE=2048]="HIDE_PLOT_MODE",We[We.K_ISO_PAIR_TOP=4096]="K_ISO_PAIR_TOP",We[We.K_ISO_PAIR_RIGHT=8192]="K_ISO_PAIR_RIGHT",We[We.VIEWPORT_ZOOM_LOCKING=16384]="VIEWPORT_ZOOM_LOCKING",We[We.UNUSED=32768]="UNUSED",We[We.NON_RECTANGULAR_CLIPPING=65536]="NON_RECTANGULAR_CLIPPING",We[We.VIEWPORT_OFF=131072]="VIEWPORT_OFF",We[We.GRID_BEYOND_DRAWING_LIMITS=262144]="GRID_BEYOND_DRAWING_LIMITS",We[We.ADAPTIVE_GRID_DISPLAY=524288]="ADAPTIVE_GRID_DISPLAY",We[We.SUBDIVISION_BELOW_SPACING=1048576]="SUBDIVISION_BELOW_SPACING",We[We.GRID_FOLLOWS_WORKPLANE=2097152]="GRID_FOLLOWS_WORKPLANE";(on={})[on.OPTIMIZED_2D=0]="OPTIMIZED_2D",on[on.WIREFRAME=1]="WIREFRAME",on[on.HIDDEN_LINE=2]="HIDDEN_LINE",on[on.FLAT_SHADED=3]="FLAT_SHADED",on[on.GOURAUD_SHADED=4]="GOURAUD_SHADED",on[on.FLAT_SHADED_WITH_WIREFRAME=5]="FLAT_SHADED_WITH_WIREFRAME",on[on.GOURAUD_SHADED_WITH_WIREFRAME=6]="GOURAUD_SHADED_WITH_WIREFRAME";(ao={})[ao.UCS_UNCHANGED=0]="UCS_UNCHANGED",ao[ao.HAS_OWN_UCS=1]="HAS_OWN_UCS";(ln={})[ln.NON_ORTHOGRAPHIC=0]="NON_ORTHOGRAPHIC",ln[ln.TOP=1]="TOP",ln[ln.BOTTOM=2]="BOTTOM",ln[ln.FRONT=3]="FRONT",ln[ln.BACK=4]="BACK",ln[ln.LEFT=5]="LEFT",ln[ln.RIGHT=6]="RIGHT";(oo={})[oo.ONE_DISTANT_LIGHT=0]="ONE_DISTANT_LIGHT",oo[oo.TWO_DISTANT_LIGHTS=1]="TWO_DISTANT_LIGHTS";($s={})[$s.ByLayer=0]="ByLayer",$s[$s.ByBlock=1]="ByBlock",$s[$s.ByDictionaryDefault=2]="ByDictionaryDefault",$s[$s.ByObject=3]="ByObject";function Qe(s,e,t){return s.code===e&&(t==null||s.value===t)}function dt(s){let e={};s.rewind();let t=s.next(),n=t.code;if(e.x=t.value,(t=s.next()).code!==n+10)throw Error("Expected code for point value to be 20 but got "+t.code+".");return e.y=t.value,(t=s.next()).code!==n+20?s.rewind():e.z=t.value,e}let hh=Symbol();function Ye(s,e){return(t,n,r)=>{let i=function(c,u=!1){return c.reduce((p,g)=>{g.pushContext&&p.push({});let m=p[p.length-1];for(let y of typeof g.code=="number"?[g.code]:g.code){let A=m[y]??(m[y]=[]);g.isMultiple&&A.length&&u&&console.warn(`Snippet ${A[A.length-1].name} for code(${y}) is shadowed by ${g.name}`),A.push(g)}return p},[{}])}(s,n.debug),a=!1,l=i.length-1;for(;!Qe(t,0,"EOF");){let c=function(C,E,L){return C.find((O,F)=>{var B;return F>=L&&((B=O[E])==null?void 0:B.length)})}(i,t.code,l),u=c==null?void 0:c[t.code],p=u==null?void 0:u[u.length-1];if(!c||!p){n.rewind();break}p.isMultiple||c[t.code].pop();let{name:g,parser:m,isMultiple:y,isReducible:A}=p,w=m==null?void 0:m(t,n,r);if(w===hh){n.rewind();break}if(g){let[C,E]=function(L,O){let F=O.split(".");if(!F.length)throw Error("[parserGenerator::getObjectByPath] Invalid empty path");let B=L;for(let Z=0;Z<F.length-1;++Z){let W=Nl(F[Z]),Q=Nl(F[Z+1]);Object.prototype.hasOwnProperty.call(B,W)||(typeof Q=="number"?B[W]=[]:B[W]={}),B=B[W]}return[B,Nl(F[F.length-1])]}(r,g);y&&!A?(Object.prototype.hasOwnProperty.call(C,E)||(C[E]=[]),C[E].push(w)):C[E]=w}p.pushContext&&(l-=1),a=!0,t=n.next()}return e&&Object.setPrototypeOf(r,e),a}}function Nl(s){let e=Number.parseInt(s);return Number.isNaN(e)?s:e}function M({value:s}){return s}function re(s,e){return dt(e)}function ft({value:s}){return!!s}let Sy=[{code:1001,name:"xdata",parser:eg}];function eg(s,e){var t;if(!Qe(s,1001))throw Error("XData must starts with code 1001");let n={appName:s.value,value:[]};s=e.next();let r=[n.value];for(;!Qe(s,0,"EOF")&&s.code>=1e3;){let i=r[r.length-1];switch(s.code){case 1002:s.value==="{"?r.push([]):(r.pop(),(t=r[r.length-1])==null||t.push(i));break;case 1e3:case 1004:case 1040:case 1070:case 1071:i.push({type:Ts(s.code),value:s.value});break;case 1003:i.push({name:"layer",type:Ts(s.code),value:s.value});break;case 1005:i.push({name:"handle",type:Ts(s.code),value:s.value});break;case 1010:i.push({type:Ts(s.code),value:dt(e)});break;case 1011:i.push({name:"worldSpacePosition",type:Ts(s.code),value:dt(e)});break;case 1012:i.push({name:"worldSpaceDisplacement",type:Ts(s.code),value:dt(e)});break;case 1013:i.push({name:"worldSpaceDirection",type:Ts(s.code),value:dt(e)});break;case 1041:i.push({name:"distance",type:Ts(s.code),value:s.value});break;case 1042:i.push({name:"scale",type:Ts(s.code),value:s.value})}s=e.next()}return e.rewind(),n}function Ts(s){switch(s){case 1e3:case 1003:case 1005:return"string";case 1004:return"hex";case 1040:case 1041:case 1042:return"real";case 1070:return"integer";case 1071:return"long";case 1010:case 1011:case 1012:case 1013:return"point";default:return""}}function Lr(s,e,t){for(;Qe(s,102);){var n;let r=s.value;if(s=e.next(),!r.startsWith("{")){e.debug&&console.warn(`Invalid application group, expected to start with "{" but received: ${r}`),function(a,l){for(;!Qe(a,102)&&!Qe(a,0,"EOF");)a=l.next()}(s,e),s=e.next();continue}let i=r.slice(1).trim();t.extensions??(t.extensions={}),(n=t.extensions)[i]??(n[i]=[]),function(a,l,c){for(;!Qe(a,102,"}")&&!Qe(a,0,"EOF");)c.push(a),a=l.next()}(s,e,t.extensions[i]),s=e.next()}e.rewind()}let Ay=0;function tg(s){if(!s)throw TypeError("entity cannot be undefined or null");s.handle||(s.handle=Ay++)}var Ey=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];function ng(s){return Ey[s]}(Ws={})[Ws.CAST_AND_RECEIVE=0]="CAST_AND_RECEIVE",Ws[Ws.CAST=1]="CAST",Ws[Ws.RECEIVE=2]="RECEIVE",Ws[Ws.IGNORE=3]="IGNORE";let mt=[...Sy,{code:284,name:"shadowMode",parser:M},{code:390,name:"plotStyleHardId",parser:M},{code:380,name:"plotStyleType",parser:M},{code:440,name:"transparency",parser:M},{code:430,name:"colorName",parser:M},{code:420,name:"color",parser:M},{code:310,name:"proxyEntity",isMultiple:!0,parser:M},{code:92,name:"proxyByte",parser:M},{code:60,name:"isVisible",parser:ft},{code:48,name:"lineTypeScale",parser:M},{code:370,name:"lineweight",parser:M},{code:62,name:"colorIndex",parser(s,e,t){let n=s.value;return n>0&&n<256&&(t.color=ng(Math.abs(n))),n}},{code:347,name:"materialObjectHardId",parser:M},{code:6,name:"lineType",parser:M},{code:8,name:"layer",parser:M},{code:410,name:"layoutTabName",parser:M},{code:67,name:"isInPaperSpace",parser:ft},{code:100},{code:160},{code:330,name:"ownerBlockRecordSoftId",parser:M},{code:102,parser:Lr},{code:102,parser:Lr},{code:102,parser:Lr},{code:5,name:"handle",parser:M}];function nl(s){return[{code:3,name:s,parser:(e,t,n)=>(n._code3text=(n._code3text??"")+e.value,n._code3text+(n._code1text??"")),isMultiple:!0,isReducible:!0},{code:1,name:s,parser:(e,t,n)=>(n._code1text=e.value,(n._code3text??"")+n._code1text)}]}function sg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Ty={extrusionDirection:{x:0,y:0,z:1}},Iy=[{code:210,name:"extrusionDirection",parser:re},{code:51,name:"endAngle",parser:M},{code:50,name:"startAngle",parser:M},{code:100,name:"subclassMarker",parser:M},{code:40,name:"radius",parser:M},{code:10,name:"center",parser:re},{code:39,name:"thickness",parser:M},{code:100},...mt],rg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){sg(this,"parser",Ye(Iy,Ty))}};sg(rg,"ForEntityName","ARC");(os={})[os.NONE=0]="NONE",os[os.INVISIBLE=1]="INVISIBLE",os[os.CONSTANT=2]="CONSTANT",os[os.VERIFICATION_REQUIRED=4]="VERIFICATION_REQUIRED",os[os.PRESET=8]="PRESET";(lo={})[lo.MULTILINE=2]="MULTILINE",lo[lo.CONSTANT_MULTILINE=4]="CONSTANT_MULTILINE";(ai={})[ai.NONE=0]="NONE",ai[ai.MIRRORED_X=2]="MIRRORED_X",ai[ai.MIRRORED_Y=4]="MIRRORED_Y";var Cy=((bn={})[bn.LEFT=0]="LEFT",bn[bn.CENTER=1]="CENTER",bn[bn.RIGHT=2]="RIGHT",bn[bn.ALIGNED=3]="ALIGNED",bn[bn.MIDDLE=4]="MIDDLE",bn[bn.FIT=5]="FIT",bn),ky=((As={})[As.BASELINE=0]="BASELINE",As[As.BOTTOM=1]="BOTTOM",As[As.MIDDLE=2]="MIDDLE",As[As.TOP=3]="TOP",As);function ig(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let ag={thickness:0,rotation:0,xScale:1,obliqueAngle:0,styleName:"STANDARD",generationFlag:0,halign:Cy.LEFT,valign:ky.BASELINE,extrusionDirection:{x:0,y:0,z:1}},og=[{code:73,name:"valign",parser:M},{code:100},{code:210,name:"extrusionDirection",parser:re},{code:11,name:"endPoint",parser:re},{code:72,name:"valign",parser:M},{code:72,name:"halign",parser:M},{code:71,name:"generationFlag",parser:M},{code:7,name:"styleName",parser:M},{code:51,name:"obliqueAngle",parser:M},{code:41,name:"xScale",parser:M},{code:50,name:"rotation",parser:M},{code:1,name:"text",parser:M},{code:40,name:"textHeight",parser:M},{code:10,name:"startPoint",parser:re},{code:39,name:"thickness",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],lg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){ig(this,"parser",Ye(og,ag))}};function cg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}ig(lg,"ForEntityName","TEXT");let My={...ag},Py=[{code:2},{code:40,name:"annotationScale",parser:M},{code:10,name:"alignmentPoint",parser:re},{code:340,name:"secondaryAttributesHardIds",isMultiple:!0,parser:M},{code:70,name:"numberOfSecondaryAttributes",parser:M},{code:70,name:"isReallyLocked",parser:ft},{code:70,name:"mtextFlag",parser:M},{code:280,name:"isDuplicatedRecord",parser:ft},{code:100},{code:280,name:"isLocked",parser:ft},{code:74,name:"valign",parser:M},{code:73},{code:70,name:"attributeFlag",parser:M},{code:2,name:"tag",parser:M},{code:3,name:"prompt",parser:M},{code:280},{code:100,name:"subclassMarker",parser:M},...og.slice(2)],hg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){cg(this,"parser",Ye(Py,My))}};cg(hg,"ForEntityName","ATTDEF");(oi={})[oi.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",oi[oi.TOP_TO_BOTTOM=3]="TOP_TO_BOTTOM",oi[oi.BY_STYLE=5]="BY_STYLE";function Ly(s,e){let t={};for(let n of s){let r=e(n);r!=null&&(t[r]??(t[r]=[]),t[r].push(n))}return t}function*$o(s,e=1/0,t=1){for(let n=s;n!==e;n+=t)yield n}function rr(s){return{x:s.x??0,y:s.y??0,z:s.z??0}}function uh(s,e,t){if(Qe(e,102))return Lr(e,t,s),!0;switch(e.code){case 0:s.type=e.value;break;case 5:s.handle=e.value;break;case 330:s.ownerBlockRecordSoftId=e.value;break;case 67:s.isInPaperSpace=!!e.value;break;case 8:s.layer=e.value;break;case 6:s.lineType=e.value;break;case 347:s.materialObjectHardId=e.value;break;case 62:s.colorIndex=e.value,s.color=ng(Math.abs(e.value));break;case 370:s.lineweight=e.value;break;case 48:s.lineTypeScale=e.value;break;case 60:s.isVisible=!!e.value;break;case 92:s.proxyByte=e.value;break;case 310:s.proxyEntity=e.value;break;case 100:break;case 420:s.color=e.value;break;case 430:s.transparency=e.value;break;case 390:s.plotStyleHardId=e.value;break;case 284:s.shadowMode=e.value;break;case 1001:s.xdata=eg(e,t);break;default:return!1}return!0}function ug(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Oy={textStyle:"STANDARD",extrusionDirection:{x:0,y:0,z:1},rotation:0},Oo=[{code:46,name:"annotationHeight",parser:M},{code:101,parser(s,e){(function(t){t.rewind();let n=t.next();if(n.code!==101)throw Error("Bad call for skipEmbeddedObject()");do n=t.next();while(n.code!==0);t.rewind()})(e)}},{code:50,name:"columnHeight",parser:M},{code:49,name:"columnGutter",parser:M},{code:48,name:"columnWidth",parser:M},{code:79,name:"columnAutoHeight",parser:M},{code:78,name:"columnFlowReversed",parser:M},{code:76,name:"columnCount",parser:M},{code:75,name:"columnType",parser:M},{code:441,name:"backgroundFillTransparency",parser:M},{code:63,name:"backgroundFillColor",parser:M},{code:45,name:"fillBoxScale",parser:M},{code:[...$o(430,440)],name:"backgroundColor",parser:M},{code:[...$o(420,430)],name:"backgroundColor",parser:M},{code:90,name:"backgroundFill",parser:M},{code:44,name:"lineSpacing",parser:M},{code:73,name:"lineSpacingStyle",parser:M},{code:50,name:"rotation",parser:M},{code:43},{code:42},{code:11,name:"direction",parser:re},{code:210,name:"extrusionDirection",parser:re},{code:7,name:"styleName",parser:M},...nl("text"),{code:72,name:"drawingDirection",parser:M},{code:71,name:"attachmentPoint",parser:M},{code:41,name:"width",parser:M},{code:40,name:"height",parser:M},{code:10,name:"insertionPoint",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],dg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){ug(this,"parser",Ye(Oo,Oy))}};function pg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}ug(dg,"ForEntityName","MTEXT");let Dy={thickness:0,rotation:0,scale:1,obliqueAngle:0,textStyle:"STANDARD",textGenerationFlag:0,horizontalJustification:0,verticalJustification:0,extrusionDirection:{x:0,y:0,z:1}},By=[...Oo.slice(Oo.findIndex(({name:s})=>s==="columnType"),Oo.findIndex(({name:s})=>s==="subclassMarker")+1),{code:100},{code:0,parser(s){if(!Qe(s,0,"MTEXT"))return hh}},{code:2,name:"definitionTag",parser:M},{code:40,name:"annotationScale",parser:M},{code:10,name:"alignmentPoint",parser:re},{code:340,name:"secondaryAttributesHardId",parser:M},{code:70,name:"numberOfSecondaryAttributes",parser:M},{code:70,name:"isReallyLocked",parser:ft},{code:70,name:"mtextFlag",parser:M},{code:280,name:"isDuplicatedEntriesKeep",parser:ft},{code:100},{code:280,name:"lockPositionFlag",parser:ft},{code:210,name:"extrusionDirection",parser:re},{code:11,name:"alignmentPoint",parser:re},{code:74,name:"verticalJustification",parser:M},{code:72,name:"horizontalJustification",parser:M},{code:71,name:"textGenerationFlag",parser:M},{code:7,name:"textStyle",parser:M},{code:51,name:"obliqueAngle",parser:M},{code:41,name:"scale",parser:M},{code:50,name:"rotation",parser:M},{code:73},{code:70,name:"attributeFlag",parser:M},{code:2,name:"tag",parser:M},{code:280},{code:100,name:"subclassMarker",parser:M},{code:1,name:"text",parser:M},{code:40,name:"textHeight",parser:M},{code:10,name:"startPoint",parser:re},{code:39,name:"thickness",parser:M},{code:100},...mt],fg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){pg(this,"parser",Ye(By,Dy))}};function gg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}pg(fg,"ForEntityName","ATTRIB");let Ny=[...nl("data"),{code:70,name:"version",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],mg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){gg(this,"parser",Ye(Ny))}};function yg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}gg(mg,"ForEntityName","BODY");let Ry={thickness:0,extrusionDirection:{x:0,y:0,z:1}},Fy=[{code:210,name:"extrusionDirection",parser:re},{code:40,name:"radius",parser:M},{code:10,name:"center",parser:re},{code:39,name:"thickness",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],vg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){yg(this,"parser",Ye(Fy,Ry))}};yg(vg,"ForEntityName","CIRCLE");let Do=class{parseEntity(e,t){let n={};for(;!Qe(t,0,"EOF");){if(t.code===0){e.rewind();break}(function(r,i,a){switch(i.code){case 100:r.subclassMarker=i.value;break;case 280:r.version=i.value;break;case 2:r.name=i.value;break;case 10:r.definitionPoint=dt(a);break;case 11:r.textPoint=dt(a);break;case 12:r.insertionPoint=dt(a);break;case 13:r.subDefinitionPoint1=dt(a);break;case 14:r.subDefinitionPoint2=dt(a);break;case 15:r.centerPoint=dt(a);break;case 16:r.arcPoint=dt(a);break;case 70:r.dimensionType=i.value;break;case 71:r.attachmentPoint=i.value;break;case 72:r.textLineSpacingStyle=i.value;break;case 40:r.leaderLength=i.value;break;case 41:r.textLineSpacingFactor=i.value;break;case 42:r.measurement=i.value;break;case 1:r.text=i.value;break;case 50:r.rotationAngle=i.value;break;case 52:r.obliqueAngle=i.value;break;case 53:r.textRotation=i.value;break;case 51:r.ocsRotation=i.value;break;case 210:r.extrusionDirection=dt(a);break;case 3:r.styleName=i.value;break;default:uh(r,i,a)}})(n,t,e),t=e.next()}return n}};function bg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}kl="DIMENSION",(Cl="ForEntityName")in Do?Object.defineProperty(Do,Cl,{value:kl,enumerable:!0,configurable:!0,writable:!0}):Do[Cl]=kl;let zy={extrusionDirection:{x:0,y:0,z:1}},Uy=[{code:42,name:"endAngle",parser:M},{code:41,name:"startAngle",parser:M},{code:40,name:"axisRatio",parser:M},{code:210,name:"extrusionDirection",parser:re},{code:11,name:"majorAxisEndPoint",parser:re},{code:10,name:"center",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],_g=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){bg(this,"parser",Ye(Uy,zy))}};bg(_g,"ForEntityName","ELLIPSE");(Hs={})[Hs.First=1]="First",Hs[Hs.Second=2]="Second",Hs[Hs.Third=4]="Third",Hs[Hs.Fourth=8]="Fourth";function xg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Gy=[{code:13,name:"vertices.3",parser:re},{code:12,name:"vertices.2",parser:re},{code:11,name:"vertices.1",parser:re},{code:10,name:"vertices.0",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],wg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){xg(this,"parser",Ye(Gy))}};xg(wg,"ForEntityName","3DFACE");let Sg=[{code:330,name:"sourceBoundaryObjects",parser:M,isMultiple:!0},{code:97,name:"numberOfSourceBoundaryObjects",parser:M}],Vy=[{code:11,name:"end",parser:re},{code:10,name:"start",parser:re}],jy=[{code:73,name:"isCCW",parser:ft},{code:51,name:"endAngle",parser:M},{code:50,name:"startAngle",parser:M},{code:40,name:"radius",parser:M},{code:10,name:"center",parser:re}],$y=[{code:73,name:"isCCW",parser:ft},{code:51,name:"endAngle",parser:M},{code:50,name:"startAngle",parser:M},{code:40,name:"lengthOfMinorAxis",parser:M},{code:11,name:"end",parser:re},{code:10,name:"center",parser:re}],Wy=[{code:13,name:"endTangent",parser:re},{code:12,name:"startTangent",parser:re},{code:11,name:"fitDatum",isMultiple:!0,parser:re},{code:97,name:"numberOfFitData",parser:M},{code:10,name:"controlPoints",isMultiple:!0,parser(s,e){let t={...dt(e),weight:1};return(s=e.next()).code===42?t.weight=s.value:e.rewind(),t}},{code:40,name:"knots",isMultiple:!0,parser:M},{code:96,name:"numberOfControlPoints",parser:M},{code:95,name:"numberOfKnots",parser:M},{code:74,name:"isPeriodic",parser:ft},{code:73,name:"splineFlag",parser:M},{code:94,name:"degree",parser:M}],Hy={[fo.Line]:Vy,[fo.Circular]:jy,[fo.Elliptic]:$y,[fo.Spline]:Wy},qy=[...Sg,{code:72,name:"edges",parser(s,e){let t={type:s.value},n=Ye(Hy[t.type]);if(!n)throw Error(`Invalid edge type ${t.type}`);return n(s=e.next(),e,t),t},isMultiple:!0},{code:93,name:"numberOfEdges",parser:M}],Yy=[...Sg,{code:10,name:"vertices",parser(s,e){let t={...dt(e),bulge:0};return(s=e.next()).code===42?t.bulge=s.value:e.rewind(),t},isMultiple:!0},{code:93,name:"numberOfVertices",parser:M},{code:73,name:"isClosed",parser:ft},{code:72,name:"hasBulge",parser:ft}],Xy=[{code:49,name:"dashLengths",parser:M,isMultiple:!0},{code:79,name:"numberOfDashLengths",parser:M},{code:45,name:"offset",parser:bu},{code:43,name:"base",parser:bu},{code:53,name:"angle",parser:M}];function bu(s,e){let t=s.code+1,n={x:s.value,y:1};return(s=e.next()).code===t?n.y=s.value:e.rewind(),n}function Ag(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Zy={extrusionDirection:{x:0,y:0,z:1},gradientRotation:0,colorTint:0},Ky=[{code:470},{code:463},{code:462,name:"colorTint",parser:M},{code:461,name:"gradientDefinition",parser:M},{code:460,name:"gradientRotation",parser:M},{code:453,name:"numberOfColors",parser:M},{code:452,name:"gradientColorFlag",parser:M},{code:451},{code:450,name:"gradientFlag",parser:M},{code:10,name:"seedPoints",parser:re,isMultiple:!0},{code:99},{code:11,name:"offsetVector",parser:re},{code:98,name:"numberOfSeedPoints",parser:M},{code:47,name:"pixelSize",parser:M},{code:53,name:"definitionLines",parser:function(s,e){let t={};return Ye(Xy)(s,e,t),t},isMultiple:!0},{code:78,name:"numberOfDefinitionLines",parser:M},{code:77,name:"isDouble",parser:ft},{code:73,name:"isAnnotated",parser:ft},{code:41,name:"patternScale",parser:M},{code:52,name:"patternAngle",parser:M},{code:76,name:"patternType",parser:M},{code:75,name:"hatchStyle",parser:M},{code:92,name:"boundaryPaths",parser:function(s,e){let t={boundaryPathTypeFlag:s.value},n=t.boundaryPathTypeFlag&xy.Polyline;return s=e.next(),n?Ye(Yy)(s,e,t):Ye(qy)(s,e,t),t},isMultiple:!0},{code:91,name:"numberOfBoundaryPaths",parser:M},{code:71,name:"associativity",parser:M},{code:63,name:"patternFillColor",parser:M},{code:70,name:"solidFill",parser:M},{code:2,name:"patternName",parser:M},{code:210,name:"extrusionDirection",parser:re},{code:10,name:"elevationPoint",parser:re},{code:100,name:"subclassMarker",parser:M,pushContext:!0},...mt],Eg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Ag(this,"parser",Ye(Ky,Zy))}};Ag(Eg,"ForEntityName","HATCH");(qs={})[qs.ShowImage=1]="ShowImage",qs[qs.ShowImageWhenNotAlignedWithScreen=2]="ShowImageWhenNotAlignedWithScreen",qs[qs.UseClippingBoundary=4]="UseClippingBoundary",qs[qs.TransparencyIsOn=8]="TransparencyIsOn";(co={})[co.Rectangular=1]="Rectangular",co[co.Polygonal=2]="Polygonal";(ho={})[ho.Outside=0]="Outside",ho[ho.Inside=1]="Inside";function Tg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Qy={brightness:50,contrast:50,fade:0,clippingBoundaryPath:[]},Jy=[{code:290,name:"clipMode",parser:M},{code:14,name:"clippingBoundaryPath",isMultiple:!0,parser:re},{code:91,name:"countBoundaryPoints",parser:M},{code:71,name:"clippingBoundaryType",parser:M},{code:360,name:"imageDefReactorHandle",parser:M},{code:283,name:"fade",parser:M},{code:282,name:"contrast",parser:M},{code:281,name:"brightness",parser:M},{code:280,name:"isClipped",parser:ft},{code:70,name:"flags",parser:M},{code:340,name:"imageDefHandle",parser:M},{code:13,name:"imageSize",parser:re},{code:12,name:"vPixel",parser:re},{code:11,name:"uPixel",parser:re},{code:10,name:"position",parser:re},{code:90,name:"version",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],Ig=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Tg(this,"parser",Ye(Jy,Qy))}};function Cg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Tg(Ig,"ForEntityName","IMAGE");let ev={xScale:1,yScale:1,zScale:1,rotation:0,columnCount:0,rowCount:0,columnSpacing:0,rowSpacing:0,extrusionDirection:{x:0,y:0,z:1}},tv=[{code:210,name:"extrusionDirection",parser:re},{code:45,name:"rowSpacing",parser:M},{code:44,name:"columnSpacing",parser:M},{code:71,name:"rowCount",parser:M},{code:70,name:"columnCount",parser:M},{code:50,name:"rotation",parser:M},{code:43,name:"zScale",parser:M},{code:42,name:"yScale",parser:M},{code:41,name:"xScale",parser:M},{code:10,name:"insertionPoint",parser:re},{code:2,name:"name",parser:M},{code:66,name:"isVariableAttributes",parser:ft},{code:100,name:"subclassMarker",parser:M},...mt],kg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Cg(this,"parser",Ye(tv,ev))}};function Mg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Cg(kg,"ForEntityName","INSERT");let nv={isArrowheadEnabled:!0},sv=[{code:213,name:"offsetFromAnnotation",parser:re},{code:212,name:"offsetFromBlock",parser:re},{code:211,name:"horizontalDirection",parser:re},{code:210,name:"normal",parser:re},{code:340,name:"associatedAnnotation",parser:M},{code:77,name:"byBlockColor",parser:M},{code:10,name:"vertices",parser:re,isMultiple:!0},{code:76,name:"numberOfVertices",parser:M},{code:41,name:"textWidth",parser:M},{code:40,name:"textHeight",parser:M},{code:75,name:"isHooklineExists",parser:ft},{code:74,name:"isHooklineSameDirection",parser:ft},{code:73,name:"leaderCreationFlag",parser:M},{code:72,name:"isSpline",parser:ft},{code:71,name:"isArrowheadEnabled",parser:ft},{code:3,name:"styleName",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],Pg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Mg(this,"parser",Ye(sv,nv))}};Mg(Pg,"ForEntityName","LEADER");(Ys={})[Ys.TextAnnotation=0]="TextAnnotation",Ys[Ys.ToleranceAnnotation=1]="ToleranceAnnotation",Ys[Ys.BlockReferenceAnnotation=2]="BlockReferenceAnnotation",Ys[Ys.NoAnnotation=3]="NoAnnotation";function Lg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let rv={thickness:0,extrusionDirection:{x:0,y:0,z:1}},iv=[{code:210,name:"extrusionDirection",parser:re},{code:11,name:"endPoint",parser:re},{code:10,name:"startPoint",parser:re},{code:39,name:"thickness",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],Og=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Lg(this,"parser",Ye(iv,rv))}};Lg(Og,"ForEntityName","LINE");(uo={})[uo.IS_CLOSED=1]="IS_CLOSED",uo[uo.PLINE_GEN=128]="PLINE_GEN";let av={flag:0,elevation:0,thickness:0,extrusionDirection:{x:0,y:0,z:1},vertices:[]},ov={bulge:0},lv=[{code:42,name:"bulge",parser:M},{code:41,name:"endWidth",parser:M},{code:40,name:"startWidth",parser:M},{code:91,name:"id",parser:M},{code:20,name:"y",parser:M},{code:10,name:"x",parser:M}],cv=[{code:210,name:"extrusionDirection",parser:re},{code:10,name:"vertices",isMultiple:!0,parser(s,e){let t={};return Ye(lv,ov)(s,e,t),t}},{code:39,name:"thickness",parser:M},{code:38,name:"elevation",parser:M},{code:43,name:"constantWidth",parser:M},{code:70,name:"flag",parser:M},{code:90,name:"numberOfVertices",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],Bo=class{parseEntity(e,t){let n={};return Ye(cv,av)(t,e,n),n}};function Dg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Pl="LWPOLYLINE",(Ml="ForEntityName")in Bo?Object.defineProperty(Bo,Ml,{value:Pl,enumerable:!0,configurable:!0,writable:!0}):Bo[Ml]=Pl;let hv=[{code:90,name:"overridenSubEntityCount",parser:M},{code:140,name:"edgeCreaseWeights",parser:M,isMultiple:!0},{code:95,name:"edgeCreaseCount",parser:M},{code:94,parser(s,e,t){t.edgeCount=s.value,t.edgeIndices=[];for(let n=0;n<t.edgeCount;++n){let r=[];s=e.next(),r[0]=s.value,s=e.next(),r[1]=s.value,t.edgeIndices.push(r)}}},{code:93,parser(s,e,t){t.totalFaceIndices=s.value,t.faceIndices=[];let n=[];for(let i=0;i<t.totalFaceIndices&&!Qe(s,0);++i)s=e.next(),n.push(s.value);let r=0;for(;r<n.length;){let i=n[r++],a=[];for(let l=0;l<i;++l)a.push(n[r++]);t.faceIndices.push(a)}}},{code:10,name:"vertices",parser:re,isMultiple:!0},{code:92,name:"verticesCount",parser:M},{code:91,name:"subdivisionLevel",parser:M},{code:40,name:"blendCrease",parser:M},{code:72,name:"isBlendCreased",parser:ft},{code:71,name:"version",parser:M},{code:100,name:"subclassMarker",parser:function({value:s}){return s.trim()},pushContext:!0},...mt],Bg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Dg(this,"parser",Ye(hv))}};function Ng(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Dg(Bg,"ForEntityName","MESH");let uv={thickness:0,extrusionDirection:{x:0,y:0,z:1},angle:0},dv=[{code:50,name:"angle",parser:M},{code:210,name:"extrusionDirection",parser:re},{code:39,name:"thickness",parser:M},{code:10,name:"position",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],Rg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Ng(this,"parser",Ye(dv,uv))}};Ng(Rg,"ForEntityName","POINT");(Xt={})[Xt.CLOSED_POLYLINE=1]="CLOSED_POLYLINE",Xt[Xt.CURVE_FIT=2]="CURVE_FIT",Xt[Xt.SPLINE_FIT=4]="SPLINE_FIT",Xt[Xt.POLYLINE_3D=8]="POLYLINE_3D",Xt[Xt.POLYGON_3D=16]="POLYGON_3D",Xt[Xt.CLOSED_POLYGON=32]="CLOSED_POLYGON",Xt[Xt.POLYFACE=64]="POLYFACE",Xt[Xt.CONTINUOUS=128]="CONTINUOUS";var go=((Es={})[Es.NONE=0]="NONE",Es[Es.QUADRATIC=5]="QUADRATIC",Es[Es.CUBIC=6]="CUBIC",Es[Es.BEZIER=8]="BEZIER",Es),pv=((Wt={})[Wt.CREATED_BY_CURVE_FIT=1]="CREATED_BY_CURVE_FIT",Wt[Wt.TANGENT_DEFINED=2]="TANGENT_DEFINED",Wt[Wt.NOT_USED=4]="NOT_USED",Wt[Wt.CREATED_BY_SPLINE_FIT=8]="CREATED_BY_SPLINE_FIT",Wt[Wt.SPLINE_CONTROL_POINT=16]="SPLINE_CONTROL_POINT",Wt[Wt.FOR_POLYLINE=32]="FOR_POLYLINE",Wt[Wt.FOR_POLYGON=64]="FOR_POLYGON",Wt[Wt.POLYFACE=128]="POLYFACE",Wt);function Fg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let fv={startWidth:0,endWidth:0,bulge:0},gv=[{code:91,name:"id",parser:M},{code:[...$o(71,75)],name:"faces",isMultiple:!0,parser:M},{code:50,name:"tangentDirection",parser:M},{code:70,name:"flag",parser:M},{code:42,name:"bulge",parser:M},{code:41,name:"endWidth",parser:M},{code:40,name:"startWidth",parser:M},{code:30,name:"z",parser:M},{code:20,name:"y",parser:M},{code:10,name:"x",parser:M},{code:100,name:"subclassMarker",parser:M},{code:100},...mt],dh=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Fg(this,"parser",Ye(gv,fv))}};function zg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Fg(dh,"ForEntityName","VERTEX");let mv={thickness:0,flag:0,startWidth:0,endWidth:0,meshMVertexCount:0,meshNVertexCount:0,surfaceMDensity:0,surfaceNDensity:0,smoothType:0,extrusionDirection:{x:0,y:0,z:1},vertices:[]},yv=[{code:0,name:"vertices",isMultiple:!0,parser:(s,e)=>Qe(s,0,"VERTEX")?(s=e.next(),new dh().parseEntity(e,s)):hh},{code:210,name:"extrusionDirection",parser:re},{code:75,name:"smoothType",parser:M},{code:74,name:"surfaceNDensity",parser:M},{code:73,name:"surfaceMDensity",parser:M},{code:72,name:"meshNVertexCount",parser:M},{code:71,name:"meshMVertexCount",parser:M},{code:41,name:"endWidth",parser:M},{code:40,name:"startWidth",parser:M},{code:70,name:"flag",parser:M},{code:39,name:"thickness",parser:M},{code:30,name:"elevation",parser:M},{code:20},{code:10},{code:66},{code:100,name:"subclassMarker",parser:M},...mt],Ug=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){zg(this,"parser",Ye(yv,mv))}};function Gg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}zg(Ug,"ForEntityName","POLYLINE");let vv=[{code:11,name:"direction",parser:re},{code:10,name:"position",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],Vg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Gg(this,"parser",Ye(vv))}};function jg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Gg(Vg,"ForEntityName","RAY");let bv=[...nl("data"),{code:70,name:"version",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],$g=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){jg(this,"parser",Ye(bv))}};function Wg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}jg($g,"ForEntityName","REGION");let _v={vertices:[],backLineVertices:[]},xv=[{code:360,name:"geometrySettingHardId",parser:M},{code:12,name:"backLineVertices",isMultiple:!0,parser:re},{code:93,name:"numberOfBackLineVertices",parser:M},{code:11,name:"vertices",isMultiple:!0,parser:re},{code:92,name:"verticesCount",parser:M},{code:[63,411],name:"indicatorColor",parser:M},{code:70,name:"indicatorTransparency",parser:M},{code:41,name:"bottomHeight",parser:M},{code:40,name:"topHeight",parser:M},{code:10,name:"verticalDirection",parser:re},{code:1,name:"name",parser:M},{code:91,name:"flag",parser:M},{code:90,name:"state",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],Hg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Wg(this,"parser",Ye(xv,_v))}};function qg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Wg(Hg,"ForEntityName","SECTION");let wv={points:[],thickness:0,extrusionDirection:{x:0,y:0,z:1}},Sv=[{code:210,name:"extrusionDirection",parser:re},{code:39,name:"thickness",parser:M},{code:[...$o(10,14)],name:"points",isMultiple:!0,parser:re},{code:100,name:"subclassMarker",parser:M},...mt],Yg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){qg(this,"parser",Ye(Sv,wv))}};function Xg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}qg(Yg,"ForEntityName","SOLID");let Av=[{code:350,name:"historyObjectSoftId",parser:M},{code:100,name:"subclassMarker",parser:M},...nl("data"),{code:70,name:"version",parser:M},{code:100},...mt],Zg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Xg(this,"parser",Ye(Av))}};Xg(Zg,"ForEntityName","3DSOLID");(Tn={})[Tn.NONE=0]="NONE",Tn[Tn.CLOSED=1]="CLOSED",Tn[Tn.PERIODIC=2]="PERIODIC",Tn[Tn.RATIONAL=4]="RATIONAL",Tn[Tn.PLANAR=8]="PLANAR",Tn[Tn.LINEAR=16]="LINEAR";function Kg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Ev={knotTolerance:1e-6,controlTolerance:1e-6,fitTolerance:1e-9,knotValues:[],controlPoints:[],fitPoints:[]},Tv=[{code:11,name:"fitPoints",isMultiple:!0,parser:re},{code:10,name:"controlPoints",isMultiple:!0,parser:re},{code:41,name:"weights",isMultiple:!0,parser:M},{code:40,name:"knots",isMultiple:!0,parser:M},{code:13,name:"endTangent",parser:re},{code:12,name:"startTangent",parser:re},{code:44,name:"fitTolerance",parser:M},{code:43,name:"controlTolerance",parser:M},{code:42,name:"knotTolerance",parser:M},{code:74,name:"numberOfFitPoints",parser:M},{code:73,name:"numberOfControlPoints",parser:M},{code:72,name:"numberOfKnots",parser:M},{code:71,name:"degree",parser:M},{code:70,name:"flag",parser:M},{code:210,name:"normal",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],Qg=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Kg(this,"parser",Ye(Tv,Ev))}};Kg(Qg,"ForEntityName","SPLINE");let No=class{parseEntity(e,t){let n={};for(;!e.isEOF();){if(t.code===0){e.rewind();break}switch(t.code){case 100:n.subclassMarker=t.value,t=e.next();break;case 2:n.name=t.value,t=e.next();break;case 5:n.handle=t.value,t=e.next();break;case 10:n.startPoint=rr(dt(e)),t=e.lastReadGroup;break;case 11:n.directionVector=rr(dt(e)),t=e.lastReadGroup;break;case 90:n.tableValue=t.value,t=e.next();break;case 91:n.rowCount=t.value,t=e.next();break;case 92:n.columnCount=t.value,t=e.next();break;case 93:n.overrideFlag=t.value,t=e.next();break;case 94:n.borderColorOverrideFlag=t.value,t=e.next();break;case 95:n.borderLineWeightOverrideFlag=t.value,t=e.next();break;case 96:n.borderVisibilityOverrideFlag=t.value,t=e.next();break;case 141:n.rowHeightArr??(n.rowHeightArr=[]),n.rowHeightArr.push(t.value),t=e.next();break;case 142:n.columnWidthArr??(n.columnWidthArr=[]),n.columnWidthArr.push(t.value),t=e.next();break;case 280:n.version=t.value,t=e.next();break;case 310:n.bmpPreview??(n.bmpPreview=""),n.bmpPreview+=t.value,t=e.next();break;case 330:n.ownerDictionaryId=t.value,t=e.next();break;case 342:n.tableStyleId=t.value,t=e.next();break;case 343:n.blockRecordHandle=t.value,t=e.next();break;case 170:n.attachmentPoint=t.value,t=e.next();break;case 171:n.cells??(n.cells=[]),n.cells.push(function(r,i){let a=!1,l=!1,c={};for(;!r.isEOF()&&i.code!==0&&!l;)switch(i.code){case 171:if(a){l=!0;continue}c.cellType=i.value,a=!0,i=r.next();break;case 172:c.flagValue=i.value,i=r.next();break;case 173:c.mergedValue=i.value,i=r.next();break;case 174:c.autoFit=i.value,i=r.next();break;case 175:c.borderWidth=i.value,i=r.next();break;case 176:c.borderHeight=i.value,i=r.next();break;case 91:c.overrideFlag=i.value,i=r.next();break;case 178:c.virtualEdgeFlag=i.value,i=r.next();break;case 145:c.rotation=i.value,i=r.next();break;case 345:c.fieldObjetId=i.value,i=r.next();break;case 340:c.blockTableRecordId=i.value,i=r.next();break;case 146:c.blockScale=i.value,i=r.next();break;case 177:c.blockAttrNum=i.value,i=r.next();break;case 7:c.textStyle=i.value,i=r.next();break;case 140:c.textHeight=i.value,i=r.next();break;case 170:c.attachmentPoint=i.value,i=r.next();break;case 92:c.extendedCellFlags=i.value,i=r.next();break;case 285:c.rightBorderVisibility=!!(i.value??!0),i=r.next();break;case 286:c.bottomBorderVisibility=!!(i.value??!0),i=r.next();break;case 288:c.leftBorderVisibility=!!(i.value??!0),i=r.next();break;case 289:c.topBorderVisibility=!!(i.value??!0),i=r.next();break;case 301:(function(u,p,g){for(;g.code!==304;)switch(g.code){case 301:case 93:case 90:case 94:g=p.next();break;case 1:u.text=g.value,g=p.next();break;case 300:u.attrText=g.value,g=p.next();break;case 302:u.text=g.value?g.value:u.text,g=p.next();break;default:console.log(`Ignore code: ${g.code}, value: ${g.value}`),g=p.next()}})(c,r,i),i=r.next();break;default:return c}return a=!1,l=!1,c}(e,t)),t=e.lastReadGroup;break;default:uh(n,t,e),t=e.next()}}return n}};function Jg(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}Ol="ACAD_TABLE",(Ll="ForEntityName")in No?Object.defineProperty(No,Ll,{value:Ol,enumerable:!0,configurable:!0,writable:!0}):No[Ll]=Ol;let Iv=[{code:11,name:"xAxisDirection",parser:re},{code:210,name:"extrusionDirection",parser:re},{code:1,name:"text",parser:M},{code:10,name:"position",parser:re},{code:3,name:"styleName",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],em=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){Jg(this,"parser",Ye(Iv))}};Jg(em,"ForEntityName","TOLERANCE");let Ro=class{parseEntity(e,t){let n={};for(;t!=="EOF";){if(t.code===0){e.rewind();break}!function(r,i,a){if(a==="EOF")return!1;switch(a.code){case 0:return!1;case 8:r.layer=a.value;break;case 100:r.subclassMarker=a.value;break;case 10:r.viewportCenter=rr(dt(i));break;case 40:r.width=a.value;break;case 41:r.height=a.value;break;case 68:r.status=a.value;break;case 69:r.viewportId=a.value;break;case 12:r.displayCenter=dt(i);break;case 13:r.snapBase=dt(i);break;case 14:r.snapSpacing=dt(i);break;case 15:r.gridSpacing=dt(i);break;case 16:r.viewDirection=rr(dt(i));break;case 17:r.targetPoint=rr(dt(i));break;case 42:r.perspectiveLensLength=a.value;break;case 43:r.frontClipZ=a.value;break;case 44:r.backClipZ=a.value;break;case 45:r.viewHeight=a.value;break;case 50:r.snapAngle=a.value;break;case 51:r.viewTwistAngle=a.value;break;case 72:r.circleZoomPercent=a.value;break;case 331:r.frozenLayerIds??(r.frozenLayerIds=[]),r.frozenLayerIds.push(a.value);break;case 90:r.statusBitFlags=a.value;break;case 340:r.clippingBoundaryId=a.value;break;case 1:r.sheetName=a.value;break;case 281:r.renderMode=a.value;break;case 71:r.ucsPerViewport=a.value;break;case 110:r.ucsOrigin=rr(dt(i));break;case 111:r.ucsXAxis=rr(dt(i));break;case 112:r.ucsYAxis=rr(dt(i));break;case 345:r.ucsId=a.value;break;case 346:r.ucsBaseId=a.value;break;case 79:r.orthographicType=a.value;break;case 146:r.elevation=a.value;break;case 170:r.shadePlotMode=a.value;break;case 61:r.majorGridFrequency=a.value;break;case 332:r.backgroundId=a.value;break;case 333:r.shadePlotId=a.value;break;case 348:r.visualStyleId=a.value;break;case 292:r.isDefaultLighting=!!a.value;break;case 282:r.defaultLightingType=a.value;break;case 141:r.brightness=a.value;break;case 142:r.contrast=a.value;break;case 63:case 421:case 431:r.ambientLightColor=a.value;break;case 361:r.sunId=a.value;break;case 335:case 343:case 344:case 91:r.softPointer=a.value}return!0}(n,e,t)&&uh(n,t,e),t=e.next()}return n}};Bl="VIEWPORT",(Dl="ForEntityName")in Ro?Object.defineProperty(Ro,Dl,{value:Bl,enumerable:!0,configurable:!0,writable:!0}):Ro[Dl]=Bl;(Xs={})[Xs.ShowImage=1]="ShowImage",Xs[Xs.ShowImageWhenNotAligned=2]="ShowImageWhenNotAligned",Xs[Xs.UseClippingBoundary=4]="UseClippingBoundary",Xs[Xs.Transparency=8]="Transparency";function tm(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let Cv={brightness:50,constrast:50,fade:0},kv=[{code:14,name:"boundary",isMultiple:!0,parser:re},{code:91,name:"numberOfVertices",parser:M},{code:71,name:"boundaryType",parser:M},{code:360,name:"imageDefReactorHardId",parser:M},{code:283,name:"fade",parser:M},{code:282,name:"contrast",parser:M},{code:281,name:"brightness",parser:M},{code:280,name:"isClipping",parser:ft},{code:70,name:"displayFlag",parser:M},{code:340,name:"imageDefHardId",parser:M},{code:13,name:"imageSize",parser:re},{code:12,name:"vDirection",parser:re},{code:11,name:"uDirection",parser:re},{code:10,name:"position",parser:re},{code:90,name:"classVersion",parser:M},{code:100,name:"subclassMarker",parser:M},...mt],nm=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){tm(this,"parser",Ye(kv,Cv))}};function sm(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}tm(nm,"ForEntityName","WIPEOUT");let Mv=[{code:11,name:"direction",parser:re},{code:10,name:"position",parser:re},{code:100,name:"subclassMarker",parser:M},...mt],rm=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){sm(this,"parser",Ye(Mv))}};function im(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}sm(rm,"ForEntityName","XLINE");let Pv={},Lv=[{code:170,name:"multileaderType",parser:M},{code:291,name:"doglegEnabled",parser:ft},{code:40,name:"doglegLength",parser:M},{code:172,name:"contentType",parser:M},{code:3,name:"textContent",parser:M},{code:12,name:"textAnchor",parser:re},{code:344,name:"blockHandle",parser:M},{code:15,name:"blockPosition",parser:re},{code:302,name:"leaderSections",parser:function(s,e,t){let n,r={leaderLines:[]};for(;e.hasNext()&&(n=e.next()).code!==303;)switch(n.code){case 10:r.landingPoint=(n.value,dt(e));break;case 11:r.doglegVector=(n.value,dt(e));break;case 40:r.doglegLength=n.value;break;case 304:r.leaderLines.push(function(i,a,l){let c,u={vertices:[]};for(;a.hasNext()&&(c=a.next()).code!==305;)c.code===10&&u.vertices.push((c.value,dt(a)));return u}(0,e))}return r},isMultiple:!0},...mt],am=class{parseEntity(e,t){let n={};return this.parser(t,e,n),n}constructor(){im(this,"parser",Ye(Lv,Pv))}};im(am,"ForEntityName","MULTILEADER");let Ov=Object.fromEntries([rg,hg,fg,mg,vg,Do,_g,wg,Ig,kg,Pg,Og,Bo,Bg,dg,am,Rg,Ug,Vg,$g,Hg,Yg,Zg,Qg,No,lg,em,Eg,dh,Ro,nm,rm].map(s=>[s.ForEntityName,new s]));function om(s,e){let t=[];for(;!Qe(s,0,"EOF");){if(s.code===0){if(s.value==="ENDBLK"||s.value==="ENDSEC"){e.rewind();break}let n=Ov[s.value];if(n){let r=s.value;s=e.next();let i=n.parseEntity(e,s);i.type=r,tg(i),t.push(i)}else e.debug&&console.warn(`Unsupported ENTITY type: ${s.value}`)}s=e.next()}return t}function Dv(s,e){let t={};for(;!Qe(s,0,"EOF")&&!Qe(s,0,"ENDSEC");){if(Qe(s,0,"BLOCK")){let n=Bv(s=e.next(),e);tg(n),n.name&&(t[n.name]=n)}s=e.next()}return t}function Bv(s,e){let t={};for(;!Qe(s,0,"EOF");){if(Qe(s,0,"ENDBLK")){for(s=e.next();!Qe(s,0,"EOF");){if(Qe(s,100,"AcDbBlockEnd"))return t;s=e.next()}break}switch(s.code){case 1:t.xrefPath=s.value;break;case 2:t.name=s.value;break;case 3:t.name2=s.value;break;case 5:t.handle=s.value;break;case 8:t.layer=s.value;break;case 10:t.position=dt(e);break;case 67:t.paperSpace=!!s.value&&s.value==1;break;case 70:s.value!==0&&(t.type=s.value);break;case 100:break;case 330:t.ownerHandle=s.value;break;case 0:t.entities=om(s,e)}s=e.next()}return t}function Nv(s,e){let t=null,n={};for(;!Qe(s,0,"EOF")&&!Qe(s,0,"ENDSEC");)s.code===9?t=s.value:s.code===10?n[t]=dt(e):n[t]=s.value,s=e.next();return n}(In={})[In.NOT_APPLICABLE=0]="NOT_APPLICABLE",In[In.KEEP_EXISTING=1]="KEEP_EXISTING",In[In.USE_CLONE=2]="USE_CLONE",In[In.XREF_VALUE_NAME=3]="XREF_VALUE_NAME",In[In.VALUE_NAME=4]="VALUE_NAME",In[In.UNMANGLE_NAME=5]="UNMANGLE_NAME";let ph=[{code:330,name:"ownerObjectId",parser:M},{code:102,parser:Lr},{code:102,parser:Lr},{code:102,parser:Lr},{code:5,name:"handle",parser:M}],Rv=[{code:3,name:"entries",parser:(s,e)=>{let t={name:s.value};return(s=e.next()).code===350?t.objectSoftId=s.value:s.code===360?t.objectHardId=s.value:e.rewind(),t},isMultiple:!0},{code:281,name:"recordCloneFlag",parser:M},{code:280,name:"isHardOwned",parser:ft},{code:100,name:"subclassMarker",parser:M},...ph],Fv=[{code:330,name:"imageDefReactorIdSoft",isMultiple:!0,parser:M},{code:90,name:"version",parser:M},{code:1,name:"fileName",parser:M},{code:10,name:"size",parser:re},{code:11,name:"sizeOfOnePixel",parser:re},{code:280,name:"isLoaded",parser:M},{code:281,name:"resolutionUnits",parser:M},{code:100,name:"subclassMarker",parser:M}];(li={})[li.NOUNIT=0]="NOUNIT",li[li.CENTIMETERS=2]="CENTIMETERS",li[li.INCH=5]="INCH";(po={})[po.PSLTSCALE=1]="PSLTSCALE",po[po.LIMCHECK=2]="LIMCHECK";(ci={})[ci.INCHES=0]="INCHES",ci[ci.MILLIMETERS=1]="MILLIMETERS",ci[ci.PIXELS=2]="PIXELS";(Cn={})[Cn.LAST_SCREEN_DISPLAY=0]="LAST_SCREEN_DISPLAY",Cn[Cn.DRAWING_EXTENTS=1]="DRAWING_EXTENTS",Cn[Cn.DRAWING_LIMITS=2]="DRAWING_LIMITS",Cn[Cn.VIEW_SPECIFIED=3]="VIEW_SPECIFIED",Cn[Cn.WINDOW_SPECIFIED=4]="WINDOW_SPECIFIED",Cn[Cn.LAYOUT_INFORMATION=5]="LAYOUT_INFORMATION";(Zs={})[Zs.AS_DISPLAYED=0]="AS_DISPLAYED",Zs[Zs.WIREFRAME=1]="WIREFRAME",Zs[Zs.HIDDEN=2]="HIDDEN",Zs[Zs.RENDERED=3]="RENDERED";(kn={})[kn.DRAFT=0]="DRAFT",kn[kn.PREVIEW=1]="PREVIEW",kn[kn.NORMAL=2]="NORMAL",kn[kn.PRESENTATION=3]="PRESENTATION",kn[kn.MAXIMUM=4]="MAXIMUM",kn[kn.CUSTOM=5]="CUSTOM";let lm=[{code:333,name:"shadePlotId",parser:M},{code:149,name:"imageOriginY",parser:M},{code:148,name:"imageOriginX",parser:M},{code:147,name:"scaleFactor",parser:M},{code:78,name:"shadePlotCustomDPI",parser:M},{code:77,name:"shadePlotResolution",parser:M},{code:76,name:"shadePlotMode",parser:M},{code:75,name:"standardScaleType",parser:M},{code:7,name:"currentStyleSheet",parser:M},{code:74,name:"plotType",parser:M},{code:73,name:"plotRotation",parser:M},{code:72,name:"plotPaperUnit",parser:M},{code:70,name:"layoutFlag",parser:M},{code:143,name:"printScaleDenominator",parser:M},{code:142,name:"printScaleNumerator",parser:M},{code:141,name:"windowAreaYMax",parser:M},{code:140,name:"windowAreaXMax",parser:M},{code:49,name:"windowAreaYMin",parser:M},{code:48,name:"windowAreaXMin",parser:M},{code:47,name:"plotOriginY",parser:M},{code:46,name:"plotOriginX",parser:M},{code:45,name:"paperHeight",parser:M},{code:44,name:"paperWidth",parser:M},{code:43,name:"marginTop",parser:M},{code:42,name:"marginRight",parser:M},{code:41,name:"marginBottom",parser:M},{code:40,name:"marginLeft",parser:M},{code:6,name:"plotViewName",parser:M},{code:4,name:"paperSize",parser:M},{code:2,name:"configName",parser:M},{code:1,name:"pageSetupName",parser:M},{code:100,name:"subclassMarker",parser:M},...ph],zv=[{code:346,name:"orthographicUcsId",parser:M},{code:345,name:"namedUcsId",parser:M},{code:331,name:"viewportId",parser:M},{code:330,name:"paperSpaceTableId",parser:M},{code:76,name:"orthographicType",parser:M},{code:17,name:"ucsYAxis",parser:re},{code:16,name:"ucsXAxis",parser:re},{code:13,name:"ucsOrigin",parser:re},{code:146,name:"elevation",parser:M},{code:15,name:"maxExtent",parser:re},{code:14,name:"minExtent",parser:re},{code:12,name:"insertionPoint",parser:re},{code:11,name:"maxLimit",parser:re},{code:10,name:"minLimit",parser:re},{code:71,name:"tabOrder",parser:M},{code:70,name:"controlFlag",parser:M},{code:1,name:"layoutName",parser:M},{code:100,name:"subclassMarker",parser:M},...lm],Uv=[{code:40,name:"wcsToOCSTransform",parser:_u},{code:40,name:"ocsToWCSTransform",parser:_u},{code:41,name:"backClippingDistance",parser:M},{code:73,name:"isBackClipping",parser:ft,pushContext:!0},{code:40,name:"frontClippingDistance",parser:M},{code:72,name:"isFrontClipping",parser:ft,pushContext:!0},{code:71,name:"isClipBoundaryDisplayed",parser:ft},{code:11,name:"position",parser:re},{code:210,name:"normal",parser:re},{code:10,name:"boundaryVertices",parser:re,isMultiple:!0},{code:70,name:"boundaryCount",parser:M},{code:100,name:"subclassMarker",parser:M},{code:100},...ph];function _u(s,e){let t=[];for(let n=0;n<3&&Qe(s,40);++n){let r=[];for(let i=0;i<4&&Qe(s,40);++i)r.push(s.value),s=e.next();t.push(r)}return e.rewind(),t}let Gv={LAYOUT:zv,PLOTSETTINGS:lm,DICTIONARY:Rv,SPATIAL_FILTER:Uv,IMAGEDEF:Fv};function Vv(s,e){let t=[];for(;s.code!==0||!["EOF","ENDSEC"].includes(s.value);){let n=s.value,r=Gv[n];if(s.code===0&&r!=null&&r.length){let i=Ye(r),a={name:n};i(s=e.next(),e,a)?(t.push(a),s=e.peek()):s=e.next()}else s=e.next()}return{byName:Ly(t,({name:n})=>n)}}let Oi=[{code:100,name:"subclassMarker",parser:M},{code:330,name:"ownerObjectId",parser:M},{code:102,parser(s,e){for(;!Qe(s,0,"EOF")&&!Qe(s,102,"}");)s=e.next()}},{code:5,name:"handle",parser:M}],jv=Ye([{code:310,name:"bmpPreview",parser:M},{code:281,name:"scalability",parser:M},{code:280,name:"explodability",parser:M},{code:70,name:"insertionUnits",parser:M},{code:340,name:"layoutObjects",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},...Oi]),$v=[{name:"DIMPOST",code:3},{name:"DIMAPOST",code:4},{name:"DIMBLK_OBSOLETE",code:5},{name:"DIMBLK1_OBSOLETE",code:6},{name:"DIMBLK2_OBSOLETE",code:7},{name:"DIMSCALE",code:40,defaultValue:1},{name:"DIMASZ",code:41,defaultValue:.25},{name:"DIMEXO",code:42,defaultValue:.625,defaultValueImperial:.0625},{name:"DIMDLI",code:43,defaultValue:3.75,defaultValueImperial:.38},{name:"DIMEXE",code:44,defaultValue:2.25,defaultValueImperial:.28},{name:"DIMRND",code:45,defaultValue:0},{name:"DIMDLE",code:46,defaultValue:0},{name:"DIMTP",code:47,defaultValue:0},{name:"DIMTM",code:48,defaultValue:0},{name:"DIMTXT",code:140,defaultValue:2.5,defaultValueImperial:.28},{name:"DIMCEN",code:141,defaultValue:2.5,defaultValueImperial:.09},{name:"DIMTSZ",code:142,defaultValue:0},{name:"DIMALTF",code:143,defaultValue:25.4},{name:"DIMLFAC",code:144,defaultValue:1},{name:"DIMTVP",code:145,defaultValue:0},{name:"DIMTFAC",code:146,defaultValue:1},{name:"DIMGAP",code:147,defaultValue:.625,defaultValueImperial:.09},{name:"DIMALTRND",code:148,defaultValue:0},{name:"DIMTOL",code:71,defaultValue:0,defaultValueImperial:1},{name:"DIMLIM",code:72,defaultValue:0},{name:"DIMTIH",code:73,defaultValue:0,defaultValueImperial:1},{name:"DIMTOH",code:74,defaultValue:0,defaultValueImperial:1},{name:"DIMSE1",code:75,defaultValue:0},{name:"DIMSE2",code:76,defaultValue:0},{name:"DIMTAD",code:77,defaultValue:vu.Above,defaultValueImperial:vu.Center},{name:"DIMZIN",code:78,defaultValue:hi.Trailing,defaultValueImperial:hi.Feet},{name:"DIMAZIN",code:79,defaultValue:vy.None},{name:"DIMALT",code:170,defaultValue:0},{name:"DIMALTD",code:171,defaultValue:3,defaultValueImperial:2},{name:"DIMTOFL",code:172,defaultValue:1,defaultValueImperial:0},{name:"DIMSAH",code:173,defaultValue:0},{name:"DIMTIX",code:174,defaultValue:0},{name:"DIMSOXD",code:175,defaultValue:0},{name:"DIMCLRD",code:176,defaultValue:0},{name:"DIMCLRE",code:177,defaultValue:0},{name:"DIMCLRT",code:178,defaultValue:0},{name:"DIMADEC",code:179},{name:"DIMUNIT",code:270},{name:"DIMDEC",code:271,defaultValue:2,defaultValueImperial:4},{name:"DIMTDEC",code:272,defaultValue:2,defaultValueImperial:4},{name:"DIMALTU",code:273,defaultValue:2},{name:"DIMALTTD",code:274,defaultValue:2,defaultValueImperial:4},{name:"DIMAUNIT",code:275,defaultValue:0},{name:"DIMFRAC",code:276,defaultValue:0},{name:"DIMLUNIT",code:277,defaultValue:2},{name:"DIMDSEP",code:278,defaultValue:",",defaultValueImperial:"."},{name:"DIMJUST",code:280,defaultValue:by.Center},{name:"DIMSD1",code:281,defaultValue:0},{name:"DIMSD2",code:282,defaultValue:0},{name:"DIMTOLJ",code:283,defaultValue:_y.Center},{name:"DIMTZIN",code:284,defaultValue:hi.Trailing,defaultValueImperial:hi.Feet},{name:"DIMALTZ",code:285,defaultValue:hi.Trailing},{name:"DIMALTTZ",code:286,defaultValue:hi.Trailing},{name:"DIMFIT",code:287},{name:"DIMUPT",code:288,defaultValue:0},{name:"DIMATFIT",code:289,defaultValue:3},{name:"DIMTXSTY",code:340},{name:"DIMLDRBLK",code:341},{name:"DIMBLK",code:342},{name:"DIMBLK1",code:343},{name:"DIMBLK2",code:344},{name:"DIMLWD",code:371,defaultValue:-2},{name:"DIMLWD",code:372,defaultValue:-2}],Wv=Ye([...$v.map(s=>({...s,parser:M})),{code:70,name:"standardFlag",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},{code:105,name:"handle",parser:M},...Oi.filter(s=>s.code!==5)]),Hv=Ye([{code:347,name:"materialObjectId",parser:M},{code:390,name:"plotStyleNameObjectId",parser:M},{code:370,name:"lineweight",parser:M},{code:290,name:"isPlotting",parser:ft},{code:6,name:"lineType",parser:M},{code:62,name:"colorIndex",parser:M},{code:70,name:"standardFlag",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},...Oi]);(Ks={})[Ks.NONE=0]="NONE",Ks[Ks.AbsoluteRotation=1]="AbsoluteRotation",Ks[Ks.TextEmbedded=2]="TextEmbedded",Ks[Ks.ShapeEmbedded=4]="ShapeEmbedded";let qv=Ye([{code:9,name:"text",parser:M},{code:45,name:"offsetY",parser:M},{code:44,name:"offsetX",parser:M},{code:50,name:"rotation",parser:M},{code:46,name:"scale",parser:M},{code:340,name:"styleObjectId",parser:M},{code:75,name:"shapeNumber",parser:M},{code:74,name:"elementTypeFlag",parser:M},{code:49,name:"elementLength",parser:M}],{elementTypeFlag:0,elementLength:0}),Yv=Ye([{code:49,name:"pattern",parser(s,e){let t={};return qv(s,e,t),t},isMultiple:!0},{code:40,name:"totalPatternLength",parser:M},{code:73,name:"numberOfLineTypes",parser:M},{code:72,parser:M},{code:3,name:"description",parser:M},{code:70,name:"standardFlag",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},...Oi]),Xv=Ye([{code:1e3,name:"extendedFont",parser:M},{code:1001},{code:4,name:"bigFont",parser:M},{code:3,name:"font",parser:M},{code:42,name:"lastHeight",parser:M},{code:71,name:"textGenerationFlag",parser:M},{code:50,name:"obliqueAngle",parser:M},{code:41,name:"widthFactor",parser:M},{code:40,name:"fixedTextHeight",parser:M},{code:70,name:"standardFlag",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},...Oi]),Zv=Ye([{code:[63,421,431],name:"ambientColor",parser:M},{code:142,name:"contrast",parser:M},{code:141,name:"brightness",parser:M},{code:282,name:"defaultLightingType",parser:M},{code:292,name:"isDefaultLightingOn",parser:ft},{code:348,name:"visualStyleObjectId",parser:M},{code:333,name:"shadePlotObjectId",parser:M},{code:332,name:"backgroundObjectId",parser:M},{code:61,name:"majorGridLines",parser:M},{code:170,name:"shadePlotSetting",parser:M},{code:146,name:"elevation",parser:M},{code:79,name:"orthographicType",parser:M},{code:112,name:"ucsYAxis",parser:re},{code:111,name:"ucsXAxis",parser:re},{code:110,name:"ucsOrigin",parser:re},{code:74,name:"ucsIconSetting",parser:M},{code:71,name:"viewMode",parser:M},{code:281,name:"renderMode",parser:M},{code:1,name:"styleSheet",parser:M},{code:[331,441],name:"frozenLayers",parser:M,isMultiple:!0},{code:72,name:"circleSides",parser:M},{code:51,name:"viewTwistAngle",parser:M},{code:50,name:"snapRotationAngle",parser:M},{code:45,name:"viewHeight",parser:M},{code:44,name:"backClippingPlane",parser:M},{code:43,name:"frontClippingPlane",parser:M},{code:42,name:"lensLength",parser:M},{code:17,name:"viewTarget",parser:re},{code:16,name:"viewDirectionFromTarget",parser:re},{code:15,name:"gridSpacing",parser:re},{code:14,name:"snapSpacing",parser:re},{code:13,name:"snapBasePoint",parser:re},{code:12,name:"center",parser:re},{code:11,name:"upperRightCorner",parser:re},{code:10,name:"lowerLeftCorner",parser:re},{code:70,name:"standardFlag",parser:M},{code:2,name:"name",parser:M},{code:100,name:"subclassMarker",parser:M},...Oi]),Kv={BLOCK_RECORD:jv,DIMSTYLE:Wv,LAYER:Hv,LTYPE:Yv,STYLE:Xv,VPORT:Zv},Qv=Ye([{code:70,name:"maxNumberOfEntries",parser:M},{code:100,name:"subclassMarker",parser:M},{code:330,name:"ownerObjectId",parser:M},{code:102},{code:360,isMultiple:!0},{code:102},{code:5,name:"handle",parser:M},{code:2,name:"name",parser:M}]);function Jv(s,e){var t;let n={};for(;!Qe(s,0,"EOF")&&!Qe(s,0,"ENDSEC");){if(Qe(s,0,"TABLE")){s=e.next();let r={entries:[]};Qv(s,e,r),n[r.name]=r}if(Qe(s,0)&&!Qe(s,0,"ENDTAB")){let r=s.value;s=e.next();let i=Kv[r];if(!i){e.debug&&console.warn(`parseTable: Invalid table name '${r}'`),s=e.next();continue}let a={};i(s,e,a),(t=n[r])==null||t.entries.push(a)}s=e.next()}return n}function Ji(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}class xu{next(){if(!this.hasNext())return this._eof?this.debug&&console.warn("Cannot call 'next' after EOF group has been read"):this.debug&&console.warn("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]),{code:0,value:"EOF"};let e=parseInt(this._data[this._pointer++],10),t=wu(e,this._data[this._pointer++],this.debug),n={code:e,value:t};return Qe(n,0,"EOF")&&(this._eof=!0),this.lastReadGroup=n,n}peek(){if(!this.hasNext())throw this._eof?Error("Cannot call 'next' after EOF group has been read"):Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);let e={code:parseInt(this._data[this._pointer]),value:0};return e.value=wu(e.code,this._data[this._pointer+1],this.debug),e}rewind(e){e=e||1,this._pointer=this._pointer-2*e}hasNext(){return!this._eof&&!(this._pointer>this._data.length-2)}isEOF(){return this._eof}constructor(e,t=!1){Ji(this,"_data",void 0),Ji(this,"debug",void 0),Ji(this,"_pointer",void 0),Ji(this,"_eof",void 0),Ji(this,"lastReadGroup",void 0),this._data=e,this.debug=t,this.lastReadGroup={code:0,value:0},this._pointer=0,this._eof=!1}}function wu(s,e,t=!1){return s<=9?e:s>=10&&s<=59?parseFloat(e.trim()):s>=60&&s<=99?parseInt(e.trim()):s>=100&&s<=109?e:s>=110&&s<=149?parseFloat(e.trim()):s>=160&&s<=179?parseInt(e.trim()):s>=210&&s<=239?parseFloat(e.trim()):s>=270&&s<=289?parseInt(e.trim()):s>=290&&s<=299?function(n){if(n==="0")return!1;if(n==="1")return!0;throw TypeError("String '"+n+"' cannot be cast to Boolean type")}(e.trim()):s>=300&&s<=369?e:s>=370&&s<=389?parseInt(e.trim()):s>=390&&s<=399?e:s>=400&&s<=409?parseInt(e.trim()):s>=410&&s<=419?e:s>=420&&s<=429?parseInt(e.trim()):s>=430&&s<=439?e:s>=440&&s<=459?parseInt(e.trim()):s>=460&&s<=469?parseFloat(e.trim()):s>=470&&s<=481||s===999||s>=1e3&&s<=1009?e:s>=1010&&s<=1059?parseFloat(e.trim()):s>=1060&&s<=1071?parseInt(e.trim()):(t&&console.warn("WARNING: Group code does not have a defined type: %j",{code:s,value:e}),e)}function xc(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}let eb=class{constructor(){xc(this,"encoding","utf-8"),xc(this,"encodingFailureFatal",!1)}},tb=class extends EventTarget{parseSync(e,t=!1){let n=new xu(e.split(/\r\n|\r|\n/g),t);if(!n.hasNext())throw Error("Empty file");return this.parseAll(n)}parseStream(e){let t="",n=this;return new Promise((r,i)=>{e.on("data",a=>{t+=a}),e.on("end",()=>{try{let a=t.split(/\r\n|\r|\n/g),l=new xu(a);if(!l.hasNext())throw Error("Empty file");r(n.parseAll(l))}catch(a){i(a)}}),e.on("error",a=>{i(a)})})}async parseFromUrl(e,t){let n=await fetch(e,t);if(!n.body)return null;let r=n.body.getReader(),i="";for(;;){let{done:a,value:l}=await r.read();if(a){i+=this._decoder.decode(new ArrayBuffer(0),{stream:!1});break}i+=this._decoder.decode(l,{stream:!0})}return this.parseSync(i)}parseAll(e){let t={header:{},blocks:{},entities:[],tables:{},objects:{byName:{},byTree:void 0}},n=e.next();for(;!Qe(n,0,"EOF");)Qe(n,0,"SECTION")&&(Qe(n=e.next(),2,"HEADER")?(n=e.next(),t.header=Nv(n,e)):Qe(n,2,"BLOCKS")?(n=e.next(),t.blocks=Dv(n,e)):Qe(n,2,"ENTITIES")?(n=e.next(),t.entities=om(n,e)):Qe(n,2,"TABLES")?(n=e.next(),t.tables=Jv(n,e)):Qe(n,2,"OBJECTS")&&(n=e.next(),t.objects=Vv(n,e))),n=e.next();return t}constructor(e=new eb){super(),xc(this,"_decoder",void 0),this._decoder=new TextDecoder(e.encoding,{fatal:e.encodingFailureFatal})}};const Su=[{name:"AC1.2",value:1},{name:"AC1.40",value:2},{name:"AC1.50",value:3},{name:"AC2.20",value:4},{name:"AC2.10",value:5},{name:"AC2.21",value:6},{name:"AC2.22",value:7},{name:"AC1001",value:8},{name:"AC1002",value:9},{name:"AC1003",value:10},{name:"AC1004",value:11},{name:"AC1005",value:12},{name:"AC1006",value:13},{name:"AC1007",value:14},{name:"AC1008",value:15},{name:"AC1009",value:16},{name:"AC1010",value:17},{name:"AC1011",value:18},{name:"AC1012",value:19},{name:"AC1013",value:20},{name:"AC1014",value:21},{name:"AC1500",value:22},{name:"AC1015",value:23},{name:"AC1800a",value:24},{name:"AC1018",value:25},{name:"AC2100a",value:26},{name:"AC1021",value:27},{name:"AC2400a",value:28},{name:"AC1024",value:29},{name:"AC1027",value:31},{name:"AC3200a",value:32},{name:"AC1032",value:33}];let wc=class{constructor(e){if(typeof e=="string"){const t=Su.find(n=>n.name===e);if(!t)throw new Error(`Unknown DWG version name: ${e}`);this.name=t.name,this.value=t.value;return}if(typeof e=="number"){const t=Su.find(n=>n.value===e);if(!t)throw new Error(`Unknown DWG version value: ${e}`);this.name=t.name,this.value=t.value;return}throw new Error("Invalid constructor argument for AcDbDwgVersion")}},nb=class{parse(e){const t=new tb,n=this.getDxfInfoFromBuffer(e);let r="";return n.version&&n.version.value<=23&&n.encoding?r=new TextDecoder(n.encoding).decode(e):r=new TextDecoder().decode(e),t.parseSync(r)}getDxfInfoFromBuffer(e){var t,n,r;const i=new TextDecoder("utf-8");let a=0,l="",c=null,u=null,p=!1;for(;a<e.byteLength;){const g=Math.min(a+65536,e.byteLength),m=e.slice(a,g);a=g;const y=(l+i.decode(m,{stream:!0})).split(/\r?\n/);l=y.pop()??"";for(let A=0;A<y.length;A++){const w=y[A].trim();if(w==="SECTION"&&((t=y[A+2])==null?void 0:t.trim())==="HEADER")p=!0;else if(w==="ENDSEC"&&p)return{version:c,encoding:u};if(p&&w==="$ACADVER"){const C=(n=y[A+2])==null?void 0:n.trim();C&&(c=new wc(C))}else if(p&&w==="$DWGCODEPAGE"){const C=(r=y[A+2])==null?void 0:r.trim();if(C){const E=vp[C];u=C1(E)}}if(c&&u)return{version:c,encoding:u}}}return{version:c,encoding:u}}},Au=class{convert(e){const t=this.createEntity(e);return t&&this.processCommonAttrs(e,t),t}createEntity(e){return e.type=="3DFACE"?this.convertFace(e):e.type=="ARC"?this.convertArc(e):e.type=="CIRCLE"?this.convertCirle(e):e.type=="DIMENSION"?this.convertDimension(e):e.type=="ELLIPSE"?this.convertEllipse(e):e.type=="HATCH"?this.convertHatch(e):e.type=="IMAGE"?this.convertImage(e):e.type=="LEADER"?this.convertLeader(e):e.type=="LINE"?this.convertLine(e):e.type=="LWPOLYLINE"?this.convertLWPolyline(e):e.type=="MTEXT"?this.convertMText(e):e.type=="POLYLINE"?this.convertPolyline(e):e.type=="POINT"?this.convertPoint(e):e.type=="RAY"?this.convertRay(e):e.type=="SPLINE"?this.convertSpline(e):e.type=="ACAD_TABLE"?this.convertTable(e):e.type=="TEXT"?this.convertText(e):e.type=="SOLID"?this.convertSolid(e):e.type=="VIEWPORT"?this.convertViewport(e):e.type=="WIPEOUT"?this.convertWipeout(e):e.type=="XLINE"?this.convertXline(e):e.type=="INSERT"?this.convertBlockReference(e):null}convertFace(e){const t=new uf;return e.vertices.forEach((n,r)=>t.setVertexAt(r,n)),t}convertArc(e){return new rf(e.center,e.radius,st.degToRad(e.startAngle),st.degToRad(e.endAngle),e.extrusionDirection??oe.Z_AXIS)}convertCirle(e){return new el(e.center,e.radius,e.extrusionDirection??oe.Z_AXIS)}convertEllipse(e){const t=new oe(e.majorAxisEndPoint),n=t.length();return new cf(e.center,e.extrusionDirection??oe.Z_AXIS,t,n,n*e.axisRatio,e.startAngle,e.endAngle)}convertLine(e){const t=e.startPoint,n=e.endPoint;return new sh(new te(t.x,t.y,t.z||0),new te(n.x,n.y,n.z||0))}convertSpline(e){try{if(e.numberOfControlPoints>0&&e.numberOfKnots>0)return new jo(e.controlPoints,e.knots,e.weights,e.degree,!!(e.flag&1));if(e.numberOfFitPoints>0){const t=this.numberArrayToPointArray(e.fitPoints,e.numberOfFitPoints);if(t!=null)return new jo(t,"Uniform",e.degree,!!(e.flag&1))}}catch(t){console.log(`Failed to convert spline with error: ${t}`)}return null}convertPoint(e){const t=new Of;return t.position=e.position,t}convertSolid(e){const t=new kf;return e.points.forEach((n,r)=>t.setPointAt(r,n)),t.thickness=e.thickness,t}convertPolyline(e){const t=!!(e.flag&1),n=!!(e.flag&8),r=[],i=[];if(e.vertices.map(a=>{a.flag&pv.SPLINE_CONTROL_POINT||(r.push({x:a.x,y:a.y,z:a.z}),i.push(a.bulge??0))}),n){let a=Pr.SimplePoly;return e.flag&4&&(e.smoothType==go.CUBIC?a=Pr.CubicSplinePoly:e.smoothType==go.QUADRATIC&&(a=Pr.QuadSplinePoly)),new nf(a,r,t)}else{let a=Cs.SimplePoly;return e.flag&2?a=Cs.FitCurvePoly:e.flag&4&&(e.smoothType==go.CUBIC?a=Cs.CubicSplinePoly:e.smoothType==go.QUADRATIC&&(a=Cs.QuadSplinePoly)),new ef(a,r,0,t,e.startWidth,e.endWidth,i)}}convertLWPolyline(e){const t=new Pf;return t.closed=!!(e.flag&1),e.vertices.forEach((n,r)=>{t.addVertexAt(r,new je(n.x,n.y),n.bulge,n.startWidth,n.endWidth)}),t}convertHatch(e){var t;const n=new nh;return(t=e.definitionLines)==null||t.forEach(r=>{n.definitionLines.push({angle:r.angle,origin:r.base,delta:r.offset,dashPattern:r.numberOfDashLengths>0?r.dashLengths:[]})}),n.hatchStyle=e.hatchStyle,n.patternName=e.patternName,n.patternType=e.patternType,n.patternAngle=e.patternAngle==null?0:e.patternAngle,n.patternScale=e.patternScale==null?0:e.patternScale,e.boundaryPaths.forEach(r=>{if(r.boundaryPathTypeFlag&2){const i=r,a=new Gr;a.closed=i.isClosed,i.vertices.forEach((l,c)=>{a.addVertexAt(c,{x:l.x,y:l.y,bulge:l.bulge})}),n.add(a)}else{const i=r,a=new eh;i.edges.forEach(l=>{if(l.type==1){const c=l;a.add(new ga(c.start,c.end))}else if(l.type==2){const c=l;a.add(new Vo(c.center,c.radius,st.degToRad(c.startAngle||0),st.degToRad(c.endAngle||0),!c.isCCW))}else if(l.type==3){const c=l;new xt().subVectors(c.end,c.center);const u=Math.sqrt(Math.pow(c.end.x,2)+Math.pow(c.end.y,2)),p=u*c.lengthOfMinorAxis;let g=st.degToRad(c.startAngle||0),m=st.degToRad(c.endAngle||0);const y=Math.atan2(c.end.y,c.end.x);c.isCCW||(g=Math.PI*2-g,m=Math.PI*2-m),a.add(new $p({...c.center,z:0},u,p,g,m,!c.isCCW,y))}else if(l.type==4){const c=l;if(c.numberOfControlPoints>0&&c.numberOfKnots>0){const u=c.controlPoints.map(m=>({x:m.x,y:m.y,z:0}));let p=!0;const g=c.controlPoints.map(m=>(m.weight==null&&(p=!1),m.weight||1));a.add(new Rr(u,c.knots,p?g:void 0))}else if(c.numberOfFitData>0){const u=c.fitDatum.map(p=>({x:p.x,y:p.y,z:0}));a.add(new Rr(u,"Uniform"))}}}),n.add(a)}}),n}convertTable(e){const t=new Ef(e.name,e.rowCount,e.columnCount);return t.attachmentPoint=e.attachmentPoint,t.position.copy(e.startPoint),e.columnWidthArr.forEach((n,r)=>t.setColumnWidth(r,n)),e.rowHeightArr.forEach((n,r)=>t.setRowHeight(r,n)),e.cells.forEach((n,r)=>{t.setCell(r,n)}),t}convertText(e){const t=new If;return t.textString=e.text,t.styleName=e.styleName,t.height=e.textHeight,t.position.copy(e.startPoint),t.rotation=st.degToRad(e.rotation||0),t.oblique=e.obliqueAngle??0,t.thickness=e.thickness,t.horizontalMode=e.halign,t.verticalMode=e.valign,t.widthFactor=e.xScale??1,t}convertMText(e){const t=new wf;return t.contents=e.text,e.styleName!=null&&(t.styleName=e.styleName),t.height=e.height,t.width=e.width,t.rotation=st.degToRad(e.rotation||0),t.location=e.insertionPoint,t.attachmentPoint=e.attachmentPoint,e.direction&&(t.direction=new oe(e.direction)),t.drawingDirection=e.drawingDirection,t}convertLeader(e){const t=new ff;return e.vertices.forEach(n=>{t.appendVertex(n)}),t.hasArrowHead=e.isArrowheadEnabled,t.hasHookLine=e.isHooklineExists,t.isSplined=e.isSpline,t.dimensionStyle=e.styleName,t.annoType=e.leaderCreationFlag,t}convertDimension(e){if(e.subclassMarker=="AcDbAlignedDimension"||e.subclassMarker=="AcDbRotatedDimension"){const t=e,n=new oh(t.subDefinitionPoint1,t.subDefinitionPoint2,t.definitionPoint);return t.insertionPoint&&(n.dimBlockPosition={...t.insertionPoint,z:0}),n.rotation=st.degToRad(t.rotationAngle||0),this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDb3PointAngularDimension"){const t=e,n=new Vf(t.centerPoint,t.subDefinitionPoint1,t.subDefinitionPoint2,t.definitionPoint);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbOrdinateDimension"){const t=e,n=new qf(t.subDefinitionPoint1,t.subDefinitionPoint2);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbRadialDimension"){const t=e,n=new Xf(t.definitionPoint,t.centerPoint,t.leaderLength);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbDiametricDimension"){const t=e,n=new Wf(t.definitionPoint,t.centerPoint,t.leaderLength);return this.processDimensionCommonAttrs(e,n),n}return null}processImage(e,t){t.position.copy(e.position),t.brightness=e.brightness,t.contrast=e.contrast,t.fade=e.fade,t.isShownClipped=(e.flags|4)>0,t.isImageShown=(e.flags|3)>0,t.isImageTransparent=(e.flags|8)>0,t.imageDefId=e.imageDefHandle,t.isClipped=e.isClipped,e.clippingBoundaryPath.forEach(n=>{t.clipBoundary.push(new je(n))}),t.width=Math.sqrt(e.uPixel.x**2+e.uPixel.y**2+e.uPixel.z**2)*e.imageSize.x,t.height=Math.sqrt(e.vPixel.x**2+e.vPixel.y**2+e.vPixel.z**2)*e.imageSize.y,t.rotation=Math.atan2(e.uPixel.y,e.uPixel.x)}convertImage(e){const t=new tl;return this.processImage(e,t),t.clipBoundaryType=e.clippingBoundaryType,t}processWipeout(e,t){t.position.copy(e.position),t.brightness=e.brightness,t.contrast=e.contrast,t.fade=e.fade,t.isShownClipped=(e.displayFlag|4)>0,t.isImageShown=(e.displayFlag|3)>0,t.isImageTransparent=(e.displayFlag|8)>0,t.imageDefId=e.imageDefHardId,t.isClipped=e.isClipping,e.boundary.forEach(n=>{t.clipBoundary.push(new je(n))}),t.clipBoundaryType=e.boundaryType,t.width=Math.sqrt(e.uDirection.x**2+e.uDirection.y**2+e.uDirection.z**2)*e.imageSize.x,t.height=Math.sqrt(e.vDirection.x**2+e.vDirection.y**2+e.vDirection.z**2)*e.imageSize.y,t.rotation=Math.atan2(e.uDirection.y,e.uDirection.x)}convertWipeout(e){const t=new Ff;return this.processWipeout(e,t),t}convertViewport(e){const t=new ih;return t.number=e.viewportId,t.centerPoint.copy(e.viewportCenter),t.height=e.height,t.width=e.width,t.viewCenter.copy(e.displayCenter),t.viewHeight=e.viewHeight,t}convertRay(e){const t=new rh;return t.basePoint.copy(e.position),t.unitDir.copy(e.direction),t}convertXline(e){const t=new ah;return t.basePoint.copy(e.position),t.unitDir.copy(e.direction),t}convertBlockReference(e){const t=new th(e.name);return e.insertionPoint&&t.position.copy(e.insertionPoint),t.scaleFactors.x=e.xScale||1,t.scaleFactors.y=e.yScale||1,t.scaleFactors.z=e.zScale||1,t.rotation=e.rotation!=null?st.degToRad(e.rotation):0,t.normal.copy(e.extrusionDirection??{x:0,y:0,z:1}),t}processDimensionCommonAttrs(e,t){t.dimBlockId=e.name,t.textPosition.copy(e.textPoint),t.textRotation=e.textRotation||0,e.textLineSpacingFactor&&(t.textLineSpacingFactor=e.textLineSpacingFactor),e.textLineSpacingStyle&&(t.textLineSpacingStyle=e.textLineSpacingStyle),t.dimensionStyleName=e.styleName,t.dimensionText=e.text||"",t.measurement=e.measurement,t.normal.copy(e.extrusionDirection??{x:0,y:0,z:1})}processCommonAttrs(e,t){t.layer=e.layer||"0",e.handle&&(t.objectId=e.handle),t.ownerId=e.ownerBlockRecordSoftId||"",e.lineType!=null&&(t.lineType=e.lineType),e.lineweight!=null&&(t.lineWeight=e.lineweight),e.lineTypeScale!=null&&(t.linetypeScale=e.lineTypeScale),e.color!=null&&(t.color.color=e.color),e.colorIndex!=null&&(t.color.colorIndex=e.colorIndex),e.colorName!=null&&(t.color.colorName=e.colorName),e.isVisible!=null&&(t.visibility=e.isVisible),e.transparency!=null&&(t.transparency=e.transparency)}numberArrayToPointArray(e,t){const n=e.length;let r=0;if(n/2==t?r=2:n/3==t&&(r=3),r==0)return;const i=[];for(let a=0,l=n/r;a<l;++a)i.push({x:e[a*r],y:e[a*r+1],z:r==3?e[a*r+2]:0});return i}},Di=class extends Vr{constructor(e,t){e=e||{},La(e,{name:""}),super(e,t)}get name(){return this.getAttr("name")}set name(e){this.setAttr("name",e)}};const Sc=class oa extends Di{static isModelSapceName(e){return e.toLowerCase()==oa.MODEL_SPACE_NAME.toLowerCase()}static isPaperSapceName(e){return e.toLowerCase().startsWith(oa.PAPER_SPACE_NAME_PREFIX.toLowerCase())}constructor(){super(),this._origin=new te,this._layoutId="",this._entities=new Map}get isModelSapce(){return oa.isModelSapceName(this.name)}get isPaperSapce(){return oa.isPaperSapceName(this.name)}get origin(){return this._origin}set origin(e){this._origin.copy(e)}get layoutId(){return this._layoutId}set layoutId(e){this._layoutId=e}appendEntity(e){if(Array.isArray(e))for(let t=0;t<e.length;++t){const n=e[t];n.database=this.database,n.ownerId=this.objectId,this._entities.set(n.objectId,n)}else e.database=this.database,e.ownerId=this.objectId,this._entities.set(e.objectId,e);(this.isModelSapce||this.isPaperSapce)&&this.database.events.entityAppended.dispatch({database:this.database,entity:e})}newIterator(){return new lh(this._entities)}getIdAt(e){return this._entities.get(e)}};Sc.MODEL_SPACE_NAME="*MODEL_SPACE",Sc.PAPER_SPACE_NAME_PREFIX="*PAPER_SPACE";let Zt=Sc,sb=class{convertLayout(e,t){var n,r;const i=new Ba;if(i.layoutName=e.layoutName,i.tabOrder=e.tabOrder,e.layoutName==="Model"){const a=Zt.MODEL_SPACE_NAME;(n=t.tables.BLOCK_RECORD)==null||n.entries.some(l=>l.name.toUpperCase()===a?(i.blockTableRecordId=l.handle,!0):!1)}else(r=t.tables.BLOCK_RECORD)==null||r.entries.some(a=>a.layoutObjects===e.handle?(i.blockTableRecordId=a.handle,!0):!1),i.blockTableRecordId||(i.blockTableRecordId=e.paperSpaceTableId);return i.limits.min.copy(e.minLimit),i.limits.max.copy(e.maxLimit),i.extents.min.copy(e.minExtent),i.extents.max.copy(e.maxExtent),this.processCommonAttrs(e,i),i}convertImageDef(e){const t=new Kf;return t.sourceFileName=e.fileName,this.processCommonAttrs(e,t),t}processCommonAttrs(e,t){t.objectId=e.handle,t.ownerId=e.ownerObjectId}},rb=class{constructor(e){this.taskId=0,this.workers=new Map,this.pendingTasks=new Map,this.config={workerUrl:e.workerUrl,timeout:e.timeout??3e4,maxConcurrentWorkers:e.maxConcurrentWorkers??4}}async execute(e,t){const n=Date.now(),r=this.generateTaskId();try{return await this.executeInWorker(r,e,t||this.config.workerUrl)}catch(i){const a=Date.now()-n;return{success:!1,error:i instanceof Error?i.message:String(i),duration:a}}}async executeInWorker(e,t,n){const r=Date.now();return new Promise((i,a)=>{const l=this.getAvailableWorker(n),c=setTimeout(()=>{this.cleanupTask(e),this.releaseWorker(l),a(new Error(`Worker operation timed out after ${this.config.timeout}ms`))},this.config.timeout);this.pendingTasks.set(e,{resolve:g=>{clearTimeout(c),this.releaseWorker(l),i(g)},reject:g=>{clearTimeout(c),this.releaseWorker(l),a(g)},timeout:c});const u=g=>{const{id:m,success:y,data:A,error:w}=g.data;if(m!==e)return;this.cleanupTask(e);const C=Date.now()-r;i(y?{success:!0,data:A,duration:C}:{success:!1,error:w,duration:C})},p=g=>{this.cleanupTask(e),a(new Error(`Worker error: ${g.message}`))};l.addEventListener("message",u),l.addEventListener("error",p),l.postMessage({id:e,input:t})})}cleanupTask(e){const t=this.pendingTasks.get(e);t&&(clearTimeout(t.timeout),this.pendingTasks.delete(e))}generateTaskId(){return`task_${++this.taskId}_${Date.now()}`}detectWorkerSupport(){return typeof Worker<"u"}getAvailableWorker(e){for(const[n,r]of this.workers)if(!r.isBusy)return r.isBusy=!0,r.worker;if(this.workers.size<this.config.maxConcurrentWorkers){const n=new Worker(e,{type:"module"}),r=this.generateWorkerId(),i={worker:n,isBusy:!0,id:r,createdAt:new Date};return this.workers.set(r,i),n}const t=Array.from(this.workers.values()).sort((n,r)=>n.createdAt.getTime()-r.createdAt.getTime())[0];return t.isBusy=!0,t.worker}releaseWorker(e){for(const[t,n]of this.workers)if(n.worker===e){n.isBusy=!1;break}}generateWorkerId(){return`worker_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getStats(){return{totalWorkers:this.workers.size,busyWorkers:Array.from(this.workers.values()).filter(e=>e.isBusy).length,pendingTasks:this.pendingTasks.size,config:this.config}}destroy(){for(const[e,t]of this.pendingTasks)clearTimeout(t.timeout),t.reject(new Error("Framework destroyed"));this.pendingTasks.clear();for(const[e,t]of this.workers)t.worker.terminate();this.workers.clear()}},ib=class{constructor(e){this.framework=new rb(e)}async execute(e,t){return this.framework.execute(e,t)}getStats(){return this.framework.getStats()}destroy(){this.framework.destroy()}};function cm(s){return new ib(s)}class hm extends ch{constructor(e={}){super(e),e.parserWorkerUrl||(e.parserWorkerUrl="/assets/dxf-parser-worker.js")}async parse(e){if(this.config.useWorker&&this.config.parserWorkerUrl){const t=cm({workerUrl:this.config.parserWorkerUrl,maxConcurrentWorkers:1}),n=await t.execute(e);if(t.destroy(),n.success)return{model:n.data,data:{unknownEntityCount:0}};throw new Error(`Failed to parse drawing due to error: '${n.error}'`)}else return{model:new nb().parse(e),data:{unknownEntityCount:0}}}getFonts(e){var t;const n=new Map,r=a=>{if(a){const l=a.lastIndexOf(".");return l>=0?a.substring(0,l).toLowerCase():a.toLowerCase()}};(t=e.tables.STYLE)==null||t.entries.forEach(a=>{const l=[];if(a.font){const c=r(a.font);c&&l.push(c)}if(a.bigFont){const c=r(a.bigFont);c&&l.push(c)}if(a.extendedFont){const c=r(a.extendedFont);c&&l.push(c)}n.set(a.name,l)});const i=new Set;return this.getFontsInBlock(e.entities,e.blocks,n,i),Array.from(i)}getFontsInBlock(e,t,n,r){const i=/\\f(.*?)\|/g;e.forEach(a=>{if(a.type=="MTEXT"){const l=a;[...l.text.matchAll(i)].forEach(u=>{r.add(u[1].toLowerCase())});const c=n.get(l.styleName);c==null||c.forEach(u=>r.add(u))}else if(a.type=="TEXT"){const l=a,c=n.get(l.styleName);c==null||c.forEach(u=>r.add(u))}else if(a.type=="INSERT"){const l=t[a.name];l&&l.entities&&this.getFontsInBlock(l.entities,t,n,r)}})}async processEntities(e,t,n,r,i){const a=new Au;let l=e.entities;const c=l.length,u=new Kc(c,100-r.value,n);this.config.convertByEntityType&&(l=this.groupAndFlattenByType(l));const p=t.tables.blockTable.modelSpace;await u.processChunk(async(g,m)=>{let y=[],A=g<m?l[g].type:"";for(let w=g;w<m;w++){const C=l[w],E=a.convert(C);E&&(this.config.convertByEntityType&&C.type!==A&&(p.appendEntity(y),y=[],A=C.type),y.push(E))}if(p.appendEntity(y),i){let w=r.value+m/c*(100-r.value);w>100&&(w=100),await i(w,"ENTITY","IN-PROGRESS")}})}async processEntitiesInBlock(e,t){const n=new Au,r=e.length,i=[];for(let a=0;a<r;a++){const l=e[a],c=n.convert(l);c&&i.push(c)}t.appendEntity(i)}processBlocks(e,t){const n=e.blocks;for(const[r,i]of Object.entries(n)){let a=t.tables.blockTable.getAt(i.name);a||(a=new Zt,a.objectId=i.handle,a.name=r,a.origin.copy(i.position),t.tables.blockTable.add(a)),i.entities&&this.processEntitiesInBlock(i.entities,a)}}processHeader(e,t){const n=e.header;n.$ACADVER&&(t.version=n.$ACADVER),t.cecolor.colorIndex=n.$CECOLOR||256,t.angBase=n.$ANGBASE||0,t.angDir=n.$ANGDIR||0,n.$AUNITS!=null&&(t.aunits=n.$AUNITS),n.$EXTMAX&&(t.extmax=n.$EXTMAX),n.$EXTMIN&&(t.extmin=n.$EXTMIN),n.$INSUNITS!=null&&(t.insunits=n.$INSUNITS),t.pdmode=n.$PDMODE||0,t.pdsize=n.$PDSIZE||0}processBlockTables(e,t){var n;const r=(n=e.tables.BLOCK_RECORD)==null?void 0:n.entries;r&&r.length>0&&(t.tables.blockTable.removeAll(),r.forEach(i=>{const a=new Zt;a.objectId=i.handle,a.name=i.name,a.layoutId=i.layoutObjects,t.tables.blockTable.add(a)}))}processObjects(e,t){const n=e.objects.byName,r=new sb;if("LAYOUT"in n){const i=t.dictionaries.layouts;n.LAYOUT.forEach(a=>{const l=r.convertLayout(a,e);i.setAt(l.layoutName,l)})}if("IMAGEDEF"in n){const i=t.dictionaries.imageDefs;n.IMAGEDEF.forEach(a=>{const l=r.convertImageDef(a);i.setAt(l.objectId,l)})}}processViewports(e,t){var n,r;const i=(r=(n=e.tables)==null?void 0:n.VPORT)==null?void 0:r.entries;i&&i.length>0&&i.forEach(a=>{const l=new gm;this.processCommonTableEntryAttrs(a,l),a.circleSides&&(l.circleSides=a.circleSides),l.standardFlag=a.standardFlag,l.center.copy(a.center),l.lowerLeftCorner.copy(a.lowerLeftCorner),l.upperRightCorner.copy(a.upperRightCorner),a.snapBasePoint&&l.snapBase.copy(a.snapBasePoint),a.snapRotationAngle&&(l.snapAngle=a.snapRotationAngle),a.snapSpacing&&l.snapIncrements.copy(a.snapSpacing),a.majorGridLines&&(l.gridMajor=a.majorGridLines),a.gridSpacing&&l.gridIncrements.copy(a.gridSpacing),a.backgroundObjectId&&(l.backgroundObjectId=a.backgroundObjectId),l.gsView.center.copy(a.center),l.gsView.viewDirectionFromTarget.copy(a.viewDirectionFromTarget),l.gsView.viewTarget.copy(a.viewTarget),a.lensLength&&(l.gsView.lensLength=a.lensLength),a.frontClippingPlane&&(l.gsView.frontClippingPlane=a.frontClippingPlane),a.backClippingPlane&&(l.gsView.backClippingPlane=a.backClippingPlane),a.viewHeight&&(l.gsView.viewHeight=a.viewHeight),a.viewTwistAngle&&(l.gsView.viewTwistAngle=a.viewTwistAngle),a.frozenLayers&&(l.gsView.frozenLayers=a.frozenLayers),a.styleSheet&&(l.gsView.styleSheet=a.styleSheet),a.renderMode&&(l.gsView.renderMode=a.renderMode),a.viewMode&&(l.gsView.viewMode=a.viewMode),a.ucsIconSetting&&(l.gsView.ucsIconSetting=a.ucsIconSetting),a.ucsOrigin&&l.gsView.ucsOrigin.copy(a.ucsOrigin),a.ucsXAxis&&l.gsView.ucsXAxis.copy(a.ucsXAxis),a.ucsYAxis&&l.gsView.ucsYAxis.copy(a.ucsYAxis),a.orthographicType&&(l.gsView.orthographicType=a.orthographicType),a.shadePlotSetting&&(l.gsView.shadePlotSetting=a.shadePlotSetting),a.shadePlotObjectId&&(l.gsView.shadePlotObjectId=a.shadePlotObjectId),a.visualStyleObjectId&&(l.gsView.visualStyleObjectId=a.visualStyleObjectId),a.isDefaultLightingOn&&(l.gsView.isDefaultLightingOn=a.isDefaultLightingOn),a.defaultLightingType&&(l.gsView.defaultLightingType=a.defaultLightingType),a.brightness&&(l.gsView.brightness=a.brightness),a.contrast&&(l.gsView.contrast=a.contrast),a.ambientColor&&(l.gsView.ambientColor=a.ambientColor),t.tables.viewportTable.add(l)})}processLayers(e,t){var n,r;const i=(r=(n=e.tables)==null?void 0:n.LAYER)==null?void 0:r.entries;i&&i.length>0&&i.forEach(a=>{const l=new fr;l.colorIndex=a.colorIndex;const c=new sl({name:a.name,standardFlags:a.standardFlag,linetype:a.lineType,lineWeight:a.lineweight,isOff:a.colorIndex<0,color:l,isPlottable:a.isPlotting});this.processCommonTableEntryAttrs(a,c),t.tables.layerTable.add(c)})}processLineTypes(e,t){var n,r;const i=(r=(n=e.tables)==null?void 0:n.LTYPE)==null?void 0:r.entries;i&&i.length>0&&i.forEach(a=>{const l=new ma(a);this.processCommonTableEntryAttrs(a,l),l.name=a.name,t.tables.linetypeTable.add(l)})}processTextStyles(e,t){var n;const r=(n=e.tables.STYLE)==null?void 0:n.entries;r&&r.length>0&&r.forEach(i=>{const a=new gh(i);this.processCommonTableEntryAttrs(i,a),t.tables.textStyleTable.add(a)})}processDimStyles(e,t){var n;const r=(n=e.tables.DIMSTYLE)==null?void 0:n.entries;r&&r.length>0&&r.forEach(i=>{const a={name:i.name,ownerId:i.ownerObjectId,dimpost:i.DIMPOST||"",dimapost:i.DIMAPOST||"",dimscale:i.DIMSCALE,dimasz:i.DIMASZ,dimexo:i.DIMEXO,dimdli:i.DIMDLI,dimexe:i.DIMEXE,dimrnd:i.DIMRND,dimdle:i.DIMDLE,dimtp:i.DIMTP,dimtm:i.DIMTM,dimtxt:i.DIMTXT,dimcen:i.DIMCEN,dimtsz:i.DIMTSZ,dimaltf:i.DIMALTF,dimlfac:i.DIMLFAC,dimtvp:i.DIMTVP,dimtfac:i.DIMTFAC,dimgap:i.DIMGAP,dimaltrnd:i.DIMALTRND,dimtol:i.DIMTOL==null||i.DIMTOL==0?0:1,dimlim:i.DIMLIM==null||i.DIMLIM==0?0:1,dimtih:i.DIMTIH==null||i.DIMTIH==0?0:1,dimtoh:i.DIMTOH==null||i.DIMTOH==0?0:1,dimse1:i.DIMSE1==null||i.DIMSE1==0?0:1,dimse2:i.DIMSE2==null||i.DIMSE2==0?0:1,dimtad:i.DIMTAD,dimzin:i.DIMZIN,dimazin:i.DIMAZIN,dimalt:i.DIMALT,dimaltd:i.DIMALTD,dimtofl:i.DIMTOFL,dimsah:i.DIMSAH,dimtix:i.DIMTIX,dimsoxd:i.DIMSOXD,dimclrd:i.DIMCLRD,dimclre:i.DIMCLRE,dimclrt:i.DIMCLRT,dimadec:i.DIMADEC||0,dimunit:i.DIMUNIT||2,dimdec:i.DIMDEC,dimtdec:i.DIMTDEC,dimaltu:i.DIMALTU,dimalttd:i.DIMALTTD,dimaunit:i.DIMAUNIT,dimfrac:i.DIMFRAC,dimlunit:i.DIMLUNIT,dimdsep:i.DIMDSEP,dimtmove:i.DIMTMOVE||0,dimjust:i.DIMJUST,dimsd1:i.DIMSD1,dimsd2:i.DIMSD2,dimtolj:i.DIMTOLJ,dimtzin:i.DIMTZIN,dimaltz:i.DIMALTZ,dimalttz:i.DIMALTTZ,dimfit:i.DIMFIT||0,dimupt:i.DIMUPT,dimatfit:i.DIMATFIT,dimtxsty:i.DIMTXSTY||"Standard",dimldrblk:i.DIMLDRBLK||"",dimblk:i.DIMBLK||"",dimblk1:i.DIMBLK1||"",dimblk2:i.DIMBLK2||"",dimlwd:i.DIMLWD,dimlwe:i.DIMLWE},l=new rl(a);this.processCommonTableEntryAttrs(i,l),t.tables.dimStyleTable.add(l)})}processCommonTableEntryAttrs(e,t){t.name=e.name,t.objectId=e.handle,t.ownerId=e.ownerObjectId}groupAndFlattenByType(e){const t={},n=[];for(const r of e)t[r.type]||(t[r.type]=[],n.push(r.type)),t[r.type].push(r);return n.flatMap(r=>t[r])}}class ab extends ch{constructor(e){super({}),this._database=e}async parse(){return{model:this._database,data:{unknownEntityCount:0}}}getFonts(){return[]}async processEntities(e,t,n,r,i){let a=e.tables.blockTable.modelSpace.newIterator().toArray();const l=a.length,c=new Kc(l,100-r.value,n);this.config.convertByEntityType&&(a=this.groupAndFlattenByType(a));const u=t.tables.blockTable.modelSpace;await c.processChunk(async(p,g)=>{let m=[],y=p<g?a[p].type:"";for(let A=p;A<g;A++){const w=a[A];this.config.convertByEntityType&&w.type!==y&&(this.triggerEvents(u,m),m=[],y=w.type),m.push(w)}if(this.triggerEvents(u,m),i){let A=r.value+g/l*(100-r.value);A>100&&(A=100),await i(A,"ENTITY","IN-PROGRESS")}})}processBlocks(){const e=this._database.tables.blockTable.newIterator();for(const t of e){const n=t.newIterator().toArray();this.triggerEvents(t,n)}}processHeader(){}processBlockTables(){}processObjects(){const e=this._database.dictionaries.layouts.newIterator();for(const n of e)this._database.events.dictObjetSet.dispatch({database:this._database,object:n,key:n.layoutName});const t=this._database.dictionaries.imageDefs.newIterator();for(const n of t)this._database.events.dictObjetSet.dispatch({database:this._database,object:n,key:n.objectId})}processViewports(){}processLayers(){this._database.tables.layerTable.newIterator().toArray().forEach(e=>{this._database.events.layerAppended.dispatch({database:this._database,layer:e})})}processLineTypes(){}processTextStyles(){}processDimStyles(){}groupAndFlattenByType(e){const t={},n=[];for(const r of e)t[r.type]||(t[r.type]=[],n.push(r.type)),t[r.type].push(r);return n.flatMap(r=>t[r])}triggerEvents(e,t){(e.isModelSapce||e.isPaperSapce)&&e.database.events.entityAppended.dispatch({database:e.database,entity:t})}}var cr=(s=>(s.DXF="dxf",s.DWG="dwg",s))(cr||{});let Ac=class er{constructor(){this.events={registered:new lt,unregistered:new lt},this._converters=new Map,this.register("dxf",new hm)}static createInstance(){return er._instance==null&&(er._instance=new er),this._instance}static get instance(){return er._instance||(er._instance=new er),er._instance}get fileTypes(){return this._converters.keys()}register(e,t){this._converters.set(e,t),this.events.registered.dispatch({fileType:e,converter:t})}get(e){return this._converters.get(e)}unregister(e){const t=this._converters.get(e);t&&(this._converters.delete(e),this.events.unregistered.dispatch({fileType:e,converter:t}))}},Bi=class extends Vr{constructor(e){super(),this.database=e,this._recordsByName=new Map,this._recordsById=new Map}get numEntries(){return this._recordsByName.size}add(e){e.database=this.database;const t=this.normalizeName(e.name);this._recordsByName.set(t,e),this._recordsById.set(e.objectId,e)}remove(e){const t=this.normalizeName(e),n=this._recordsByName.get(t);return n?(this._recordsById.delete(n.objectId),this._recordsByName.delete(e),!0):!1}removeId(e){const t=this._recordsById.get(e);return t?(this._recordsByName.delete(t.name),this._recordsById.delete(e),!0):!1}removeAll(){this._recordsByName.clear(),this._recordsById.clear()}has(e){const t=this.normalizeName(e);return this._recordsByName.has(t)}hasId(e){return this._recordsById.has(e)}getAt(e){const t=this.normalizeName(e);return this._recordsByName.get(t)}getIdAt(e){return this._recordsById.get(e)}getOwnerIdAt(e){return this._recordsById.get(e)}newIterator(){return new lh(this._recordsByName)}normalizeName(e){return e}};class ob extends Bi{constructor(e){super(e)}get modelSpace(){let e=this.getAt(Zt.MODEL_SPACE_NAME);return e||(e=new Zt,e.name=Zt.MODEL_SPACE_NAME,this.add(e)),e}normalizeName(e){let t=e;if(Zt.isModelSapceName(e))t=Zt.MODEL_SPACE_NAME;else if(Zt.isPaperSapceName(e)){const n=Zt.PAPER_SPACE_NAME_PREFIX,r=e.substring(n.length);t=n+r}return t}}class lb extends Bi{constructor(e){super(e)}}let sl=class extends Di{constructor(e,t){e=e||{},La(e,{color:new fr,description:"",standardFlags:0,isHidden:!1,isInUse:!0,isOff:!1,isPlottable:!0,transparency:0,linetype:"",lineWeight:1,materialId:-1}),super(e,t),this.attrs.events.attrChanged.addEventListener(n=>{this.database.events.layerModified.dispatch({database:this.database,layer:this,changes:n.object.changedAttributes()})})}get color(){return this.getAttr("color")}set color(e){this.setAttr("color",e.clone())}get description(){return this.getAttr("description")}set description(e){this.setAttr("description",e)}get standardFlags(){return this.getAttr("standardFlags")}set standardFlags(e){this.setAttr("standardFlags",e)}get isFrozen(){return(this.standardFlags&1)==1}set isFrozen(e){const t=e?1:0;this.standardFlags=this.standardFlags|t}get isHidden(){return this.getAttr("isHidden")}set isHidden(e){this.setAttr("isHidden",e)}get isInUse(){return this.getAttr("isInUse")}set isInUse(e){this.setAttr("isInUse",e)}get isLocked(){return(this.standardFlags&4)==4}set isLocked(e){const t=e?4:0;this.standardFlags=this.standardFlags|t}get isOff(){return this.getAttr("isOff")}set isOff(e){this.setAttr("isOff",e)}get isPlottable(){return this.getAttr("isPlottable")}set isPlottable(e){this.setAttr("isPlottable",e)}get transparency(){return this.getAttr("transparency")}set transparency(e){this.setAttr("transparency",e)}get linetype(){return this.getAttr("linetype")}set linetype(e){this.setAttr("linetype",e)}get lineWeight(){return this.getAttr("lineWeight")}set lineWeight(e){this.setAttr("lineWeight",e)}get materialId(){return this.getAttr("materialId")}set materialId(e){this.setAttr("materialId",e)}};class cb extends Bi{constructor(e){super(e);const t=new fr;t.color=16777215;const n=new sl({name:"0",standardFlags:0,linetype:gc,lineWeight:1,isOff:!1,color:t,isPlottable:!0});this.add(n)}add(e){super.add(e),this.database.events.layerAppended.dispatch({database:this.database,layer:e})}}class hb extends Bi{constructor(e){super(e)}}class ub extends Bi{constructor(e){super(e)}get fonts(){const e=new Set,t=r=>{if(r){const i=r.lastIndexOf(".");if(i>=0){const a=r.substring(0,i).toLowerCase();e.add(a)}else e.add(r.toLowerCase())}},n=this.newIterator();for(const r of n)t(r.fileName),t(r.bigFontFileName);return Array.from(e)}}class db extends Bi{constructor(e){super(e)}}class pb extends Vr{constructor(){super(),this.events={dictObjetSet:new lt,dictObjectErased:new lt,entityAppended:new lt,entityModified:new lt,layerAppended:new lt,layerModified:new lt,layerErased:new lt,openProgress:new lt,headerSysVarChanged:new lt},this._version=new wc("AC1014"),this._angBase=0,this._angDir=0,this._aunits=mp.DecimalDegrees,this._celtscale=1,this._cecolor=new fr,this._extents=new at,this._insunits=Qf.Millimeters,this._ltscale=1,this._pdmode=0,this._pdsize=0,this._tables={blockTable:new ob(this),dimStyleTable:new lb(this),linetypeTable:new hb(this),textStyleTable:new ub(this),layerTable:new cb(this),viewportTable:new db(this)},this._dictionaries={layouts:new my(this),imageDefs:new Zf(this)}}get tables(){return this._tables}get dictionaries(){return this._dictionaries}get currentSpaceId(){return this._currentSpace||(this._currentSpace=this._tables.blockTable.modelSpace),this._currentSpace.objectId}set currentSpaceId(e){const t=this.tables.blockTable.getIdAt(e);if(t==null)throw new Error(`[AcDbDatabase] The specified block table record id '${e}' doesn't exist in the drawing database!`);this._currentSpace=t}get aunits(){return this._aunits}set aunits(e){this._aunits=e||0,this.triggerHeaderSysVarChangedEvent("aunits")}get version(){return this._version}set version(e){this._version=new wc(e),this.triggerHeaderSysVarChangedEvent("version")}get insunits(){return this._insunits}set insunits(e){this._insunits=e||4,this.triggerHeaderSysVarChangedEvent("insunits")}get ltscale(){return this._ltscale}set ltscale(e){this._ltscale=e||1,this.triggerHeaderSysVarChangedEvent("ltscale")}get cecolor(){return this._cecolor}set cecolor(e){this._cecolor=e||0,this.triggerHeaderSysVarChangedEvent("cecolor")}get celtscale(){return this._celtscale}set celtscale(e){this._celtscale=e||1,this.triggerHeaderSysVarChangedEvent("celtscale")}get angBase(){return this._angBase}set angBase(e){this._angBase=e||0,this.triggerHeaderSysVarChangedEvent("angbase")}get angDir(){return this._angDir}set angDir(e){this._angDir=e||0,this.triggerHeaderSysVarChangedEvent("angdir")}get extmax(){return this._extents.max}set extmax(e){e&&(this._extents.expandByPoint(e),this.triggerHeaderSysVarChangedEvent("extmax"))}get extmin(){return this._extents.min}set extmin(e){e&&(this._extents.expandByPoint(e),this.triggerHeaderSysVarChangedEvent("extmin"))}get extents(){return this._extents}get pdmode(){return this._pdmode}set pdmode(e){this._pdmode=e||0,this.triggerHeaderSysVarChangedEvent("pdmode")}get pdsize(){return this._pdsize}set pdsize(e){this._pdsize=e||0,this.triggerHeaderSysVarChangedEvent("pdsize")}async read(e,t,n=cr.DXF){const r=Ac.instance.get(n);if(r==null)throw new Error(`Database converter for file type '${n}' isn't registered and can can't read this file!`);this.clear(),await r.read(e,this,t&&t.minimumChunkSize||10,async(i,a,l,c)=>{if(this.events.openProgress.dispatch({database:this,percentage:i,stage:"CONVERSION",subStage:a,subStageStatus:l,data:c}),t&&t.fontLoader&&a=="FONT"&&l=="END"){const u=c||this.tables.textStyleTable.fonts;await t.fontLoader.load(u)}})}async openUri(e,t){var n;this.events.openProgress.dispatch({database:this,percentage:0,stage:"FETCH_FILE",subStageStatus:"START"});const r=await fetch(e);if(!r.ok)throw this.events.openProgress.dispatch({database:this,percentage:100,stage:"FETCH_FILE",subStageStatus:"ERROR"}),new Error(`Failed to fetch file '${e}' with HTTP status code '${r.status}'!`);const i=r.headers.get("content-length"),a=i?parseInt(i,10):null;let l=0;const c=(n=r.body)==null?void 0:n.getReader();if(!c)throw new Error("Failed to get response reader");const u=[];for(;;){const{done:m,value:y}=await c.read();if(m)break;if(u.push(y),l+=y.length,a!==null){const A=Math.round(l/a*100);this.events.openProgress.dispatch({database:this,percentage:A,stage:"FETCH_FILE",subStageStatus:"IN-PROGRESS"})}}const p=new Uint8Array(l);let g=0;for(const m of u)p.set(m,g),g+=m.length;this.getFileNameFromUri(e).toLowerCase().split(".").pop()==="dwg"?await this.read(p.buffer,t,cr.DWG):await this.read(p.buffer,t,cr.DXF),this.events.openProgress.dispatch({database:this,percentage:100,stage:"FETCH_FILE",subStageStatus:"END"})}async regen(){await new ab(this).read(null,this,500,async(e,t,n,r)=>{this.events.openProgress.dispatch({database:this,percentage:e,stage:"CONVERSION",subStage:t,subStageStatus:n,data:r})})}createDefaultData(e={layer:!0,lineType:!0,textStyle:!0,dimStyle:!0,layout:!0}){const t=new yy(this);e.layer&&t.createDefaultLayer(),e.lineType&&t.createDefaultLineType(),e.textStyle&&t.createDefaultTextStyle(),e.dimStyle&&t.createDefaultDimStyle(),e.layout&&t.createDefaultLayout()}clear(){this._tables.blockTable.removeAll(),this._tables.dimStyleTable.removeAll(),this._tables.linetypeTable.removeAll(),this._tables.textStyleTable.removeAll(),this._tables.layerTable.removeAll(),this._tables.viewportTable.removeAll(),this._dictionaries.layouts.removeAll(),this._currentSpace=void 0,this._extents.makeEmpty()}triggerHeaderSysVarChangedEvent(e){this.events.headerSysVarChanged.dispatch({database:this,name:e})}getFileNameFromUri(e){try{const t=new URL(e).pathname.split("/");return t[t.length-1]||""}catch(t){return console.error("Invalid URI:",t),""}}}const um=class dm extends Di{constructor(e,t){e=e||{},La(e,dm.DEFAULT_DIM_VALUES),super(e,t)}get dimpost(){return this.getAttr("dimpost")}set dimpost(e){this.setAttr("dimpost",e)}get dimapost(){return this.getAttr("dimapost")}set dimapost(e){this.setAttr("dimapost",e)}get dimscale(){return this.getAttr("dimscale")}set dimscale(e){this.setAttr("dimscale",e)}get dimasz(){return this.getAttr("dimasz")}set dimasz(e){this.setAttr("dimasz",e)}get dimexo(){return this.getAttr("dimexo")}set dimexo(e){this.setAttr("dimexo",e)}get dimdli(){return this.getAttr("dimdli")}set dimdli(e){this.setAttr("dimdli",e)}get dimexe(){return this.getAttr("dimexe")}set dimexe(e){this.setAttr("dimexe",e)}get dimrnd(){return this.getAttr("dimrnd")}set dimrnd(e){this.setAttr("dimrnd",e)}get dimdle(){return this.getAttr("dimdle")}set dimdle(e){this.setAttr("dimdle",e)}get dimtp(){return this.getAttr("dimtp")}set dimtp(e){this.setAttr("dimtp",e)}get dimtm(){return this.getAttr("dimtm")}set dimtm(e){this.setAttr("dimtm",e)}get dimtxt(){return this.getAttr("dimtxt")}set dimtxt(e){this.setAttr("dimtxt",e)}get dimcen(){return this.getAttr("dimcen")}set dimcen(e){this.setAttr("dimcen",e)}get dimtsz(){return this.getAttr("dimtsz")}set dimtsz(e){this.setAttr("dimtsz",e)}get dimaltf(){return this.getAttr("dimaltf")}set dimaltf(e){this.setAttr("dimaltf",e)}get dimlfac(){return this.getAttr("dimlfac")}set dimlfac(e){this.setAttr("dimlfac",e)}get dimtvp(){return this.getAttr("dimtvp")}set dimtvp(e){this.setAttr("dimtvp",e)}get dimtfac(){return this.getAttr("dimtfac")}set dimtfac(e){this.setAttr("dimtfac",e)}get dimgap(){return this.getAttr("dimgap")}set dimgap(e){this.setAttr("dimgap",e)}get dimaltrnd(){return this.getAttr("dimaltrnd")}set dimaltrnd(e){this.setAttr("dimaltrnd",e)}get dimtol(){return this.getAttr("dimtol")}set dimtol(e){this.setAttr("dimtol",e)}get dimlim(){return this.getAttr("dimlim")}set dimlim(e){this.setAttr("dimlim",e)}get dimtih(){return this.getAttr("dimtih")}set dimtih(e){this.setAttr("dimtih",e)}get dimtoh(){return this.getAttr("dimtoh")}set dimtoh(e){this.setAttr("dimtoh",e)}get dimse1(){return this.getAttr("dimse1")}set dimse1(e){this.setAttr("dimse1",e)}get dimse2(){return this.getAttr("dimse2")}set dimse2(e){this.setAttr("dimse2",e)}get dimtad(){return this.getAttr("dimtad")}set dimtad(e){this.setAttr("dimtad",e)}get dimzin(){return this.getAttr("dimzin")}set dimzin(e){this.setAttr("dimzin",e)}get dimazin(){return this.getAttr("dimazin")}set dimazin(e){this.setAttr("dimazin",e)}get dimalt(){return this.getAttr("dimalt")}set dimalt(e){this.setAttr("dimalt",e)}get dimaltd(){return this.getAttr("dimaltd")}set dimaltd(e){this.setAttr("dimaltd",e)}get dimtofl(){return this.getAttr("dimtofl")}set dimtofl(e){this.setAttr("dimtofl",e)}get dimsah(){return this.getAttr("dimsah")}set dimsah(e){this.setAttr("dimsah",e)}get dimtix(){return this.getAttr("dimtix")}set dimtix(e){this.setAttr("dimtix",e)}get dimsoxd(){return this.getAttr("dimsoxd")}set dimsoxd(e){this.setAttr("dimsoxd",e)}get dimclrd(){return this.getAttr("dimclrd")}set dimclrd(e){this.setAttr("dimclrd",e)}get dimclre(){return this.getAttr("dimclre")}set dimclre(e){this.setAttr("dimclre",e)}get dimclrt(){return this.getAttr("dimclrt")}set dimclrt(e){this.setAttr("dimclrt",e)}get dimadec(){return this.getAttr("dimadec")}set dimadec(e){this.setAttr("dimadec",e)}get dimunit(){return this.getAttr("dimunit")}set dimunit(e){this.setAttr("dimunit",e)}get dimdec(){return this.getAttr("dimdec")}set dimdec(e){this.setAttr("dimdec",e)}get dimtdec(){return this.getAttr("dimtdec")}set dimtdec(e){this.setAttr("dimtdec",e)}get dimaltu(){return this.getAttr("dimaltu")}set dimaltu(e){this.setAttr("dimaltu",e)}get dimalttd(){return this.getAttr("dimalttd")}set dimalttd(e){this.setAttr("dimalttd",e)}get dimaunit(){return this.getAttr("dimaunit")}set dimaunit(e){this.setAttr("dimaunit",e)}get dimfrac(){return this.getAttr("dimfrac")}set dimfrac(e){this.setAttr("dimfrac",e)}get dimlunit(){return this.getAttr("dimlunit")}set dimlunit(e){this.setAttr("dimlunit",e)}get dimdsep(){return this.getAttr("dimdsep")}set dimdsep(e){this.setAttr("dimdsep",e)}get dimtmove(){return this.getAttr("dimtmove")}set dimtmove(e){this.setAttr("dimtmove",e)}get dimjust(){return this.getAttr("dimjust")}set dimjust(e){this.setAttr("dimjust",e)}get dimsd1(){return this.getAttr("dimsd1")}set dimsd1(e){this.setAttr("dimsd1",e)}get dimsd2(){return this.getAttr("dimsd2")}set dimsd2(e){this.setAttr("dimsd2",e)}get dimtolj(){return this.getAttr("dimtolj")}set dimtolj(e){this.setAttr("dimtolj",e)}get dimtzin(){return this.getAttr("dimtzin")}set dimtzin(e){this.setAttr("dimtzin",e)}get dimaltz(){return this.getAttr("dimaltz")}set dimaltz(e){this.setAttr("dimaltz",e)}get dimalttz(){return this.getAttr("dimalttz")}set dimalttz(e){this.setAttr("dimalttz",e)}get dimfit(){return this.getAttr("dimfit")}set dimfit(e){this.setAttr("dimfit",e)}get dimupt(){return this.getAttr("dimupt")}set dimupt(e){this.setAttr("dimupt",e)}get dimatfit(){return this.getAttr("dimatfit")}set dimatfit(e){this.setAttr("dimatfit",e)}get dimtxsty(){return this.getAttr("dimtxsty")}set dimtxsty(e){this.setAttr("dimtxsty",e)}get dimldrblk(){return this.getAttr("dimldrblk")}set dimldrblk(e){this.setAttr("dimldrblk",e)}get dimblk(){return this.getAttr("dimblk")}set dimblk(e){this.setAttr("dimblk",e)}get dimblk1(){return this.getAttr("dimblk1")}set dimblk1(e){this.setAttr("dimblk1",e)}get dimblk2(){return this.getAttr("dimblk2")}set dimblk2(e){this.setAttr("dimblk2",e)}get dimlwd(){return this.getAttr("dimlwd")}set dimlwd(e){this.setAttr("dimlwd",e)}get dimlwe(){return this.getAttr("dimlwe")}set dimlwe(e){this.setAttr("dimlwe",e)}};um.DEFAULT_DIM_VALUES={name:"",dimpost:"",dimapost:"",dimscale:1,dimasz:2.5,dimexo:.625,dimdli:.38,dimexe:.18,dimrnd:0,dimdle:0,dimtp:0,dimtm:0,dimtxt:2.5,dimcen:2.5,dimtsz:0,dimaltf:0,dimlfac:1,dimtvp:0,dimtfac:1,dimgap:1,dimaltrnd:0,dimtol:0,dimlim:0,dimtih:0,dimtoh:0,dimse1:0,dimse2:0,dimtad:0,dimzin:0,dimazin:0,dimalt:0,dimaltd:2,dimtofl:0,dimsah:0,dimtix:0,dimsoxd:0,dimclrd:0,dimclre:0,dimclrt:0,dimadec:0,dimunit:2,dimdec:4,dimtdec:4,dimaltu:2,dimalttd:2,dimaunit:0,dimfrac:0,dimlunit:2,dimdsep:".",dimtmove:0,dimjust:0,dimsd1:0,dimsd2:0,dimtolj:0,dimtzin:0,dimaltz:0,dimalttz:0,dimfit:0,dimupt:0,dimatfit:3,dimtxsty:"Standard",dimldrblk:"",dimblk:"",dimblk1:"",dimblk2:"",dimlwd:-2,dimlwe:-2};let rl=um,ma=class extends Di{constructor(e){super(),this.name=e.name,this._linetype=e}get numDashes(){return this._linetype.pattern?this._linetype.pattern.length:0}get patternLength(){return this._linetype.totalPatternLength}get comments(){return this._linetype.description}get linetype(){return this._linetype}dashLengthAt(e){if(e<0||e>=this.numDashes)throw new Error('Index must be greater than or equal to zero, but less than the value of property "numDashes".');return this._linetype.pattern[e].elementLength}};const pm=class fm{constructor(){this.registry=new Map,this.cache=new Map,this.events={sysVarChanged:new lt},this.registerVar({name:"PICKBOX",type:"number",defaultValue:0})}static instance(){return this._instance||(this._instance=new fm),this._instance}registerVar(e){this.registry.set(e.name.toUpperCase(),e)}registerMany(e){e.forEach(t=>this.registerVar(t))}getVar(e){if(e=e.toUpperCase(),this.cache.has(e))return this.cache.get(e)}setVar(e,t){e=e.toUpperCase();const n=this.getDescriptor(e);if(n){const r=this.getVar(e);if(this.cache.set(e,t),n.type!=="string"&&(typeof t=="string"||t instanceof String))if(n.type==="number"){const i=Number(t);if(Number.isNaN(i))throw new Error("Invalid input!");t=i}else n.type==="boolean"&&(t=this.parseBoolean(t));this.events.sysVarChanged.dispatch({name:e,newVal:t,oldVal:r})}else throw new Error(`System variable ${e} not found!`)}getDescriptor(e){return this.registry.get(e.toUpperCase())}getAllDescriptors(){return[...this.registry.values()]}parseBoolean(e){if(e==null)return!1;const t=String(e).trim().toLowerCase(),n=new Set(["true","t","1","yes","y"]),r=new Set(["false","f","0","no","n"]);return n.has(t)?!0:(r.has(t),!1)}};pm._instance=null;let fh=pm,gh=class extends Di{constructor(e){super(),this.name=e.name,this._textStyle=e,this._textStyle.font=this.getFileNameWithoutExtension(this._textStyle.font||this._textStyle.extendedFont||this.name),this._isVertical=!1}get obliquingAngle(){return this._textStyle.obliqueAngle}set obliquingAngle(e){this._textStyle.obliqueAngle=e}get priorSize(){return this._textStyle.lastHeight}set priorSize(e){this._textStyle.lastHeight=e}get textSize(){return this._textStyle.fixedTextHeight}set textSize(e){this._textStyle.fixedTextHeight=e}get xScale(){return this._textStyle.widthFactor}set xScale(e){this._textStyle.widthFactor=e}get isVertical(){return this._isVertical}set isVertical(e){this._isVertical=e}get fileName(){return this._textStyle.font}set fileName(e){this._textStyle.font=e}get bigFontFileName(){return this._textStyle.bigFont}set bigFontFileName(e){this._textStyle.bigFont=e}get textStyle(){return this._textStyle}getFileNameWithoutExtension(e){const t=e.split("/").pop();if(t){const n=t.lastIndexOf(".");return n===-1?t:t.substring(0,n)}return e}};const fb={center:new je,viewDirectionFromTarget:new te(0,0,1),viewTarget:new te(0,0,0),lensLength:500,frontClippingPlane:0,backClippingPlane:0,viewHeight:1e3,viewTwistAngle:0,frozenLayers:[],styleSheet:"",renderMode:yf.OPTIMIZED_2D,viewMode:0,ucsIconSetting:0,ucsOrigin:new te(0,0,0),ucsXAxis:new te(1,0,0),ucsYAxis:new te(0,1,0),orthographicType:vf.TOP,shadePlotSetting:0,shadePlotObjectId:void 0,visualStyleObjectId:void 0,isDefaultLightingOn:!1,defaultLightingType:bf.ONE_DISTANT_LIGHT,brightness:0,contrast:0,ambientColor:void 0};class gm extends Di{constructor(){super(),this._circleSides=100,this._center=new je,this._lowerLeftCorner=new je(0,0),this._upperRightCorner=new je(1,1),this._snapBase=new je(0,0),this._snapAngle=0,this._snapSpacing=new je(0,0),this._standardFlag=0,this._gridSpacing=new je,this._gridMajor=10,this._gsView=fb}get circleSides(){return this._circleSides}set circleSides(e){this._circleSides=e}get center(){return this._center}get lowerLeftCorner(){return this._lowerLeftCorner}set lowerLeftCorner(e){this._lowerLeftCorner.copy(e)}get upperRightCorner(){return this._upperRightCorner}set upperRightCorner(e){this._upperRightCorner.copy(e)}get snapBase(){return this._snapBase}set snapBase(e){this._snapBase.copy(e)}get snapAngle(){return this._snapAngle}set snapAngle(e){this._snapAngle=e}get snapIncrements(){return this._snapSpacing}set snapIncrements(e){this._snapSpacing.copy(e)}get gridMajor(){return this._gridMajor}set gridMajor(e){this._gridMajor=e}get gridIncrements(){return this._gridSpacing}set gridIncrements(e){this._gridSpacing.copy(e)}get standardFlag(){return this._standardFlag}set standardFlag(e){this._standardFlag=e}get snapEnabled(){return!!(this._standardFlag&256)}get backgroundObjectId(){return this._backgroundObjectId}set backgroundObjectId(e){this._backgroundObjectId=e}get gsView(){return this._gsView}}class gb{constructor(){this.events={layoutCreated:new lt,layoutRemoved:new lt,layoutRenamed:new lt,layoutSwitched:new lt}}countLayouts(e){return this.getWorkingDatabase(e).dictionaries.layouts.numEntries}findLayoutNamed(e,t){return this.getWorkingDatabase(t).dictionaries.layouts.getAt(e)}findActiveLayout(){const e=this.getActiveLayout();return e?e.layoutName:"Model"}setCurrentLayoutId(e,t){const n=this.getWorkingDatabase(t),r=n.dictionaries.layouts.getIdAt(e);return this.setCurrentLayoutInternal(r,n)}setCurrentLayoutBtrId(e,t){const n=this.getWorkingDatabase(t),r=n.dictionaries.layouts.getBtrIdAt(e);return this.setCurrentLayoutInternal(r,n)}setCurrentLayout(e,t){const n=this.getWorkingDatabase(t),r=n.dictionaries.layouts.getAt(e);return this.setCurrentLayoutInternal(r,n)}renameLayout(e,t,n){const r=this.getWorkingDatabase(n).dictionaries.layouts.getAt(e);return r?(r.layoutName=t,this.events.layoutRenamed.dispatch({layout:r,oldName:e,newName:t}),!0):!1}layoutExists(e,t){return this.getWorkingDatabase(t).dictionaries.layouts.has(e)}deleteLayout(e,t){const n=this.getWorkingDatabase(t).dictionaries.layouts,r=n.getAt(e);let i=!1;return r&&(i=n.remove(e),i&&this.events.layoutRemoved.dispatch({layout:r})),i}createLayout(e,t){const n=this.getWorkingDatabase(t),r=new Ba;r.layoutName=e,r.tabOrder=n.dictionaries.layouts.maxTabOrder;const i=new Zt;return i.name=`*Paper_Space${r.tabOrder}`,n.tables.blockTable.add(i),n.dictionaries.layouts.setAt(e,r),this.events.layoutCreated.dispatch({layout:r}),{layout:r,btr:i}}getActiveLayout(e){const t=this.getWorkingDatabase(e);return t.dictionaries.layouts.getBtrIdAt(t.currentSpaceId)}getWorkingDatabase(e){return e||Na().workingDatabase}setCurrentLayoutInternal(e,t){return e?(this.events.layoutSwitched.dispatch({layout:e}),t.currentSpaceId=e.blockTableRecordId,!0):!1}}function Na(){return mb.instance}const Ec=class{constructor(){this._workingDatabase=null,this._layoutManager=new gb}get workingDatabase(){if(this._workingDatabase==null)throw new Error("The current working database must be set before using it!");return this._workingDatabase}set workingDatabase(e){this._workingDatabase=e}get layoutManager(){return this._layoutManager}};Ec.instance=new Ec;let mb=Ec;class yb{constructor(e,t){this._view=e,this._doc=t,t.database.events.entityAppended.addEventListener(n=>{this.view.addEntity(n.entity)}),t.database.events.entityModified.addEventListener(n=>{this.view.updateEntity(n.entity)}),t.database.events.layerAppended.addEventListener(n=>{this._view.addLayer(n.layer)}),t.database.events.layerModified.addEventListener(n=>{this._view.updateLayer(n.layer)}),t.database.events.headerSysVarChanged.addEventListener(n=>{n.name=="pdmode"&&this._view.rerenderPoints(n.database.pdmode)}),t.database.events.dictObjetSet.addEventListener(n=>{n.object instanceof Ba&&this._view.addLayout(n.object)}),e.selectionSet.events.selectionAdded.addEventListener(n=>{e.highlight(n.ids)}),e.selectionSet.events.selectionRemoved.addEventListener(n=>{e.unhighlight(n.ids)})}get view(){return this._view}get doc(){return this._doc}}class Rn{constructor(){this.events={commandWillStart:new lt,commandEnded:new lt},this._globalName="",this._localName=""}get globalName(){return this._globalName}set globalName(e){this._globalName=e}get localName(){return this._localName}set localName(e){this._localName=e}tirgger(e){this.events.commandWillStart.dispatch({command:this}),this.execute(e),this.events.commandEnded.dispatch({command:this})}execute(e){}}class vb{constructor(e){this._index=0,this._commands=[],e.forEach(t=>{const n=t.groupName;t.commandsByGlobalName.forEach(r=>{this._commands.push({command:r,commandGroup:n})})})}[Symbol.iterator](){return this}get command(){return this._index<this._commands.length?this._commands[this._index].command:null}get commandGroup(){return this._index<this._commands.length?this._commands[this._index].commandGroup:null}next(){for(;this._index<this._commands.length;){const e=this._commands[this._index];return this._index+=1,{value:e,done:!1}}return{value:null,done:!0}}}const Tc=class Er{constructor(){this._commandsByGroup=[],this._systemCommandGroup={groupName:Er.SYSTEMT_COMMAND_GROUP_NAME,commandsByGlobalName:new Map,commandsByLocalName:new Map},this._defaultCommandGroup={groupName:Er.DEFAUT_COMMAND_GROUP_NAME,commandsByGlobalName:new Map,commandsByLocalName:new Map},this._commandsByGroup.push(this._systemCommandGroup),this._commandsByGroup.push(this._defaultCommandGroup)}static get instance(){return Er._instance||(Er._instance=new Er),Er._instance}addCommand(e,t,n,r){if(e=e.toUpperCase(),t=t.toUpperCase(),n=n.toUpperCase(),!t)throw new Error("[AcEdCommandStack] The global name of the command is required!");n||(n=t);let i=this._defaultCommandGroup;if(e){const a=this._commandsByGroup.find(l=>l.groupName==e);a?i=a:i={groupName:e,commandsByGlobalName:new Map,commandsByLocalName:new Map}}if(i.commandsByGlobalName.has(t))throw new Error(`[AcEdCommandStack] The command with global name '${t}' already exists!`);if(i.commandsByLocalName.has(n))throw new Error(`[AcEdCommandStack] The command with local name '${n}' already exists!`);i.commandsByGlobalName.set(t,r),i.commandsByLocalName.set(n,r),r.globalName=t,r.localName=n}iterator(){return new vb(this._commandsByGroup)}searchCommandsByPrefix(e){e=e.toUpperCase();const t=[],n=this.iterator();let r=n.next();for(;!r.done;){const{command:i}=r.value;(i.globalName.startsWith(e)||i.localName.startsWith(e))&&t.push(r.value),r=n.next()}return t}lookupGlobalCmd(e){e=e.toUpperCase();let t;for(const n of this._commandsByGroup)if(t=n.commandsByGlobalName.get(e),t)break;return t}lookupLocalCmd(e){e=e.toUpperCase();let t;for(const n of this._commandsByGroup)if(t=n.commandsByLocalName.get(e),t)break;return t}removeCmd(e,t){e=e.toUpperCase(),t=t.toUpperCase();for(const n of this._commandsByGroup)if(n.groupName==e)return n.commandsByGlobalName.delete(t);return!1}removeGroup(e){e=e.toUpperCase();let t=-1;return this._commandsByGroup.some((n,r)=>(t=r,n.groupName==e)),t>=0?(this._commandsByGroup.splice(t,1),!0):!1}};Tc.SYSTEMT_COMMAND_GROUP_NAME="ACAD",Tc.DEFAUT_COMMAND_GROUP_NAME="USER";let Gt=Tc;function bb(s){return{all:s=s||new Map,on:function(e,t){var n=s.get(e);n?n.push(t):s.set(e,[t])},off:function(e,t){var n=s.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):s.set(e,[]))},emit:function(e,t){var n=s.get(e);n&&n.slice().map(function(r){r(t)}),(n=s.get("*"))&&n.slice().map(function(r){r(e,t)})}}}const Fr=bb();class _b{constructor(e,t,n=1e3,r=0){this.condition=e,this.action=t,this.checkInterval=n,this.timeout=r,this.timerId=null,this.timeoutId=null}start(){this.timerId===null&&(this.timerId=window.setInterval(()=>{this.condition()&&this.executeAndStop()},this.checkInterval),this.timeout>0&&(this.timeoutId=window.setTimeout(()=>{console.warn("AcEdConditionWaiter: Timeout reached."),this.executeAndStop()},this.timeout)))}stop(){this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}executeAndStop(){this.stop(),this.action()}isRunning(){return this.timerId!==null}}var Ra=(s=>(s[s.NoSpecialCursor=-1]="NoSpecialCursor",s[s.Crosshair=0]="Crosshair",s[s.RectCursor=1]="RectCursor",s[s.RubberBand=2]="RubberBand",s[s.NotRotated=3]="NotRotated",s[s.TargetBox=4]="TargetBox",s[s.RotatedCrosshair=5]="RotatedCrosshair",s[s.CrosshairNoRotate=6]="CrosshairNoRotate",s[s.Invisible=7]="Invisible",s[s.EntitySelect=8]="EntitySelect",s[s.Parallelogram=9]="Parallelogram",s[s.EntitySelectNoPersp=10]="EntitySelectNoPersp",s[s.PkfirstOrGrips=11]="PkfirstOrGrips",s[s.CrosshairDashed=12]="CrosshairDashed",s[s.Grab=13]="Grab",s))(Ra||{});class xb{constructor(e){this._view=e,this._cursorMap=new Map;const t=20,n=10;this._cursorMap.set(0,this.createRectCrossIcon(n,t-n)),fh.instance().events.sysVarChanged.addEventListener(r=>{if(r.name==="PICKBOX"){let i=r.newVal;i=i>=0?i:0,this._cursorMap.set(0,this.createRectCrossIcon(i,t-i)),this.setCursor(this._currentCursor)}}),this.setCursor(0)}get currentCursor(){return this._currentCursor}setCursor(e){const t=this._view.canvas;if(e<=-1)t.style.cursor="default";else if(e==13)t.style.cursor="grab";else{const n=this._cursorMap.get(e);n&&(t.style.cursor=n)}this._currentCursor=e}encodeSvgToCursor(e,t,n){return`url('data:image/svg+xml;base64,${btoa(e)}') ${t} ${n}, auto`}createRectCrossIcon(e,t,n="white"){const r=e/2,i=e+2*t,a=`
      <svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${i}" viewBox="0 0 ${i} ${i}">
        <rect x="${t}" y="${t}" width="${e}" height="${e}" fill="none" stroke="${n}" />
        <line x1="${r+t}" y1="0" x2="${r+t}" y2="${t}" stroke="${n}" />
        <line x1="${e+t}" y1="${r+t}" x2="${e+2*t}" y2="${r+t}" stroke="${n}" />
        <line x1="${r+t}" y1="${e+t}" x2="${r+t}" y2="${e+2*t}" stroke="${n}" />
        <line x1="0" y1="${r+t}" x2="${t}" y2="${r+t}" stroke="${n}" />
      </svg>
    `;return this.encodeSvgToCursor(a,r+t,r+t)}}const xi=class{static get messages(){return this._messages}static getLocaleMessage(e){return this._messages[e]}static mergeLocaleMessage(e,t){mm(this._messages[e],t)}static registerMessage(e,t){this.mergeLocaleMessage(e,t)}static setCurrentLocale(e){const t=this._currentLocale;this._currentLocale=e,this.events.localeChanged.dispatch({old:t,new:this._currentLocale})}static get currentLocale(){return this._currentLocale}static t(e,t){const n=this._currentLocale,r=this._messages[n],i=e.split(".");let a=r;for(const l of i){if(!a||typeof a!="object")return(t==null?void 0:t.fallback)??e;a=a[l]}return typeof a=="string"?a:(t==null?void 0:t.fallback)??e}static cmdDescription(e,t){const n=`command.${e}.${t.toLowerCase()}`;return this.t(n)}static sysCmdDescription(e){return this.cmdDescription(Gt.SYSTEMT_COMMAND_GROUP_NAME,e)}};xi._messages={en:{},zh:{}},xi._currentLocale="en",xi.events={localeChanged:new lt},xi.userCmdDescription=s=>xi.cmdDescription(Gt.DEFAUT_COMMAND_GROUP_NAME,s);let dn=xi;function mm(s,e){for(const t of Object.keys(e)){const n=e[t],r=s[t];Eu(r)&&Eu(n)?mm(r,n):s[t]=n}}function Eu(s){return typeof s=="object"&&s!==null}const wb={ACAD:{circle:"Creates one circle by center and radius",csvg:"Converts current drawing to SVG",log:"Logs debug information in console",open:"Opens an existing drawing file",pan:"Shifts the view without changing the viewing direction or magnification",pickbox:"Sets the size (in pixels) of the selection box used to pick objects",qnew:"Starts a new drawing",regen:"Redraw the current drawing",select:"Selects entities",zoom:"Zooms to display the maximum extents of all entities",zoomw:"Zooms to display an area specified by a rectangular window"},USER:{}},Sb={circle:{center:"Specify the center of circle:",radius:"Specify the radius of circle:"},sysvar:{prompt:"Please input new value"}},Ab={commandLine:{noLast:"(no last command)",unknownCommand:"Unknown command",executed:"Executed command",showHistory:"Show command history",placeholder:"Type command",showMessages:"Show message history",canceled:"*Canceled*",noHistory:"(no history)"},inputManager:{firstCorner:"Specify the first corner or",secondCorner:"Specify the second corner or"},message:{fetchingDrawingFile:"Fetching file ..."},progress:{start:"Start parsing file ...",parse:"Parsing file ...",font:"Downloading fonts needed by this drawing ...",ltype:"Parsing line types ...",style:"Parsing text syltes ...",dimstyle:"Parsing dimension styles ...",layer:"Parsing layers ...",vport:"Parsing viewports ...",blockrecord:"Parsing block record ...",header:"Parsing header ...",block:"Parsing blocks ...",entity:"Parsing entities ...",object:"Parsing named dictionaries ...",end:"Finished!"}},Eb={ACAD:{circle:"",csvg:"SVG",log:"",open:"",pan:"",pickbox:"",qnew:"",regen:"",select:"",zoom:"",zoomw:""},USER:{}},Tb={circle:{center:"",radius:""},sysvar:{prompt:""}},Ib={commandLine:{noLast:"()",unknownCommand:"",executed:"",showHistory:"",placeholder:"",showMessages:"",canceled:"**",noHistory:"()"},inputManager:{firstCorner:"",secondCorner:""},message:{fetchingDrawingFile:"..."},progress:{start:"...",parse:" ...",font:"...",ltype:"...",style:"...",dimstyle:"...",layer:"...",vport:"...",blockrecord:"BTRs...",header:"...",block:"..",entity:"...",object:"NODs...",end:""}};dn.mergeLocaleMessage("en",{command:wb,jig:Sb,main:Ab});dn.mergeLocaleMessage("zh",{command:Eb,jig:Tb,main:Ib});class Cb{constructor(e=document.body){this.container=e,this.history=[],this.historyIndex=-1,this.lastExecuted=null,this.isCmdPopupOpen=!1,this.isMsgPanelOpen=!1,this.minWidth=420,this.widthRatio=.66,this.autoCompleteIndex=-1,this.injectCSS(),this.createUI(),this.bindEvents(),this.resizeHandler(),window.addEventListener("resize",()=>this.resizeHandler()),dn.events.localeChanged.addEventListener(()=>this.refreshLocale())}get visible(){return this.cliContainer.style.display!=="none"}set visible(e){this.cliContainer.style.display=e?"block":"none"}localize(e,t){return dn.t(e,{fallback:t})}refreshLocale(){Array.from(this.msgPanel.children).forEach(e=>{var t,n,r,i;const a=e,l=a.dataset.msgKey;if(l)if(l==="main.commandLine.executed"){const c=((n=(t=a.textContent)==null?void 0:t.split(":")[1])==null?void 0:n.trim())??"";a.textContent=`${this.localize(l)}: ${c}`}else if(l==="main.commandLine.unknownCommand"){const c=((i=(r=a.textContent)==null?void 0:r.split(":")[1])==null?void 0:i.trim())??"";a.textContent=`${this.localize(l)}: ${c}`}else a.textContent=this.localize(l)}),this.input.setAttribute("data-placeholder",this.localize("main.commandLine.placeholder")),this.downBtn.title=this.localize("main.commandLine.showHistory"),this.upBtn.title=this.localize("main.commandLine.showMessages")}executeCommand(e){if(!e||!e.trim())if(this.lastExecuted)e=this.lastExecuted;else{this.printMessage(this.localize("main.commandLine.noLast","(no last command)"));return}const t=this.resolveCommand(e);if(!t){const r=this.localize("main.commandLine.unknownCommand");this.printError(`${r}: ${e}`);return}this.history.push(t.globalName),this.historyIndex=this.history.length,this.lastExecuted=t.globalName,this.printHistoryLine(e);const n=this.localize("main.commandLine.executed");this.printMessage(`${n}: ${t.localName}`),Nt.instance.sendStringToExecute(e),this.renderCommandLine("")}injectCSS(){const e=document.createElement("style");e.textContent=`
      .ml-cli-container {
        position: fixed;
        bottom: 45px;
        left: 50%;
        transform: translateX(-50%);
        font-family: "Segoe UI", Arial, sans-serif;
        font-size: 13px;
        box-sizing: border-box;
        user-select: none;
      }

      .ml-cli-bar {
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 6px;
        background: linear-gradient(#ededed, #e0e0e0);
        border: 1px solid rgba(0, 0, 0, 0.35);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        min-width: 300px;
        height: 32px;
      }

      .ml-cli-left {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(0, 0, 0, 0.06);
        padding: 4px 6px;
        border-radius: 4px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        height: 100%;
      }

      .ml-cli-term {
        width: 22px;
        height: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 3px;
        background: #fff;
        border: 1px solid rgba(0, 0, 0, 0.15);
        font-weight: 700;
        color: #222;
        font-size: 12px;
      }

      .ml-cli-down,
      .ml-cli-up {
        width: 20px;
        height: 20px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 3px;
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 20px;
        color: #222;
        padding: 0;
      }

      .ml-cli-input {
        flex: 1;
        display: flex;
        align-items: center;
        min-height: 22px;
        padding: 0 6px;
        border-radius: 3px;
        background: transparent;
        outline: none;
        border: none;
        font-family: monospace;
        color: #333;
        white-space: nowrap;
        overflow: hidden;
        line-height: normal;
      }

      .ml-cli-input[data-placeholder]:empty:before {
        content: attr(data-placeholder);
        color: #9a9a9a;
        font-weight: 400;
        display: flex;
        align-items: center;
        height: 100%;
      }

      .ml-cli-option {
        display: inline-block;
        color: #222;
        background: #f7f7f7;
        border: 1px solid rgba(0, 0, 0, 0.06);
        padding: 2px 6px;
        border-radius: 3px;
        margin: 0 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .ml-cli-option:hover {
        background: #eaeaea;
      }

      .ml-cli-cmd-popup {
        position: absolute;
        bottom: 100%;
        left: 0;
        transform: translate(0, 0);
        max-height: 220px;
        overflow-y: auto;
        background: #333;
        border: 1px solid rgba(0, 0, 0, 0.5);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
        border-radius: 4px;
        padding: 6px 0;
        color: #fff;
      }

      .ml-cli-cmd-popup .item {
        padding: 8px 14px;
        cursor: pointer;
        color: #fff;
        font-size: 14px;
      }

      .ml-cli-cmd-popup .item:hover {
        background: #444;
      }

      .ml-cli-msg-panel {
        position: absolute;
        bottom: 100%;
        left: 0;
        transform: translate(0, 0);
        max-height: 340px;
        overflow-y: auto;
        background: #333;
        border: 1px solid rgba(0, 0, 0, 0.5);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
        border-radius: 4px;
        padding: 6px 0;
        font-family: "Microsoft YaHei", Arial, sans-serif;
        color: #fff;
        font-size: 14px;
        white-space: pre-wrap;
        line-height: 1.35;
      }

      .ml-cli-history-line {
        padding: 4px 6px;
        color: #fff;
      }

      .ml-cli-msg-error {
        color: #ff5555;
      }

      .ml-cli-wrapper {
        position: relative;
        width: 100%;
      }

      .hidden {
        display: none !important;
      }

      .ml-cli-cmd-popup::-webkit-scrollbar,
      .ml-cli-msg-panel::-webkit-scrollbar {
        width: 10px;
      }

      .ml-cli-cmd-popup::-webkit-scrollbar-thumb,
      .ml-cli-msg-panel::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
      }
    `,document.head.appendChild(e)}createUI(){this.cliContainer=document.createElement("div"),this.cliContainer.className="ml-cli-container",this.wrapper=document.createElement("div"),this.wrapper.className="ml-cli-wrapper",this.cliContainer.appendChild(this.wrapper),this.bar=document.createElement("div"),this.bar.className="ml-cli-bar",this.wrapper.appendChild(this.bar),this.leftGroup=document.createElement("div"),this.leftGroup.className="ml-cli-left",this.bar.appendChild(this.leftGroup),this.termGlyph=document.createElement("div"),this.termGlyph.className="ml-cli-term",this.termGlyph.textContent=">",this.leftGroup.appendChild(this.termGlyph),this.downBtn=document.createElement("button"),this.downBtn.className="ml-cli-down",this.downBtn.title=this.localize("main.commandLine.showHistory"),this.downBtn.innerHTML="&#9662;",this.leftGroup.appendChild(this.downBtn),this.input=document.createElement("div"),this.input.className="ml-cli-input",this.input.contentEditable="true",this.input.setAttribute("spellcheck","false"),this.input.setAttribute("data-placeholder",this.localize("main.commandLine.placeholder")),this.bar.appendChild(this.input),this.upBtn=document.createElement("button"),this.upBtn.className="ml-cli-up",this.upBtn.title=this.localize("main.commandLine.showMessages"),this.upBtn.innerHTML="&#9652;",this.bar.appendChild(this.upBtn),this.cmdPopup=document.createElement("div"),this.cmdPopup.className="ml-cli-cmd-popup hidden",this.wrapper.appendChild(this.cmdPopup),this.msgPanel=document.createElement("div"),this.msgPanel.className="ml-cli-msg-panel hidden",this.wrapper.appendChild(this.msgPanel),this.container.appendChild(this.cliContainer)}bindEvents(){this.downBtn.addEventListener("click",e=>{e.stopPropagation(),this.isCmdPopupOpen=!this.isCmdPopupOpen,this.updatePopups({showCmd:this.isCmdPopupOpen,showMsg:!1}),this.isCmdPopupOpen&&this.showCommandHistoryPopup()}),this.upBtn.addEventListener("click",e=>{e.stopPropagation(),this.isMsgPanelOpen=!this.isMsgPanelOpen,this.updatePopups({showCmd:!1,showMsg:this.isMsgPanelOpen}),this.isMsgPanelOpen&&this.showMessagePanel()}),document.addEventListener("click",e=>{this.cliContainer.contains(e.target)||this.updatePopups({showCmd:!1,showMsg:!1})}),this.input.addEventListener("keydown",e=>this.handleKeyDown(e)),this.input.addEventListener("keydown",e=>this.handleArrowKeys(e)),this.input.addEventListener("input",()=>this.handleInputChange()),this.input.addEventListener("focus",()=>this.updatePopups({showCmd:!1,showMsg:!1})),this.cmdPopup.addEventListener("click",e=>{const t=e.target.closest(".item");t&&(this.setInputText(t.dataset.value||""),this.input.focus(),this.updatePopups({showCmd:!1,showMsg:!1}))})}handleKeyDown(e){if(e.key==="Enter"){e.preventDefault();const t=this.getInputText();this.executeCommand(t),this.updatePopups({showCmd:!1,showMsg:!1})}else e.key==="Escape"&&(e.preventDefault(),this.setInputText(""),this.printMessage(this.localize("main.commandLine.canceled")),this.updatePopups({showCmd:!1,showMsg:!1}))}handleArrowKeys(e){e.key==="ArrowUp"&&(e.preventDefault(),this.isCmdPopupOpen?this.navigateAutoComplete(-1):this.navigateHistory(-1)),e.key==="ArrowDown"&&(e.preventDefault(),this.isCmdPopupOpen?this.navigateAutoComplete(1):this.navigateHistory(1))}handleInputChange(){const e=this.getInputText();if(!e){this.updatePopups({showCmd:!1});return}const t=Gt.instance.searchCommandsByPrefix(e);t.length?(this.autoCompleteIndex=-1,this.cmdPopup.innerHTML="",t.forEach((n,r)=>{const i=document.createElement("div");i.className="item",i.dataset.value=n.command.globalName;const a=dn.cmdDescription(n.commandGroup,n.command.globalName);i.innerHTML=`<strong>${n.command.globalName} - ${a}</strong>`,r===this.autoCompleteIndex&&i.classList.add("selected"),this.cmdPopup.appendChild(i)}),this.updatePopups({showCmd:!0})):this.updatePopups({showCmd:!1})}navigateAutoComplete(e){const t=Array.from(this.cmdPopup.querySelectorAll(".item"));if(!t.length)return;this.autoCompleteIndex+=e,this.autoCompleteIndex<0&&(this.autoCompleteIndex=0),this.autoCompleteIndex>=t.length&&(this.autoCompleteIndex=t.length-1),t.forEach((r,i)=>{r.classList.toggle("selected",i===this.autoCompleteIndex)});const n=t[this.autoCompleteIndex];n&&this.setInputText(n.dataset.value??"")}navigateHistory(e){this.history.length&&(this.historyIndex===-1&&(this.historyIndex=this.history.length),this.historyIndex+=e,this.historyIndex<0&&(this.historyIndex=0),this.historyIndex>this.history.length&&(this.historyIndex=this.history.length),this.historyIndex>=0&&this.historyIndex<this.history.length?this.setInputText(this.history[this.historyIndex]):this.setInputText(""))}getInputText(){const e=this.input.cloneNode(!0);return e.querySelectorAll(".ml-cli-option").forEach(t=>t.remove()),e.innerText.replace(/\u00A0/g," ").trim()}setInputText(e=""){this.input.innerHTML="",e&&this.input.appendChild(document.createTextNode(e+" ")),this.setCursorToEnd()}renderCommandLine(e,t=[]){this.input.innerHTML="",e&&this.input.appendChild(document.createTextNode(e+" ")),t.forEach(n=>{const r=document.createElement("span");r.className="ml-cli-option",r.textContent=n,r.addEventListener("click",i=>{i.stopPropagation(),this.insertOption(n)}),this.input.appendChild(r),this.input.appendChild(document.createTextNode(" "))}),this.setCursorToEnd(),this.input.focus()}insertOption(e){this.input.appendChild(document.createTextNode(e+" ")),this.setCursorToEnd(),this.input.focus()}setCursorToEnd(){const e=document.createRange();e.selectNodeContents(this.input),e.collapse(!1);const t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e),this.input.scrollLeft=this.input.scrollWidth)}resolveCommand(e){const t=e.trim().split(/\s+/)[0].toUpperCase();return Gt.instance.lookupLocalCmd(t)}updatePopups({showCmd:e=!1,showMsg:t=!1}={}){this.isCmdPopupOpen=e,this.isMsgPanelOpen=t,this.cmdPopup.classList.toggle("hidden",!e),this.msgPanel.classList.toggle("hidden",!t),e&&this.positionCmdPopup(),t&&this.positionMsgPanel()}showCommandHistoryPopup(){if(this.cmdPopup.innerHTML="",this.history.length)for(let e=this.history.length-1;e>=0;e--){const t=document.createElement("div");t.className="item",t.dataset.value=this.history[e],t.textContent=this.history[e],this.cmdPopup.appendChild(t)}else{const e=document.createElement("div");e.className="item",e.textContent=this.localize("main.commandLine.noHistory"),this.cmdPopup.appendChild(e)}this.positionCmdPopup()}positionCmdPopup(){this.cmdPopup.style.left="0px",this.cmdPopup.style.width=this.bar.offsetWidth+"px"}showMessagePanel(){this.msgPanel.scrollTop=this.msgPanel.scrollHeight,this.positionMsgPanel()}positionMsgPanel(){this.msgPanel.style.width=this.bar.offsetWidth+"px"}printMessage(e,t){const n=document.createElement("div");n.className="ml-cli-history-line",n.textContent=e,t&&(n.dataset.msgKey=t),this.msgPanel.appendChild(n),this.showMessagePanel()}printError(e,t){const n=document.createElement("div");n.className="ml-cli-history-line ml-cli-msg-error",n.textContent=e,t&&(n.dataset.msgKey=t),this.msgPanel.appendChild(n),this.showMessagePanel()}printHistoryLine(e){const t=document.createElement("div");t.className="ml-cli-history-line",t.textContent="> "+e,t.dataset.msgKey="main.commandLine.executed",this.msgPanel.appendChild(t),this.showMessagePanel()}resizeHandler(){const e=Math.max(this.minWidth,window.innerWidth*this.widthRatio);this.bar.style.width=e+"px",this.positionMsgPanel(),this.positionCmdPopup()}}class kb{constructor(e){this.options=e}parse(e){const t=Number(e);return isNaN(t)||!this.options.allowNegative&&t<0||!this.options.allowZero&&t===0?null:t}}class mh{constructor(e){this.options=e}parse(e){const t=Number(e);return isNaN(t)||!this.options.allowNegative&&t<0||!this.options.allowZero&&t===0?null:t}}class Tu extends mh{}class Mb extends mh{}class Pb extends mh{constructor(e){super(e)}parse(e){const t=super.parse(e);return t==null?t:!Number.isInteger(t)||this.options.lowerLimit!==void 0&&t<this.options.lowerLimit||this.options.upperLimit!==void 0&&t>this.options.upperLimit?null:t}}class Lb{constructor(e){this.options=e}parse(e,t){const n=Number(e),r=Number(t);return isNaN(n)||isNaN(r)?null:{x:n,y:r,z:0}}}class Ob{constructor(e){this.options=e}parse(e){return!this.options.allowSpaces&&e.includes(" ")||!this.options.allowEmpty&&e.length===0||this.options.maxLength&&e.length>this.options.maxLength?null:e}}class yh{constructor(e="rect",t=8,n="green"){this._type=e,this._size=t,this._color=n,yh.injectCSS(),this._el=document.createElement("div"),this._el.classList.add("ml-marker"),this._el.style.color=n,this.applyShape(),document.body.appendChild(this._el)}get color(){return this._color}set color(e){this._color=e,this._el.style.color=e}get type(){return this._type}set type(e){this._type=e,this.applyShape()}static injectCSS(){if(document.getElementById("ml-marker-style"))return;const e=document.createElement("style");e.id="ml-marker-style",e.textContent=`
      .ml-marker {
        position: absolute;
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: 999999;
      }
      .ml-marker-circle {
        border-radius: 50%;
        border: 2px solid currentColor;
        background: transparent;
      }
      .ml-marker-rect {
        border: 2px solid currentColor;
        background: transparent;
      }
      .ml-marker-triangle {
        width: 0;
        height: 0;
        border-left: 0.5em solid transparent;
        border-right: 0.5em solid transparent;
        border-bottom: 1em solid currentColor;
        transform: translate(-50%, -100%);
      }
    `,document.head.appendChild(e)}applyShape(){switch(this._type){case"circle":this._el.classList.add("ml-marker-circle"),this._el.style.width=`${this._size}px`,this._el.style.height=`${this._size}px`;break;case"rect":this._el.classList.add("ml-marker-rect"),this._el.style.width=`${this._size}px`,this._el.style.height=`${this._size}px`;break;case"triangle":this._el.classList.add("ml-marker-triangle"),this._el.style.fontSize=`${this._size}px`;break}}setPosition(e){this._el.style.left=`${e.x}px`,this._el.style.top=`${e.y}px`}destroy(){this._el.remove()}}class Db{constructor(e){this.stack=[],this.view=e}showMarker(e,t,n,r){const i=this.view.wcs2Cwcs(e),a=new yh(t,n,r);return a.setPosition(i),this.stack.push(a),a}hideMarker(){const e=this.stack.pop();e&&e.destroy()}clear(){for(const e of this.stack)e.destroy();this.stack=[]}top(){return this.stack[this.stack.length-1]}}class Bb{constructor(e,t,n,r=!0,i=!1,a=!0){this._displayName=e,this._globalName=t??e,this._localName=n??this._globalName,this._enabled=r,this._isReadOnly=i,this._visible=a}get displayName(){return this._displayName}set displayName(e){this._isReadOnly||(this._displayName=e)}get enabled(){return this._enabled}set enabled(e){this._isReadOnly||(this._enabled=e)}get globalName(){return this._globalName}set globalName(e){this._isReadOnly||(this._globalName=e)}get isReadOnly(){return this._isReadOnly}get localName(){return this._localName}set localName(e){this._isReadOnly||(this._localName=e)}get visible(){return this._visible}set visible(e){this._isReadOnly||(this._visible=e)}}class Nb{constructor(){this._keywords=[]}add(e,t,n,r=!0,i=!0){let a,l,c;t===void 0?(a=e,l=e,c=e):n===void 0?(a=t,l=e,c=t):(a=e,l=t,c=n);const u=new Bb(a,l,c,r,!1,i);return this._keywords.push(u),u}clear(){this._keywords=[],this._defaultKeyword=void 0}toArray(){return this._keywords.slice()}get default(){return this._defaultKeyword}set default(e){if(e&&!this._keywords.includes(e))throw new Error("Default keyword must be one of the collection's keywords");this._defaultKeyword=e}getDisplayString(e=!1){return this._keywords.filter(t=>t.visible&&t.enabled).map(t=>(!e&&this._defaultKeyword,t.displayName)).join("/")}[Symbol.iterator](){let e=0;const t=this._keywords;return{next(){return e<t.length?{done:!1,value:t[e++]}:{done:!0,value:void 0}}}}findByDisplayName(e){return this._keywords.find(t=>t.displayName.toLowerCase()===e.toLowerCase())}findByGlobalName(e){return this._keywords.find(t=>t.globalName.toLowerCase()===e.toLowerCase())}get count(){return this._keywords.length}}class vh{constructor(e){this._message=e,this._appendKeywordsToMessage=!0,this._isReadOnly=!1,this._keywords=new Nb}get jig(){return this._jig}set jig(e){this._isReadOnly||(this._jig=e)}get message(){return this._message}set message(e){this._isReadOnly||(this._message=e)}get appendKeywordsToMessage(){return this._appendKeywordsToMessage}set appendKeywordsToMessage(e){this._isReadOnly||(this._appendKeywordsToMessage=e)}get isReadOnly(){return this._isReadOnly}get keywords(){return this._keywords}setMessageAndKeywords(e,t){if(this._isReadOnly)return this;const n=e.match(/^(.*?)\s*(?:\[(.*)\])?$/);if(n){const[,r,i]=n;if(this._message=r.trim(),i!==void 0){const a=i.split("/").map(l=>l.trim()).filter(l=>l.length>0);this._keywords.clear();for(const l of a){let c=t.split(/\s+/).find(u=>u.toLowerCase()===l.toLowerCase());c||(c=l),this._keywords.add(l,c)}}}return this}}class Rb extends vh{constructor(e){super(e),this._defaultValue=0,this._useDefaultValue=!1,this._allowNone=!1,this._allowArbitraryInput=!1,this._allowNegative=!1,this._allowZero=!0}get defaultValue(){return this._defaultValue}set defaultValue(e){this.isReadOnly||(this._defaultValue=e)}get useDefaultValue(){return this._useDefaultValue}set useDefaultValue(e){this.isReadOnly||(this._useDefaultValue=e)}get allowNone(){return this._allowNone}set allowNone(e){this.isReadOnly||(this._allowNone=e)}get allowArbitraryInput(){return this._allowArbitraryInput}set allowArbitraryInput(e){this.isReadOnly||(this._allowArbitraryInput=e)}get allowNegative(){return this._allowNegative}set allowNegative(e){this.isReadOnly||(this._allowNegative=e)}get allowZero(){return this._allowZero}set allowZero(e){this.isReadOnly||(this._allowZero=e)}}class Fb extends Rb{constructor(e){super(e),this._useBasePoint=!1,this._useDashedLine=!1,this._only2d=!1,this.allowNegative=!1}get basePoint(){return this._basePoint}set basePoint(e){this.isReadOnly||(e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e))}get useBasePoint(){return this._useBasePoint}set useBasePoint(e){this.isReadOnly||(this._useBasePoint=e)}get useDashedLine(){return this._useDashedLine}set useDashedLine(e){this.isReadOnly||(this._useDashedLine=e)}get only2d(){return this._only2d}set only2d(e){this.isReadOnly||(this._only2d=e)}}class Sa extends vh{constructor(e){super(e),this._useBasePoint=!1,this._useDashedLine=!1,this._allowNone=!1}get basePoint(){return this._basePoint}set basePoint(e){this.isReadOnly||(e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e))}get useBasePoint(){return this._useBasePoint}set useBasePoint(e){this.isReadOnly||(this._useBasePoint=e)}get useDashedLine(){return this._useDashedLine}set useDashedLine(e){this.isReadOnly||(this._useDashedLine=e)}get allowNone(){return this._allowNone}set allowNone(e){this.isReadOnly||(this._allowNone=e)}}class zb extends vh{constructor(e){super(e),this._allowSpaces=!0,this._allowEmpty=!1,this._defaultValue="",this._useDefaultValue=!1}get allowSpaces(){return this._allowSpaces}set allowSpaces(e){this.isReadOnly||(this._allowSpaces=e)}get allowEmpty(){return this._allowEmpty}set allowEmpty(e){this.isReadOnly||(this._allowEmpty=e)}get maxLength(){return this._maxLength}set maxLength(e){this.isReadOnly||(this._maxLength=e)}get defaultValue(){return this._defaultValue}set defaultValue(e){this.isReadOnly||(this._defaultValue=e)}get useDefaultValue(){return this._useDefaultValue}set useDefaultValue(e){this.isReadOnly||(this._useDefaultValue=e)}}class Iu{constructor(e){this.userTyped=!1,this.parent=e,this.input=document.createElement("input"),this.input.type="text",this.boundOnInput=()=>{this.userTyped=!0,this.resetValidation()},this.input.addEventListener("input",this.boundOnInput),this.parent.appendChild(this.input)}markInvalid(){this.input.classList.add("invalid")}markValid(){this.input.classList.remove("invalid")}resetValidation(){this.input.classList.remove("invalid")}get placeholder(){return this.input.placeholder}set placeholder(e){e&&(this.input.placeholder=e)}set value(e){e!==void 0&&(this.input.value=e)}get value(){return this.input.value}get focused(){return document.activeElement===this.input}focus(){this.input.focus()}select(){this.input.select()}remove(){this.input.remove()}isEventTarget(e){return e.target===this.input}dispose(){this.input.removeEventListener("input",this.boundOnInput),this.remove()}addEventListener(e,t,n){this.input.addEventListener(e,t,n)}removeEventListener(e,t,n){this.input.removeEventListener(e,t,n)}}class Ub{constructor(e){this.parent=e.parent,this.twoInputs=e.twoInputs??!0,this.boundOnInput=()=>this.handleInput(),this.boundOnKeyDown=t=>this.handleKeyDown(t),this.xInput=new Iu(this.parent),this.xInput.addEventListener("input",this.boundOnInput),this.xInput.addEventListener("keydown",this.boundOnKeyDown),this.twoInputs&&(this.yInput=new Iu(this.parent),this.yInput.addEventListener("input",this.boundOnInput),this.yInput.addEventListener("keydown",this.boundOnKeyDown)),this.validateFn=e.validate,this.onCommit=e.onCommit,this.onChange=e.onChange,this.onCancel=e.onCancel,setTimeout(()=>{this.yInput&&this.yInput.select(),this.xInput.focus(),this.xInput.select()},0)}get userTyped(){var e;return this.xInput.userTyped||!!((e=this.xInput)!=null&&e.userTyped)}get focused(){var e;return this.xInput.focused||((e=this.yInput)==null?void 0:e.focused)}focus(){this.xInput.focus()}setValue(e){this.xInput.userTyped||(this.xInput.value=e.x),this.twoInputs&&this.yInput&&!this.yInput.userTyped&&(this.yInput.value=e.y??"")}dispose(){var e;this.xInput.removeEventListener("input",this.boundOnInput),this.xInput.removeEventListener("keydown",this.boundOnKeyDown),this.xInput.dispose(),this.yInput&&(this.yInput.removeEventListener("input",this.boundOnInput),this.yInput.removeEventListener("keydown",this.boundOnKeyDown),(e=this.yInput)==null||e.dispose())}handleInput(){var e;const t=this.validate();(e=this.onChange)==null||e.call(this,t)}handleKeyDown(e){var t,n;let r=this.xInput,i=this.yInput;if(this.yInput&&this.yInput.isEventTarget(e)&&(r=this.yInput,i=this.xInput),e.key==="Enter"){const a=this.validate();a.isValid&&a.value!=null?((t=this.onCommit)==null||t.call(this,a.value),r.markValid()):r.markInvalid(),e.preventDefault(),e.stopPropagation()}else e.key==="Escape"?((n=this.onCancel)==null||n.call(this),e.preventDefault(),e.stopPropagation()):e.key==="Tab"&&(e.preventDefault(),i&&(i==null||i.focus(),i==null||i.select()))}validate(){const e=this.xInput.value.trim(),t=this.twoInputs&&this.yInput?this.yInput.value.trim():void 0;return this.validateFn({x:e,y:t})}}const ym=class Ic{constructor(e){this.visible=!1,this.disposed=!1,this.parent=e.parent??document.body,this.validateFn=e.validate,this.getDynamicValue=e.getDynamicValue,this.drawPreview=e.drawPreview,this.onCommit=e.onCommit,this.onChange=e.onChange,this.onCancel=e.onCancel,this.container=document.createElement("div"),this.container.className="ml-floating-input";const t=document.createElement("span");t.className="ml-floating-input-label",t.textContent=e.message??"",this.container.appendChild(t),this.inputs=new Ub({parent:this.container,twoInputs:e.twoInputs,validate:this.validateFn,onCancel:this.onCancel,onCommit:this.onCommit,onChange:this.onChange}),document.body.appendChild(this.container),this.boundOnMouseEnter=n=>this.handleMouseEnter(n),this.boundOnMouseLeave=()=>this.handleMouseLeave(),this.boundOnMouseMove=n=>this.handleMouseMove(n),this.boundOnClick=n=>this.handleClick(n),this.parent.addEventListener("mouseenter",this.boundOnMouseEnter),this.parent.addEventListener("mouseleave",this.boundOnMouseLeave),this.injectCSS()}injectCSS(){if(Ic.stylesInjected)return;Ic.stylesInjected=!0;const e=document.createElement("style");e.textContent=`
      .ml-floating-input {
        position: absolute;
        display: flex;
        align-items: center;
        padding: 2px 4px;
        background: #444; /* gray background for container */
        color: #fff; /* white text for message */
        border: none;
        border-radius: 4px;
        font-size: 12px;
        pointer-events: none;
        z-index: 10000;
      }
      .ml-floating-input input {
        font-size: 12px;
        padding: 2px 4px;
        margin-left: 6px;
        height: 22px;
        width: 90px; /* wider to show coordinates */
        background: #888; /* gray background for input */
        border: 1px solid #666; /* subtle border */
        border-radius: 2px;
      }
      .ml-floating-input input.invalid {
        border-color: red;
        color: red;
      }
      .ml-floating-input-label {
        white-space: nowrap;
        color: #fff; /* white label text */
      }
    `,document.head.appendChild(e)}get isVisible(){return this.visible}showAt(e){this.disposed||(this.container.style.display="flex",this.visible=!0,this.inputs.focus(),this.setPosition(e),this.parent.addEventListener("mousemove",this.boundOnMouseMove),this.parent.addEventListener("click",this.boundOnClick))}hide(){this.visible&&(this.container.style.display="none",this.visible=!1,this.removeListener())}dispose(){this.disposed||(this.disposed=!0,this.inputs.dispose(),this.removeListener(!0),this.container.remove())}setPosition(e){const t=this.parent.getBoundingClientRect(),n=this.container.getBoundingClientRect(),r={x:e.x-t.left,y:e.y-t.top};this.mousePos=r;let i=r.x+10,a=r.y+10;return i+n.width>t.right&&(i=t.right-n.width),a+n.height>t.bottom&&(a=t.bottom-n.height),i<t.left&&(i=t.left),a<t.top&&(a=t.top),this.container.style.left=`${i}px`,this.container.style.top=`${a}px`,r}removeListener(e=!1){this.parent.removeEventListener("mousemove",this.boundOnMouseMove),this.parent.removeEventListener("click",this.boundOnClick),e&&(this.parent.removeEventListener("mouseenter",this.boundOnMouseEnter),this.parent.removeEventListener("mouseleave",this.boundOnMouseLeave))}handleMouseEnter(e){this.showAt(e)}handleMouseLeave(){this.hide()}handleMouseMove(e){var t;if(!this.visible)return;const n=this.setPosition({x:e.x,y:e.y}),r=this.getDynamicValue(n.x,n.y);this.inputs.setValue(r.raw),this.inputs.focused||this.inputs.focus(),(t=this.drawPreview)==null||t.call(this,n.x,n.y)}handleClick(e){var t;if(!this.visible)return;const n=this.setPosition({x:e.x,y:e.y}),r=this.getDynamicValue(n.x,n.y);(t=this.onCommit)==null||t.call(this,r.value)}};ym.stylesInjected=!1;let Gb=ym;class Vb{constructor(e){this.container=null,this.baseLine=null,this.perpLineAtBase=null,this.perpLineAtCursor=null,this.connectorLine=null,this.labelEl=null,this.angleLabelEl=null,this.xAxisLine=null,this.angleSvg=null,this.anglePath=null,this.options={},this.view=e}get element(){return this.container}start(e,t){this.basePoint=new te(e),this.options=t||{};const n=this.options.color||"#0f0";this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.left="0",this.container.style.top="0",this.container.style.pointerEvents="none",this.container.style.zIndex="99999",document.body.appendChild(this.container),this.baseLine=document.createElement("div"),this.baseLine.style.position="fixed",this.baseLine.style.borderTop=`1px solid ${n}`,this.container.appendChild(this.baseLine);const r=()=>{const i=document.createElement("div");return i.style.position="fixed",i.style.borderTop=`1px dashed ${n}`,this.container.appendChild(i),i};this.options.showBaseLineOnly||(this.perpLineAtBase=r(),this.perpLineAtCursor=r(),this.connectorLine=r(),this.labelEl=document.createElement("div"),this.labelEl.style.position="fixed",this.labelEl.style.color=n,this.labelEl.style.fontSize="12px",this.labelEl.style.padding="2px 4px",this.labelEl.style.borderRadius="4px",this.container.appendChild(this.labelEl),this.xAxisLine=document.createElement("div"),this.xAxisLine.style.position="fixed",this.xAxisLine.style.borderTop=`1px solid ${n}`,this.container.appendChild(this.xAxisLine),this.angleSvg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.angleSvg.setAttribute("style","position:absolute; overflow:visible; pointer-events:none;"),this.anglePath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.anglePath.setAttribute("fill","none"),this.anglePath.setAttribute("stroke",n),this.anglePath.setAttribute("stroke-width","1"),this.anglePath.setAttribute("stroke-dasharray","4 4"),this.angleSvg.appendChild(this.anglePath),this.container.appendChild(this.angleSvg),this.angleLabelEl=document.createElement("div"),this.angleLabelEl.style.position="fixed",this.angleLabelEl.style.color=n,this.angleLabelEl.style.fontSize="12px",this.angleLabelEl.style.padding="2px 4px",this.angleLabelEl.style.borderRadius="4px",this.container.appendChild(this.angleLabelEl))}update(e){if(!this.container||!this.basePoint||!this.baseLine)return;const t=this.view.canvas.getBoundingClientRect(),n=this.view.wcs2Cwcs(this.basePoint),r=this.view.wcs2Cwcs(e),i=t.left,a=t.top,l=(C,E,L)=>{const O=L.x-E.x,F=L.y-E.y,B=Math.sqrt(O*O+F*F),Z=Math.atan2(F,O)*(180/Math.PI);C.style.width=`${B}px`,C.style.transformOrigin="0 0",C.style.transform=`translate(${E.x+i}px, ${E.y+a}px) rotate(${Z}deg)`};if(l(this.baseLine,n,r),this.options.showBaseLineOnly||!this.perpLineAtBase||!this.perpLineAtCursor||!this.connectorLine)return;const c=r.x-n.x,u=r.y-n.y,p=Math.sqrt(c*c+u*u);if(p===0){this.perpLineAtBase&&(this.perpLineAtBase.style.width="0px"),this.perpLineAtCursor&&(this.perpLineAtCursor.style.width="0px"),this.connectorLine&&(this.connectorLine.style.width="0px"),this.xAxisLine&&(this.xAxisLine.style.width="0px"),this.anglePath&&this.anglePath.setAttribute("d",""),this.angleLabelEl&&(this.angleLabelEl.style.display="none");return}const g=this.options.perpendicularLength??50,m=-u/p,y=c/p,A={x:n.x+m*g,y:n.y+y*g},w={x:r.x+m*g,y:r.y+y*g};if(l(this.perpLineAtBase,n,A),l(this.perpLineAtCursor,r,w),l(this.connectorLine,A,w),this.labelEl){const C=(A.x+w.x)/2+i,E=(A.y+w.y)/2+a-24,L=Math.sqrt((e.x-this.basePoint.x)**2+(e.y-this.basePoint.y)**2);this.labelEl.textContent=L.toFixed(3),this.labelEl.style.left=`${C-20}px`,this.labelEl.style.top=`${E}px`,this.labelEl.style.display=""}if(this.xAxisLine){const C={x:n.x+p,y:n.y};l(this.xAxisLine,n,C)}if(this.angleSvg&&this.anglePath&&this.angleLabelEl){const C=p,E=n.x+i,L=n.y+a,O=Math.atan2(r.y-n.y,r.x-n.x),F=O*180/Math.PI,B=O/2,Z=E-C,W=L-C,Q=C*2;this.angleSvg.style.left=`${Z}px`,this.angleSvg.style.top=`${W}px`,this.angleSvg.setAttribute("width",`${Q}`),this.angleSvg.setAttribute("height",`${Q}`),this.angleSvg.setAttribute("viewBox",`0 0 ${Q} ${Q}`);const ye=C,Se=C,ge=ye+C,Le=Se,Je=ye+C*Math.cos(O),Ge=Se+C*Math.sin(O),Ze=Math.abs(O)>Math.PI?"1":"0",Fe=O>=0?"1":"0",Xe=`M ${ge} ${Le} A ${C} ${C} 0 ${Ze} ${Fe} ${Je} ${Ge}`;this.anglePath.setAttribute("d",Xe);const ie=`${Math.abs(F).toFixed(1)}`,Ee=E+C*Math.cos(B),et=L+C*Math.sin(B);this.angleLabelEl.textContent=ie;const Me=40;this.angleLabelEl.style.left=`${Ee-Me/2}px`,this.angleLabelEl.style.top=`${et-12}px`,this.angleLabelEl.style.display=""}}dispose(){this.container&&this.container.remove(),this.container=null,this.baseLine=null,this.perpLineAtBase=null,this.perpLineAtCursor=null,this.connectorLine=null,this.labelEl=null,this.angleLabelEl=null,this.xAxisLine=null,this.angleSvg=null,this.anglePath=null}}const vm=class Cc{constructor(e){this.lastPoint=null,this.active=!1,this.view=e,this.injectCSS()}get isActive(){return this.active}injectCSS(){if(Cc.stylesInjected)return;Cc.stylesInjected=!0;const e=document.createElement("style");e.textContent=`
      .ml-jig-preview-rect {
        position: absolute;
        border: 1px dashed var(--line-color, #0f0);
        background: rgba(0, 255, 0, 0.04);
        pointer-events: none;
        z-index: 9999;
      }
      .ml-jig-preview-line {
        position: absolute;
        height: 1px;
        background: var(--line-color, #0f0);
        transform-origin: 0 0;
        pointer-events: none;
        z-index: 9999;
      }
    `,document.head.appendChild(e)}formatNumber(e,t){switch(t){case"angle":return e.toFixed(2);case"distance":case"point":default:return e.toFixed(3)}}getPoint(e){return this.getPointInternal(e)}getNumberTyped(e,t){const n=()=>({value:0,raw:{x:""}});return this.makePromise({message:e.message,twoInputs:!1,jig:e.jig,showBaseLineOnly:!1,useBasePoint:!1,handler:t,getDynamicValue:n})}getDistance(e){if(!this.lastPoint)return this.getNumberTyped(e,new Tu(e));const t=(r,i)=>{const a=this.view.cwcs2Wcs({x:r,y:i}),l=a.x-this.lastPoint.x,c=a.y-this.lastPoint.y,u=Math.sqrt(l*l+c*c);return{value:u,raw:{x:this.formatNumber(u,"distance")}}},n=new Tu(e);return this.makePromise({message:e.message,twoInputs:!1,jig:e.jig,showBaseLineOnly:!1,useBasePoint:!0,handler:n,getDynamicValue:t})}getAngle(e){const t=(r,i)=>{const a=this.view.cwcs2Wcs({x:r,y:i}),l=a.x-this.lastPoint.x,c=a.y-this.lastPoint.y,u=Math.atan2(c,l)*180/Math.PI;return{value:u,raw:{x:this.formatNumber(u,"angle")}}},n=new kb(e);return this.makePromise({message:e.message,twoInputs:!1,jig:e.jig,showBaseLineOnly:!1,useBasePoint:!0,handler:n,getDynamicValue:t})}getDouble(e){return this.getNumberTyped(e,new Mb(e))}getInteger(e){return this.getNumberTyped(e,new Pb(e))}getString(e){const t=()=>({value:"",raw:{x:""}}),n=new Ob(e);return this.makePromise({message:e.message,twoInputs:!1,jig:e.jig,showBaseLineOnly:!1,useBasePoint:!1,handler:n,getDynamicValue:t})}async getBox(){const e=dn.t("main.inputManager.firstCorner"),t=new Sa(e);t.useDashedLine=!1,t.useBasePoint=!1;const n=await this.getPoint(t),r=this.view.wcs2Cwcs(n),i=document.createElement("div");i.className="ml-jig-preview-rect",document.body.appendChild(i);const a=()=>{i.remove()},l=(g,m)=>{const y=Math.min(g,r.x),A=Math.min(m,r.y),w=Math.abs(g-r.x),C=Math.abs(m-r.y);Object.assign(i.style,{left:`${y}px`,top:`${A}px`,width:`${w}px`,height:`${C}px`})},c=dn.t("main.inputManager.secondCorner"),u=new Sa(c);u.useDashedLine=!1,u.useBasePoint=!1;const p=await this.getPointInternal(u,a,l);return new Ct().expandByPoint(n).expandByPoint(p)}getPointInternal(e,t,n){const r=(a,l)=>{const c=this.view.cwcs2Wcs({x:a,y:l});return{value:{...c,z:0},raw:{x:this.formatNumber(c.x,"point"),y:this.formatNumber(c.y,"point")}}},i=new Lb(e);return this.makePromise({message:e.message,twoInputs:!0,jig:e.jig,showBaseLineOnly:!e.useDashedLine,useBasePoint:e.useBasePoint,cleanup:t,handler:i,getDynamicValue:r,drawPreview:n})}makePromise(e){return new Promise((t,n)=>{this.active=!0;const r=m=>{const y=e.handler.parse(m.x,m.y);return{isValid:y!=null,value:y??void 0}};let i;e.disableOSnap||(i=new Db(this.view));const a=new Gb({parent:this.view.canvas,twoInputs:e.twoInputs,message:e.message,validate:r,getDynamicValue:e.getDynamicValue,drawPreview:(m,y)=>{var A;if(e.jig){const w=e.getDynamicValue(m,y);e.jig.update(w.value),e.jig.render()}if(l){const w=this.view.cwcs2Wcs({x:m,y});l==null||l.update(w)}i&&(i.hideMarker(),this.lastOSnapPoint=this.getOSnapPoint(),this.lastOSnapPoint&&i.showMarker(this.lastOSnapPoint)),(A=e.drawPreview)==null||A.call(e,m,y)},onCommit:m=>{u(m),a.mousePos&&(this.lastPoint={...this.view.cwcs2Wcs(a.mousePos),z:0})},onCancel:()=>p()});let l;this.lastPoint&&e.useBasePoint&&(l=new Vb(this.view),l.start(this.lastPoint,{color:"#0f0",showBaseLineOnly:e.showBaseLineOnly}));const c=()=>{var m,y;this.active=!1,(m=e.cleanup)==null||m.call(e),(y=e.jig)==null||y.end(),document.removeEventListener("keydown",g),i==null||i.clear(),l==null||l.dispose(),a.dispose()},u=m=>{c(),t(m)},p=()=>{c(),n(new Error("cancelled"))},g=m=>{m.key==="Escape"&&p()};document.addEventListener("keydown",g),a.showAt(this.view.curMousePos)})}getOSnapPoint(e,t=20){const n=this.view.pick(e,t);if(n.length>0){const r=Na().workingDatabase.tables.blockTable.modelSpace.getIdAt(n[0]);if(r){const i=[];r.subGetOsnapPoints(Tr.EndPoint,{...this.view.curPos,z:0},this.lastPoint,i);let a=Number.MAX_VALUE,l=-1;for(let c=0;c<i.length;++c){const u=this.view.curPos.distanceTo(i[c]);u<a&&(a=u,l=c)}if(l!=-1){const c=this.view.cwcs2Wcs({x:0,y:0}),u=this.view.cwcs2Wcs({x:t,y:0});if(a<u.x-c.x)return i[l]}}}}};vm.stylesInjected=!1;let jb=vm;class $b{constructor(e){this.events={sysVarChanged:new lt},this._view=e,this._cursorManager=new xb(e),this._inputManager=new jb(e)}get isActive(){return this._inputManager.isActive}get currentCursor(){return this._currentCursor}restoreCursor(){this._previousCursor!=null&&this.setCursor(this._previousCursor)}setCursor(e){this._cursorManager.setCursor(e),this._previousCursor=this._currentCursor,this._currentCursor=e}async getPoint(e){return await this._inputManager.getPoint(e)}async getAngle(e){return await this._inputManager.getAngle(e)}async getDistance(e){return await this._inputManager.getDistance(e)}async getString(e){return await this._inputManager.getString(e)}async getSelection(){return await this._inputManager.getBox()}}class bm{constructor(e){this.view=e}render(){this.entity&&this.view.addTransientEntity(this.entity)}end(){this.entity&&this.view.removeTransientEntity(this.entity.objectId)}}class Wb{constructor(e=[]){this.events={selectionAdded:new lt,selectionRemoved:new lt},this._ids=new Set(e)}get ids(){return Array.from(this._ids)}get count(){return this._ids.size}add(e){Array.isArray(e)?(e.forEach(t=>this._ids.add(t)),this.events.selectionAdded.dispatch({ids:e})):(this._ids.add(e),this.events.selectionAdded.dispatch({ids:[e]}))}delete(e){Array.isArray(e)?(e.forEach(t=>this._ids.delete(t)),this.events.selectionRemoved.dispatch({ids:e})):(this._ids.delete(e),this.events.selectionRemoved.dispatch({ids:[e]}))}has(e){return this._ids.has(e)}clear(){if(this._ids.size>0){const e=Array.from(this._ids);this._ids.clear(),this.events.selectionRemoved.dispatch({ids:e})}}}var hr=(s=>(s[s.SELECTION=0]="SELECTION",s[s.PAN=1]="PAN",s))(hr||{});class Hb{constructor(e){this.events={mouseMove:new lt,viewResize:new lt,hover:new lt,unhover:new lt},this._canvas=e;const t=e.getBoundingClientRect();this._bbox=new at,this._width=t.width,this._height=t.height,this._curPos=new je,this._curMousePos=new je,this._selectionSet=new Wb,this._editor=new $b(this),this._canvas.addEventListener("mousemove",n=>this.onMouseMove(n)),this._canvas.addEventListener("mousedown",n=>{n.button===1&&this._editor.setCursor(Ra.Grab)}),this._canvas.addEventListener("mouseup",n=>{n.button===1&&this._editor.restoreCursor()}),window.addEventListener("resize",this.onWindowResize.bind(this)),this._selectionBoxSize=4,this._hoverTimer=null,this._pauseTimer=null,this._hoveredObjectId=null}get editor(){return this._editor}get selectionBoxSize(){return this._selectionBoxSize}set selectionBoxSize(e){this._selectionBoxSize=e}setCursor(e){this._editor.setCursor(e)}setCalculateSizeCallback(e){this._calculateSizeCallback=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get bbox(){return this._bbox}get canvas(){return this._canvas}get aspect(){return this._width/this._height}get curPos(){return this._curPos}get curMousePos(){return this._curMousePos}get selectionSet(){return this._selectionSet}onWindowResize(){if(this._calculateSizeCallback){const{width:e,height:t}=this._calculateSizeCallback();this._width=e,this._height=t}else this._width=this._canvas.clientWidth,this._height=this._canvas.clientHeight;this.events.viewResize.dispatch({width:this._width,height:this._height})}onMouseMove(e){this._curMousePos=new je(e.clientX,e.clientY);const t=this.cwcs2Wcs(this._curMousePos);this._curPos.copy(t),this.events.mouseMove.dispatch({x:t.x,y:t.y}),this.mode==0&&(this._editor.isActive||this.startHoverTimer(t.x,t.y))}setHoveredObjectId(e){this._hoveredObjectId&&(this.events.unhover.dispatch({id:this._hoveredObjectId,x:this.curMousePos.x,y:this.curMousePos.y}),this.onUnhover(this._hoveredObjectId)),this._hoveredObjectId=e,e&&(this.startPauseTimer(e),this.onHover(e))}hoverAt(e,t){const n=this.pick({x:e,y:t});n.length>0?this.setHoveredObjectId(n[0]):(this.setHoveredObjectId(null),this.clearPauseTimer())}clearHoverTimer(){this._hoverTimer&&clearTimeout(this._hoverTimer)}clearPauseTimer(){this._pauseTimer&&clearTimeout(this._pauseTimer)}startHoverTimer(e,t){this.clearHoverTimer(),this._hoverTimer=setTimeout(()=>{this.hoverAt(e,t)},50)}startPauseTimer(e){this._pauseTimer=setTimeout(()=>{this.events.hover.dispatch({id:e,x:this.curMousePos.x,y:this.curMousePos.y})},500)}}class qb{constructor(){this._fileName="",this._docTitle="",this._isReadOnly=!0,this._database=new pb,this.docTitle="Untitled"}async openUri(e,t){this._uri=e,this._isReadOnly=t&&t.readOnly||!1,this._fileName=this.getFileNameFromUri(e);let n=!0;try{await this._database.openUri(e,t),this.docTitle=this._fileName}catch{n=!1,Fr.emit("failed-to-open-file",{fileName:e})}return n}async openDocument(e,t,n){var r;let i=!0;this._fileName=e;try{const a=(r=e.split(".").pop())==null?void 0:r.toLocaleLowerCase();await this._database.read(t,n,a=="dwg"?cr.DWG:cr.DXF),this.docTitle=this._fileName}catch(a){i=!1,Fr.emit("failed-to-open-file",{fileName:e}),console.error(a)}return i}get uri(){return this._uri}get database(){return this._database}get docTitle(){return this._docTitle}set docTitle(e){this._docTitle=e,typeof document<"u"&&(document.title=e)}get isReadOnly(){return this._isReadOnly}getFileNameFromUri(e){try{const t=new URL(e).pathname.split("/");return t[t.length-1]||""}catch(t){return console.error("Invalid URI:",t),""}}}class Cu{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}removeEventListener(e){this.listeners=this.listeners.filter(t=>t!==e)}replaceEventListener(e){this.removeEventListener(e),this.addEventListener(e)}dispatch(e,...t){for(const n of this.listeners)n.call(null,e,...t)}}class Yb{constructor(){this.cache=new Map}hasGeometry(e,t){const n=this.generateKey(e,t);return this.cache.has(n)}getGeometry(e,t){const n=this.generateKey(e,t);if(this.cache.has(n))return this.cache.get(n)}setGeometry(e,t,n){const r=this.generateKey(e,t);this.cache.set(r,n)}dispose(){for(const e of this.cache.values())e.dispose();this.cache.clear()}generateKey(e,t){return`${e}_${t}`}}class _m{constructor(e){this.names=new Set,this.unsupportedChars={},this.encoding=e.encoding,e.alias.forEach(t=>this.names.add(t)),this.cache=new Yb}addUnsupportedChar(e){this.unsupportedChars[e]||(this.unsupportedChars[e]=0),this.unsupportedChars[e]++}}class xm extends va{constructor(){super(...arguments),this.width=0}}const kc=(s,e)=>e.some(t=>s instanceof t);let ku,Mu;function Xb(){return ku||(ku=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Zb(){return Mu||(Mu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Mc=new WeakMap,Rl=new WeakMap,il=new WeakMap;function Kb(s){const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("success",i),s.removeEventListener("error",a)},i=()=>{t(Or(s.result)),r()},a=()=>{n(s.error),r()};s.addEventListener("success",i),s.addEventListener("error",a)});return il.set(e,s),e}function Qb(s){if(Mc.has(s))return;const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",a),s.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",i),s.addEventListener("error",a),s.addEventListener("abort",a)});Mc.set(s,e)}let Pc={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Mc.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Or(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function wm(s){Pc=s(Pc)}function Jb(s){return Zb().includes(s)?function(...e){return s.apply(Lc(this),e),Or(this.request)}:function(...e){return Or(s.apply(Lc(this),e))}}function e_(s){return typeof s=="function"?Jb(s):(s instanceof IDBTransaction&&Qb(s),kc(s,Xb())?new Proxy(s,Pc):s)}function Or(s){if(s instanceof IDBRequest)return Kb(s);if(Rl.has(s))return Rl.get(s);const e=e_(s);return e!==s&&(Rl.set(s,e),il.set(e,s)),e}const Lc=s=>il.get(s);function t_(s,e,{blocked:t,upgrade:n,blocking:r,terminated:i}={}){const a=indexedDB.open(s,e),l=Or(a);return n&&a.addEventListener("upgradeneeded",c=>{n(Or(a.result),c.oldVersion,c.newVersion,Or(a.transaction),c)}),t&&a.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const n_=["get","getKey","getAll","getAllKeys","count"],s_=["put","add","delete","clear"],Fl=new Map;function Pu(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Fl.get(e))return Fl.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=s_.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||n_.includes(t)))return;const i=async function(a,...l){const c=this.transaction(a,r?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[t](...l),r&&c.done]))[0]};return Fl.set(e,i),i}wm(s=>({...s,get:(e,t,n)=>Pu(e,t)||s.get(e,t,n),has:(e,t)=>!!Pu(e,t)||s.has(e,t)}));const r_=["continue","continuePrimaryKey","advance"],Lu={},Oc=new WeakMap,Sm=new WeakMap,i_={get(s,e){if(!r_.includes(e))return s[e];let t=Lu[e];return t||(t=Lu[e]=function(...n){Oc.set(this,Sm.get(this)[e](...n))}),t}};async function*a_(...s){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...s)),!e)return;e=e;const t=new Proxy(e,i_);for(Sm.set(t,e),il.set(t,Lc(e));e;)yield t,e=await(Oc.get(t)||e.continue()),Oc.delete(t)}function Ou(s,e){return e===Symbol.asyncIterator&&kc(s,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&kc(s,[IDBIndex,IDBObjectStore])}wm(s=>({...s,get(e,t,n){return Ou(e,t)?a_:s.get(e,t,n)},has(e,t){return Ou(e,t)||s.has(e,t)}}));const Ir={fonts:"fonts"},Dc=[{version:1,stores:[{name:Ir.fonts,keyPath:"name"}]},{version:2,stores:[{name:Ir.fonts,keyPath:"name"}]}],Bc=class us{constructor(){this.isClosing=!1,typeof window<"u"&&window.addEventListener("unload",()=>{this.close()})}static get instance(){return us._instance||(us._instance=new us),us._instance}async set(e,t){await(await this.getDatabase()).put(Ir.fonts,{...t,name:e})}async get(e){return await(await this.getDatabase()).get(Ir.fonts,e)}async delete(e){await(await this.getDatabase()).delete(Ir.fonts,e)}async getAll(){return await(await this.getDatabase()).getAll(Ir.fonts)}async clear(){await(await this.getDatabase()).clear(Ir.fonts)}async has(e){return await this.get(e)!==void 0}close(){if(!this.isClosing){this.isClosing=!0;try{this.db&&(this.db.close(),this.db=void 0)}finally{this.isClosing=!1}}}async destroy(){this.close(),await indexedDB.deleteDatabase(us.DATABASE_NAME),us._instance=void 0}async getDatabase(){if(this.isClosing)throw new Error("Cannot perform operation while database is closing");return this.db?this.db:(this.db=await t_(us.DATABASE_NAME,us.DATABASE_VERSION,{upgrade:(e,t,n)=>this.handleUpgrade(e,t,n),blocked(){console.warn("Database upgrade blocked - please close other tabs using the application")},blocking(){console.warn("Database blocking newer version - closing connection"),us.instance.close()}}),this.db)}handleUpgrade(e,t,n){const r=Dc.filter(i=>i.version>t&&(!n||i.version<=n));for(const i of r)this.applySchemaVersion(e,i)}applySchemaVersion(e,t){for(const n of t.stores)e.objectStoreNames.contains(n.name)||e.createObjectStore(n.name,{keyPath:n.keyPath})}};Bc.DATABASE_NAME="mlightcad",Bc.DATABASE_VERSION=Dc[Dc.length-1].version;let zl=Bc;const Am=s=>s.split("/").pop(),Du=s=>{const e=Am(s);if(e){const t=e.lastIndexOf(".");return t===-1?e:e.substring(0,t)}return s},o_=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215,0],l_=s=>o_[s];/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var s=function(){try{var t={},n=Object.defineProperty,r=n(t,t,t)&&n}catch{}return r}(),e=function(t){if(this==null)throw TypeError();var n=String(this),r=n.length,i=t?Number(t):0;if(i!=i&&(i=0),!(i<0||i>=r)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&r>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};s?s(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();var bh=0,Em=-3;function Aa(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function c_(s,e){this.source=s,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=e,this.destLen=0,this.ltree=new Aa,this.dtree=new Aa}var Tm=new Aa,Im=new Aa,_h=new Uint8Array(30),xh=new Uint16Array(30),Cm=new Uint8Array(30),km=new Uint16Array(30),h_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bu=new Aa,ls=new Uint8Array(320);function Mm(s,e,t,n){var r,i;for(r=0;r<t;++r)s[r]=0;for(r=0;r<30-t;++r)s[r+t]=r/t|0;for(i=n,r=0;r<30;++r)e[r]=i,i+=1<<s[r]}function u_(s,e){var t;for(t=0;t<7;++t)s.table[t]=0;for(s.table[7]=24,s.table[8]=152,s.table[9]=112,t=0;t<24;++t)s.trans[t]=256+t;for(t=0;t<144;++t)s.trans[24+t]=t;for(t=0;t<8;++t)s.trans[168+t]=280+t;for(t=0;t<112;++t)s.trans[176+t]=144+t;for(t=0;t<5;++t)e.table[t]=0;for(e.table[5]=32,t=0;t<32;++t)e.trans[t]=t}var Nu=new Uint16Array(16);function Ul(s,e,t,n){var r,i;for(r=0;r<16;++r)s.table[r]=0;for(r=0;r<n;++r)s.table[e[t+r]]++;for(s.table[0]=0,i=0,r=0;r<16;++r)Nu[r]=i,i+=s.table[r];for(r=0;r<n;++r)e[t+r]&&(s.trans[Nu[e[t+r]]++]=r)}function d_(s){s.bitcount--||(s.tag=s.source[s.sourceIndex++],s.bitcount=7);var e=s.tag&1;return s.tag>>>=1,e}function ds(s,e,t){if(!e)return t;for(;s.bitcount<24;)s.tag|=s.source[s.sourceIndex++]<<s.bitcount,s.bitcount+=8;var n=s.tag&65535>>>16-e;return s.tag>>>=e,s.bitcount-=e,n+t}function Nc(s,e){for(;s.bitcount<24;)s.tag|=s.source[s.sourceIndex++]<<s.bitcount,s.bitcount+=8;var t=0,n=0,r=0,i=s.tag;do n=2*n+(i&1),i>>>=1,++r,t+=e.table[r],n-=e.table[r];while(n>=0);return s.tag=i,s.bitcount-=r,e.trans[t+n]}function p_(s,e,t){var n,r,i,a,l,c;for(n=ds(s,5,257),r=ds(s,5,1),i=ds(s,4,4),a=0;a<19;++a)ls[a]=0;for(a=0;a<i;++a){var u=ds(s,3,0);ls[h_[a]]=u}for(Ul(Bu,ls,0,19),l=0;l<n+r;){var p=Nc(s,Bu);switch(p){case 16:var g=ls[l-1];for(c=ds(s,2,3);c;--c)ls[l++]=g;break;case 17:for(c=ds(s,3,3);c;--c)ls[l++]=0;break;case 18:for(c=ds(s,7,11);c;--c)ls[l++]=0;break;default:ls[l++]=p;break}}Ul(e,ls,0,n),Ul(t,ls,n,r)}function Ru(s,e,t){for(;;){var n=Nc(s,e);if(n===256)return bh;if(n<256)s.dest[s.destLen++]=n;else{var r,i,a,l;for(n-=257,r=ds(s,_h[n],xh[n]),i=Nc(s,t),a=s.destLen-ds(s,Cm[i],km[i]),l=a;l<a+r;++l)s.dest[s.destLen++]=s.dest[l]}}}function f_(s){for(var e,t,n;s.bitcount>8;)s.sourceIndex--,s.bitcount-=8;if(e=s.source[s.sourceIndex+1],e=256*e+s.source[s.sourceIndex],t=s.source[s.sourceIndex+3],t=256*t+s.source[s.sourceIndex+2],e!==(~t&65535))return Em;for(s.sourceIndex+=4,n=e;n;--n)s.dest[s.destLen++]=s.source[s.sourceIndex++];return s.bitcount=0,bh}function g_(s,e){var t=new c_(s,e),n,r,i;do{switch(n=d_(t),r=ds(t,2,0),r){case 0:i=f_(t);break;case 1:i=Ru(t,Tm,Im);break;case 2:p_(t,t.ltree,t.dtree),i=Ru(t,t.ltree,t.dtree);break;default:i=Em}if(i!==bh)throw new Error("Data error")}while(!n);return t.destLen<t.dest.length?typeof t.dest.slice=="function"?t.dest.slice(0,t.destLen):t.dest.subarray(0,t.destLen):t.dest}u_(Tm,Im);Mm(_h,xh,4,3);Mm(Cm,km,2,1);_h[28]=0;xh[28]=258;var m_=g_;function ui(s,e,t,n,r){return Math.pow(1-r,3)*s+3*Math.pow(1-r,2)*r*e+3*(1-r)*Math.pow(r,2)*t+Math.pow(r,3)*n}function gr(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}gr.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};gr.prototype.addPoint=function(s,e){typeof s=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=s,this.x2=s),s<this.x1&&(this.x1=s),s>this.x2&&(this.x2=s)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};gr.prototype.addX=function(s){this.addPoint(s,null)};gr.prototype.addY=function(s){this.addPoint(null,s)};gr.prototype.addBezier=function(s,e,t,n,r,i,a,l){var c=[s,e],u=[t,n],p=[r,i],g=[a,l];this.addPoint(s,e),this.addPoint(a,l);for(var m=0;m<=1;m++){var y=6*c[m]-12*u[m]+6*p[m],A=-3*c[m]+9*u[m]-9*p[m]+3*g[m],w=3*u[m]-3*c[m];if(A===0){if(y===0)continue;var C=-w/y;0<C&&C<1&&(m===0&&this.addX(ui(c[m],u[m],p[m],g[m],C)),m===1&&this.addY(ui(c[m],u[m],p[m],g[m],C)));continue}var E=Math.pow(y,2)-4*w*A;if(!(E<0)){var L=(-y+Math.sqrt(E))/(2*A);0<L&&L<1&&(m===0&&this.addX(ui(c[m],u[m],p[m],g[m],L)),m===1&&this.addY(ui(c[m],u[m],p[m],g[m],L)));var O=(-y-Math.sqrt(E))/(2*A);0<O&&O<1&&(m===0&&this.addX(ui(c[m],u[m],p[m],g[m],O)),m===1&&this.addY(ui(c[m],u[m],p[m],g[m],O)))}}};gr.prototype.addQuad=function(s,e,t,n,r,i){var a=s+.6666666666666666*(t-s),l=e+2/3*(n-e),c=a+1/3*(r-s),u=l+1/3*(i-e);this.addBezier(s,e,a,l,c,u,r,i)};function zt(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}zt.prototype.moveTo=function(s,e){this.commands.push({type:"M",x:s,y:e})};zt.prototype.lineTo=function(s,e){this.commands.push({type:"L",x:s,y:e})};zt.prototype.curveTo=zt.prototype.bezierCurveTo=function(s,e,t,n,r,i){this.commands.push({type:"C",x1:s,y1:e,x2:t,y2:n,x:r,y:i})};zt.prototype.quadTo=zt.prototype.quadraticCurveTo=function(s,e,t,n){this.commands.push({type:"Q",x1:s,y1:e,x:t,y:n})};zt.prototype.close=zt.prototype.closePath=function(){this.commands.push({type:"Z"})};zt.prototype.extend=function(s){if(s.commands)s=s.commands;else if(s instanceof gr){var e=s;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,s)};zt.prototype.getBoundingBox=function(){for(var s=new gr,e=0,t=0,n=0,r=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":s.addPoint(a.x,a.y),e=n=a.x,t=r=a.y;break;case"L":s.addPoint(a.x,a.y),n=a.x,r=a.y;break;case"Q":s.addQuad(n,r,a.x1,a.y1,a.x,a.y),n=a.x,r=a.y;break;case"C":s.addBezier(n,r,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,r=a.y;break;case"Z":n=e,r=t;break;default:throw new Error("Unexpected path command "+a.type)}}return s.isEmpty()&&s.addPoint(0,0),s};zt.prototype.draw=function(s){s.beginPath();for(var e=0;e<this.commands.length;e+=1){var t=this.commands[e];t.type==="M"?s.moveTo(t.x,t.y):t.type==="L"?s.lineTo(t.x,t.y):t.type==="C"?s.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y):t.type==="Q"?s.quadraticCurveTo(t.x1,t.y1,t.x,t.y):t.type==="Z"&&s.closePath()}this.fill&&(s.fillStyle=this.fill,s.fill()),this.stroke&&(s.strokeStyle=this.stroke,s.lineWidth=this.strokeWidth,s.stroke())};zt.prototype.toPathData=function(s){s=s!==void 0?s:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(s)}function t(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var u=a[c];u>=0&&c>0&&(l+=" "),l+=e(u)}return l}for(var n="",r=0;r<this.commands.length;r+=1){var i=this.commands[r];i.type==="M"?n+="M"+t(i.x,i.y):i.type==="L"?n+="L"+t(i.x,i.y):i.type==="C"?n+="C"+t(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+t(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};zt.prototype.toSVG=function(s){var e='<path d="';return e+=this.toPathData(s),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};zt.prototype.toDOMElement=function(s){var e=this.toPathData(s),t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t};function Pm(s){throw new Error(s)}function Fu(s,e){s||Pm(e)}var Ne={fail:Pm,argument:Fu,assert:Fu},zu=32768,Uu=2147483648,Mi={},pe={},Ue={};function es(s){return function(){return s}}pe.BYTE=function(s){return Ne.argument(s>=0&&s<=255,"Byte value should be between 0 and 255."),[s]};Ue.BYTE=es(1);pe.CHAR=function(s){return[s.charCodeAt(0)]};Ue.CHAR=es(1);pe.CHARARRAY=function(s){typeof s>"u"&&(s="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],t=0;t<s.length;t+=1)e[t]=s.charCodeAt(t);return e};Ue.CHARARRAY=function(s){return typeof s>"u"?0:s.length};pe.USHORT=function(s){return[s>>8&255,s&255]};Ue.USHORT=es(2);pe.SHORT=function(s){return s>=zu&&(s=-(2*zu-s)),[s>>8&255,s&255]};Ue.SHORT=es(2);pe.UINT24=function(s){return[s>>16&255,s>>8&255,s&255]};Ue.UINT24=es(3);pe.ULONG=function(s){return[s>>24&255,s>>16&255,s>>8&255,s&255]};Ue.ULONG=es(4);pe.LONG=function(s){return s>=Uu&&(s=-(2*Uu-s)),[s>>24&255,s>>16&255,s>>8&255,s&255]};Ue.LONG=es(4);pe.FIXED=pe.ULONG;Ue.FIXED=Ue.ULONG;pe.FWORD=pe.SHORT;Ue.FWORD=Ue.SHORT;pe.UFWORD=pe.USHORT;Ue.UFWORD=Ue.USHORT;pe.LONGDATETIME=function(s){return[0,0,0,0,s>>24&255,s>>16&255,s>>8&255,s&255]};Ue.LONGDATETIME=es(8);pe.TAG=function(s){return Ne.argument(s.length===4,"Tag should be exactly 4 ASCII characters."),[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]};Ue.TAG=es(4);pe.Card8=pe.BYTE;Ue.Card8=Ue.BYTE;pe.Card16=pe.USHORT;Ue.Card16=Ue.USHORT;pe.OffSize=pe.BYTE;Ue.OffSize=Ue.BYTE;pe.SID=pe.USHORT;Ue.SID=Ue.USHORT;pe.NUMBER=function(s){return s>=-107&&s<=107?[s+139]:s>=108&&s<=1131?(s=s-108,[(s>>8)+247,s&255]):s>=-1131&&s<=-108?(s=-s-108,[(s>>8)+251,s&255]):s>=-32768&&s<=32767?pe.NUMBER16(s):pe.NUMBER32(s)};Ue.NUMBER=function(s){return pe.NUMBER(s).length};pe.NUMBER16=function(s){return[28,s>>8&255,s&255]};Ue.NUMBER16=es(3);pe.NUMBER32=function(s){return[29,s>>24&255,s>>16&255,s>>8&255,s&255]};Ue.NUMBER32=es(5);pe.REAL=function(s){var e=s.toString(),t=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(t){var n=parseFloat("1e"+((t[2]?+t[2]:0)+t[1].length));e=(Math.round(s*n)/n).toString()}for(var r="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?r+=e[++i]==="-"?"c":"b":l==="."?r+="a":l==="-"?r+="e":r+=l}r+=r.length&1?"f":"ff";for(var c=[30],u=0,p=r.length;u<p;u+=2)c.push(parseInt(r.substr(u,2),16));return c};Ue.REAL=function(s){return pe.REAL(s).length};pe.NAME=pe.CHARARRAY;Ue.NAME=Ue.CHARARRAY;pe.STRING=pe.CHARARRAY;Ue.STRING=Ue.CHARARRAY;Mi.UTF8=function(s,e,t){for(var n=[],r=t,i=0;i<r;i++,e+=1)n[i]=s.getUint8(e);return String.fromCharCode.apply(null,n)};Mi.UTF16=function(s,e,t){for(var n=[],r=t/2,i=0;i<r;i++,e+=2)n[i]=s.getUint16(e);return String.fromCharCode.apply(null,n)};pe.UTF16=function(s){for(var e=[],t=0;t<s.length;t+=1){var n=s.charCodeAt(t);e[e.length]=n>>8&255,e[e.length]=n&255}return e};Ue.UTF16=function(s){return s.length*2};var Rc={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Mi.MACSTRING=function(s,e,t,n){var r=Rc[n];if(r!==void 0){for(var i="",a=0;a<t;a++){var l=s.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=r[l&127]}return i}};var mo=typeof WeakMap=="function"&&new WeakMap,yo,y_=function(s){if(!yo){yo={};for(var e in Rc)yo[e]=new String(e)}var t=yo[s];if(t!==void 0){if(mo){var n=mo.get(t);if(n!==void 0)return n}var r=Rc[s];if(r!==void 0){for(var i={},a=0;a<r.length;a++)i[r.charCodeAt(a)]=a+128;return mo&&mo.set(t,i),i}}};pe.MACSTRING=function(s,e){var t=y_(e);if(t!==void 0){for(var n=[],r=0;r<s.length;r++){var i=s.charCodeAt(r);if(i>=128&&(i=t[i],i===void 0))return;n[r]=i}return n}};Ue.MACSTRING=function(s,e){var t=pe.MACSTRING(s,e);return t!==void 0?t.length:0};function Fc(s){return s>=-128&&s<=127}function v_(s,e,t){for(var n=0,r=s.length;e<r&&n<64&&s[e]===0;)++e,++n;return t.push(128|n-1),e}function b_(s,e,t){for(var n=0,r=s.length,i=e;i<r&&n<64;){var a=s[i];if(!Fc(a)||a===0&&i+1<r&&s[i+1]===0)break;++i,++n}t.push(n-1);for(var l=e;l<i;++l)t.push(s[l]+256&255);return i}function __(s,e,t){for(var n=0,r=s.length,i=e;i<r&&n<64;){var a=s[i];if(a===0||Fc(a)&&i+1<r&&Fc(s[i+1]))break;++i,++n}t.push(64|n-1);for(var l=e;l<i;++l){var c=s[l];t.push(c+65536>>8&255,c+256&255)}return i}pe.VARDELTAS=function(s){for(var e=0,t=[];e<s.length;){var n=s[e];n===0?e=v_(s,e,t):n>=-128&&n<=127?e=b_(s,e,t):e=__(s,e,t)}return t};pe.INDEX=function(s){for(var e=1,t=[e],n=[],r=0;r<s.length;r+=1){var i=pe.OBJECT(s[r]);Array.prototype.push.apply(n,i),e+=i.length,t.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,pe.BYTE,pe.USHORT,pe.UINT24,pe.ULONG][l],u=0;u<t.length;u+=1){var p=c(t[u]);Array.prototype.push.apply(a,p)}return Array.prototype.concat(pe.Card16(s.length),pe.OffSize(l),a,n)};Ue.INDEX=function(s){return pe.INDEX(s).length};pe.DICT=function(s){for(var e=[],t=Object.keys(s),n=t.length,r=0;r<n;r+=1){var i=parseInt(t[r],0),a=s[i];e=e.concat(pe.OPERAND(a.value,a.type)),e=e.concat(pe.OPERATOR(i))}return e};Ue.DICT=function(s){return pe.DICT(s).length};pe.OPERATOR=function(s){return s<1200?[s]:[12,s-1200]};pe.OPERAND=function(s,e){var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)Ne.argument(s.length===e.length,"Not enough arguments given for type"+e),t=t.concat(pe.OPERAND(s[n],e[n]));else if(e==="SID")t=t.concat(pe.NUMBER(s));else if(e==="offset")t=t.concat(pe.NUMBER32(s));else if(e==="number")t=t.concat(pe.NUMBER(s));else if(e==="real")t=t.concat(pe.REAL(s));else throw new Error("Unknown operand type "+e);return t};pe.OP=pe.BYTE;Ue.OP=Ue.BYTE;var vo=typeof WeakMap=="function"&&new WeakMap;pe.CHARSTRING=function(s){if(vo){var e=vo.get(s);if(e!==void 0)return e}for(var t=[],n=s.length,r=0;r<n;r+=1){var i=s[r];t=t.concat(pe[i.type](i.value))}return vo&&vo.set(s,t),t};Ue.CHARSTRING=function(s){return pe.CHARSTRING(s).length};pe.OBJECT=function(s){var e=pe[s.type];return Ne.argument(e!==void 0,"No encoding function for type "+s.type),e(s.value)};Ue.OBJECT=function(s){var e=Ue[s.type];return Ne.argument(e!==void 0,"No sizeOf function for type "+s.type),e(s.value)};pe.TABLE=function(s){for(var e=[],t=s.fields.length,n=[],r=[],i=0;i<t;i+=1){var a=s.fields[i],l=pe[a.type];Ne.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=s[a.name];c===void 0&&(c=a.value);var u=l(c);a.type==="TABLE"?(r.push(e.length),e=e.concat([0,0]),n.push(u)):e=e.concat(u)}for(var p=0;p<n.length;p+=1){var g=r[p],m=e.length;Ne.argument(m<65536,"Table "+s.tableName+" too big."),e[g]=m>>8,e[g+1]=m&255,e=e.concat(n[p])}return e};Ue.TABLE=function(s){for(var e=0,t=s.fields.length,n=0;n<t;n+=1){var r=s.fields[n],i=Ue[r.type];Ne.argument(i!==void 0,"No sizeOf function for field type "+r.type+" ("+r.name+")");var a=s[r.name];a===void 0&&(a=r.value),e+=i(a),r.type==="TABLE"&&(e+=2)}return e};pe.RECORD=pe.TABLE;Ue.RECORD=Ue.TABLE;pe.LITERAL=function(s){return s};Ue.LITERAL=function(s){return s.length};function Vt(s,e,t){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var r=e[n];this[r.name]=r.value}if(this.tableName=s,this.fields=e,t)for(var i=Object.keys(t),a=0;a<i.length;a+=1){var l=i[a],c=t[l];this[l]!==void 0&&(this[l]=c)}}Vt.prototype.encode=function(){return pe.TABLE(this)};Vt.prototype.sizeOf=function(){return Ue.TABLE(this)};function Ea(s,e,t){t===void 0&&(t=e.length);var n=new Array(e.length+1);n[0]={name:s+"Count",type:"USHORT",value:t};for(var r=0;r<e.length;r++)n[r+1]={name:s+r,type:"USHORT",value:e[r]};return n}function zc(s,e,t){var n=e.length,r=new Array(n+1);r[0]={name:s+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)r[i+1]={name:s+i,type:"TABLE",value:t(e[i],i)};return r}function Ta(s,e,t){var n=e.length,r=[];r[0]={name:s+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)r=r.concat(t(e[i],i));return r}function Wo(s){s.format===1?Vt.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Ea("glyph",s.glyphs))):s.format===2?Vt.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Ta("rangeRecord",s.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):Ne.assert(!1,"Coverage format must be 1 or 2.")}Wo.prototype=Object.create(Vt.prototype);Wo.prototype.constructor=Wo;function Ho(s){Vt.call(this,"scriptListTable",Ta("scriptRecord",s,function(e,t){var n=e.script,r=n.defaultLangSys;return Ne.assert(!!r,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new Vt("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Vt("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(Ea("featureIndex",r.featureIndexes)))}].concat(Ta("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new Vt("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(Ea("featureIndex",l.featureIndexes)))}]})))}]}))}Ho.prototype=Object.create(Vt.prototype);Ho.prototype.constructor=Ho;function qo(s){Vt.call(this,"featureListTable",Ta("featureRecord",s,function(e,t){var n=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new Vt("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Ea("lookupListIndex",n.lookupListIndexes)))}]}))}qo.prototype=Object.create(Vt.prototype);qo.prototype.constructor=qo;function Yo(s,e){Vt.call(this,"lookupListTable",zc("lookup",s,function(t){var n=e[t.lookupType];return Ne.assert(!!n,"Unable to write GSUB lookup type "+t.lookupType+" tables."),new Vt("lookupTable",[{name:"lookupType",type:"USHORT",value:t.lookupType},{name:"lookupFlag",type:"USHORT",value:t.lookupFlag}].concat(zc("subtable",t.subtables,n)))}))}Yo.prototype=Object.create(Vt.prototype);Yo.prototype.constructor=Yo;var fe={Table:Vt,Record:Vt,Coverage:Wo,ScriptList:Ho,FeatureList:qo,LookupList:Yo,ushortList:Ea,tableList:zc,recordList:Ta};function Gu(s,e){return s.getUint8(e)}function Xo(s,e){return s.getUint16(e,!1)}function x_(s,e){return s.getInt16(e,!1)}function wh(s,e){return s.getUint32(e,!1)}function Lm(s,e){var t=s.getInt16(e,!1),n=s.getUint16(e+2,!1);return t+n/65535}function w_(s,e){for(var t="",n=e;n<e+4;n+=1)t+=String.fromCharCode(s.getInt8(n));return t}function S_(s,e,t){for(var n=0,r=0;r<t;r+=1)n<<=8,n+=s.getUint8(e+r);return n}function A_(s,e,t){for(var n=[],r=e;r<t;r+=1)n.push(s.getUint8(r));return n}function E_(s){for(var e="",t=0;t<s.length;t+=1)e+=String.fromCharCode(s[t]);return e}var T_={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function q(s,e){this.data=s,this.offset=e,this.relativeOffset=0}q.prototype.parseByte=function(){var s=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,s};q.prototype.parseChar=function(){var s=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,s};q.prototype.parseCard8=q.prototype.parseByte;q.prototype.parseUShort=function(){var s=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,s};q.prototype.parseCard16=q.prototype.parseUShort;q.prototype.parseSID=q.prototype.parseUShort;q.prototype.parseOffset16=q.prototype.parseUShort;q.prototype.parseShort=function(){var s=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,s};q.prototype.parseF2Dot14=function(){var s=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,s};q.prototype.parseULong=function(){var s=wh(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,s};q.prototype.parseOffset32=q.prototype.parseULong;q.prototype.parseFixed=function(){var s=Lm(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,s};q.prototype.parseString=function(s){var e=this.data,t=this.offset+this.relativeOffset,n="";this.relativeOffset+=s;for(var r=0;r<s;r++)n+=String.fromCharCode(e.getUint8(t+r));return n};q.prototype.parseTag=function(){return this.parseString(4)};q.prototype.parseLongDateTime=function(){var s=wh(this.data,this.offset+this.relativeOffset+4);return s-=2082844800,this.relativeOffset+=8,s};q.prototype.parseVersion=function(s){var e=Xo(this.data,this.offset+this.relativeOffset),t=Xo(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,s===void 0&&(s=4096),e+t/s/10};q.prototype.skip=function(s,e){e===void 0&&(e=1),this.relativeOffset+=T_[s]*e};q.prototype.parseULongList=function(s){s===void 0&&(s=this.parseULong());for(var e=new Array(s),t=this.data,n=this.offset+this.relativeOffset,r=0;r<s;r++)e[r]=t.getUint32(n),n+=4;return this.relativeOffset+=s*4,e};q.prototype.parseOffset16List=q.prototype.parseUShortList=function(s){s===void 0&&(s=this.parseUShort());for(var e=new Array(s),t=this.data,n=this.offset+this.relativeOffset,r=0;r<s;r++)e[r]=t.getUint16(n),n+=2;return this.relativeOffset+=s*2,e};q.prototype.parseShortList=function(s){for(var e=new Array(s),t=this.data,n=this.offset+this.relativeOffset,r=0;r<s;r++)e[r]=t.getInt16(n),n+=2;return this.relativeOffset+=s*2,e};q.prototype.parseByteList=function(s){for(var e=new Array(s),t=this.data,n=this.offset+this.relativeOffset,r=0;r<s;r++)e[r]=t.getUint8(n++);return this.relativeOffset+=s,e};q.prototype.parseList=function(s,e){e||(e=s,s=this.parseUShort());for(var t=new Array(s),n=0;n<s;n++)t[n]=e.call(this);return t};q.prototype.parseList32=function(s,e){e||(e=s,s=this.parseULong());for(var t=new Array(s),n=0;n<s;n++)t[n]=e.call(this);return t};q.prototype.parseRecordList=function(s,e){e||(e=s,s=this.parseUShort());for(var t=new Array(s),n=Object.keys(e),r=0;r<s;r++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}t[r]=i}return t};q.prototype.parseRecordList32=function(s,e){e||(e=s,s=this.parseULong());for(var t=new Array(s),n=Object.keys(e),r=0;r<s;r++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}t[r]=i}return t};q.prototype.parseStruct=function(s){if(typeof s=="function")return s.call(this);for(var e=Object.keys(s),t={},n=0;n<e.length;n++){var r=e[n],i=s[r];t[r]=i.call(this)}return t};q.prototype.parseValueRecord=function(s){if(s===void 0&&(s=this.parseUShort()),s!==0){var e={};return s&1&&(e.xPlacement=this.parseShort()),s&2&&(e.yPlacement=this.parseShort()),s&4&&(e.xAdvance=this.parseShort()),s&8&&(e.yAdvance=this.parseShort()),s&16&&(e.xPlaDevice=void 0,this.parseShort()),s&32&&(e.yPlaDevice=void 0,this.parseShort()),s&64&&(e.xAdvDevice=void 0,this.parseShort()),s&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};q.prototype.parseValueRecordList=function(){for(var s=this.parseUShort(),e=this.parseUShort(),t=new Array(e),n=0;n<e;n++)t[n]=this.parseValueRecord(s);return t};q.prototype.parsePointer=function(s){var e=this.parseOffset16();if(e>0)return new q(this.data,this.offset+e).parseStruct(s)};q.prototype.parsePointer32=function(s){var e=this.parseOffset32();if(e>0)return new q(this.data,this.offset+e).parseStruct(s)};q.prototype.parseListOfLists=function(s){for(var e=this.parseOffset16List(),t=e.length,n=this.relativeOffset,r=new Array(t),i=0;i<t;i++){var a=e[i];if(a===0){r[i]=void 0;continue}if(this.relativeOffset=a,s){for(var l=this.parseOffset16List(),c=new Array(l.length),u=0;u<l.length;u++)this.relativeOffset=a+l[u],c[u]=s.call(this);r[i]=c}else r[i]=this.parseUShortList()}return this.relativeOffset=n,r};q.prototype.parseCoverage=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort(),t=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(t)};if(e===2){for(var n=new Array(t),r=0;r<t;r++)n[r]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+s.toString(16)+": Coverage format must be 1 or 2.")};q.prototype.parseClassDef=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:q.uShort,end:q.uShort,classId:q.uShort})};throw new Error("0x"+s.toString(16)+": ClassDef format must be 1 or 2.")};q.list=function(s,e){return function(){return this.parseList(s,e)}};q.list32=function(s,e){return function(){return this.parseList32(s,e)}};q.recordList=function(s,e){return function(){return this.parseRecordList(s,e)}};q.recordList32=function(s,e){return function(){return this.parseRecordList32(s,e)}};q.pointer=function(s){return function(){return this.parsePointer(s)}};q.pointer32=function(s){return function(){return this.parsePointer32(s)}};q.tag=q.prototype.parseTag;q.byte=q.prototype.parseByte;q.uShort=q.offset16=q.prototype.parseUShort;q.uShortList=q.prototype.parseUShortList;q.uLong=q.offset32=q.prototype.parseULong;q.uLongList=q.prototype.parseULongList;q.struct=q.prototype.parseStruct;q.coverage=q.prototype.parseCoverage;q.classDef=q.prototype.parseClassDef;var Vu={reserved:q.uShort,reqFeatureIndex:q.uShort,featureIndexes:q.uShortList};q.prototype.parseScriptList=function(){return this.parsePointer(q.recordList({tag:q.tag,script:q.pointer({defaultLangSys:q.pointer(Vu),langSysRecords:q.recordList({tag:q.tag,langSys:q.pointer(Vu)})})}))||[]};q.prototype.parseFeatureList=function(){return this.parsePointer(q.recordList({tag:q.tag,feature:q.pointer({featureParams:q.offset16,lookupListIndexes:q.uShortList})}))||[]};q.prototype.parseLookupList=function(s){return this.parsePointer(q.list(q.pointer(function(){var e=this.parseUShort();Ne.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var t=this.parseUShort(),n=t&16;return{lookupType:e,lookupFlag:t,subtables:this.parseList(q.pointer(s[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};q.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var s=this.parseUShort(),e=this.parseUShort();Ne.argument(s===1&&e<1,"GPOS/GSUB feature variations table unknown.");var t=this.parseRecordList32({conditionSetOffset:q.offset32,featureTableSubstitutionOffset:q.offset32});return t})||[]};var _e={getByte:Gu,getCard8:Gu,getUShort:Xo,getCard16:Xo,getShort:x_,getULong:wh,getFixed:Lm,getTag:w_,getOffset:S_,getBytes:A_,bytesToString:E_,Parser:q};function I_(s,e){e.parseUShort(),s.length=e.parseULong(),s.language=e.parseULong();var t;s.groupCount=t=e.parseULong(),s.glyphIndexMap={};for(var n=0;n<t;n+=1)for(var r=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=r;l<=i;l+=1)s.glyphIndexMap[l]=a,a++}function C_(s,e,t,n,r){s.length=e.parseUShort(),s.language=e.parseUShort();var i;s.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),s.glyphIndexMap={};for(var a=new _e.Parser(t,n+r+14),l=new _e.Parser(t,n+r+16+i*2),c=new _e.Parser(t,n+r+16+i*4),u=new _e.Parser(t,n+r+16+i*6),p=n+r+16+i*8,g=0;g<i-1;g+=1)for(var m=void 0,y=a.parseUShort(),A=l.parseUShort(),w=c.parseShort(),C=u.parseUShort(),E=A;E<=y;E+=1)C!==0?(p=u.offset+u.relativeOffset-2,p+=C,p+=(E-A)*2,m=_e.getUShort(t,p),m!==0&&(m=m+w&65535)):m=E+w&65535,s.glyphIndexMap[E]=m}function k_(s,e){var t={};t.version=_e.getUShort(s,e),Ne.argument(t.version===0,"cmap table version should be 0."),t.numTables=_e.getUShort(s,e+2);for(var n=-1,r=t.numTables-1;r>=0;r-=1){var i=_e.getUShort(s,e+4+r*8),a=_e.getUShort(s,e+4+r*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=_e.getULong(s,e+4+r*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new _e.Parser(s,e+n);if(t.format=l.parseUShort(),t.format===12)I_(t,l);else if(t.format===4)C_(t,l,s,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+t.format+").");return t}function M_(s,e,t){s.segments.push({end:e,start:e,delta:-(e-t),offset:0,glyphIndex:t})}function P_(s){s.segments.push({end:65535,start:65535,delta:1,offset:0})}function L_(s){var e=!0,t;for(t=s.length-1;t>0;t-=1){var n=s.get(t);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var r=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:20}];e||(r=r.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),r=r.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new fe.Table("cmap",r);for(i.segments=[],t=0;t<s.length;t+=1){for(var a=s.get(t),l=0;l<a.unicodes.length;l+=1)M_(i,a.unicodes[l],t);i.segments=i.segments.sort(function(L,O){return L.start-O.start})}P_(i);var c=i.segments.length,u=0,p=[],g=[],m=[],y=[],A=[],w=[];for(t=0;t<c;t+=1){var C=i.segments[t];C.end<=65535&&C.start<=65535?(p=p.concat({name:"end_"+t,type:"USHORT",value:C.end}),g=g.concat({name:"start_"+t,type:"USHORT",value:C.start}),m=m.concat({name:"idDelta_"+t,type:"SHORT",value:C.delta}),y=y.concat({name:"idRangeOffset_"+t,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(A=A.concat({name:"glyph_"+t,type:"USHORT",value:C.glyphId}))):u+=1,!e&&C.glyphIndex!==void 0&&(w=w.concat({name:"cmap12Start_"+t,type:"ULONG",value:C.start}),w=w.concat({name:"cmap12End_"+t,type:"ULONG",value:C.end}),w=w.concat({name:"cmap12Glyph_"+t,type:"ULONG",value:C.glyphIndex}))}if(i.segCountX2=(c-u)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-u)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(p),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(m),i.fields=i.fields.concat(y),i.fields=i.fields.concat(A),i.cmap4Length=14+p.length*2+2+g.length*2+m.length*2+y.length*2+A.length*2,!e){var E=16+w.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:E},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:w.length/3}]),i.fields=i.fields.concat(w)}return i}var Om={parse:k_,make:L_},Fo=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],O_=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],D_=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Cr=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Dm(s){this.font=s}Dm.prototype.charToGlyphIndex=function(s){var e=s.codePointAt(0),t=this.font.glyphs;if(t){for(var n=0;n<t.length;n+=1)for(var r=t.get(n),i=0;i<r.unicodes.length;i+=1)if(r.unicodes[i]===e)return n}return null};function Bm(s){this.cmap=s}Bm.prototype.charToGlyphIndex=function(s){return this.cmap.glyphIndexMap[s.codePointAt(0)]||0};function Zo(s,e){this.encoding=s,this.charset=e}Zo.prototype.charToGlyphIndex=function(s){var e=s.codePointAt(0),t=this.encoding[e];return this.charset.indexOf(t)};function Sh(s){switch(s.version){case 1:this.names=Cr.slice();break;case 2:this.names=new Array(s.numberOfGlyphs);for(var e=0;e<s.numberOfGlyphs;e++)s.glyphNameIndex[e]<Cr.length?this.names[e]=Cr[s.glyphNameIndex[e]]:this.names[e]=s.names[s.glyphNameIndex[e]-Cr.length];break;case 2.5:this.names=new Array(s.numberOfGlyphs);for(var t=0;t<s.numberOfGlyphs;t++)this.names[t]=Cr[t+s.glyphNameIndex[t]];break;case 3:this.names=[];break;default:this.names=[];break}}Sh.prototype.nameToGlyphIndex=function(s){return this.names.indexOf(s)};Sh.prototype.glyphIndexToName=function(s){return this.names[s]};function B_(s){for(var e,t=s.tables.cmap.glyphIndexMap,n=Object.keys(t),r=0;r<n.length;r+=1){var i=n[r],a=t[i];e=s.glyphs.get(a),e.addUnicode(parseInt(i))}for(var l=0;l<s.glyphs.length;l+=1)e=s.glyphs.get(l),s.cffEncoding?s.isCIDFont?e.name="gid"+l:e.name=s.cffEncoding.charset[l]:s.glyphNames.names&&(e.name=s.glyphNames.glyphIndexToName(l))}function N_(s){s._IndexToUnicodeMap={};for(var e=s.tables.cmap.glyphIndexMap,t=Object.keys(e),n=0;n<t.length;n+=1){var r=t[n],i=e[r];s._IndexToUnicodeMap[i]===void 0?s._IndexToUnicodeMap[i]={unicodes:[parseInt(r)]}:s._IndexToUnicodeMap[i].unicodes.push(parseInt(r))}}function R_(s,e){e.lowMemory?N_(s):B_(s)}function F_(s,e,t,n,r){s.beginPath(),s.moveTo(e,t),s.lineTo(n,r),s.stroke()}var Sr={line:F_};function z_(s,e){var t=e||new zt;return{configurable:!0,get:function(){return typeof t=="function"&&(t=t()),t},set:function(n){t=n}}}function Fn(s){this.bindConstructorValues(s)}Fn.prototype.bindConstructorValues=function(s){this.index=s.index||0,this.name=s.name||null,this.unicode=s.unicode||void 0,this.unicodes=s.unicodes||s.unicode!==void 0?[s.unicode]:[],"xMin"in s&&(this.xMin=s.xMin),"yMin"in s&&(this.yMin=s.yMin),"xMax"in s&&(this.xMax=s.xMax),"yMax"in s&&(this.yMax=s.yMax),"advanceWidth"in s&&(this.advanceWidth=s.advanceWidth),Object.defineProperty(this,"path",z_(this,s.path))};Fn.prototype.addUnicode=function(s){this.unicodes.length===0&&(this.unicode=s),this.unicodes.push(s)};Fn.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Fn.prototype.getPath=function(s,e,t,n,r){s=s!==void 0?s:0,e=e!==void 0?e:0,t=t!==void 0?t:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&r&&r.hinting&&(a=this.path&&r.hinting.exec(this,t)),a)i=r.hinting.getCommands(a),s=Math.round(s),e=Math.round(e),l=c=1;else{i=this.path.commands;var u=1/(this.path.unitsPerEm||1e3)*t;l===void 0&&(l=u),c===void 0&&(c=u)}for(var p=new zt,g=0;g<i.length;g+=1){var m=i[g];m.type==="M"?p.moveTo(s+m.x*l,e+-m.y*c):m.type==="L"?p.lineTo(s+m.x*l,e+-m.y*c):m.type==="Q"?p.quadraticCurveTo(s+m.x1*l,e+-m.y1*c,s+m.x*l,e+-m.y*c):m.type==="C"?p.curveTo(s+m.x1*l,e+-m.y1*c,s+m.x2*l,e+-m.y2*c,s+m.x*l,e+-m.y*c):m.type==="Z"&&p.closePath()}return p};Fn.prototype.getContours=function(){if(this.points===void 0)return[];for(var s=[],e=[],t=0;t<this.points.length;t+=1){var n=this.points[t];e.push(n),n.lastPointOfContour&&(s.push(e),e=[])}return Ne.argument(e.length===0,"There are still points left in the current contour."),s};Fn.prototype.getMetrics=function(){for(var s=this.path.commands,e=[],t=[],n=0;n<s.length;n+=1){var r=s[n];r.type!=="Z"&&(e.push(r.x),t.push(r.y)),(r.type==="Q"||r.type==="C")&&(e.push(r.x1),t.push(r.y1)),r.type==="C"&&(e.push(r.x2),t.push(r.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,t),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};Fn.prototype.draw=function(s,e,t,n,r){this.getPath(e,t,n,r).draw(s)};Fn.prototype.drawPoints=function(s,e,t,n){function r(g,m,y,A){s.beginPath();for(var w=0;w<g.length;w+=1)s.moveTo(m+g[w].x*A,y+g[w].y*A),s.arc(m+g[w].x*A,y+g[w].y*A,2,0,Math.PI*2,!1);s.closePath(),s.fill()}e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,u=0;u<c.commands.length;u+=1){var p=c.commands[u];p.x!==void 0&&a.push({x:p.x,y:-p.y}),p.x1!==void 0&&l.push({x:p.x1,y:-p.y1}),p.x2!==void 0&&l.push({x:p.x2,y:-p.y2})}s.fillStyle="blue",r(a,e,t,i),s.fillStyle="red",r(l,e,t,i)};Fn.prototype.drawMetrics=function(s,e,t,n){var r;e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:24,r=1/this.path.unitsPerEm*n,s.lineWidth=1,s.strokeStyle="black",Sr.line(s,e,-1e4,e,1e4),Sr.line(s,-1e4,t,1e4,t);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,u=this.advanceWidth||0;s.strokeStyle="blue",Sr.line(s,e+i*r,-1e4,e+i*r,1e4),Sr.line(s,e+l*r,-1e4,e+l*r,1e4),Sr.line(s,-1e4,t+-a*r,1e4,t+-a*r),Sr.line(s,-1e4,t+-c*r,1e4,t+-c*r),s.strokeStyle="green",Sr.line(s,e+u*r,-1e4,e+u*r,1e4)};function bo(s,e,t){Object.defineProperty(s,e,{get:function(){return s.path,s[t]},set:function(n){s[t]=n},enumerable:!0,configurable:!0})}function Ah(s,e){if(this.font=s,this.glyphs={},Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];n.path.unitsPerEm=s.unitsPerEm,this.glyphs[t]=n}this.length=e&&e.length||0}Ah.prototype.get=function(s){if(this.glyphs[s]===void 0){this.font._push(s),typeof this.glyphs[s]=="function"&&(this.glyphs[s]=this.glyphs[s]());var e=this.glyphs[s],t=this.font._IndexToUnicodeMap[s];if(t)for(var n=0;n<t.unicodes.length;n++)e.addUnicode(t.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+s:e.name=this.font.cffEncoding.charset[s]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(s)),this.glyphs[s].advanceWidth=this.font._hmtxTableData[s].advanceWidth,this.glyphs[s].leftSideBearing=this.font._hmtxTableData[s].leftSideBearing}else typeof this.glyphs[s]=="function"&&(this.glyphs[s]=this.glyphs[s]());return this.glyphs[s]};Ah.prototype.push=function(s,e){this.glyphs[s]=e,this.length++};function U_(s,e){return new Fn({index:e,font:s})}function G_(s,e,t,n,r,i){return function(){var a=new Fn({index:e,font:s});return a.path=function(){t(a,n,r);var l=i(s.glyphs,a);return l.unitsPerEm=s.unitsPerEm,l},bo(a,"xMin","_xMin"),bo(a,"xMax","_xMax"),bo(a,"yMin","_yMin"),bo(a,"yMax","_yMax"),a}}function V_(s,e,t,n){return function(){var r=new Fn({index:e,font:s});return r.path=function(){var i=t(s,r,n);return i.unitsPerEm=s.unitsPerEm,i},r}}var gs={GlyphSet:Ah,glyphLoader:U_,ttfGlyphLoader:G_,cffGlyphLoader:V_};function Nm(s,e){if(s===e)return!0;if(Array.isArray(s)&&Array.isArray(e)){if(s.length!==e.length)return!1;for(var t=0;t<s.length;t+=1)if(!Nm(s[t],e[t]))return!1;return!0}else return!1}function Uc(s){var e;return s.length<1240?e=107:s.length<33900?e=1131:e=32768,e}function tr(s,e,t){var n=[],r=[],i=_e.getCard16(s,e),a,l;if(i!==0){var c=_e.getByte(s,e+2);a=e+(i+1)*c+2;for(var u=e+3,p=0;p<i+1;p+=1)n.push(_e.getOffset(s,u,c)),u+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var m=_e.getBytes(s,a+n[g],a+n[g+1]);t&&(m=t(m)),r.push(m)}return{objects:r,startOffset:e,endOffset:l}}function j_(s,e){var t=[],n=_e.getCard16(s,e),r,i;if(n!==0){var a=_e.getByte(s,e+2);r=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)t.push(_e.getOffset(s,l,a)),l+=a;i=r+t[n]}else i=e+2;return{offsets:t,startOffset:e,endOffset:i}}function $_(s,e,t,n,r){var i=_e.getCard16(t,n),a=0;if(i!==0){var l=_e.getByte(t,n+2);a=n+(i+1)*l+2}var c=_e.getBytes(t,a+e[s],a+e[s+1]);return c}function W_(s){for(var e="",t=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=s.parseByte(),i=r>>4,a=r&15;if(i===t||(e+=n[i],a===t))break;e+=n[a]}return parseFloat(e)}function H_(s,e){var t,n,r,i;if(e===28)return t=s.parseByte(),n=s.parseByte(),t<<8|n;if(e===29)return t=s.parseByte(),n=s.parseByte(),r=s.parseByte(),i=s.parseByte(),t<<24|n<<16|r<<8|i;if(e===30)return W_(s);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return t=s.parseByte(),(e-247)*256+t+108;if(e>=251&&e<=254)return t=s.parseByte(),-(e-251)*256-t-108;throw new Error("Invalid b0 "+e)}function q_(s){for(var e={},t=0;t<s.length;t+=1){var n=s[t][0],r=s[t][1],i=void 0;if(r.length===1?i=r[0]:i=r,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Rm(s,e,t){e=e!==void 0?e:0;var n=new _e.Parser(s,e),r=[],i=[];for(t=t!==void 0?t:s.length;n.relativeOffset<t;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),r.push([a,i]),i=[]):i.push(H_(n,a))}return q_(r)}function ya(s,e){return e<=390?e=Fo[e]:e=s[e-391],e}function Fm(s,e,t){for(var n={},r,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)r=s[a.op]!==void 0?s[a.op][c]:void 0,r===void 0&&(r=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(r=ya(t,r)),l[c]=r;n[a.name]=l}else r=s[a.op],r===void 0&&(r=a.value!==void 0?a.value:null),a.type==="SID"&&(r=ya(t,r)),n[a.name]=r}return n}function Y_(s,e){var t={};return t.formatMajor=_e.getCard8(s,e),t.formatMinor=_e.getCard8(s,e+1),t.size=_e.getCard8(s,e+2),t.offsetSize=_e.getCard8(s,e+3),t.startOffset=e,t.endOffset=e+4,t}var zm=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Um=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function X_(s,e){var t=Rm(s,0,s.byteLength);return Fm(t,zm,e)}function Gm(s,e,t,n){var r=Rm(s,e,t);return Fm(r,Um,n)}function ju(s,e,t,n){for(var r=[],i=0;i<t.length;i+=1){var a=new DataView(new Uint8Array(t[i]).buffer),l=X_(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],u=l.private[1];if(c!==0&&u!==0){var p=Gm(s,u+e,c,n);if(l._defaultWidthX=p.defaultWidthX,l._nominalWidthX=p.nominalWidthX,p.subrs!==0){var g=u+p.subrs,m=tr(s,g+e);l._subrs=m.objects,l._subrsBias=Uc(l._subrs)}l._privateDict=p}r.push(l)}return r}function Z_(s,e,t,n){var r,i,a=new _e.Parser(s,e);t-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var u=0;u<t;u+=1)r=a.parseSID(),l.push(ya(n,r));else if(c===1)for(;l.length<=t;){r=a.parseSID(),i=a.parseCard8();for(var p=0;p<=i;p+=1)l.push(ya(n,r)),r+=1}else if(c===2)for(;l.length<=t;){r=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(ya(n,r)),r+=1}else throw new Error("Unknown charset format "+c);return l}function K_(s,e,t){var n,r={},i=new _e.Parser(s,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),r[n]=c;else if(a===1){var u=i.parseCard8();n=1;for(var p=0;p<u;p+=1)for(var g=i.parseCard8(),m=i.parseCard8(),y=g;y<=g+m;y+=1)r[y]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new Zo(r,t)}function $u(s,e,t){var n,r,i,a,l=new zt,c=[],u=0,p=!1,g=!1,m=0,y=0,A,w,C,E;if(s.isCIDFont){var L=s.tables.cff.topDict._fdSelect[e.index],O=s.tables.cff.topDict._fdArray[L];A=O._subrs,w=O._subrsBias,C=O._defaultWidthX,E=O._nominalWidthX}else A=s.tables.cff.topDict._subrs,w=s.tables.cff.topDict._subrsBias,C=s.tables.cff.topDict._defaultWidthX,E=s.tables.cff.topDict._nominalWidthX;var F=C;function B(Q,ye){g&&l.closePath(),l.moveTo(Q,ye),g=!0}function Z(){var Q;Q=c.length%2!==0,Q&&!p&&(F=c.shift()+E),u+=c.length>>1,c.length=0,p=!0}function W(Q){for(var ye,Se,ge,Le,Je,Ge,Ze,Fe,Xe,ie,Ee,et,Me=0;Me<Q.length;){var He=Q[Me];switch(Me+=1,He){case 1:Z();break;case 3:Z();break;case 4:c.length>1&&!p&&(F=c.shift()+E,p=!0),y+=c.pop(),B(m,y);break;case 5:for(;c.length>0;)m+=c.shift(),y+=c.shift(),l.lineTo(m,y);break;case 6:for(;c.length>0&&(m+=c.shift(),l.lineTo(m,y),c.length!==0);)y+=c.shift(),l.lineTo(m,y);break;case 7:for(;c.length>0&&(y+=c.shift(),l.lineTo(m,y),c.length!==0);)m+=c.shift(),l.lineTo(m,y);break;case 8:for(;c.length>0;)n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a+c.shift(),l.curveTo(n,r,i,a,m,y);break;case 10:Je=c.pop()+w,Ge=A[Je],Ge&&W(Ge);break;case 11:return;case 12:switch(He=Q[Me],Me+=1,He){case 35:n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),Ze=i+c.shift(),Fe=a+c.shift(),Xe=Ze+c.shift(),ie=Fe+c.shift(),Ee=Xe+c.shift(),et=ie+c.shift(),m=Ee+c.shift(),y=et+c.shift(),c.shift(),l.curveTo(n,r,i,a,Ze,Fe),l.curveTo(Xe,ie,Ee,et,m,y);break;case 34:n=m+c.shift(),r=y,i=n+c.shift(),a=r+c.shift(),Ze=i+c.shift(),Fe=a,Xe=Ze+c.shift(),ie=a,Ee=Xe+c.shift(),et=y,m=Ee+c.shift(),l.curveTo(n,r,i,a,Ze,Fe),l.curveTo(Xe,ie,Ee,et,m,y);break;case 36:n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),Ze=i+c.shift(),Fe=a,Xe=Ze+c.shift(),ie=a,Ee=Xe+c.shift(),et=ie+c.shift(),m=Ee+c.shift(),l.curveTo(n,r,i,a,Ze,Fe),l.curveTo(Xe,ie,Ee,et,m,y);break;case 37:n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),Ze=i+c.shift(),Fe=a+c.shift(),Xe=Ze+c.shift(),ie=Fe+c.shift(),Ee=Xe+c.shift(),et=ie+c.shift(),Math.abs(Ee-m)>Math.abs(et-y)?m=Ee+c.shift():y=et+c.shift(),l.curveTo(n,r,i,a,Ze,Fe),l.curveTo(Xe,ie,Ee,et,m,y);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+He),c.length=0}break;case 14:c.length>0&&!p&&(F=c.shift()+E,p=!0),g&&(l.closePath(),g=!1);break;case 18:Z();break;case 19:case 20:Z(),Me+=u+7>>3;break;case 21:c.length>2&&!p&&(F=c.shift()+E,p=!0),y+=c.pop(),m+=c.pop(),B(m,y);break;case 22:c.length>1&&!p&&(F=c.shift()+E,p=!0),m+=c.pop(),B(m,y);break;case 23:Z();break;case 24:for(;c.length>2;)n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a+c.shift(),l.curveTo(n,r,i,a,m,y);m+=c.shift(),y+=c.shift(),l.lineTo(m,y);break;case 25:for(;c.length>6;)m+=c.shift(),y+=c.shift(),l.lineTo(m,y);n=m+c.shift(),r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a+c.shift(),l.curveTo(n,r,i,a,m,y);break;case 26:for(c.length%2&&(m+=c.shift());c.length>0;)n=m,r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i,y=a+c.shift(),l.curveTo(n,r,i,a,m,y);break;case 27:for(c.length%2&&(y+=c.shift());c.length>0;)n=m+c.shift(),r=y,i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a,l.curveTo(n,r,i,a,m,y);break;case 28:ye=Q[Me],Se=Q[Me+1],c.push((ye<<24|Se<<16)>>16),Me+=2;break;case 29:Je=c.pop()+s.gsubrsBias,Ge=s.gsubrs[Je],Ge&&W(Ge);break;case 30:for(;c.length>0&&(n=m,r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a+(c.length===1?c.shift():0),l.curveTo(n,r,i,a,m,y),c.length!==0);)n=m+c.shift(),r=y,i=n+c.shift(),a=r+c.shift(),y=a+c.shift(),m=i+(c.length===1?c.shift():0),l.curveTo(n,r,i,a,m,y);break;case 31:for(;c.length>0&&(n=m+c.shift(),r=y,i=n+c.shift(),a=r+c.shift(),y=a+c.shift(),m=i+(c.length===1?c.shift():0),l.curveTo(n,r,i,a,m,y),c.length!==0);)n=m,r=y+c.shift(),i=n+c.shift(),a=r+c.shift(),m=i+c.shift(),y=a+(c.length===1?c.shift():0),l.curveTo(n,r,i,a,m,y);break;default:He<32?console.log("Glyph "+e.index+": unknown operator "+He):He<247?c.push(He-139):He<251?(ye=Q[Me],Me+=1,c.push((He-247)*256+ye+108)):He<255?(ye=Q[Me],Me+=1,c.push(-(He-251)*256-ye-108)):(ye=Q[Me],Se=Q[Me+1],ge=Q[Me+2],Le=Q[Me+3],Me+=4,c.push((ye<<24|Se<<16|ge<<8|Le)/65536))}}}return W(t),e.advanceWidth=F,l}function Q_(s,e,t,n){var r=[],i,a=new _e.Parser(s,e),l=a.parseCard8();if(l===0)for(var c=0;c<t;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");r.push(i)}else if(l===3){var u=a.parseCard16(),p=a.parseCard16();if(p!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+p);for(var g,m=0;m<u;m++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;p<g;p++)r.push(i);p=g}if(g!==t)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return r}function J_(s,e,t,n){t.tables.cff={};var r=Y_(s,e),i=tr(s,r.endOffset,_e.bytesToString),a=tr(s,i.endOffset),l=tr(s,a.endOffset,_e.bytesToString),c=tr(s,l.endOffset);t.gsubrs=c.objects,t.gsubrsBias=Uc(t.gsubrs);var u=ju(s,e,a.objects,l.objects);if(u.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+u.length);var p=u[0];if(t.tables.cff.topDict=p,p._privateDict&&(t.defaultWidthX=p._privateDict.defaultWidthX,t.nominalWidthX=p._privateDict.nominalWidthX),p.ros[0]!==void 0&&p.ros[1]!==void 0&&(t.isCIDFont=!0),t.isCIDFont){var g=p.fdArray,m=p.fdSelect;if(g===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var y=tr(s,g),A=ju(s,e,y.objects,l.objects);p._fdArray=A,m+=e,p._fdSelect=Q_(s,m,t.numGlyphs,A.length)}var w=e+p.private[1],C=Gm(s,w,p.private[0],l.objects);if(t.defaultWidthX=C.defaultWidthX,t.nominalWidthX=C.nominalWidthX,C.subrs!==0){var E=w+C.subrs,L=tr(s,E);t.subrs=L.objects,t.subrsBias=Uc(t.subrs)}else t.subrs=[],t.subrsBias=0;var O;n.lowMemory?(O=j_(s,e+p.charStrings),t.nGlyphs=O.offsets.length):(O=tr(s,e+p.charStrings),t.nGlyphs=O.objects.length);var F=Z_(s,e+p.charset,t.nGlyphs,l.objects);if(p.encoding===0?t.cffEncoding=new Zo(O_,F):p.encoding===1?t.cffEncoding=new Zo(D_,F):t.cffEncoding=K_(s,e+p.encoding,F),t.encoding=t.encoding||t.cffEncoding,t.glyphs=new gs.GlyphSet(t),n.lowMemory)t._push=function(W){var Q=$_(W,O.offsets,s,e+p.charStrings);t.glyphs.push(W,gs.cffGlyphLoader(t,W,$u,Q))};else for(var B=0;B<t.nGlyphs;B+=1){var Z=O.objects[B];t.glyphs.push(B,gs.cffGlyphLoader(t,B,$u,Z))}}function Vm(s,e){var t,n=Fo.indexOf(s);return n>=0&&(t=n),n=e.indexOf(s),n>=0?t=n+Fo.length:(t=Fo.length+e.length,e.push(s)),t}function e2(){return new fe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function t2(s){var e=new fe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var t=0;t<s.length;t+=1)e.names.push({name:"name_"+t,type:"NAME",value:s[t]});return e}function jm(s,e,t){for(var n={},r=0;r<s.length;r+=1){var i=s[r],a=e[i.name];a!==void 0&&!Nm(a,i.value)&&(i.type==="SID"&&(a=Vm(a,t)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function Wu(s,e){var t=new fe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=jm(zm,s,e),t}function Hu(s){var e=new fe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:s}],e}function n2(s){var e=new fe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var t=0;t<s.length;t+=1)e.strings.push({name:"string_"+t,type:"STRING",value:s[t]});return e}function s2(){return new fe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function r2(s,e){for(var t=new fe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<s.length;n+=1){var r=s[n],i=Vm(r,e);t.fields.push({name:"glyph_"+n,type:"SID",value:i})}return t}function i2(s){var e=[],t=s.path;e.push({name:"width",type:"NUMBER",value:s.advanceWidth});for(var n=0,r=0,i=0;i<t.commands.length;i+=1){var a=void 0,l=void 0,c=t.commands[i];if(c.type==="Q"){var u=.3333333333333333,p=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(u*n+p*c.x1),y1:Math.round(u*r+p*c.y1),x2:Math.round(u*c.x+p*c.x1),y2:Math.round(u*c.y+p*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-r),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),r=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-r),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),r=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),m=Math.round(c.y1-r),y=Math.round(c.x2-c.x1),A=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:y}),e.push({name:"dy2",type:"NUMBER",value:A}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),r=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function a2(s){for(var e=new fe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),t=0;t<s.length;t+=1){var n=s.get(t),r=i2(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:r})}return e}function o2(s,e){var t=new fe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return t.dict=jm(Um,s,e),t}function l2(s,e){for(var t=new fe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,r={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<s.length;c+=1)l=s.get(c),a.push(l.name);var u=[];t.header=e2(),t.nameIndex=t2([e.postScriptName]);var p=Wu(r,u);t.topDictIndex=Hu(p),t.globalSubrIndex=s2(),t.charsets=r2(a,u),t.charStringsIndex=a2(s),t.privateDict=o2(i,u),t.stringIndex=n2(u);var g=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();return r.charset=g,r.encoding=0,r.charStrings=r.charset+t.charsets.sizeOf(),r.private[1]=r.charStrings+t.charStringsIndex.sizeOf(),p=Wu(r,u),t.topDictIndex=Hu(p),t}var $m={parse:J_,make:l2};function c2(s,e){var t={},n=new _e.Parser(s,e);return t.version=n.parseVersion(),t.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,t.checkSumAdjustment=n.parseULong(),t.magicNumber=n.parseULong(),Ne.argument(t.magicNumber===1594834165,"Font header has wrong magic number."),t.flags=n.parseUShort(),t.unitsPerEm=n.parseUShort(),t.created=n.parseLongDateTime(),t.modified=n.parseLongDateTime(),t.xMin=n.parseShort(),t.yMin=n.parseShort(),t.xMax=n.parseShort(),t.yMax=n.parseShort(),t.macStyle=n.parseUShort(),t.lowestRecPPEM=n.parseUShort(),t.fontDirectionHint=n.parseShort(),t.indexToLocFormat=n.parseShort(),t.glyphDataFormat=n.parseShort(),t}function h2(s){var e=Math.round(new Date().getTime()/1e3)+2082844800,t=e;return s.createdTimestamp&&(t=s.createdTimestamp+2082844800),new fe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:t},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],s)}var Wm={parse:c2,make:h2};function u2(s,e){var t={},n=new _e.Parser(s,e);return t.version=n.parseVersion(),t.ascender=n.parseShort(),t.descender=n.parseShort(),t.lineGap=n.parseShort(),t.advanceWidthMax=n.parseUShort(),t.minLeftSideBearing=n.parseShort(),t.minRightSideBearing=n.parseShort(),t.xMaxExtent=n.parseShort(),t.caretSlopeRise=n.parseShort(),t.caretSlopeRun=n.parseShort(),t.caretOffset=n.parseShort(),n.relativeOffset+=8,t.metricDataFormat=n.parseShort(),t.numberOfHMetrics=n.parseUShort(),t}function d2(s){return new fe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],s)}var Hm={parse:u2,make:d2};function p2(s,e,t,n,r){for(var i,a,l=new _e.Parser(s,e),c=0;c<n;c+=1){c<t&&(i=l.parseUShort(),a=l.parseShort());var u=r.get(c);u.advanceWidth=i,u.leftSideBearing=a}}function f2(s,e,t,n,r){s._hmtxTableData={};for(var i,a,l=new _e.Parser(e,t),c=0;c<r;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),s._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function g2(s,e,t,n,r,i,a){a.lowMemory?f2(s,e,t,n,r):p2(e,t,n,r,i)}function m2(s){for(var e=new fe.Table("hmtx",[]),t=0;t<s.length;t+=1){var n=s.get(t),r=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+t,type:"USHORT",value:r}),e.fields.push({name:"leftSideBearing_"+t,type:"SHORT",value:i})}return e}var qm={parse:g2,make:m2};function y2(s){for(var e=new fe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:s.length}]),t="",n=12+s.length*4,r=0;r<s.length;++r){var i=t.indexOf(s[r]);i<0&&(i=t.length,t+=s[r]),e.fields.push({name:"offset "+r,type:"USHORT",value:n+i}),e.fields.push({name:"length "+r,type:"USHORT",value:s[r].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),e}function v2(s,e){var t=new _e.Parser(s,e),n=t.parseULong();Ne.argument(n===1,"Unsupported ltag table version."),t.skip("uLong",1);for(var r=t.parseULong(),i=[],a=0;a<r;a++){for(var l="",c=e+t.parseUShort(),u=t.parseUShort(),p=c;p<c+u;++p)l+=String.fromCharCode(s.getInt8(p));i.push(l)}return i}var Ym={make:y2,parse:v2};function b2(s,e){var t={},n=new _e.Parser(s,e);return t.version=n.parseVersion(),t.numGlyphs=n.parseUShort(),t.version===1&&(t.maxPoints=n.parseUShort(),t.maxContours=n.parseUShort(),t.maxCompositePoints=n.parseUShort(),t.maxCompositeContours=n.parseUShort(),t.maxZones=n.parseUShort(),t.maxTwilightPoints=n.parseUShort(),t.maxStorage=n.parseUShort(),t.maxFunctionDefs=n.parseUShort(),t.maxInstructionDefs=n.parseUShort(),t.maxStackElements=n.parseUShort(),t.maxSizeOfInstructions=n.parseUShort(),t.maxComponentElements=n.parseUShort(),t.maxComponentDepth=n.parseUShort()),t}function _2(s){return new fe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:s}])}var Xm={parse:b2,make:_2},Zm=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Km={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},x2={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Qm={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function w2(s,e,t){switch(s){case 0:if(e===65535)return"und";if(t)return t[e];break;case 1:return Km[e];case 3:return Qm[e]}}var Gc="utf-16",S2={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},A2={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Jm(s,e,t){switch(s){case 0:return Gc;case 1:return A2[t]||S2[e];case 3:if(e===1||e===10)return Gc;break}}function E2(s,e,t){for(var n={},r=new _e.Parser(s,e),i=r.parseUShort(),a=r.parseUShort(),l=r.offset+r.parseUShort(),c=0;c<a;c++){var u=r.parseUShort(),p=r.parseUShort(),g=r.parseUShort(),m=r.parseUShort(),y=Zm[m]||m,A=r.parseUShort(),w=r.parseUShort(),C=w2(u,g,t),E=Jm(u,p,g);if(E!==void 0&&C!==void 0){var L=void 0;if(E===Gc?L=Mi.UTF16(s,l+w,A):L=Mi.MACSTRING(s,l+w,A,E),L){var O=n[y];O===void 0&&(O=n[y]={}),O[C]=L}}}return i===1&&r.parseUShort(),n}function Gl(s){var e={};for(var t in s)e[s[t]]=parseInt(t);return e}function qu(s,e,t,n,r,i){return new fe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:s},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:t},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:r},{name:"offset",type:"USHORT",value:i}])}function T2(s,e){var t=s.length,n=e.length-t+1;e:for(var r=0;r<n;r++)for(;r<n;r++){for(var i=0;i<t;i++)if(e[r+i]!==s[i])continue e;return r}return-1}function Yu(s,e){var t=T2(s,e);if(t<0){t=e.length;for(var n=0,r=s.length;n<r;++n)e.push(s[n])}return t}function I2(s,e){var t,n=[],r={},i=Gl(Zm);for(var a in s){var l=i[a];if(l===void 0&&(l=a),t=parseInt(l),isNaN(t))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');r[t]=s[a],n.push(t)}for(var c=Gl(Km),u=Gl(Qm),p=[],g=[],m=0;m<n.length;m++){t=n[m];var y=r[t];for(var A in y){var w=y[A],C=1,E=c[A],L=x2[E],O=Jm(C,L,E),F=pe.MACSTRING(w,O);F===void 0&&(C=0,E=e.indexOf(A),E<0&&(E=e.length,e.push(A)),L=4,F=pe.UTF16(w));var B=Yu(F,g);p.push(qu(C,L,E,t,F.length,B));var Z=u[A];if(Z!==void 0){var W=pe.UTF16(w),Q=Yu(W,g);p.push(qu(3,1,Z,t,W.length,Q))}}}p.sort(function(ge,Le){return ge.platformID-Le.platformID||ge.encodingID-Le.encodingID||ge.languageID-Le.languageID||ge.nameID-Le.nameID});for(var ye=new fe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:p.length},{name:"stringOffset",type:"USHORT",value:6+p.length*12}]),Se=0;Se<p.length;Se++)ye.fields.push({name:"record_"+Se,type:"RECORD",value:p[Se]});return ye.fields.push({name:"strings",type:"LITERAL",value:g}),ye}var e0={parse:E2,make:I2},Vc=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function C2(s){for(var e=0;e<Vc.length;e+=1){var t=Vc[e];if(s>=t.begin&&s<t.end)return e}return-1}function k2(s,e){var t={},n=new _e.Parser(s,e);t.version=n.parseUShort(),t.xAvgCharWidth=n.parseShort(),t.usWeightClass=n.parseUShort(),t.usWidthClass=n.parseUShort(),t.fsType=n.parseUShort(),t.ySubscriptXSize=n.parseShort(),t.ySubscriptYSize=n.parseShort(),t.ySubscriptXOffset=n.parseShort(),t.ySubscriptYOffset=n.parseShort(),t.ySuperscriptXSize=n.parseShort(),t.ySuperscriptYSize=n.parseShort(),t.ySuperscriptXOffset=n.parseShort(),t.ySuperscriptYOffset=n.parseShort(),t.yStrikeoutSize=n.parseShort(),t.yStrikeoutPosition=n.parseShort(),t.sFamilyClass=n.parseShort(),t.panose=[];for(var r=0;r<10;r++)t.panose[r]=n.parseByte();return t.ulUnicodeRange1=n.parseULong(),t.ulUnicodeRange2=n.parseULong(),t.ulUnicodeRange3=n.parseULong(),t.ulUnicodeRange4=n.parseULong(),t.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),t.fsSelection=n.parseUShort(),t.usFirstCharIndex=n.parseUShort(),t.usLastCharIndex=n.parseUShort(),t.sTypoAscender=n.parseShort(),t.sTypoDescender=n.parseShort(),t.sTypoLineGap=n.parseShort(),t.usWinAscent=n.parseUShort(),t.usWinDescent=n.parseUShort(),t.version>=1&&(t.ulCodePageRange1=n.parseULong(),t.ulCodePageRange2=n.parseULong()),t.version>=2&&(t.sxHeight=n.parseShort(),t.sCapHeight=n.parseShort(),t.usDefaultChar=n.parseUShort(),t.usBreakChar=n.parseUShort(),t.usMaxContent=n.parseUShort()),t}function M2(s){return new fe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],s)}var jc={parse:k2,make:M2,unicodeRanges:Vc,getUnicodeRange:C2};function P2(s,e){var t={},n=new _e.Parser(s,e);switch(t.version=n.parseVersion(),t.italicAngle=n.parseFixed(),t.underlinePosition=n.parseShort(),t.underlineThickness=n.parseShort(),t.isFixedPitch=n.parseULong(),t.minMemType42=n.parseULong(),t.maxMemType42=n.parseULong(),t.minMemType1=n.parseULong(),t.maxMemType1=n.parseULong(),t.version){case 1:t.names=Cr.slice();break;case 2:t.numberOfGlyphs=n.parseUShort(),t.glyphNameIndex=new Array(t.numberOfGlyphs);for(var r=0;r<t.numberOfGlyphs;r++)t.glyphNameIndex[r]=n.parseUShort();t.names=[];for(var i=0;i<t.numberOfGlyphs;i++)if(t.glyphNameIndex[i]>=Cr.length){var a=n.parseChar();t.names.push(n.parseString(a))}break;case 2.5:t.numberOfGlyphs=n.parseUShort(),t.offset=new Array(t.numberOfGlyphs);for(var l=0;l<t.numberOfGlyphs;l++)t.offset[l]=n.parseChar();break}return t}function L2(){return new fe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var t0={parse:P2,make:L2},Kn=new Array(9);Kn[1]=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{substFormat:1,coverage:this.parsePointer(q.coverage),deltaGlyphId:this.parseUShort()};if(e===2)return{substFormat:2,coverage:this.parsePointer(q.coverage),substitute:this.parseOffset16List()};Ne.assert(!1,"0x"+s.toString(16)+": lookup type 1 format must be 1 or 2.")};Kn[2]=function(){var s=this.parseUShort();return Ne.argument(s===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:s,coverage:this.parsePointer(q.coverage),sequences:this.parseListOfLists()}};Kn[3]=function(){var s=this.parseUShort();return Ne.argument(s===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:s,coverage:this.parsePointer(q.coverage),alternateSets:this.parseListOfLists()}};Kn[4]=function(){var s=this.parseUShort();return Ne.argument(s===1,"GSUB ligature table identifier-format must be 1"),{substFormat:s,coverage:this.parsePointer(q.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Ti={sequenceIndex:q.uShort,lookupListIndex:q.uShort};Kn[5]=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{substFormat:e,coverage:this.parsePointer(q.coverage),ruleSets:this.parseListOfLists(function(){var r=this.parseUShort(),i=this.parseUShort();return{input:this.parseUShortList(r-1),lookupRecords:this.parseRecordList(i,Ti)}})};if(e===2)return{substFormat:e,coverage:this.parsePointer(q.coverage),classDef:this.parsePointer(q.classDef),classSets:this.parseListOfLists(function(){var r=this.parseUShort(),i=this.parseUShort();return{classes:this.parseUShortList(r-1),lookupRecords:this.parseRecordList(i,Ti)}})};if(e===3){var t=this.parseUShort(),n=this.parseUShort();return{substFormat:e,coverages:this.parseList(t,q.pointer(q.coverage)),lookupRecords:this.parseRecordList(n,Ti)}}Ne.assert(!1,"0x"+s.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Kn[6]=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{substFormat:1,coverage:this.parsePointer(q.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ti)}})};if(e===2)return{substFormat:2,coverage:this.parsePointer(q.coverage),backtrackClassDef:this.parsePointer(q.classDef),inputClassDef:this.parsePointer(q.classDef),lookaheadClassDef:this.parsePointer(q.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ti)}})};if(e===3)return{substFormat:3,backtrackCoverage:this.parseList(q.pointer(q.coverage)),inputCoverage:this.parseList(q.pointer(q.coverage)),lookaheadCoverage:this.parseList(q.pointer(q.coverage)),lookupRecords:this.parseRecordList(Ti)};Ne.assert(!1,"0x"+s.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Kn[7]=function(){var s=this.parseUShort();Ne.argument(s===1,"GSUB Extension Substitution subtable identifier-format must be 1");var e=this.parseUShort(),t=new q(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:e,extension:Kn[e].call(t)}};Kn[8]=function(){var s=this.parseUShort();return Ne.argument(s===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:s,coverage:this.parsePointer(q.coverage),backtrackCoverage:this.parseList(q.pointer(q.coverage)),lookaheadCoverage:this.parseList(q.pointer(q.coverage)),substitutes:this.parseUShortList()}};function O2(s,e){e=e||0;var t=new q(s,e),n=t.parseVersion(1);return Ne.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(Kn)}:{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(Kn),variations:t.parseFeatureVariationsList()}}var Ni=new Array(9);Ni[1]=function(s){return s.substFormat===1?new fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)},{name:"deltaGlyphID",type:"USHORT",value:s.deltaGlyphId}]):new fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)}].concat(fe.ushortList("substitute",s.substitute)))};Ni[2]=function(s){return Ne.assert(s.substFormat===1,"Lookup type 2 substFormat must be 1."),new fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)}].concat(fe.tableList("seqSet",s.sequences,function(e){return new fe.Table("sequenceSetTable",fe.ushortList("sequence",e))})))};Ni[3]=function(s){return Ne.assert(s.substFormat===1,"Lookup type 3 substFormat must be 1."),new fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)}].concat(fe.tableList("altSet",s.alternateSets,function(e){return new fe.Table("alternateSetTable",fe.ushortList("alternate",e))})))};Ni[4]=function(s){return Ne.assert(s.substFormat===1,"Lookup type 4 substFormat must be 1."),new fe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)}].concat(fe.tableList("ligSet",s.ligatureSets,function(e){return new fe.Table("ligatureSetTable",fe.tableList("ligature",e,function(t){return new fe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:t.ligGlyph}].concat(fe.ushortList("component",t.components,t.components.length+1)))}))})))};Ni[6]=function(s){if(s.substFormat===1){var e=new fe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:s.substFormat},{name:"coverage",type:"TABLE",value:new fe.Coverage(s.coverage)}].concat(fe.tableList("chainRuleSet",s.chainRuleSets,function(r){return new fe.Table("chainRuleSetTable",fe.tableList("chainRule",r,function(i){var a=fe.ushortList("backtrackGlyph",i.backtrack,i.backtrack.length).concat(fe.ushortList("inputGlyph",i.input,i.input.length+1)).concat(fe.ushortList("lookaheadGlyph",i.lookahead,i.lookahead.length)).concat(fe.ushortList("substitution",[],i.lookupRecords.length));return i.lookupRecords.forEach(function(l,c){a=a.concat({name:"sequenceIndex"+c,type:"USHORT",value:l.sequenceIndex}).concat({name:"lookupListIndex"+c,type:"USHORT",value:l.lookupListIndex})}),new fe.Table("chainRuleTable",a)}))})));return e}else if(s.substFormat===2)Ne.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(s.substFormat===3){var t=[{name:"substFormat",type:"USHORT",value:s.substFormat}];t.push({name:"backtrackGlyphCount",type:"USHORT",value:s.backtrackCoverage.length}),s.backtrackCoverage.forEach(function(r,i){t.push({name:"backtrackCoverage"+i,type:"TABLE",value:new fe.Coverage(r)})}),t.push({name:"inputGlyphCount",type:"USHORT",value:s.inputCoverage.length}),s.inputCoverage.forEach(function(r,i){t.push({name:"inputCoverage"+i,type:"TABLE",value:new fe.Coverage(r)})}),t.push({name:"lookaheadGlyphCount",type:"USHORT",value:s.lookaheadCoverage.length}),s.lookaheadCoverage.forEach(function(r,i){t.push({name:"lookaheadCoverage"+i,type:"TABLE",value:new fe.Coverage(r)})}),t.push({name:"substitutionCount",type:"USHORT",value:s.lookupRecords.length}),s.lookupRecords.forEach(function(r,i){t=t.concat({name:"sequenceIndex"+i,type:"USHORT",value:r.sequenceIndex}).concat({name:"lookupListIndex"+i,type:"USHORT",value:r.lookupListIndex})});var n=new fe.Table("chainContextTable",t);return n}Ne.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function D2(s){return new fe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new fe.ScriptList(s.scripts)},{name:"features",type:"TABLE",value:new fe.FeatureList(s.features)},{name:"lookups",type:"TABLE",value:new fe.LookupList(s.lookups,Ni)}])}var n0={parse:O2,make:D2};function B2(s,e){var t=new _e.Parser(s,e),n=t.parseULong();Ne.argument(n===1,"Unsupported META table version."),t.parseULong(),t.parseULong();for(var r=t.parseULong(),i={},a=0;a<r;a++){var l=t.parseTag(),c=t.parseULong(),u=t.parseULong(),p=Mi.UTF8(s,e+c,u);i[l]=p}return i}function N2(s){var e=Object.keys(s).length,t="",n=16+e*12,r=new fe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in s){var a=t.length;t+=s[i],r.fields.push({name:"tag "+i,type:"TAG",value:i}),r.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),r.fields.push({name:"length "+i,type:"ULONG",value:s[i].length})}return r.fields.push({name:"stringPool",type:"CHARARRAY",value:t}),r}var s0={parse:B2,make:N2};function Xu(s){return Math.log(s)/Math.log(2)|0}function Eh(s){for(;s.length%4!==0;)s.push(0);for(var e=0,t=0;t<s.length;t+=4)e+=(s[t]<<24)+(s[t+1]<<16)+(s[t+2]<<8)+s[t+3];return e%=Math.pow(2,32),e}function Zu(s,e,t,n){return new fe.Record("Table Record",[{name:"tag",type:"TAG",value:s!==void 0?s:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:t!==void 0?t:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function r0(s){var e=new fe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=s,e.numTables=s.length;var t=Math.pow(2,Xu(e.numTables));e.searchRange=16*t,e.entrySelector=Xu(t),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],r=[],i=e.sizeOf()+Zu().sizeOf()*e.numTables;i%4!==0;)i+=1,r.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<s.length;a+=1){var l=s[a];Ne.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),u=Zu(l.tableName,Eh(l.encode()),i,c);for(n.push({name:u.tag+" Table Record",type:"RECORD",value:u}),r.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,Ne.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,r.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(p,g){return p.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(r),e}function Ku(s,e,t){for(var n=0;n<e.length;n+=1){var r=s.charToGlyphIndex(e[n]);if(r>0){var i=s.glyphs.get(r);return i.getMetrics()}}return t}function R2(s){for(var e=0,t=0;t<s.length;t+=1)e+=s[t];return e/s.length}function F2(s){for(var e=[],t=[],n=[],r=[],i=[],a=[],l=[],c,u=0,p=0,g=0,m=0,y=0,A=0;A<s.glyphs.length;A+=1){var w=s.glyphs.get(A),C=w.unicode|0;if(isNaN(w.advanceWidth))throw new Error("Glyph "+w.name+" ("+A+"): advanceWidth is not a number.");(c>C||c===void 0)&&C>0&&(c=C),u<C&&(u=C);var E=jc.getUnicodeRange(C);if(E<32)p|=1<<E;else if(E<64)g|=1<<E-32;else if(E<96)m|=1<<E-64;else if(E<123)y|=1<<E-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(w.name!==".notdef"){var L=w.getMetrics();e.push(L.xMin),t.push(L.yMin),n.push(L.xMax),r.push(L.yMax),a.push(L.leftSideBearing),l.push(L.rightSideBearing),i.push(w.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,t),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,r),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:R2(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};O.ascender=s.ascender,O.descender=s.descender;var F=Wm.make({flags:3,unitsPerEm:s.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:s.createdTimestamp}),B=Hm.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:s.glyphs.length}),Z=Xm.make(s.glyphs.length),W=jc.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:u,ulUnicodeRange1:p,ulUnicodeRange2:g,ulUnicodeRange3:m,ulUnicodeRange4:y,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:Ku(s,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:Ku(s,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:s.hasChar(" ")?32:0,usBreakChar:s.hasChar(" ")?32:0},s.tables.os2)),Q=qm.make(s.glyphs),ye=Om.make(s.glyphs),Se=s.getEnglishName("fontFamily"),ge=s.getEnglishName("fontSubfamily"),Le=Se+" "+ge,Je=s.getEnglishName("postScriptName");Je||(Je=Se.replace(/\s/g,"")+"-"+ge);var Ge={};for(var Ze in s.names)Ge[Ze]=s.names[Ze];Ge.uniqueID||(Ge.uniqueID={en:s.getEnglishName("manufacturer")+":"+Le}),Ge.postScriptName||(Ge.postScriptName={en:Je}),Ge.preferredFamily||(Ge.preferredFamily=s.names.fontFamily),Ge.preferredSubfamily||(Ge.preferredSubfamily=s.names.fontSubfamily);var Fe=[],Xe=e0.make(Ge,Fe),ie=Fe.length>0?Ym.make(Fe):void 0,Ee=t0.make(),et=$m.make(s.glyphs,{version:s.getEnglishName("version"),fullName:Le,familyName:Se,weightName:ge,postScriptName:Je,unitsPerEm:s.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),Me=s.metas&&Object.keys(s.metas).length>0?s0.make(s.metas):void 0,He=[F,B,Z,W,Xe,ye,Ee,et,Q];ie&&He.push(ie),s.tables.gsub&&He.push(n0.make(s.tables.gsub)),Me&&He.push(Me);for(var qe=r0(He),zn=qe.encode(),Mt=Eh(zn),pt=qe.fields,pn=!1,Re=0;Re<pt.length;Re+=1)if(pt[Re].name==="head table"){pt[Re].value.checkSumAdjustment=2981146554-Mt,pn=!0;break}if(!pn)throw new Error("Could not find head table with checkSum to adjust.");return qe}var z2={make:r0,fontToTable:F2,computeCheckSum:Eh};function Vl(s,e){for(var t=0,n=s.length-1;t<=n;){var r=t+n>>>1,i=s[r].tag;if(i===e)return r;i<e?t=r+1:n=r-1}return-t-1}function Qu(s,e){for(var t=0,n=s.length-1;t<=n;){var r=t+n>>>1,i=s[r];if(i===e)return r;i<e?t=r+1:n=r-1}return-t-1}function Ju(s,e){for(var t,n=0,r=s.length-1;n<=r;){var i=n+r>>>1;t=s[i];var a=t.start;if(a===e)return t;a<e?n=i+1:r=i-1}if(n>0)return t=s[n-1],e>t.end?0:t}function Fa(s,e){this.font=s,this.tableName=e}Fa.prototype={searchTag:Vl,binSearch:Qu,getTable:function(s){var e=this.font.tables[this.tableName];return!e&&s&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var s=this.getTable();return s?s.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var s=this.getTable();if(s){for(var e=!1,t=0;t<s.scripts.length;t++){var n=s.scripts[t].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(s,e){var t=this.getTable(e);if(t){s=s||"DFLT";var n=t.scripts,r=Vl(t.scripts,s);if(r>=0)return n[r].script;if(e){var i={tag:s,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-r,0,i),i.script}}},getLangSysTable:function(s,e,t){var n=this.getScriptTable(s,t);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var r=Vl(n.langSysRecords,e);if(r>=0)return n.langSysRecords[r].langSys;if(t){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-r,0,i),i.langSys}}},getFeatureTable:function(s,e,t,n){var r=this.getLangSysTable(s,e,n);if(r){for(var i,a=r.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===t)return i.feature;if(n){var u=l.length;return Ne.assert(u===0||t>=l[u-1].tag,"Features must be added in alphabetical order."),i={tag:t,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(u),i.feature}}},getLookupTables:function(s,e,t,n,r){var i=this.getFeatureTable(s,e,t,r),a=[];if(i){for(var l,c=i.lookupListIndexes,u=this.font.tables[this.tableName].lookups,p=0;p<c.length;p++)l=u[c[p]],l.lookupType===n&&a.push(l);if(a.length===0&&r){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=u.length;return u.push(l),c.push(g),[l]}}return a},getGlyphClass:function(s,e){switch(s.format){case 1:return s.startGlyph<=e&&e<s.startGlyph+s.classes.length?s.classes[e-s.startGlyph]:0;case 2:var t=Ju(s.ranges,e);return t?t.classId:0}},getCoverageIndex:function(s,e){switch(s.format){case 1:var t=Qu(s.glyphs,e);return t>=0?t:-1;case 2:var n=Ju(s.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(s){if(s.format===1)return s.glyphs;for(var e=[],t=s.ranges,n=0;n<t.length;n++)for(var r=t[n],i=r.start,a=r.end,l=i;l<=a;l++)e.push(l);return e}};function za(s){Fa.call(this,s,"gpos")}za.prototype=Fa.prototype;za.prototype.init=function(){var s=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(s)};za.prototype.getKerningValue=function(s,e,t){for(var n=0;n<s.length;n++)for(var r=s[n].subtables,i=0;i<r.length;i++){var a=r[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],u=0;u<c.length;u++){var p=c[u];if(p.secondGlyph===t)return p.value1&&p.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),m=this.getGlyphClass(a.classDef2,t),y=a.classRecords[g][m];return y.value1&&y.value1.xAdvance||0}}return 0};za.prototype.getKerningTables=function(s,e){if(this.font.tables.gpos)return this.getLookupTables(s,e,"kern",2)};function xn(s){Fa.call(this,s,"gsub")}function U2(s,e){var t=s.length;if(t!==e.length)return!1;for(var n=0;n<t;n++)if(s[n]!==e[n])return!1;return!0}function Th(s,e,t){for(var n=s.subtables,r=0;r<n.length;r++){var i=n[r];if(i.substFormat===e)return i}if(t)return n.push(t),t}xn.prototype=Fa.prototype;xn.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};xn.prototype.getSingle=function(s,e,t){for(var n=[],r=this.getLookupTables(e,t,s,1),i=0;i<r.length;i++)for(var a=r[i].subtables,l=0;l<a.length;l++){var c=a[l],u=this.expandCoverage(c.coverage),p=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(p=0;p<u.length;p++){var m=u[p];n.push({sub:m,by:m+g})}}else{var y=c.substitute;for(p=0;p<u.length;p++)n.push({sub:u[p],by:y[p]})}}return n};xn.prototype.getMultiple=function(s,e,t){for(var n=[],r=this.getLookupTables(e,t,s,2),i=0;i<r.length;i++)for(var a=r[i].subtables,l=0;l<a.length;l++){var c=a[l],u=this.expandCoverage(c.coverage),p=void 0;for(p=0;p<u.length;p++){var g=u[p],m=c.sequences[p];n.push({sub:g,by:m})}}return n};xn.prototype.getAlternates=function(s,e,t){for(var n=[],r=this.getLookupTables(e,t,s,3),i=0;i<r.length;i++)for(var a=r[i].subtables,l=0;l<a.length;l++)for(var c=a[l],u=this.expandCoverage(c.coverage),p=c.alternateSets,g=0;g<u.length;g++)n.push({sub:u[g],by:p[g]});return n};xn.prototype.getLigatures=function(s,e,t){for(var n=[],r=this.getLookupTables(e,t,s,4),i=0;i<r.length;i++)for(var a=r[i].subtables,l=0;l<a.length;l++)for(var c=a[l],u=this.expandCoverage(c.coverage),p=c.ligatureSets,g=0;g<u.length;g++)for(var m=u[g],y=p[g],A=0;A<y.length;A++){var w=y[A];n.push({sub:[m].concat(w.components),by:w.ligGlyph})}return n};xn.prototype.addSingle=function(s,e,t,n){var r=this.getLookupTables(t,n,s,1,!0)[0],i=Th(r,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Ne.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};xn.prototype.addMultiple=function(s,e,t,n){Ne.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var r=this.getLookupTables(t,n,s,2,!0)[0],i=Th(r,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});Ne.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};xn.prototype.addAlternate=function(s,e,t,n){var r=this.getLookupTables(t,n,s,3,!0)[0],i=Th(r,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Ne.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};xn.prototype.addLigature=function(s,e,t,n){var r=this.getLookupTables(t,n,s,4,!0)[0],i=r.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},r.subtables[0]=i),Ne.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},u=this.binSearch(i.coverage.glyphs,a);if(u>=0){for(var p=i.ligatureSets[u],g=0;g<p.length;g++)if(U2(p[g].components,l))return;p.push(c)}else u=-1-u,i.coverage.glyphs.splice(u,0,a),i.ligatureSets.splice(u,0,[c])};xn.prototype.getFeature=function(s,e,t){if(/ss\d\d/.test(s))return this.getSingle(s,e,t);switch(s){case"aalt":case"salt":return this.getSingle(s,e,t).concat(this.getAlternates(s,e,t));case"dlig":case"liga":case"rlig":return this.getLigatures(s,e,t);case"ccmp":return this.getMultiple(s,e,t).concat(this.getLigatures(s,e,t));case"stch":return this.getMultiple(s,e,t)}};xn.prototype.add=function(s,e,t,n){if(/ss\d\d/.test(s))return this.addSingle(s,e,t,n);switch(s){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(s,e,t,n):this.addAlternate(s,e,t,n);case"dlig":case"liga":case"rlig":return this.addLigature(s,e,t,n);case"ccmp":return e.by instanceof Array?this.addMultiple(s,e,t,n):this.addLigature(s,e,t,n)}};function G2(){return typeof window<"u"}function V2(s){for(var e=new Buffer(s.byteLength),t=new Uint8Array(s),n=0;n<e.length;++n)e[n]=t[n];return e}function ea(s,e){if(!s)throw e}function ed(s,e,t,n,r){var i;return(e&n)>0?(i=s.parseByte(),e&r||(i=-i),i=t+i):(e&r)>0?i=t:i=t+s.parseShort(),i}function i0(s,e,t){var n=new _e.Parser(e,t);s.numberOfContours=n.parseShort(),s._xMin=n.parseShort(),s._yMin=n.parseShort(),s._xMax=n.parseShort(),s._yMax=n.parseShort();var r,i;if(s.numberOfContours>0){for(var a=s.endPointIndices=[],l=0;l<s.numberOfContours;l+=1)a.push(n.parseUShort());s.instructionLength=n.parseUShort(),s.instructions=[];for(var c=0;c<s.instructionLength;c+=1)s.instructions.push(n.parseByte());var u=a[a.length-1]+1;r=[];for(var p=0;p<u;p+=1)if(i=n.parseByte(),r.push(i),(i&8)>0)for(var g=n.parseByte(),m=0;m<g;m+=1)r.push(i),p+=1;if(Ne.argument(r.length===u,"Bad flags."),a.length>0){var y=[],A;if(u>0){for(var w=0;w<u;w+=1)i=r[w],A={},A.onCurve=!!(i&1),A.lastPointOfContour=a.indexOf(w)>=0,y.push(A);for(var C=0,E=0;E<u;E+=1)i=r[E],A=y[E],A.x=ed(n,i,C,2,16),C=A.x;for(var L=0,O=0;O<u;O+=1)i=r[O],A=y[O],A.y=ed(n,i,L,4,32),L=A.y}s.points=y}else s.points=[]}else if(s.numberOfContours===0)s.points=[];else{s.isComposite=!0,s.points=[],s.components=[];for(var F=!0;F;){r=n.parseUShort();var B={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(r&1)>0?(r&2)>0?(B.dx=n.parseShort(),B.dy=n.parseShort()):B.matchedPoints=[n.parseUShort(),n.parseUShort()]:(r&2)>0?(B.dx=n.parseChar(),B.dy=n.parseChar()):B.matchedPoints=[n.parseByte(),n.parseByte()],(r&8)>0?B.xScale=B.yScale=n.parseF2Dot14():(r&64)>0?(B.xScale=n.parseF2Dot14(),B.yScale=n.parseF2Dot14()):(r&128)>0&&(B.xScale=n.parseF2Dot14(),B.scale01=n.parseF2Dot14(),B.scale10=n.parseF2Dot14(),B.yScale=n.parseF2Dot14()),s.components.push(B),F=!!(r&32)}if(r&256){s.instructionLength=n.parseUShort(),s.instructions=[];for(var Z=0;Z<s.instructionLength;Z+=1)s.instructions.push(n.parseByte())}}}function jl(s,e){for(var t=[],n=0;n<s.length;n+=1){var r=s[n],i={x:e.xScale*r.x+e.scale01*r.y+e.dx,y:e.scale10*r.x+e.yScale*r.y+e.dy,onCurve:r.onCurve,lastPointOfContour:r.lastPointOfContour};t.push(i)}return t}function j2(s){for(var e=[],t=[],n=0;n<s.length;n+=1){var r=s[n];t.push(r),r.lastPointOfContour&&(e.push(t),t=[])}return Ne.argument(t.length===0,"There are still points left in the current contour."),e}function a0(s){var e=new zt;if(!s)return e;for(var t=j2(s),n=0;n<t.length;++n){var r=t[n],i=null,a=r[r.length-1],l=r[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var u=0;u<r.length;++u)if(i=a,a=l,l=r[(u+1)%r.length],a.onCurve)e.lineTo(a.x,a.y);else{var p=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(p={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,p.x,p.y)}e.closePath()}return e}function o0(s,e){if(e.isComposite)for(var t=0;t<e.components.length;t+=1){var n=e.components[t],r=s.get(n.glyphIndex);if(r.getPath(),r.points){var i=void 0;if(n.matchedPoints===void 0)i=jl(r.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>r.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=r.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=jl([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=jl(r.points,c)}e.points=e.points.concat(i)}}return a0(e.points)}function $2(s,e,t,n){for(var r=new gs.GlyphSet(n),i=0;i<t.length-1;i+=1){var a=t[i],l=t[i+1];a!==l?r.push(i,gs.ttfGlyphLoader(n,i,i0,s,e+a,o0)):r.push(i,gs.glyphLoader(n,i))}return r}function W2(s,e,t,n){var r=new gs.GlyphSet(n);return n._push=function(i){var a=t[i],l=t[i+1];a!==l?r.push(i,gs.ttfGlyphLoader(n,i,i0,s,e+a,o0)):r.push(i,gs.glyphLoader(n,i))},r}function H2(s,e,t,n,r){return r.lowMemory?W2(s,e,t,n):$2(s,e,t,n)}var l0={getPath:a0,parse:H2},c0,zr,h0,$c;function u0(s){this.font=s,this.getCommands=function(e){return l0.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function q2(s){return s}function d0(s){return Math.sign(s)*Math.round(Math.abs(s))}function Y2(s){return Math.sign(s)*Math.round(Math.abs(s*2))/2}function X2(s){return Math.sign(s)*(Math.round(Math.abs(s)+.5)-.5)}function Z2(s){return Math.sign(s)*Math.ceil(Math.abs(s))}function K2(s){return Math.sign(s)*Math.floor(Math.abs(s))}var p0=function(s){var e=this.srPeriod,t=this.srPhase,n=this.srThreshold,r=1;return s<0&&(s=-s,r=-1),s+=n-t,s=Math.trunc(s/e)*e,s+=t,s<0?t*r:s*r},fs={x:1,y:0,axis:"x",distance:function(s,e,t,n){return(t?s.xo:s.x)-(n?e.xo:e.x)},interpolate:function(s,e,t,n){var r,i,a,l,c,u,p;if(!n||n===this){if(r=s.xo-e.xo,i=s.xo-t.xo,c=e.x-e.xo,u=t.x-t.xo,a=Math.abs(r),l=Math.abs(i),p=a+l,p===0){s.x=s.xo+(c+u)/2;return}s.x=s.xo+(c*l+u*a)/p;return}if(r=n.distance(s,e,!0,!0),i=n.distance(s,t,!0,!0),c=n.distance(e,e,!1,!0),u=n.distance(t,t,!1,!0),a=Math.abs(r),l=Math.abs(i),p=a+l,p===0){fs.setRelative(s,s,(c+u)/2,n,!0);return}fs.setRelative(s,s,(c*l+u*a)/p,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(s,e,t,n,r){if(!n||n===this){s.x=(r?e.xo:e.x)+t;return}var i=r?e.xo:e.x,a=r?e.yo:e.y,l=i+t*n.x,c=a+t*n.y;s.x=l+(s.y-c)/n.normalSlope},slope:0,touch:function(s){s.xTouched=!0},touched:function(s){return s.xTouched},untouch:function(s){s.xTouched=!1}},ks={x:0,y:1,axis:"y",distance:function(s,e,t,n){return(t?s.yo:s.y)-(n?e.yo:e.y)},interpolate:function(s,e,t,n){var r,i,a,l,c,u,p;if(!n||n===this){if(r=s.yo-e.yo,i=s.yo-t.yo,c=e.y-e.yo,u=t.y-t.yo,a=Math.abs(r),l=Math.abs(i),p=a+l,p===0){s.y=s.yo+(c+u)/2;return}s.y=s.yo+(c*l+u*a)/p;return}if(r=n.distance(s,e,!0,!0),i=n.distance(s,t,!0,!0),c=n.distance(e,e,!1,!0),u=n.distance(t,t,!1,!0),a=Math.abs(r),l=Math.abs(i),p=a+l,p===0){ks.setRelative(s,s,(c+u)/2,n,!0);return}ks.setRelative(s,s,(c*l+u*a)/p,n,!0)},normalSlope:0,setRelative:function(s,e,t,n,r){if(!n||n===this){s.y=(r?e.yo:e.y)+t;return}var i=r?e.xo:e.x,a=r?e.yo:e.y,l=i+t*n.x,c=a+t*n.y;s.y=c+n.normalSlope*(s.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(s){s.yTouched=!0},touched:function(s){return s.yTouched},untouch:function(s){s.yTouched=!1}};Object.freeze(fs);Object.freeze(ks);function Ua(s,e){this.x=s,this.y=e,this.axis=void 0,this.slope=e/s,this.normalSlope=-s/e,Object.freeze(this)}Ua.prototype.distance=function(s,e,t,n){return this.x*fs.distance(s,e,t,n)+this.y*ks.distance(s,e,t,n)};Ua.prototype.interpolate=function(s,e,t,n){var r,i,a,l,c,u,p;if(a=n.distance(s,e,!0,!0),l=n.distance(s,t,!0,!0),r=n.distance(e,e,!1,!0),i=n.distance(t,t,!1,!0),c=Math.abs(a),u=Math.abs(l),p=c+u,p===0){this.setRelative(s,s,(r+i)/2,n,!0);return}this.setRelative(s,s,(r*u+i*c)/p,n,!0)};Ua.prototype.setRelative=function(s,e,t,n,r){n=n||this;var i=r?e.xo:e.x,a=r?e.yo:e.y,l=i+t*n.x,c=a+t*n.y,u=n.normalSlope,p=this.slope,g=s.x,m=s.y;s.x=(p*g-u*l+c-m)/(p-u),s.y=p*(s.x-g)+m};Ua.prototype.touch=function(s){s.xTouched=!0,s.yTouched=!0};function Ga(s,e){var t=Math.sqrt(s*s+e*e);return s/=t,e/=t,s===1&&e===0?fs:s===0&&e===1?ks:new Ua(s,e)}function Ps(s,e,t,n){this.x=this.xo=Math.round(s*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=t,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Ps.prototype.nextTouched=function(s){for(var e=this.nextPointOnContour;!s.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Ps.prototype.prevTouched=function(s){for(var e=this.prevPointOnContour;!s.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Ia=Object.freeze(new Ps(0,0)),Q2={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function ir(s,e){switch(this.env=s,this.stack=[],this.prog=e,s){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=fs,this.round=d0}}u0.prototype.exec=function(s,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var t=this.font,n=this._prepState;if(!n||n.ppem!==e){var r=this._fpgmState;if(!r){ir.prototype=Q2,r=this._fpgmState=new ir("fpgm",t.tables.fpgm),r.funcs=[],r.font=t,exports.DEBUG&&(console.log("---EXEC FPGM---"),r.step=-1);try{zr(r)}catch(u){console.log("Hinting error in FPGM:"+u),this._errorState=3;return}}ir.prototype=r,n=this._prepState=new ir("prep",t.tables.prep),n.ppem=e;var i=t.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/t.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{zr(n)}catch(u){this._errorState<2&&console.log("Hinting error in PREP:"+u),this._errorState=2}}if(!(this._errorState>1))try{return h0(s,n)}catch(u){this._errorState<1&&(console.log("Hinting error:"+u),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};h0=function(s,e){var t=e.ppem/e.font.unitsPerEm,n=t,r=s.components,i,a,l;if(ir.prototype=e,!r)l=new ir("glyf",s.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),$c(s,l,t,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var u=0;u<r.length;u++){var p=r[u],g=c.glyphs.get(p.glyphIndex);l=new ir("glyf",g.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+u+"---"),l.step=-1),$c(g,l,t,n);for(var m=Math.round(p.dx*t),y=Math.round(p.dy*n),A=l.gZone,w=l.contours,C=0;C<A.length;C++){var E=A[C];E.xTouched=E.yTouched=!1,E.xo=E.x=E.x+m,E.yo=E.y=E.y+y}var L=a.length;a.push.apply(a,A);for(var O=0;O<w.length;O++)i.push(w[O]+L)}s.instructions&&!l.inhibitGridFit&&(l=new ir("glyf",s.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new Ps(0,0),new Ps(Math.round(s.advanceWidth*t),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),zr(l),a.length-=2)}return a};$c=function(s,e,t,n){for(var r=s.points||[],i=r.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,u=0;u<i;u++)c=r[u],a[u]=new Ps(c.x*t,c.y*n,c.lastPointOfContour,c.onCurve);for(var p,g,m=0;m<i;m++)c=a[m],p||(p=c,l.push(m)),c.lastPointOfContour?(c.nextPointOnContour=p,p.prevPointOnContour=c,p=void 0):(g=a[m+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var y=0;y<i;y++)console.log(y,a[y].x,a[y].y)}if(a.push(new Ps(0,0),new Ps(Math.round(s.advanceWidth*t),0)),zr(e),a.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var A=0;A<i;A++)console.log(A,a[A].x,a[A].y)}}};zr=function(s){var e=s.prog;if(e){var t=e.length,n;for(s.ip=0;s.ip<t;s.ip++){if(exports.DEBUG&&s.step++,n=c0[e[s.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[s.ip]).toString(16));n(s)}}};function al(s){for(var e=s.tZone=new Array(s.gZone.length),t=0;t<e.length;t++)e[t]=new Ps(0,0)}function f0(s,e){var t=s.prog,n=s.ip,r=1,i;do if(i=t[++n],i===88)r++;else if(i===89)r--;else if(i===64)n+=t[n+1]+1;else if(i===65)n+=2*t[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&r===1&&i===27)break;while(r>0);s.ip=n}function td(s,e){exports.DEBUG&&console.log(e.step,"SVTCA["+s.axis+"]"),e.fv=e.pv=e.dpv=s}function nd(s,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+s.axis+"]"),e.pv=e.dpv=s}function sd(s,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+s.axis+"]"),e.fv=s}function rd(s,e){var t=e.stack,n=t.pop(),r=t.pop(),i=e.z2[n],a=e.z1[r];exports.DEBUG&&console.log("SPVTL["+s+"]",n,r);var l,c;s?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=Ga(l,c)}function id(s,e){var t=e.stack,n=t.pop(),r=t.pop(),i=e.z2[n],a=e.z1[r];exports.DEBUG&&console.log("SFVTL["+s+"]",n,r);var l,c;s?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=Ga(l,c)}function J2(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"SPVFS[]",t,n),s.pv=s.dpv=Ga(n,t)}function ex(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"SPVFS[]",t,n),s.fv=Ga(n,t)}function tx(s){var e=s.stack,t=s.pv;exports.DEBUG&&console.log(s.step,"GPV[]"),e.push(t.x*16384),e.push(t.y*16384)}function nx(s){var e=s.stack,t=s.fv;exports.DEBUG&&console.log(s.step,"GFV[]"),e.push(t.x*16384),e.push(t.y*16384)}function sx(s){s.fv=s.pv,exports.DEBUG&&console.log(s.step,"SFVTPV[]")}function rx(s){var e=s.stack,t=e.pop(),n=e.pop(),r=e.pop(),i=e.pop(),a=e.pop(),l=s.z0,c=s.z1,u=l[t],p=l[n],g=c[r],m=c[i],y=s.z2[a];exports.DEBUG&&console.log("ISECT[], ",t,n,r,i,a);var A=u.x,w=u.y,C=p.x,E=p.y,L=g.x,O=g.y,F=m.x,B=m.y,Z=(A-C)*(O-B)-(w-E)*(L-F),W=A*E-w*C,Q=L*B-O*F;y.x=(W*(L-F)-Q*(A-C))/Z,y.y=(W*(O-B)-Q*(w-E))/Z}function ix(s){s.rp0=s.stack.pop(),exports.DEBUG&&console.log(s.step,"SRP0[]",s.rp0)}function ax(s){s.rp1=s.stack.pop(),exports.DEBUG&&console.log(s.step,"SRP1[]",s.rp1)}function ox(s){s.rp2=s.stack.pop(),exports.DEBUG&&console.log(s.step,"SRP2[]",s.rp2)}function lx(s){var e=s.stack.pop();switch(exports.DEBUG&&console.log(s.step,"SZP0[]",e),s.zp0=e,e){case 0:s.tZone||al(s),s.z0=s.tZone;break;case 1:s.z0=s.gZone;break;default:throw new Error("Invalid zone pointer")}}function cx(s){var e=s.stack.pop();switch(exports.DEBUG&&console.log(s.step,"SZP1[]",e),s.zp1=e,e){case 0:s.tZone||al(s),s.z1=s.tZone;break;case 1:s.z1=s.gZone;break;default:throw new Error("Invalid zone pointer")}}function hx(s){var e=s.stack.pop();switch(exports.DEBUG&&console.log(s.step,"SZP2[]",e),s.zp2=e,e){case 0:s.tZone||al(s),s.z2=s.tZone;break;case 1:s.z2=s.gZone;break;default:throw new Error("Invalid zone pointer")}}function ux(s){var e=s.stack.pop();switch(exports.DEBUG&&console.log(s.step,"SZPS[]",e),s.zp0=s.zp1=s.zp2=e,e){case 0:s.tZone||al(s),s.z0=s.z1=s.z2=s.tZone;break;case 1:s.z0=s.z1=s.z2=s.gZone;break;default:throw new Error("Invalid zone pointer")}}function dx(s){s.loop=s.stack.pop(),exports.DEBUG&&console.log(s.step,"SLOOP[]",s.loop)}function px(s){exports.DEBUG&&console.log(s.step,"RTG[]"),s.round=d0}function fx(s){exports.DEBUG&&console.log(s.step,"RTHG[]"),s.round=X2}function gx(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"SMD[]",e),s.minDis=e/64}function mx(s){exports.DEBUG&&console.log(s.step,"ELSE[]"),f0(s,!1)}function yx(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"JMPR[]",e),s.ip+=e-1}function vx(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"SCVTCI[]",e),s.cvCutIn=e/64}function bx(s){var e=s.stack;exports.DEBUG&&console.log(s.step,"DUP[]"),e.push(e[e.length-1])}function $l(s){exports.DEBUG&&console.log(s.step,"POP[]"),s.stack.pop()}function _x(s){exports.DEBUG&&console.log(s.step,"CLEAR[]"),s.stack.length=0}function xx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"SWAP[]"),e.push(t),e.push(n)}function wx(s){var e=s.stack;exports.DEBUG&&console.log(s.step,"DEPTH[]"),e.push(e.length)}function Sx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"LOOPCALL[]",t,n);var r=s.ip,i=s.prog;s.prog=s.funcs[t];for(var a=0;a<n;a++)zr(s),exports.DEBUG&&console.log(++s.step,a+1<n?"next loopcall":"done loopcall",a);s.ip=r,s.prog=i}function Ax(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"CALL[]",e);var t=s.ip,n=s.prog;s.prog=s.funcs[e],zr(s),s.ip=t,s.prog=n,exports.DEBUG&&console.log(++s.step,"returning from",e)}function Ex(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"CINDEX[]",t),e.push(e[e.length-t])}function Tx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"MINDEX[]",t),e.push(e.splice(e.length-t,1)[0])}function Ix(s){if(s.env!=="fpgm")throw new Error("FDEF not allowed here");var e=s.stack,t=s.prog,n=s.ip,r=e.pop(),i=n;for(exports.DEBUG&&console.log(s.step,"FDEF[]",r);t[++n]!==45;);s.ip=n,s.funcs[r]=t.slice(i+1,n)}function ad(s,e){var t=e.stack.pop(),n=e.z0[t],r=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+s+"]",t);var a=i.distance(n,Ia);s&&(a=e.round(a)),r.setRelative(n,Ia,a,i),r.touch(n),e.rp0=e.rp1=t}function od(s,e){var t=e.z2,n=t.length-2,r,i,a;exports.DEBUG&&console.log(e.step,"IUP["+s.axis+"]");for(var l=0;l<n;l++)r=t[l],!s.touched(r)&&(i=r.prevTouched(s),i!==r&&(a=r.nextTouched(s),i===a&&s.setRelative(r,r,s.distance(i,i,!1,!0),s,!0),s.interpolate(r,i,a,s)))}function ld(s,e){for(var t=e.stack,n=s?e.rp1:e.rp2,r=(s?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var u=t.pop(),p=c[u],g=a.distance(r,r,!1,!0);i.setRelative(p,p,g,a),i.touch(p),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(s?"rp1":"rp2")+"]",u)}e.loop=1}function cd(s,e){var t=e.stack,n=s?e.rp1:e.rp2,r=(s?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=t.pop(),c=e.z2[e.contours[l]],u=c;exports.DEBUG&&console.log(e.step,"SHC["+s+"]",l);var p=a.distance(r,r,!1,!0);do u!==r&&i.setRelative(u,u,p,a),u=u.nextPointOnContour;while(u!==c)}function hd(s,e){var t=e.stack,n=s?e.rp1:e.rp2,r=(s?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=t.pop();exports.DEBUG&&console.log(e.step,"SHZ["+s+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var u,p=a.distance(r,r,!1,!0),g=c.length-2,m=0;m<g;m++)u=c[m],i.setRelative(u,u,p,a)}function Cx(s){for(var e=s.stack,t=s.loop,n=s.fv,r=e.pop()/64,i=s.z2;t--;){var a=e.pop(),l=i[a];exports.DEBUG&&console.log(s.step,(s.loop>1?"loop "+(s.loop-t)+": ":"")+"SHPIX[]",a,r),n.setRelative(l,l,r),n.touch(l)}s.loop=1}function kx(s){for(var e=s.stack,t=s.rp1,n=s.rp2,r=s.loop,i=s.z0[t],a=s.z1[n],l=s.fv,c=s.dpv,u=s.z2;r--;){var p=e.pop(),g=u[p];exports.DEBUG&&console.log(s.step,(s.loop>1?"loop "+(s.loop-r)+": ":"")+"IP[]",p,t,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}s.loop=1}function ud(s,e){var t=e.stack,n=t.pop()/64,r=t.pop(),i=e.z1[r],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+s+"]",n,r),e.rp1=e.rp0,e.rp2=r,s&&(e.rp0=r)}function Mx(s){for(var e=s.stack,t=s.rp0,n=s.z0[t],r=s.loop,i=s.fv,a=s.pv,l=s.z1;r--;){var c=e.pop(),u=l[c];exports.DEBUG&&console.log(s.step,(s.loop>1?"loop "+(s.loop-r)+": ":"")+"ALIGNRP[]",c),i.setRelative(u,n,0,a),i.touch(u)}s.loop=1}function Px(s){exports.DEBUG&&console.log(s.step,"RTDG[]"),s.round=Y2}function dd(s,e){var t=e.stack,n=t.pop(),r=t.pop(),i=e.z0[r],a=e.fv,l=e.pv,c=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+s+"]",n,"(",c,")",r);var u=l.distance(i,Ia);s&&(Math.abs(u-c)<e.cvCutIn&&(u=c),u=e.round(u)),a.setRelative(i,Ia,u,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=r}function Lx(s){var e=s.prog,t=s.ip,n=s.stack,r=e[++t];exports.DEBUG&&console.log(s.step,"NPUSHB[]",r);for(var i=0;i<r;i++)n.push(e[++t]);s.ip=t}function Ox(s){var e=s.ip,t=s.prog,n=s.stack,r=t[++e];exports.DEBUG&&console.log(s.step,"NPUSHW[]",r);for(var i=0;i<r;i++){var a=t[++e]<<8|t[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}s.ip=e}function Dx(s){var e=s.stack,t=s.store;t||(t=s.store=[]);var n=e.pop(),r=e.pop();exports.DEBUG&&console.log(s.step,"WS",n,r),t[r]=n}function Bx(s){var e=s.stack,t=s.store,n=e.pop();exports.DEBUG&&console.log(s.step,"RS",n);var r=t&&t[n]||0;e.push(r)}function Nx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"WCVTP",t,n),s.cvt[n]=t/64}function Rx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"RCVT",t),e.push(s.cvt[t]*64)}function pd(s,e){var t=e.stack,n=t.pop(),r=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+s+"]",n),t.push(e.dpv.distance(r,Ia,s,!1)*64)}function fd(s,e){var t=e.stack,n=t.pop(),r=t.pop(),i=e.z1[n],a=e.z0[r],l=e.dpv.distance(a,i,s,s);exports.DEBUG&&console.log(e.step,"MD["+s+"]",n,r,"->",l),e.stack.push(Math.round(l*64))}function Fx(s){exports.DEBUG&&console.log(s.step,"MPPEM[]"),s.stack.push(s.ppem)}function zx(s){exports.DEBUG&&console.log(s.step,"FLIPON[]"),s.autoFlip=!0}function Ux(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"LT[]",t,n),e.push(n<t?1:0)}function Gx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"LTEQ[]",t,n),e.push(n<=t?1:0)}function Vx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"GT[]",t,n),e.push(n>t?1:0)}function jx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"GTEQ[]",t,n),e.push(n>=t?1:0)}function $x(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"EQ[]",t,n),e.push(t===n?1:0)}function Wx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"NEQ[]",t,n),e.push(t!==n?1:0)}function Hx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"ODD[]",t),e.push(Math.trunc(t)%2?1:0)}function qx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"EVEN[]",t),e.push(Math.trunc(t)%2?0:1)}function Yx(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"IF[]",e),e||(f0(s,!0),exports.DEBUG&&console.log(s.step,"EIF[]"))}function Xx(s){exports.DEBUG&&console.log(s.step,"EIF[]")}function Zx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"AND[]",t,n),e.push(t&&n?1:0)}function Kx(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"OR[]",t,n),e.push(t||n?1:0)}function Qx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"NOT[]",t),e.push(t?0:1)}function Wl(s,e){var t=e.stack,n=t.pop(),r=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(s-1)*16,c=e.deltaShift,u=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+s+"]",n,t);for(var p=0;p<n;p++){var g=t.pop(),m=t.pop(),y=l+((m&240)>>4);if(y===a){var A=(m&15)-8;A>=0&&A++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",A*c);var w=u[g];r.setRelative(w,w,A*c,i)}}}function Jx(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"SDB[]",t),s.deltaBase=t}function ew(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"SDS[]",t),s.deltaShift=Math.pow(.5,t)}function tw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"ADD[]",t,n),e.push(n+t)}function nw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"SUB[]",t,n),e.push(n-t)}function sw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"DIV[]",t,n),e.push(n*64/t)}function rw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"MUL[]",t,n),e.push(n*t/64)}function iw(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"ABS[]",t),e.push(Math.abs(t))}function aw(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"NEG[]",t),e.push(-t)}function ow(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"FLOOR[]",t),e.push(Math.floor(t/64)*64)}function lw(s){var e=s.stack,t=e.pop();exports.DEBUG&&console.log(s.step,"CEILING[]",t),e.push(Math.ceil(t/64)*64)}function _o(s,e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),t.push(e.round(n/64)*64)}function cw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"WCVTF[]",t,n),s.cvt[n]=t*s.ppem/s.font.unitsPerEm}function Hl(s,e){var t=e.stack,n=t.pop(),r=e.ppem,i=e.deltaBase+(s-1)*16,a=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+s+"]",n,t);for(var l=0;l<n;l++){var c=t.pop(),u=t.pop(),p=i+((u&240)>>4);if(p===r){var g=(u&15)-8;g>=0&&g++;var m=g*a;exports.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",m),e.cvt[c]+=m}}}function hw(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"SROUND[]",e),s.round=p0;var t;switch(e&192){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(s.srPeriod=t,e&48){case 0:s.srPhase=0;break;case 16:s.srPhase=.25*t;break;case 32:s.srPhase=.5*t;break;case 48:s.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?s.srThreshold=0:s.srThreshold=(e/8-.5)*t}function uw(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"S45ROUND[]",e),s.round=p0;var t;switch(e&192){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(s.srPeriod=t,e&48){case 0:s.srPhase=0;break;case 16:s.srPhase=.25*t;break;case 32:s.srPhase=.5*t;break;case 48:s.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?s.srThreshold=0:s.srThreshold=(e/8-.5)*t}function dw(s){exports.DEBUG&&console.log(s.step,"ROFF[]"),s.round=q2}function pw(s){exports.DEBUG&&console.log(s.step,"RUTG[]"),s.round=Z2}function fw(s){exports.DEBUG&&console.log(s.step,"RDTG[]"),s.round=K2}function gw(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"SCANCTRL[]",e)}function gd(s,e){var t=e.stack,n=t.pop(),r=t.pop(),i=e.z2[n],a=e.z1[r];exports.DEBUG&&console.log(e.step,"SDPVTL["+s+"]",n,r);var l,c;s?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=Ga(l,c)}function mw(s){var e=s.stack,t=e.pop(),n=0;exports.DEBUG&&console.log(s.step,"GETINFO[]",t),t&1&&(n=35),t&32&&(n|=4096),e.push(n)}function yw(s){var e=s.stack,t=e.pop(),n=e.pop(),r=e.pop();exports.DEBUG&&console.log(s.step,"ROLL[]"),e.push(n),e.push(t),e.push(r)}function vw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"MAX[]",t,n),e.push(Math.max(n,t))}function bw(s){var e=s.stack,t=e.pop(),n=e.pop();exports.DEBUG&&console.log(s.step,"MIN[]",t,n),e.push(Math.min(n,t))}function _w(s){var e=s.stack.pop();exports.DEBUG&&console.log(s.step,"SCANTYPE[]",e)}function xw(s){var e=s.stack.pop(),t=s.stack.pop();switch(exports.DEBUG&&console.log(s.step,"INSTCTRL[]",e,t),e){case 1:s.inhibitGridFit=!!t;return;case 2:s.ignoreCvt=!!t;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Qs(s,e){var t=e.stack,n=e.prog,r=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+s+"]");for(var i=0;i<s;i++)t.push(n[++r]);e.ip=r}function Js(s,e){var t=e.ip,n=e.prog,r=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+s+"]");for(var i=0;i<s;i++){var a=n[++t]<<8|n[++t];a&32768&&(a=-((a^65535)+1)),r.push(a)}e.ip=t}function be(s,e,t,n,r,i){var a=i.stack,l=s&&a.pop(),c=a.pop(),u=i.rp0,p=i.z0[u],g=i.z1[c],m=i.minDis,y=i.fv,A=i.dpv,w,C,E,L;C=w=A.distance(g,p,!0,!0),E=C>=0?1:-1,C=Math.abs(C),s&&(L=i.cvt[l],n&&Math.abs(C-L)<i.cvCutIn&&(C=L)),t&&C<m&&(C=m),n&&(C=i.round(C)),y.setRelative(g,p,E*C,A),y.touch(g),exports.DEBUG&&console.log(i.step,(s?"MIRP[":"MDRP[")+(e?"M":"m")+(t?">":"_")+(n?"R":"_")+(r===0?"Gr":r===1?"Bl":r===2?"Wh":"")+"]",s?l+"("+i.cvt[l]+","+L+")":"",c,"(d =",w,"->",E*C,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}c0=[td.bind(void 0,ks),td.bind(void 0,fs),nd.bind(void 0,ks),nd.bind(void 0,fs),sd.bind(void 0,ks),sd.bind(void 0,fs),rd.bind(void 0,0),rd.bind(void 0,1),id.bind(void 0,0),id.bind(void 0,1),J2,ex,tx,nx,sx,rx,ix,ax,ox,lx,cx,hx,ux,dx,px,fx,gx,mx,yx,vx,void 0,void 0,bx,$l,_x,xx,wx,Ex,Tx,void 0,void 0,void 0,Sx,Ax,Ix,void 0,ad.bind(void 0,0),ad.bind(void 0,1),od.bind(void 0,ks),od.bind(void 0,fs),ld.bind(void 0,0),ld.bind(void 0,1),cd.bind(void 0,0),cd.bind(void 0,1),hd.bind(void 0,0),hd.bind(void 0,1),Cx,kx,ud.bind(void 0,0),ud.bind(void 0,1),Mx,Px,dd.bind(void 0,0),dd.bind(void 0,1),Lx,Ox,Dx,Bx,Nx,Rx,pd.bind(void 0,0),pd.bind(void 0,1),void 0,fd.bind(void 0,0),fd.bind(void 0,1),Fx,void 0,zx,void 0,void 0,Ux,Gx,Vx,jx,$x,Wx,Hx,qx,Yx,Xx,Zx,Kx,Qx,Wl.bind(void 0,1),Jx,ew,tw,nw,sw,rw,iw,aw,ow,lw,_o.bind(void 0,0),_o.bind(void 0,1),_o.bind(void 0,2),_o.bind(void 0,3),void 0,void 0,void 0,void 0,cw,Wl.bind(void 0,2),Wl.bind(void 0,3),Hl.bind(void 0,1),Hl.bind(void 0,2),Hl.bind(void 0,3),hw,uw,void 0,void 0,dw,void 0,pw,fw,$l,$l,void 0,void 0,void 0,void 0,void 0,gw,gd.bind(void 0,0),gd.bind(void 0,1),mw,void 0,yw,vw,bw,_w,xw,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Qs.bind(void 0,1),Qs.bind(void 0,2),Qs.bind(void 0,3),Qs.bind(void 0,4),Qs.bind(void 0,5),Qs.bind(void 0,6),Qs.bind(void 0,7),Qs.bind(void 0,8),Js.bind(void 0,1),Js.bind(void 0,2),Js.bind(void 0,3),Js.bind(void 0,4),Js.bind(void 0,5),Js.bind(void 0,6),Js.bind(void 0,7),Js.bind(void 0,8),be.bind(void 0,0,0,0,0,0),be.bind(void 0,0,0,0,0,1),be.bind(void 0,0,0,0,0,2),be.bind(void 0,0,0,0,0,3),be.bind(void 0,0,0,0,1,0),be.bind(void 0,0,0,0,1,1),be.bind(void 0,0,0,0,1,2),be.bind(void 0,0,0,0,1,3),be.bind(void 0,0,0,1,0,0),be.bind(void 0,0,0,1,0,1),be.bind(void 0,0,0,1,0,2),be.bind(void 0,0,0,1,0,3),be.bind(void 0,0,0,1,1,0),be.bind(void 0,0,0,1,1,1),be.bind(void 0,0,0,1,1,2),be.bind(void 0,0,0,1,1,3),be.bind(void 0,0,1,0,0,0),be.bind(void 0,0,1,0,0,1),be.bind(void 0,0,1,0,0,2),be.bind(void 0,0,1,0,0,3),be.bind(void 0,0,1,0,1,0),be.bind(void 0,0,1,0,1,1),be.bind(void 0,0,1,0,1,2),be.bind(void 0,0,1,0,1,3),be.bind(void 0,0,1,1,0,0),be.bind(void 0,0,1,1,0,1),be.bind(void 0,0,1,1,0,2),be.bind(void 0,0,1,1,0,3),be.bind(void 0,0,1,1,1,0),be.bind(void 0,0,1,1,1,1),be.bind(void 0,0,1,1,1,2),be.bind(void 0,0,1,1,1,3),be.bind(void 0,1,0,0,0,0),be.bind(void 0,1,0,0,0,1),be.bind(void 0,1,0,0,0,2),be.bind(void 0,1,0,0,0,3),be.bind(void 0,1,0,0,1,0),be.bind(void 0,1,0,0,1,1),be.bind(void 0,1,0,0,1,2),be.bind(void 0,1,0,0,1,3),be.bind(void 0,1,0,1,0,0),be.bind(void 0,1,0,1,0,1),be.bind(void 0,1,0,1,0,2),be.bind(void 0,1,0,1,0,3),be.bind(void 0,1,0,1,1,0),be.bind(void 0,1,0,1,1,1),be.bind(void 0,1,0,1,1,2),be.bind(void 0,1,0,1,1,3),be.bind(void 0,1,1,0,0,0),be.bind(void 0,1,1,0,0,1),be.bind(void 0,1,1,0,0,2),be.bind(void 0,1,1,0,0,3),be.bind(void 0,1,1,0,1,0),be.bind(void 0,1,1,0,1,1),be.bind(void 0,1,1,0,1,2),be.bind(void 0,1,1,0,1,3),be.bind(void 0,1,1,1,0,0),be.bind(void 0,1,1,1,0,1),be.bind(void 0,1,1,1,0,2),be.bind(void 0,1,1,1,0,3),be.bind(void 0,1,1,1,1,0),be.bind(void 0,1,1,1,1,1),be.bind(void 0,1,1,1,1,2),be.bind(void 0,1,1,1,1,3)];function Ri(s){this.char=s,this.state={},this.activeState=null}function Ih(s,e,t){this.contextName=t,this.startIndex=s,this.endOffset=e}function ww(s,e,t){this.contextName=s,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=t}function Qn(s,e){this.context=s,this.index=e,this.length=s.length,this.current=s[e],this.backtrack=s.slice(0,e),this.lookahead=s.slice(e+1)}function ol(s){this.eventId=s,this.subscribers=[]}function Sw(s){var e=this,t=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];t.forEach(function(r){Object.defineProperty(e.events,r,{value:new ol(r)})}),s&&t.forEach(function(r){var i=s[r];typeof i=="function"&&e.events[r].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(r){e.events[r].subscribe(e.updateContextsRanges)})}function kt(s){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Sw.call(this,s)}Ri.prototype.setState=function(s,e){return this.state[s]=e,this.activeState={key:s,value:this.state[s]},this.activeState};Ri.prototype.getState=function(s){return this.state[s]||null};kt.prototype.inboundIndex=function(s){return s>=0&&s<this.tokens.length};kt.prototype.composeRUD=function(s){var e=this,t=!0,n=s.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(t))}),r=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(r))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(r)};this.dispatch("composeRUD",[n.filter(function(i){return!r(i)})])};kt.prototype.replaceRange=function(s,e,t,n){e=e!==null?e:this.tokens.length;var r=t.every(function(a){return a instanceof Ri});if(!isNaN(s)&&this.inboundIndex(s)&&r){var i=this.tokens.splice.apply(this.tokens,[s,e].concat(t));return n||this.dispatch("replaceToken",[s,e,t]),[i,t]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};kt.prototype.replaceToken=function(s,e,t){if(!isNaN(s)&&this.inboundIndex(s)&&e instanceof Ri){var n=this.tokens.splice(s,1,e);return t||this.dispatch("replaceToken",[s,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};kt.prototype.removeRange=function(s,e,t){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(s,e);return t||this.dispatch("removeRange",[n,s,e]),n};kt.prototype.removeToken=function(s,e){if(!isNaN(s)&&this.inboundIndex(s)){var t=this.tokens.splice(s,1);return e||this.dispatch("removeToken",[t,s]),t}else return{FAIL:"removeToken: invalid token index."}};kt.prototype.insertToken=function(s,e,t){var n=s.every(function(r){return r instanceof Ri});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(s)),t||this.dispatch("insertToken",[s,e]),s):{FAIL:"insertToken: invalid token(s)."}};kt.prototype.registerModifier=function(s,e,t){this.events.newToken.subscribe(function(n,r){var i=[n,r],a=e===null||e.apply(this,i)===!0,l=[n,r];if(a){var c=t.apply(this,l);n.setState(s,c)}}),this.registeredModifiers.push(s)};ol.prototype.subscribe=function(s){return typeof s=="function"?this.subscribers.push(s)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};ol.prototype.unsubscribe=function(s){this.subscribers.splice(s,1)};Qn.prototype.setCurrentIndex=function(s){this.index=s,this.current=this.context[s],this.backtrack=this.context.slice(0,s),this.lookahead=this.context.slice(s+1)};Qn.prototype.get=function(s){switch(!0){case s===0:return this.current;case(s<0&&Math.abs(s)<=this.backtrack.length):return this.backtrack.slice(s)[0];case(s>0&&s<=this.lookahead.length):return this.lookahead[s-1];default:return null}};kt.prototype.rangeToText=function(s){if(s instanceof Ih)return this.getRangeTokens(s).map(function(e){return e.char}).join("")};kt.prototype.getText=function(){return this.tokens.map(function(s){return s.char}).join("")};kt.prototype.getContext=function(s){var e=this.registeredContexts[s];return e||null};kt.prototype.on=function(s,e){var t=this.events[s];return t?t.subscribe(e):null};kt.prototype.dispatch=function(s,e){var t=this,n=this.events[s];n instanceof ol&&n.subscribers.forEach(function(r){r.apply(t,e||[])})};kt.prototype.registerContextChecker=function(s,e,t){if(this.getContext(s))return{FAIL:"context name '"+s+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof t!="function")return{FAIL:"missing context end check."};var n=new ww(s,e,t);return this.registeredContexts[s]=n,this.contextCheckers.push(n),n};kt.prototype.getRangeTokens=function(s){var e=s.startIndex+s.endOffset;return[].concat(this.tokens.slice(s.startIndex,e))};kt.prototype.getContextRanges=function(s){var e=this.getContext(s);return e?e.ranges:{FAIL:"context checker '"+s+"' is not registered."}};kt.prototype.resetContextsRanges=function(){var s=this.registeredContexts;for(var e in s)if(s.hasOwnProperty(e)){var t=s[e];t.ranges=[]}};kt.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var s=this.tokens.map(function(n){return n.char}),e=0;e<s.length;e++){var t=new Qn(s,e);this.runContextCheck(t)}this.dispatch("updateContextsRanges",[this.registeredContexts])};kt.prototype.setEndOffset=function(s,e){var t=this.getContext(e).openRange.startIndex,n=new Ih(t,s,e),r=this.getContext(e).ranges;return n.rangeId=e+"."+r.length,r.push(n),this.getContext(e).openRange=null,n};kt.prototype.runContextCheck=function(s){var e=this,t=s.index;this.contextCheckers.forEach(function(n){var r=n.contextName,i=e.getContext(r).openRange;if(!i&&n.checkStart(s)&&(i=new Ih(t,null,r),e.getContext(r).openRange=i,e.dispatch("contextStart",[r,t])),i&&n.checkEnd(s)){var a=t-i.startIndex+1,l=e.setEndOffset(a,r);e.dispatch("contextEnd",[r,l])}})};kt.prototype.tokenize=function(s){this.tokens=[],this.resetContextsRanges();var e=Array.from(s);this.dispatch("start");for(var t=0;t<e.length;t++){var n=e[t],r=new Qn(e,t);this.dispatch("next",[r]),this.runContextCheck(r);var i=new Ri(n);this.tokens.push(i),this.dispatch("newToken",[i,r])}return this.dispatch("end",[this.tokens]),this.tokens};function ur(s){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(s)}function g0(s){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(s)}function pr(s){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(s)}function zo(s){return/[A-z]/.test(s)}function Aw(s){return/\s/.test(s)}function wn(s){this.font=s,this.features={}}function kr(s){this.id=s.id,this.tag=s.tag,this.substitution=s.substitution}function Va(s,e){if(!s)return-1;switch(e.format){case 1:return e.glyphs.indexOf(s);case 2:for(var t=e.ranges,n=0;n<t.length;n++){var r=t[n];if(s>=r.start&&s<=r.end){var i=s-r.start;return r.index+i}}break;default:return-1}return-1}function Ew(s,e){var t=Va(s,e.coverage);return t===-1?null:s+e.deltaGlyphId}function Tw(s,e){var t=Va(s,e.coverage);return t===-1?null:e.substitute[t]}function ql(s,e){for(var t=[],n=0;n<s.length;n++){var r=s[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=Va(i,r);a!==-1&&t.push(a)}return t.length!==s.length?-1:t}function Iw(s,e){var t=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(s.context.length<t)return[];var n=ql(e.inputCoverage,s);if(n===-1)return[];var r=e.inputCoverage.length-1;if(s.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=s.lookahead.slice(r);i.length&&pr(i[0].char);)i.shift();var a=new Qn(i,0),l=ql(e.lookaheadCoverage,a),c=[].concat(s.backtrack);for(c.reverse();c.length&&pr(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var u=new Qn(c,0),p=ql(e.backtrackCoverage,u),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&p.length===e.backtrackCoverage.length,m=[];if(g)for(var y=0;y<e.lookupRecords.length;y++)for(var A=e.lookupRecords[y],w=A.lookupListIndex,C=this.getLookupByIndex(w),E=0;E<C.subtables.length;E++){var L=C.subtables[E],O=this.getLookupMethod(C,L),F=this.getSubstitutionType(C,L);if(F==="12")for(var B=0;B<n.length;B++){var Z=s.get(B),W=O(Z);W&&m.push(W)}}return m}function Cw(s,e){var t=s.current,n=Va(t,e.coverage);if(n===-1)return null;for(var r,i=e.ligatureSets[n],a=0;a<i.length;a++){r=i[a];for(var l=0;l<r.components.length;l++){var c=s.lookahead[l],u=r.components[l];if(c!==u)break;if(l===r.components.length-1)return r}}return null}function kw(s,e){var t=Va(s,e.coverage);return t===-1?null:e.sequences[t]}wn.prototype.getDefaultScriptFeaturesIndexes=function(){for(var s=this.font.tables.gsub.scripts,e=0;e<s.length;e++){var t=s[e];if(t.tag==="DFLT")return t.script.defaultLangSys.featureIndexes}return[]};wn.prototype.getScriptFeaturesIndexes=function(s){var e=this.font.tables;if(!e.gsub)return[];if(!s)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,n=0;n<t.length;n++){var r=t[n];if(r.tag===s&&r.script.defaultLangSys)return r.script.defaultLangSys.featureIndexes;var i=r.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===s){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};wn.prototype.mapTagsToFeatures=function(s,e){for(var t={},n=0;n<s.length;n++){var r=s[n].tag,i=s[n].feature;t[r]=i}this.features[e].tags=t};wn.prototype.getScriptFeatures=function(s){var e=this.features[s];if(this.features.hasOwnProperty(s))return e;var t=this.getScriptFeaturesIndexes(s);if(!t)return null;var n=this.font.tables.gsub;return e=t.map(function(r){return n.features[r]}),this.features[s]=e,this.mapTagsToFeatures(e,s),e};wn.prototype.getSubstitutionType=function(s,e){var t=s.lookupType.toString(),n=e.substFormat.toString();return t+n};wn.prototype.getLookupMethod=function(s,e){var t=this,n=this.getSubstitutionType(s,e);switch(n){case"11":return function(r){return Ew.apply(t,[r,e])};case"12":return function(r){return Tw.apply(t,[r,e])};case"63":return function(r){return Iw.apply(t,[r,e])};case"41":return function(r){return Cw.apply(t,[r,e])};case"21":return function(r){return kw.apply(t,[r,e])};default:throw new Error("lookupType: "+s.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};wn.prototype.lookupFeature=function(s){var e=s.contextParams,t=e.index,n=this.getFeature({tag:s.tag,script:s.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+s.tag+"' for script '"+s.script+"'.");for(var r=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<r.length;a++)for(var l=r[a],c=this.getLookupSubtables(l),u=0;u<c.length;u++){var p=c[u],g=this.getSubstitutionType(l,p),m=this.getLookupMethod(l,p),y=void 0;switch(g){case"11":y=m(e.current),y&&i.splice(t,1,new kr({id:11,tag:s.tag,substitution:y}));break;case"12":y=m(e.current),y&&i.splice(t,1,new kr({id:12,tag:s.tag,substitution:y}));break;case"63":y=m(e),Array.isArray(y)&&y.length&&i.splice(t,1,new kr({id:63,tag:s.tag,substitution:y}));break;case"41":y=m(e),y&&i.splice(t,1,new kr({id:41,tag:s.tag,substitution:y}));break;case"21":y=m(e.current),y&&i.splice(t,1,new kr({id:21,tag:s.tag,substitution:y}));break}e=new Qn(i,t),!(Array.isArray(y)&&!y.length)&&(y=null)}return i.length?i:null};wn.prototype.supports=function(s){if(!s.script)return!1;this.getScriptFeatures(s.script);var e=this.features.hasOwnProperty(s.script);if(!s.tag)return e;var t=this.features[s.script].some(function(n){return n.tag===s.tag});return e&&t};wn.prototype.getLookupSubtables=function(s){return s.subtables||null};wn.prototype.getLookupByIndex=function(s){var e=this.font.tables.gsub.lookups;return e[s]||null};wn.prototype.getFeatureLookups=function(s){return s.lookupListIndexes.map(this.getLookupByIndex.bind(this))};wn.prototype.getFeature=function(s){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(s.script)||this.getScriptFeatures(s.script);var e=this.features[s.script];return e?e.tags[s.tag]?this.features[s.script].tags[s.tag]:null:{FAIL:"No feature for script "+s.script}};function Mw(s){var e=s.current,t=s.get(-1);return t===null&&ur(e)||!ur(t)&&ur(e)}function Pw(s){var e=s.get(1);return e===null||!ur(e)}var Lw={startCheck:Mw,endCheck:Pw};function Ow(s){var e=s.current,t=s.get(-1);return(ur(e)||pr(e))&&!ur(t)}function Dw(s){var e=s.get(1);switch(!0){case e===null:return!0;case(!ur(e)&&!pr(e)):var t=Aw(e);if(!t)return!0;if(t){var n=!1;if(n=s.lookahead.some(function(r){return ur(r)||pr(r)}),!n)return!0}break;default:return!1}}var Bw={startCheck:Ow,endCheck:Dw};function Nw(s,e,t){e[t].setState(s.tag,s.substitution)}function Rw(s,e,t){e[t].setState(s.tag,s.substitution)}function Fw(s,e,t){s.substitution.forEach(function(n,r){var i=e[t+r];i.setState(s.tag,n)})}function zw(s,e,t){var n=e[t];n.setState(s.tag,s.substitution.ligGlyph);for(var r=s.substitution.components.length,i=0;i<r;i++)n=e[t+i+1],n.setState("deleted",!0)}var md={11:Nw,12:Rw,63:Fw,41:zw};function Ch(s,e,t){s instanceof kr&&md[s.id]&&md[s.id](s,e,t)}function Uw(s){for(var e=[].concat(s.backtrack),t=e.length-1;t>=0;t--){var n=e[t],r=g0(n),i=pr(n);if(!r&&!i)return!0;if(r)return!1}return!1}function Gw(s){if(g0(s.current))return!1;for(var e=0;e<s.lookahead.length;e++){var t=s.lookahead[e],n=pr(t);if(!n)return!0}return!1}function Vw(s){var e=this,t="arab",n=this.featuresTags[t],r=this.tokenizer.getRangeTokens(s);if(r.length!==1){var i=new Qn(r.map(function(l){return l.getState("glyphIndex")}),0),a=new Qn(r.map(function(l){return l.char}),0);r.forEach(function(l,c){if(!pr(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var u=0;Uw(a)&&(u|=1),Gw(a)&&(u|=2);var p;switch(u){case 1:p="fina";break;case 2:p="init";break;case 3:p="medi";break}if(n.indexOf(p)!==-1){var g=e.query.lookupFeature({tag:p,script:t,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(m,y){m instanceof kr&&(Ch(m,r,y),i.context[y]=m.substitution)})}}})}}function yd(s,e){var t=s.map(function(n){return n.activeState.value});return new Qn(t,0)}function jw(s){var e=this,t="arab",n=this.tokenizer.getRangeTokens(s),r=yd(n);r.context.forEach(function(i,a){r.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:t,contextParams:r});l.length&&(l.forEach(function(c){return Ch(c,n,a)}),r=yd(n))})}function $w(s){var e=s.current,t=s.get(-1);return t===null&&zo(e)||!zo(t)&&zo(e)}function Ww(s){var e=s.get(1);return e===null||!zo(e)}var Hw={startCheck:$w,endCheck:Ww};function vd(s,e){var t=s.map(function(n){return n.activeState.value});return new Qn(t,0)}function qw(s){var e=this,t="latn",n=this.tokenizer.getRangeTokens(s),r=vd(n);r.context.forEach(function(i,a){r.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:t,contextParams:r});l.length&&(l.forEach(function(c){return Ch(c,n,a)}),r=vd(n))})}function ts(s){this.baseDir=s||"ltr",this.tokenizer=new kt,this.featuresTags={}}ts.prototype.setText=function(s){this.text=s};ts.prototype.contextChecks={latinWordCheck:Hw,arabicWordCheck:Lw,arabicSentenceCheck:Bw};function Yl(s){var e=this.contextChecks[s+"Check"];return this.tokenizer.registerContextChecker(s,e.startCheck,e.endCheck)}function Yw(){return Yl.call(this,"latinWord"),Yl.call(this,"arabicWord"),Yl.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Xw(){var s=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(t){var n=s.tokenizer.getRangeTokens(t);s.tokenizer.replaceRange(t.startIndex,t.endOffset,n.reverse())})}ts.prototype.registerFeatures=function(s,e){var t=this,n=e.filter(function(r){return t.query.supports({script:s,tag:r})});this.featuresTags.hasOwnProperty(s)?this.featuresTags[s]=this.featuresTags[s].concat(n):this.featuresTags[s]=n};ts.prototype.applyFeatures=function(s,e){if(!s)throw new Error("No valid font was provided to apply features");this.query||(this.query=new wn(s));for(var t=0;t<e.length;t++){var n=e[t];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};ts.prototype.registerModifier=function(s,e,t){this.tokenizer.registerModifier(s,e,t)};function kh(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Zw(){var s=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){kh.call(this);var t=this.tokenizer.getContextRanges("arabicWord");t.forEach(function(n){Vw.call(s,n)})}}function Kw(){var s=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("rlig")!==-1){kh.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(r){jw.call(s,r)})}}}function Qw(){var s=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var t=this.featuresTags[e];if(t.indexOf("liga")!==-1){kh.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(r){qw.call(s,r)})}}}ts.prototype.checkContextReady=function(s){return!!this.tokenizer.getContext(s)};ts.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Zw.call(this),Kw.call(this)),this.checkContextReady("latinWord")&&Qw.call(this),this.checkContextReady("arabicSentence")&&Xw.call(this)};ts.prototype.processText=function(s){(!this.text||this.text!==s)&&(this.setText(s),Yw.call(this),this.applyFeaturesToContexts())};ts.prototype.getBidiText=function(s){return this.processText(s),this.tokenizer.getText()};ts.prototype.getTextGlyphs=function(s){this.processText(s);for(var e=[],t=0;t<this.tokenizer.tokens.length;t++){var n=this.tokenizer.tokens[t];if(!n.state.deleted){var r=n.activeState.value;e.push(Array.isArray(r)?r[0]:r)}}return e};function yt(s){s=s||{},s.tables=s.tables||{},s.empty||(ea(s.familyName,"When creating a new Font object, familyName is required."),ea(s.styleName,"When creating a new Font object, styleName is required."),ea(s.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),ea(s.ascender,"When creating a new Font object, ascender is required."),ea(s.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:s.familyName||" "},fontSubfamily:{en:s.styleName||" "},fullName:{en:s.fullName||s.familyName+" "+s.styleName},postScriptName:{en:s.postScriptName||(s.familyName+s.styleName).replace(/\s/g,"")},designer:{en:s.designer||" "},designerURL:{en:s.designerURL||" "},manufacturer:{en:s.manufacturer||" "},manufacturerURL:{en:s.manufacturerURL||" "},license:{en:s.license||" "},licenseURL:{en:s.licenseURL||" "},version:{en:s.version||"Version 0.1"},description:{en:s.description||" "},copyright:{en:s.copyright||" "},trademark:{en:s.trademark||" "}},this.unitsPerEm=s.unitsPerEm||1e3,this.ascender=s.ascender,this.descender=s.descender,this.createdTimestamp=s.createdTimestamp,this.tables=Object.assign(s.tables,{os2:Object.assign({usWeightClass:s.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:s.widthClass||this.usWidthClasses.MEDIUM,fsSelection:s.fsSelection||this.fsSelectionValues.REGULAR},s.tables.os2)})),this.supported=!0,this.glyphs=new gs.GlyphSet(this,s.glyphs||[]),this.encoding=new Dm(this),this.position=new za(this),this.substitution=new xn(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new u0(this)}})}yt.prototype.hasChar=function(s){return this.encoding.charToGlyphIndex(s)!==null};yt.prototype.charToGlyphIndex=function(s){return this.encoding.charToGlyphIndex(s)};yt.prototype.charToGlyph=function(s){var e=this.charToGlyphIndex(s),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t};yt.prototype.updateFeatures=function(s){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(t){return s[t]})}:e})};yt.prototype.stringToGlyphs=function(s,e){var t=this,n=new ts,r=function(g){return t.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,r);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(s),l=a.length,c=new Array(l),u=this.glyphs.get(0),p=0;p<l;p+=1)c[p]=this.glyphs.get(a[p])||u;return c};yt.prototype.nameToGlyphIndex=function(s){return this.glyphNames.nameToGlyphIndex(s)};yt.prototype.nameToGlyph=function(s){var e=this.nameToGlyphIndex(s),t=this.glyphs.get(e);return t||(t=this.glyphs.get(0)),t};yt.prototype.glyphIndexToName=function(s){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(s):""};yt.prototype.getKerningValue=function(s,e){s=s.index||s,e=e.index||e;var t=this.position.defaultKerningTables;return t?this.position.getKerningValue(t,s,e):this.kerningPairs[s+","+e]||0};yt.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};yt.prototype.forEachGlyph=function(s,e,t,n,r,i){e=e!==void 0?e:0,t=t!==void 0?t:0,n=n!==void 0?n:72,r=Object.assign({},this.defaultRenderOptions,r);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(s,r),c;if(r.kerning){var u=r.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(u,r.language)}for(var p=0;p<l.length;p+=1){var g=l[p];if(i.call(this,g,e,t,n,r),g.advanceWidth&&(e+=g.advanceWidth*a),r.kerning&&p<l.length-1){var m=c?this.position.getKerningValue(c,g.index,l[p+1].index):this.getKerningValue(g,l[p+1]);e+=m*a}r.letterSpacing?e+=r.letterSpacing*n:r.tracking&&(e+=r.tracking/1e3*n)}return e};yt.prototype.getPath=function(s,e,t,n,r){var i=new zt;return this.forEachGlyph(s,e,t,n,r,function(a,l,c,u){var p=a.getPath(l,c,u,r,this);i.extend(p)}),i};yt.prototype.getPaths=function(s,e,t,n,r){var i=[];return this.forEachGlyph(s,e,t,n,r,function(a,l,c,u){var p=a.getPath(l,c,u,r,this);i.push(p)}),i};yt.prototype.getAdvanceWidth=function(s,e,t){return this.forEachGlyph(s,0,0,e,t,function(){})};yt.prototype.draw=function(s,e,t,n,r,i){this.getPath(e,t,n,r,i).draw(s)};yt.prototype.drawPoints=function(s,e,t,n,r,i){this.forEachGlyph(e,t,n,r,i,function(a,l,c,u){a.drawPoints(s,l,c,u)})};yt.prototype.drawMetrics=function(s,e,t,n,r,i){this.forEachGlyph(e,t,n,r,i,function(a,l,c,u){a.drawMetrics(s,l,c,u)})};yt.prototype.getEnglishName=function(s){var e=this.names[s];if(e)return e.en};yt.prototype.validate=function(){var s=this;function e(t){var n=s.getEnglishName(t);n&&n.trim().length>0}e("fontFamily"),e("weightName"),e("manufacturer"),e("copyright"),e("version"),this.unitsPerEm>0};yt.prototype.toTables=function(){return z2.fontToTable(this)};yt.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};yt.prototype.toArrayBuffer=function(){for(var s=this.toTables(),e=s.encode(),t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e[r];return t};yt.prototype.download=function(s){var e=this.getEnglishName("fontFamily"),t=this.getEnglishName("fontSubfamily");s=s||e.replace(/\s/g,"")+"-"+t+".otf";var n=this.toArrayBuffer();if(G2())if(window.URL=window.URL||window.webkitURL,window.URL){var r=new DataView(n),i=new Blob([r],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=s;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),u=V2(n);c.writeFileSync(s,u)}};yt.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};yt.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};yt.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function m0(s,e){var t=JSON.stringify(s),n=256;for(var r in e){var i=parseInt(r);if(!(!i||i<256)){if(JSON.stringify(e[r])===t)return i;n<=i&&(n=i+1)}}return e[n]=s,n}function Jw(s,e,t){var n=m0(e.name,t);return[{name:"tag_"+s,type:"TAG",value:e.tag},{name:"minValue_"+s,type:"FIXED",value:e.minValue<<16},{name:"defaultValue_"+s,type:"FIXED",value:e.defaultValue<<16},{name:"maxValue_"+s,type:"FIXED",value:e.maxValue<<16},{name:"flags_"+s,type:"USHORT",value:0},{name:"nameID_"+s,type:"USHORT",value:n}]}function e4(s,e,t){var n={},r=new _e.Parser(s,e);return n.tag=r.parseTag(),n.minValue=r.parseFixed(),n.defaultValue=r.parseFixed(),n.maxValue=r.parseFixed(),r.skip("uShort",1),n.name=t[r.parseUShort()]||{},n}function t4(s,e,t,n){for(var r=m0(e.name,n),i=[{name:"nameID_"+s,type:"USHORT",value:r},{name:"flags_"+s,type:"USHORT",value:0}],a=0;a<t.length;++a){var l=t[a].tag;i.push({name:"axis_"+s+" "+l,type:"FIXED",value:e.coordinates[l]<<16})}return i}function n4(s,e,t,n){var r={},i=new _e.Parser(s,e);r.name=n[i.parseUShort()]||{},i.skip("uShort",1),r.coordinates={};for(var a=0;a<t.length;++a)r.coordinates[t[a].tag]=i.parseFixed();return r}function s4(s,e){var t=new fe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:s.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:s.instances.length},{name:"instanceSize",type:"USHORT",value:4+s.axes.length*4}]);t.offsetToData=t.sizeOf();for(var n=0;n<s.axes.length;n++)t.fields=t.fields.concat(Jw(n,s.axes[n],e));for(var r=0;r<s.instances.length;r++)t.fields=t.fields.concat(t4(r,s.instances[r],s.axes,e));return t}function r4(s,e,t){var n=new _e.Parser(s,e),r=n.parseULong();Ne.argument(r===65536,"Unsupported fvar table version.");var i=n.parseOffset16();n.skip("uShort",1);for(var a=n.parseUShort(),l=n.parseUShort(),c=n.parseUShort(),u=n.parseUShort(),p=[],g=0;g<a;g++)p.push(e4(s,e+i+g*l,t));for(var m=[],y=e+i+a*l,A=0;A<c;A++)m.push(n4(s,y+A*u,p,t));return{axes:p,instances:m}}var i4={make:s4,parse:r4},a4=function(){return{coverage:this.parsePointer(q.coverage),attachPoints:this.parseList(q.pointer(q.uShortList))}},o4=function(){var s=this.parseUShort();if(Ne.argument(s===1||s===2||s===3,"Unsupported CaretValue table version."),s===1)return{coordinate:this.parseShort()};if(s===2)return{pointindex:this.parseShort()};if(s===3)return{coordinate:this.parseShort()}},l4=function(){return this.parseList(q.pointer(o4))},c4=function(){return{coverage:this.parsePointer(q.coverage),ligGlyphs:this.parseList(q.pointer(l4))}},h4=function(){return this.parseUShort(),this.parseList(q.pointer(q.coverage))};function u4(s,e){e=e||0;var t=new q(s,e),n=t.parseVersion(1);Ne.argument(n===1||n===1.2||n===1.3,"Unsupported GDEF table version.");var r={version:n,classDef:t.parsePointer(q.classDef),attachList:t.parsePointer(a4),ligCaretList:t.parsePointer(c4),markAttachClassDef:t.parsePointer(q.classDef)};return n>=1.2&&(r.markGlyphSets=t.parsePointer(h4)),r}var d4={parse:u4},Jn=new Array(10);Jn[1]=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{posFormat:1,coverage:this.parsePointer(q.coverage),value:this.parseValueRecord()};if(e===2)return{posFormat:2,coverage:this.parsePointer(q.coverage),values:this.parseValueRecordList()};Ne.assert(!1,"0x"+s.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Jn[2]=function(){var s=this.offset+this.relativeOffset,e=this.parseUShort();Ne.assert(e===1||e===2,"0x"+s.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var t=this.parsePointer(q.coverage),n=this.parseUShort(),r=this.parseUShort();if(e===1)return{posFormat:e,coverage:t,valueFormat1:n,valueFormat2:r,pairSets:this.parseList(q.pointer(q.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(n),value2:this.parseValueRecord(r)}})))};if(e===2){var i=this.parsePointer(q.classDef),a=this.parsePointer(q.classDef),l=this.parseUShort(),c=this.parseUShort();return{posFormat:e,coverage:t,valueFormat1:n,valueFormat2:r,classDef1:i,classDef2:a,class1Count:l,class2Count:c,classRecords:this.parseList(l,q.list(c,function(){return{value1:this.parseValueRecord(n),value2:this.parseValueRecord(r)}}))}}};Jn[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Jn[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Jn[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Jn[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Jn[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Jn[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Jn[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function p4(s,e){e=e||0;var t=new q(s,e),n=t.parseVersion(1);return Ne.argument(n===1||n===1.1,"Unsupported GPOS table version "+n),n===1?{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(Jn)}:{version:n,scripts:t.parseScriptList(),features:t.parseFeatureList(),lookups:t.parseLookupList(Jn),variations:t.parseFeatureVariationsList()}}var f4=new Array(10);function g4(s){return new fe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new fe.ScriptList(s.scripts)},{name:"features",type:"TABLE",value:new fe.FeatureList(s.features)},{name:"lookups",type:"TABLE",value:new fe.LookupList(s.lookups,f4)}])}var m4={parse:p4,make:g4};function y4(s){var e={};s.skip("uShort");var t=s.parseUShort();Ne.argument(t===0,"Unsupported kern sub-table version."),s.skip("uShort",2);var n=s.parseUShort();s.skip("uShort",3);for(var r=0;r<n;r+=1){var i=s.parseUShort(),a=s.parseUShort(),l=s.parseShort();e[i+","+a]=l}return e}function v4(s){var e={};s.skip("uShort");var t=s.parseULong();t>1&&console.warn("Only the first kern subtable is supported."),s.skip("uLong");var n=s.parseUShort(),r=n&255;if(s.skip("uShort"),r===0){var i=s.parseUShort();s.skip("uShort",3);for(var a=0;a<i;a+=1){var l=s.parseUShort(),c=s.parseUShort(),u=s.parseShort();e[l+","+c]=u}}return e}function b4(s,e){var t=new _e.Parser(s,e),n=t.parseUShort();if(n===0)return y4(t);if(n===1)return v4(t);throw new Error("Unsupported kern table version ("+n+").")}var _4={parse:b4};function x4(s,e,t,n){for(var r=new _e.Parser(s,e),i=n?r.parseUShort:r.parseULong,a=[],l=0;l<t+1;l+=1){var c=i.call(r);n&&(c*=2),a.push(c)}return a}var w4={parse:x4};function bd(s,e){for(var t=[],n=12,r=0;r<e;r+=1){var i=_e.getTag(s,n),a=_e.getULong(s,n+4),l=_e.getULong(s,n+8),c=_e.getULong(s,n+12);t.push({tag:i,checksum:a,offset:l,length:c,compression:!1}),n+=16}return t}function S4(s,e){for(var t=[],n=44,r=0;r<e;r+=1){var i=_e.getTag(s,n),a=_e.getULong(s,n+4),l=_e.getULong(s,n+8),c=_e.getULong(s,n+12),u=void 0;l<c?u="WOFF":u=!1,t.push({tag:i,offset:a,compression:u,compressedLength:l,length:c}),n+=20}return t}function Pt(s,e){if(e.compression==="WOFF"){var t=new Uint8Array(s.buffer,e.offset+2,e.compressedLength-2),n=new Uint8Array(e.length);if(m_(t,n),n.byteLength!==e.length)throw new Error("Decompression error: "+e.tag+" decompressed length doesn't match recorded length");var r=new DataView(n.buffer,0);return{data:r,offset:0}}else return{data:s,offset:e.offset}}function A4(s,e){e=e??{};var t,n,r=new yt({empty:!0}),i=new DataView(s,0),a,l=[],c=_e.getTag(i,0);if(c==="\0\0\0"||c==="true"||c==="typ1")r.outlinesFormat="truetype",a=_e.getUShort(i,4),l=bd(i,a);else if(c==="OTTO")r.outlinesFormat="cff",a=_e.getUShort(i,4),l=bd(i,a);else if(c==="wOFF"){var u=_e.getTag(i,4);if(u==="\0\0\0")r.outlinesFormat="truetype";else if(u==="OTTO")r.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+c);a=_e.getUShort(i,12),l=S4(i,a)}else throw new Error("Unsupported OpenType signature "+c);for(var p,g,m,y,A,w,C,E,L,O,F,B,Z=0;Z<a;Z+=1){var W=l[Z],Q=void 0;switch(W.tag){case"cmap":Q=Pt(i,W),r.tables.cmap=Om.parse(Q.data,Q.offset),r.encoding=new Bm(r.tables.cmap);break;case"cvt ":Q=Pt(i,W),B=new _e.Parser(Q.data,Q.offset),r.tables.cvt=B.parseShortList(W.length/2);break;case"fvar":g=W;break;case"fpgm":Q=Pt(i,W),B=new _e.Parser(Q.data,Q.offset),r.tables.fpgm=B.parseByteList(W.length);break;case"head":Q=Pt(i,W),r.tables.head=Wm.parse(Q.data,Q.offset),r.unitsPerEm=r.tables.head.unitsPerEm,t=r.tables.head.indexToLocFormat;break;case"hhea":Q=Pt(i,W),r.tables.hhea=Hm.parse(Q.data,Q.offset),r.ascender=r.tables.hhea.ascender,r.descender=r.tables.hhea.descender,r.numberOfHMetrics=r.tables.hhea.numberOfHMetrics;break;case"hmtx":C=W;break;case"ltag":Q=Pt(i,W),n=Ym.parse(Q.data,Q.offset);break;case"maxp":Q=Pt(i,W),r.tables.maxp=Xm.parse(Q.data,Q.offset),r.numGlyphs=r.tables.maxp.numGlyphs;break;case"name":O=W;break;case"OS/2":Q=Pt(i,W),r.tables.os2=jc.parse(Q.data,Q.offset);break;case"post":Q=Pt(i,W),r.tables.post=t0.parse(Q.data,Q.offset),r.glyphNames=new Sh(r.tables.post);break;case"prep":Q=Pt(i,W),B=new _e.Parser(Q.data,Q.offset),r.tables.prep=B.parseByteList(W.length);break;case"glyf":m=W;break;case"loca":L=W;break;case"CFF ":p=W;break;case"kern":E=W;break;case"GDEF":y=W;break;case"GPOS":A=W;break;case"GSUB":w=W;break;case"meta":F=W;break}}var ye=Pt(i,O);if(r.tables.name=e0.parse(ye.data,ye.offset,n),r.names=r.tables.name,m&&L){var Se=t===0,ge=Pt(i,L),Le=w4.parse(ge.data,ge.offset,r.numGlyphs,Se),Je=Pt(i,m);r.glyphs=l0.parse(Je.data,Je.offset,Le,r,e)}else if(p){var Ge=Pt(i,p);$m.parse(Ge.data,Ge.offset,r,e)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var Ze=Pt(i,C);if(qm.parse(r,Ze.data,Ze.offset,r.numberOfHMetrics,r.numGlyphs,r.glyphs,e),R_(r,e),E){var Fe=Pt(i,E);r.kerningPairs=_4.parse(Fe.data,Fe.offset)}else r.kerningPairs={};if(y){var Xe=Pt(i,y);r.tables.gdef=d4.parse(Xe.data,Xe.offset)}if(A){var ie=Pt(i,A);r.tables.gpos=m4.parse(ie.data,ie.offset),r.position.init()}if(w){var Ee=Pt(i,w);r.tables.gsub=n0.parse(Ee.data,Ee.offset)}if(g){var et=Pt(i,g);r.tables.fvar=i4.parse(et.data,et.offset,r.names)}if(F){var Me=Pt(i,F);r.tables.meta=s0.parse(Me.data,Me.offset),r.metas=r.tables.meta}return r}function _d(s,e=!1){const t=s[0].index!==null,n=new Set(Object.keys(s[0].attributes)),r=new Set(Object.keys(s[0].morphAttributes)),i={},a={},l=s[0].morphTargetsRelative,c=new It;let u=0;for(let p=0;p<s.length;++p){const g=s[p];let m=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const y in g.attributes){if(!n.has(y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+'. All geometries must have compatible attributes; make sure "'+y+'" attribute exists among all geometries, or in none of them.'),null;i[y]===void 0&&(i[y]=[]),i[y].push(g.attributes[y]),m++}if(m!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". Make sure all geometries have the same number of attributes."),null;if(l!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const y in g.morphAttributes){if(!r.has(y))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+".  .morphAttributes must be consistent throughout all geometries."),null;a[y]===void 0&&(a[y]=[]),a[y].push(g.morphAttributes[y])}if(e){let y;if(t)y=g.index.count;else if(g.attributes.position!==void 0)y=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". The geometry must have either an index or a position attribute"),null;c.addGroup(u,y,p),u+=y}}if(t){let p=0;const g=[];for(let m=0;m<s.length;++m){const y=s[m].index;for(let A=0;A<y.count;++A)g.push(y.getX(A)+p);p+=s[m].attributes.position.count}c.setIndex(g)}for(const p in i){const g=xd(i[p]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" attribute."),null;c.setAttribute(p,g)}for(const p in a){const g=a[p][0].length;if(g===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[p]=[];for(let m=0;m<g;++m){const y=[];for(let w=0;w<a[p].length;++w)y.push(a[p][w][m]);const A=xd(y);if(!A)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" morphAttribute."),null;c.morphAttributes[p].push(A)}}return c}function xd(s){let e,t,n,r=-1,i=0;for(let u=0;u<s.length;++u){const p=s[u];if(e===void 0&&(e=p.array.constructor),e!==p.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=p.itemSize),t!==p.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=p.normalized),n!==p.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(r===-1&&(r=p.gpuType),r!==p.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;i+=p.count*t}const a=new e(i),l=new Rt(a,t,n);let c=0;for(let u=0;u<s.length;++u){const p=s[u];if(p.isInterleavedBufferAttribute){const g=c/t;for(let m=0,y=p.count;m<y;m++)for(let A=0;A<t;A++){const w=p.getComponent(m,A);l.setComponent(m+g,A,w)}}else a.set(p.array,c);c+=p.count*t}return r!==void 0&&(l.gpuType=r),l}function E4(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=s.getIndex(),r=s.getAttribute("position"),i=n?n.count:r.count;let a=0;const l=Object.keys(s.attributes),c={},u={},p=[],g=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let L=0,O=l.length;L<O;L++){const F=l[L],B=s.attributes[F];c[F]=new B.constructor(new B.array.constructor(B.count*B.itemSize),B.itemSize,B.normalized);const Z=s.morphAttributes[F];Z&&(u[F]||(u[F]=[]),Z.forEach((W,Q)=>{const ye=new W.array.constructor(W.count*W.itemSize);u[F][Q]=new W.constructor(ye,W.itemSize,W.normalized)}))}const y=e*.5,A=Math.log10(1/e),w=Math.pow(10,A),C=y*w;for(let L=0;L<i;L++){const O=n?n.getX(L):L;let F="";for(let B=0,Z=l.length;B<Z;B++){const W=l[B],Q=s.getAttribute(W),ye=Q.itemSize;for(let Se=0;Se<ye;Se++)F+=`${~~(Q[g[Se]](O)*w+C)},`}if(F in t)p.push(t[F]);else{for(let B=0,Z=l.length;B<Z;B++){const W=l[B],Q=s.getAttribute(W),ye=s.morphAttributes[W],Se=Q.itemSize,ge=c[W],Le=u[W];for(let Je=0;Je<Se;Je++){const Ge=g[Je],Ze=m[Je];if(ge[Ze](a,Q[Ge](O)),ye)for(let Fe=0,Xe=ye.length;Fe<Xe;Fe++)Le[Fe][Ze](a,ye[Fe][Ge](O))}}t[F]=a,p.push(a),a++}}const E=s.clone();for(const L in s.attributes){const O=c[L];if(E.setAttribute(L,new O.constructor(O.array.slice(0,a*O.itemSize),O.itemSize,O.normalized)),L in u)for(let F=0;F<u[L].length;F++){const B=u[L][F];E.morphAttributes[L][F]=new B.constructor(B.array.slice(0,a*B.itemSize),B.itemSize,B.normalized)}}return E.setIndex(p),E}new en;class wd extends xm{constructor(e,t,n){super(),this.isFound=!1,this.char=e,this.fontSize=t,this.font=n,this.width=this.getCharWidth(e,t,n)}toGeometry(){let e=this.font.cache.getGeometry(this.char.charCodeAt(0),this.fontSize);if(e==null){const t=this.font.generateShapes(this.char,this.fontSize);return e=new ba(t,4),e.hasAttribute("uv")&&e.deleteAttribute("uv"),e.hasAttribute("normal")&&e.deleteAttribute("normal"),E4(e,1e-6)}return e}getCharWidth(e,t,n){const r=n.data.glyphs[e];return r?(this.isFound=!0,r.ha*t/n.data.resolution):(this.isFound=!1,0)}}class T4{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],r=I4(e,t,this.data);for(let i=0,a=r.length;i<a;i++)n.push(...r[i].toShapes());return n}}function I4(s,e,t){const n=Array.from(s),r=e/t.resolution,i=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r,a=[];let l=0,c=0;for(let u=0;u<n.length;u++){const p=n[u];if(p===`
`)l=0,c-=i;else{const g=C4(p,r,l,c,t);l+=g.offsetX,a.push(g.path)}}return a}function C4(s,e,t,n,r){const i=r.glyphs[s]||r.glyphs["?"];if(!i){console.error('THREE.Font: character "'+s+'" does not exists in font family '+r.familyName+".");return}const a=new cp;let l,c,u,p,g,m,y,A;if(i.o){const w=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let C=0,E=w.length;C<E;)switch(w[C++]){case"m":l=w[C++]*e+t,c=w[C++]*e+n,a.moveTo(l,c);break;case"l":l=w[C++]*e+t,c=w[C++]*e+n,a.lineTo(l,c);break;case"q":u=w[C++]*e+t,p=w[C++]*e+n,g=w[C++]*e+t,m=w[C++]*e+n,a.quadraticCurveTo(g,m,u,p);break;case"b":u=w[C++]*e+t,p=w[C++]*e+n,g=w[C++]*e+t,m=w[C++]*e+n,y=w[C++]*e+t,A=w[C++]*e+n,a.bezierCurveTo(g,m,y,A,u,p);break}}return{offsetX:i.ha*e,path:a}}class k4 extends T4{generateShapes(e,t=100,n="ltr"){const r=[];return M4(e,t,this.data,n).forEach(i=>{r.push(...R4(i))}),r}}function M4(s,e,t,n="ltr"){const r=Array.from(s),i=e/t.resolution,a=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,l=[];let c=0,u=0;(n==="rtl"||n==="tb")&&r.reverse();for(const p of r)if(p===`
`)c=0,u-=a;else{const g=P4(p,i,c,u,t);if(!g)continue;n==="tb"?(c=0,u+=t.ascender*i):c+=g.offsetX,l.push(g.path)}return l}function P4(s,e,t,n,r){const i=r.glyphs[s]||r.glyphs["?"];if(!i){console.error(`THREE.Font: character "${s}" does not exist in font family ${r.familyName}.`);return}const a=new cp;if(i.o){const l=i.o.split(" ");let c=0;for(;c<l.length;){const u=l[c++];let p,g,m,y,A,w,C,E;switch(u){case"m":p=parseFloat(l[c++])*e+t,g=parseFloat(l[c++])*e+n,a.moveTo(p,g);break;case"l":p=parseFloat(l[c++])*e+t,g=parseFloat(l[c++])*e+n,a.lineTo(p,g);break;case"q":m=parseFloat(l[c++])*e+t,y=parseFloat(l[c++])*e+n,A=parseFloat(l[c++])*e+t,w=parseFloat(l[c++])*e+n,a.quadraticCurveTo(A,w,m,y);break;case"b":m=parseFloat(l[c++])*e+t,y=parseFloat(l[c++])*e+n,A=parseFloat(l[c++])*e+t,w=parseFloat(l[c++])*e+n,C=parseFloat(l[c++])*e+t,E=parseFloat(l[c++])*e+n,a.bezierCurveTo(A,w,C,E,m,y);break}}}return{offsetX:i.ha*e,path:a}}function L4(s,e){let t=!1;const{x:n,y:r}=s,i=e.length;for(let a=0,l=i-1;a<i;l=a++){const c=e[a].x,u=e[a].y,p=e[l].x,g=e[l].y;u>r!=g>r&&n<(p-c)*(r-u)/(g-u)+c&&(t=!t)}return t}function O4(s){const e=s.length,t=Array(e).fill(null);for(let n=0;n<e;n++){let r=null,i=1/0;for(let a=0;a<e;a++)if(n!==a&&s[n].every(l=>L4(l,s[a]))){const l=Math.abs(hp.area(s[a]));l<i&&(i=l,r=a)}t[n]=r}return t}function D4(s){const e=s.length,t=Array.from({length:e},()=>[]);for(let n=0;n<e;n++){const r=s[n];r!==null&&t[r].push(n)}return t}function B4(s){return s.map((e,t)=>e===null?t:-1).filter(e=>e>=0)}function N4(s){const e=[];for(let t=s.length-1;t>=0;t--){const n=s[t];if(n instanceof _l)e.push(new _l(n.v2.clone(),n.v1.clone()));else if(n instanceof ru)e.push(new ru(n.v2.clone(),n.v1.clone(),n.v0.clone()));else if(n instanceof iu)e.push(new iu(n.v3.clone(),n.v2.clone(),n.v1.clone(),n.v0.clone()));else if(n instanceof au)e.push(new au(n.aX,n.aY,n.xRadius,n.yRadius,n.aEndAngle,n.aStartAngle,!n.aClockwise,n.aRotation));else if(typeof n.getPoints=="function"){const r=n.getPoints(8);for(let i=r.length-1;i>0;i--)e.push(new _l(r[i].clone(),r[i-1].clone()))}}return e}function Sd(s,e){const t=hp.area(s.getPoints(32))>0,n=e===t?s.curves.slice():N4(s.curves),r=new va;return r.curves.push(...n),r}function R4(s,e=32){const t=s.subPaths;if(!t||t.length===0)return[];const n=t.map(y=>y.getPoints(e)),r=O4(n),i=D4(r),a=B4(r),l=t.length,c=Array(l).fill(-1),u=Array(l).fill(-1);for(const y of a){const A=[{idx:y,d:0}];for(;A.length;){const w=A.pop();c[w.idx]=w.d,u[w.idx]=y;for(const C of i[w.idx])A.push({idx:C,d:w.d+1})}}const p=[],g=new Set;function m(y){const A=Sd(t[y],!0);g.add(y);for(const w of i[y])if(!g.has(w)&&c[w]===c[y]+1){const C=Sd(t[w],!1);A.holes.push(C),g.add(w)}p.push(A)}for(const y of a)m(y);for(let y=0;y<l;y++)g.has(y)||m(y);return p}class F4{constructor(e=512){this.maxSize=e,this.map=new Map}get(e){const t=this.map.get(e);return t&&(this.map.delete(e),this.map.set(e,t)),t}set(e,t){if(this.map.has(e))this.map.delete(e);else if(this.map.size>=this.maxSize){const n=this.map.keys().next().value;n!==void 0&&this.map.delete(n)}this.map.set(e,t)}has(e){return this.map.has(e)}clear(){this.map.clear()}}class z4 extends _m{constructor(e){super(e),this.type="mesh",this.glyphCache=new F4(512);const t=e.data;if(t instanceof ArrayBuffer){const n=this.parseMeshFont(t);this.data=n.data,this.opentypeFont=n.font}else throw new Error("Invalid font cache data. Please remove font cache database named 'mlightcad' in IndexedDB and try again!");this.font=new k4(this.data)}parseMeshFont(e){const t=A4(e),n=Math.round,r=t.charToGlyph("A"),i=r?t.unitsPerEm/(r.yMax||t.unitsPerEm):1,a={glyphs:{},familyName:t.getEnglishName("fullName"),ascender:n(t.ascender),descender:n(t.descender),underlinePosition:t.tables.post.underlinePosition,underlineThickness:t.tables.post.underlineThickness,boundingBox:{xMin:t.tables.head.xMin,xMax:t.tables.head.xMax,yMin:t.tables.head.yMin,yMax:t.tables.head.yMax},resolution:t.unitsPerEm||1e3,scaleFactor:i,original_font_information:t.tables.name};return{font:t,data:a}}hasChar(e){return this.opentypeFont.hasChar(e)}hasCode(e){return this.hasChar(String.fromCodePoint(e))}_loadGlyphIfNeeded(e){if(this.data.glyphs[e]||!this.opentypeFont)return;const t=this.glyphCache.get(e);if(t){this.data.glyphs[e]=t;return}const n=this.opentypeFont.charToGlyph(e);if(!n||!n.path)return;const r=Math.round,i={ha:r(n.advanceWidth??0),x_min:r(n.xMin??0),x_max:r(n.xMax??0),o:""};n.path.commands.forEach(a=>{let l=a.type.toLowerCase();l==="c"&&(l="b"),i.o+=l+" ",a.x!==void 0&&a.y!==void 0&&(i.o+=r(a.x)+" "+r(a.y)+" "),a.x1!==void 0&&a.y1!==void 0&&(i.o+=r(a.x1)+" "+r(a.y1)+" "),a.x2!==void 0&&a.y2!==void 0&&(i.o+=r(a.x2)+" "+r(a.y2)+" ")}),this.data.glyphs[e]=i,this.glyphCache.set(e,i)}generateShapes(e,t){for(const n of e)this._loadGlyphIfNeeded(n);return this.font.generateShapes(e,t)}getCharShape(e,t){if(this._loadGlyphIfNeeded(e),!this.data.glyphs[e]){this.addUnsupportedChar(e);return}return new wd(e,t,this)}getCodeShape(e,t){return this.getCharShape(String.fromCodePoint(e),t)}getScaleFactor(){return this.scaleFactor==null?(this.scaleFactor=this.data.scaleFactor,this.scaleFactor):this.scaleFactor}getNotFoundTextShape(e){return new wd("?",e,this)}}let Jt=class{static byteToSByte(s){return(s&127)-(s&128?128:0)}constructor(s){this.position=0,this.data=new DataView(s)}readBytes(s=1){this.data.byteLength<this.position+s&&this.throwOutOfRangeError(this.position+s);const e=new Uint8Array(this.data.buffer,this.position,s);return this.position+=s,e}skip(s){this.data.byteLength<this.position+s&&this.throwOutOfRangeError(this.position+s),this.position+=s}readUint8(){this.data.byteLength<this.position+1&&this.throwOutOfRangeError(this.position+1);const s=this.data.getUint8(this.position);return this.position+=1,s}readInt8(){this.data.byteLength<this.position+1&&this.throwOutOfRangeError(this.position+1);const s=this.data.getInt8(this.position);return this.position+=1,s}readUint16(s=!0){this.data.byteLength<this.position+2&&this.throwOutOfRangeError(this.position+2);const e=this.data.getUint16(this.position,s);return this.position+=2,e}readInt16(){this.data.byteLength<this.position+2&&this.throwOutOfRangeError(this.position+2);const s=this.data.getInt16(this.position,!0);return this.position+=2,s}readUint32(){this.data.byteLength<this.position+4&&this.throwOutOfRangeError(this.position+4);const s=this.data.getUint32(this.position,!0);return this.position+=4,s}readInt32(){this.data.byteLength<this.position+4&&this.throwOutOfRangeError(this.position+4);const s=this.data.getInt32(this.position,!0);return this.position+=4,s}readFloat32(){this.data.byteLength<this.position+4&&this.throwOutOfRangeError(this.position+4);const s=this.data.getFloat32(this.position,!0);return this.position+=4,s}readFloat64(){this.data.byteLength<this.position+8&&this.throwOutOfRangeError(this.position+8);const s=this.data.getFloat64(this.position,!0);return this.position+=8,s}setPosition(s){this.data.byteLength<s&&this.throwOutOfRangeError(s),this.position=s}isEnd(){return this.position===this.data.byteLength-1}get currentPosition(){return this.position}get length(){return this.data.byteLength}throwOutOfRangeError(s){throw new Error(`Position ${s} is out of range for the data length ${this.data.byteLength}!`)}};var hn=(s=>(s.SHAPES="shapes",s.BIGFONT="bigfont",s.UNIFONT="unifont",s))(hn||{});class U4{parse(e){const t=this.parseHeader(e).split(" "),n=t[1].toLocaleLowerCase();if(!Object.values(hn).includes(n))throw new Error(`Invalid font type: ${n}`);return{fileHeader:t[0],fontType:n,fileVersion:t[2]}}parseHeader(e){let t="",n=0;for(;e.currentPosition<e.length-2&&n<1024;){const r=e.readUint8();if(r===13){const i=e.currentPosition,a=e.readUint8(),l=e.readUint8();if(a===10&&l===26)break;e.setPosition(i),t+=String.fromCharCode(r)}else t+=String.fromCharCode(r);n++}return t.trim()}}const On=10;class G4{parse(e){try{e.readBytes(4);const t=e.readInt16();if(t<=0)throw new Error("Invalid shape count in font file");const n=[];for(let a=0;a<t;a++){const l=e.readUint16(),c=e.readUint16();c>0&&n.push({code:l,length:c})}const r={};for(const a of n)try{const l=e.readBytes(a.length);if(l.length===a.length){const c=l.indexOf(0);let u=0;c>=0&&c<l.length&&(u=c+1),u<l.length&&(r[a.code]=l.subarray(u))}}catch{console.warn(`Failed to read shape data for code ${a.code}`)}const i={data:r,info:"",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1};if(0 in r){const a=r[0];try{const l=new TextDecoder().decode(a);let c=l.indexOf("\0");c>=0&&(i.info=l.substring(0,c),c+3<a.length&&(i.baseUp=a[c+1],i.baseDown=a[c+2],i.height=i.baseDown+i.baseUp,i.width=i.height,i.orientation=a[c+3]===0?"horizontal":"vertical"))}catch{console.warn("Failed to parse font info block")}}return i}catch(t){return console.error("Error parsing shape font:",t),{data:{},info:"Failed to parse font file",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1}}}}class V4{parse(e){try{e.readInt16();const t=e.readInt16(),n=e.readInt16();if(t<=0)throw new Error("Invalid character count in font file");e.skip(n*4);const r=[];for(let l=0;l<t;l++){const c=e.readUint16(),u=e.readUint16(),p=e.readUint32();(c!==0||u!==0||p!==0)&&r.push({code:c,length:u,offset:p})}const i={};for(const l of r)try{e.setPosition(l.offset);const c=e.readBytes(l.length);c.length===l.length&&(i[l.code]=c)}catch{console.warn(`Failed to read bigfont data for code ${l.code}`)}const a={data:i,info:"",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1};if(0 in i){const l=i[0];try{const c=this.utf8ArrayToStr(l);let u=c.pos;u>=0&&(a.info=c.text,u++,u+3<l.length&&(l.length-u>4?(a.height=l[u++],u++,a.orientation=l[u++]===0?"horizontal":"vertical",a.width=l[u++],a.baseUp=a.height,a.baseDown=0,a.isExtended=!0):(a.baseUp=l[u++],a.baseDown=l[u++],a.height=a.baseDown+a.baseUp,a.width=a.height,a.orientation=l[u]===0?"horizontal":"vertical")))}catch{console.warn("Failed to parse bigfont info block")}}return a}catch(t){return console.error("Error parsing big font:",t),{data:{},info:"Failed to parse font file",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1}}}utf8ArrayToStr(e){let t="",n=0;for(;n<e.length;){const r=e[n];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:{const i=e[n++];t+=String.fromCharCode((r&31)<<6|i&63);break}case 14:{const i=e[n++],a=e[n++];t+=String.fromCharCode((r&15)<<12|(i&63)<<6|(a&63)<<0);break}}if(t.charCodeAt(t.length-1)===0)break;n++}return{text:t,pos:n}}}class j4{parse(e){try{const t=e.readInt32();if(t<=0)throw new Error("Invalid character count in font file");const n=e.readInt16(),r=e.readBytes(n),i={data:{},info:"",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1};try{const l=new TextDecoder().decode(r);let c=l.indexOf("\0");c>=0&&(i.info=l.substring(0,c),c+3<r.length&&(i.baseUp=r[c+1],i.baseDown=r[c+2],i.height=i.baseUp+i.baseDown,i.width=i.height,i.orientation=r[c+3]===0?"horizontal":"vertical"))}catch{console.warn("Failed to parse unifont info block")}const a={};for(let l=0;l<t-1;l++)try{const c=e.readUint16(),u=e.readUint16();if(u>0){const p=e.readBytes(u);if(p.length===u){const g=p.indexOf(0);let m=0;g>=0&&g<p.length&&(m=g+1),m<p.length&&(a[c]=p.subarray(m))}}}catch{console.warn("Failed to read unifont character data");break}return i.data=a,i}catch(t){return console.error("Error parsing unifont:",t),{data:{},info:"Failed to parse font file",baseUp:8,baseDown:2,height:On,width:On,orientation:"horizontal",isExtended:!1}}}}let $4=class{static createParser(s){switch(s){case hn.SHAPES:return new G4;case hn.BIGFONT:return new V4;case hn.UNIFONT:return new j4;default:throw new Error(`Unsupported font type: ${s}`)}}},Dt=class y0{constructor(e=0,t=0){this.x=e,this.y=t}set(e,t){return this.x=e,this.y=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.length();return e!==0&&(this.x/=e,this.y/=e),this}clone(){return new y0(this.x,this.y)}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}multiply(e){return this.x*=e,this.y*=e,this}divide(e){return e!==0&&(this.x/=e,this.y/=e),this}multiplyScalars(e,t){return this.x*=e,this.y*=t,this}divideScalars(e,t){return e!==0&&(this.x/=e),t!==0&&(this.y/=t),this}distanceTo(e){const t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}};const Ad=Math.PI/4;let Ed=class Wc{static fromBulge(e,t,n){const r=Math.max(-1,Math.min(1,n));return new Wc({start:e,end:t,bulge:r})}static fromOctant(e,t,n,r,i){return new Wc({center:e,radius:t,startOctant:n,octantCount:r,isClockwise:i})}constructor(e){if(e.start&&e.end&&e.bulge!==void 0){this.start=e.start.clone(),this.end=e.end.clone(),this.bulge=e.bulge,this.isClockwise=e.bulge<0;const t=this.end.clone().subtract(this.start),n=t.length();if(Math.abs(this.bulge)*n/2===0){this.radius=0,this.center=this.start.clone(),this.startAngle=Math.atan2(t.y,t.x),this.endAngle=this.startAngle;return}const r=4*Math.atan(Math.abs(this.bulge));this.radius=n/(2*Math.sin(r/2));const i=this.start.clone().add(t.clone().divide(2)),a=new Dt(-t.y,t.x);a.normalize(),a.multiply(Math.abs(this.radius*Math.cos(r/2))),this.center=i.clone(),this.isClockwise?this.center.subtract(a):this.center.add(a),this.startAngle=Math.atan2(this.start.y-this.center.y,this.start.x-this.center.x),this.endAngle=Math.atan2(this.end.y-this.center.y,this.end.x-this.center.x),this.isClockwise?this.endAngle>=this.startAngle&&(this.endAngle-=2*Math.PI):this.endAngle<=this.startAngle&&(this.endAngle+=2*Math.PI)}else if(e.center&&e.radius!==void 0&&e.startOctant!==void 0&&e.octantCount!==void 0&&e.isClockwise!==void 0){this.center=e.center.clone(),this.radius=e.radius,this.isClockwise=e.isClockwise,this.startAngle=e.startOctant*Ad;const t=(e.octantCount===0?8:e.octantCount)*Ad;this.endAngle=this.startAngle+(this.isClockwise?-t:t),this.start=this.center.clone().add(new Dt(this.radius*Math.cos(this.startAngle),this.radius*Math.sin(this.startAngle))),this.end=this.center.clone().add(new Dt(this.radius*Math.cos(this.endAngle),this.radius*Math.sin(this.endAngle)))}else throw new Error("Invalid arc parameters")}tessellate(e=Math.PI/18){if(this.radius===0)return[this.start.clone(),this.end.clone()];const t=[this.start.clone()],n=Math.abs(this.endAngle-this.startAngle),r=Math.max(1,Math.floor(n/e));for(let i=1;i<r;i++){const a=i/r,l=this.isClockwise?this.startAngle-a*n:this.startAngle+a*n;t.push(this.center.clone().add(new Dt(this.radius*Math.cos(l),this.radius*Math.sin(l))))}return t.push(this.end?this.end.clone():this.center.clone().add(new Dt(this.radius*Math.cos(this.endAngle),this.radius*Math.sin(this.endAngle)))),t}},Xl=class v0{constructor(e,t=[]){this.lastPoint=e,this.polylines=t}get bbox(){if(this._bbox)return this._bbox;let e=1/0,t=-1/0,n=1/0,r=-1/0;return this.polylines.forEach(i=>{i.forEach(a=>{e=Math.min(e,a.x),t=Math.max(t,a.x),n=Math.min(n,a.y),r=Math.max(r,a.y)})}),this._bbox={minX:e,minY:n,maxX:t,maxY:r},this._bbox}offset(e,t=!0){var n,r;return t?new v0((n=this.lastPoint)==null?void 0:n.clone().add(e),this.polylines.map(i=>i.map(a=>a.clone().add(e)))):((r=this.lastPoint)==null||r.add(e),this.polylines.forEach(i=>i.forEach(a=>a.add(e))),this._bbox&&(this._bbox.maxX+=e.x,this._bbox.minX+=e.x,this._bbox.maxY+=e.y,this._bbox.minY+=e.y),this)}normalizeToOrigin(e=!1){const t=this.bbox;return this.offset(new Dt(-t.minX,-t.minY),e)}toSVG(e={}){const{strokeWidth:t="0.5%",strokeColor:n="black",isAutoFit:r=!1}=e;let i,a;if(r){const l=this.bbox,c=.2,u=l.maxX-l.minX,p=l.maxY-l.minY,g=u===0?p:u,m=p===0?u:p,y=l.minX-g*c,A=l.maxX+g*c,w=l.minY-m*c,C=l.maxY+m*c;a=this.polylines.map(E=>{let L="";return E.forEach((O,F)=>{const B=O.x,Z=-O.y;L+=F===0?`M ${B} ${Z} `:`L ${B} ${Z} `}),`<path d="${L}" stroke="${n}" stroke-width="${t}" fill="none"/>`}).join(""),i=`${y} ${-C} ${A-y} ${C-w}`}else i="0 0 20 20",a=this.polylines.map(l=>{let c="";return l.forEach((u,p)=>{const g=u.x+5,m=-u.y+15;c+=p===0?`M ${g} ${m} `:`L ${g} ${m} `}),`<path d="${c}" stroke="${n}" stroke-width="${t}" fill="none"/>`}).join("");return`<svg width="100%" height="100%" viewBox="${i}" preserveAspectRatio="xMidYMid meet">${a}</svg>`}};const W4=Math.PI/18;class H4{constructor(e){this.shapeCache=new Map,this.shapeData=new Map,this.fontData=e}release(){this.shapeCache.clear(),this.shapeData.clear()}getCharShape(e,t){const n=t/this.fontData.content.height;return this.parseAndScale(e,{factor:n})}parseAndScale(e,t){if(e===0)return;let n;if(this.shapeCache.has(e))n=this.shapeCache.get(e);else{const r=this.fontData.content.data;if(r[e]){const i=r[e];n=this.parseShape(i),this.shapeData.set(e,n),this.shapeCache.set(e,n)}}if(n){if(t.factor!==void 0)return this.scaleShapeByFactor(n,t.factor);if(t.height!==void 0){const r=t.width??t.height;return this.scaleShapeByHeightAndWidth(n,t.height,r)}else return n}}scaleShapeByFactor(e,t){var n;return new Xl((n=e.lastPoint)==null?void 0:n.clone().multiply(t),e.polylines.map(r=>r.map(i=>i.clone().multiply(t))))}scaleShapeByHeightAndWidth(e,t,n){var r;const i=e.bbox,a=i.maxY-i.minY,l=i.maxX-i.minX,c=a>0?t/a:1,u=l>0?n/l:1,p=(r=e.lastPoint)==null?void 0:r.clone();p&&(p.x*=u,p.y*=c);const g=e.polylines.map(m=>m.map(y=>{const A=y.clone();return A.x*=u,A.y*=c,A}));return new Xl(p,g)}parseShape(e){const t={currentPoint:new Dt,polylines:[],currentPolyline:[],sp:[],isPenDown:!1,scale:1};for(let n=0;n<e.length;n++){const r=e[n];r<=15?n=this.handleSpecialCommand(r,e,n,t):this.handleVectorCommand(r,t)}return new Xl(t.currentPoint,t.polylines)}handleSpecialCommand(e,t,n,r){let i=n;switch(e){case 0:r.currentPolyline=[],r.isPenDown=!1;break;case 1:r.isPenDown=!0,r.currentPolyline.push(r.currentPoint.clone());break;case 2:r.isPenDown=!1,r.currentPolyline.length>1&&r.polylines.push(r.currentPolyline.slice()),r.currentPolyline=[];break;case 3:i++,r.scale/=t[i];break;case 4:i++,r.scale*=t[i];break;case 5:if(r.sp.length===4)throw new Error("The position stack is only four locations deep");r.sp.push(r.currentPoint.clone());break;case 6:r.currentPoint=r.sp.pop()??r.currentPoint;break;case 7:i=this.handleSubshapeCommand(t,i,r);break;case 8:i=this.handleXYDisplacement(t,i,r);break;case 9:i=this.handleMultipleXYDisplacements(t,i,r);break;case 10:i=this.handleOctantArc(t,i,r);break;case 11:i=this.handleFractionalArc(t,i,r);break;case 12:i=this.handleBulgeArc(t,i,r);break;case 13:i=this.handleMultipleBulgeArcs(t,i,r);break;case 14:i=this.skipCode(t,++i);break}return i}handleVectorCommand(e,t){const n=(e&240)>>4,r=e&15,i=this.getVectorForDirection(r);t.currentPoint.add(i.multiply(n*t.scale)),t.isPenDown&&t.currentPolyline.push(t.currentPoint.clone())}getVectorForDirection(e){const t=new Dt;switch(e){case 0:t.x=1;break;case 1:t.x=1,t.y=.5;break;case 2:t.x=1,t.y=1;break;case 3:t.x=.5,t.y=1;break;case 4:t.y=1;break;case 5:t.x=-.5,t.y=1;break;case 6:t.x=-1,t.y=1;break;case 7:t.x=-1,t.y=.5;break;case 8:t.x=-1;break;case 9:t.x=-1,t.y=-.5;break;case 10:t.x=-1,t.y=-1;break;case 11:t.x=-.5,t.y=-1;break;case 12:t.y=-1;break;case 13:t.x=.5,t.y=-1;break;case 14:t.x=1,t.y=-1;break;case 15:t.x=1,t.y=-.5;break}return t}handleSubshapeCommand(e,t,n){let r=t,i=0,a,l=n.scale*this.fontData.content.height,c=l;const u=n.currentPoint.clone();switch(n.currentPolyline.length>1&&(n.polylines.push(n.currentPolyline.slice()),n.currentPolyline=[]),this.fontData.header.fontType){case hn.SHAPES:r++,i=e[r];break;case hn.BIGFONT:r++,i=e[r],i===0&&(r++,i=e[r++]<<8|e[r++],u.x=Jt.byteToSByte(e[r++])*n.scale,u.y=Jt.byteToSByte(e[r++])*n.scale,this.fontData.content.isExtended&&(c=e[r++]*n.scale),l=e[r]*n.scale);break;case hn.UNIFONT:r++,i=e[r++]<<8|e[r++];break}return i!==0&&(a=this.getScaledSubshapeAtInsertPoint(i,c,l,u),a&&n.polylines.push(...a.polylines.slice())),n.currentPolyline=[],r}handleXYDisplacement(e,t,n){let r=t;const i=new Dt;return i.x=Jt.byteToSByte(e[++r]),i.y=Jt.byteToSByte(e[++r]),n.currentPoint.add(i.multiply(n.scale)),n.isPenDown&&n.currentPolyline.push(n.currentPoint.clone()),r}handleMultipleXYDisplacements(e,t,n){let r=t;for(;;){const i=new Dt;if(i.x=Jt.byteToSByte(e[++r]),i.y=Jt.byteToSByte(e[++r]),i.x===0&&i.y===0)break;n.currentPoint.add(i.multiply(n.scale)),n.isPenDown&&n.currentPolyline.push(n.currentPoint.clone())}return r}handleOctantArc(e,t,n){var r;let i=t;const a=e[++i]*n.scale,l=Jt.byteToSByte(e[++i]),c=(l&112)>>4;let u=l&7;const p=l<0,g=Math.PI/4*c,m=n.currentPoint.clone().subtract(new Dt(Math.cos(g)*a,Math.sin(g)*a)),y=Ed.fromOctant(m,a,c,u,p);if(n.isPenDown){const A=y.tessellate();n.currentPolyline.pop(),n.currentPolyline.push(...A.slice())}return n.currentPoint=(r=y.tessellate().pop())==null?void 0:r.clone(),i}handleFractionalArc(e,t,n){let r=t;const i=e[++r],a=e[++r],l=e[++r],c=e[++r],u=(l*255+c)*n.scale,p=Jt.byteToSByte(e[++r]),g=(p&112)>>4;let m=p&7;m===0&&(m=8),a!==0&&m--;const y=Math.PI/4;let A=y*m,w=W4,C=1;p<0&&(w=-w,A=-A,C=-1);let E=y*g,L=E+A;E+=y*i/256*C,L+=y*a/256*C;const O=n.currentPoint.clone().subtract(new Dt(u*Math.cos(E),u*Math.sin(E)));if(n.currentPoint=O.clone().add(new Dt(u*Math.cos(L),u*Math.sin(L))),n.isPenDown){let F=E;const B=[];if(B.push(O.clone().add(new Dt(u*Math.cos(F),u*Math.sin(F)))),w>0)for(;F+w<L;)F+=w,B.push(O.clone().add(new Dt(u*Math.cos(F),u*Math.sin(F))));else for(;F+w>L;)F+=w,B.push(O.clone().add(new Dt(u*Math.cos(F),u*Math.sin(F))));B.push(O.clone().add(new Dt(u*Math.cos(L),u*Math.sin(L)))),n.currentPolyline.push(...B)}return r}handleBulgeArc(e,t,n){let r=t;const i=new Dt;i.x=Jt.byteToSByte(e[++r]),i.y=Jt.byteToSByte(e[++r]);const a=Jt.byteToSByte(e[++r]);return n.currentPoint=this.handleArcSegment(n.currentPoint,i,a,n.scale,n.isPenDown,n.currentPolyline),r}handleMultipleBulgeArcs(e,t,n){let r=t;for(;;){const i=new Dt;if(i.x=Jt.byteToSByte(e[++r]),i.y=Jt.byteToSByte(e[++r]),i.x===0&&i.y===0)break;const a=Jt.byteToSByte(e[++r]);n.currentPoint=this.handleArcSegment(n.currentPoint,i,a,n.scale,n.isPenDown,n.currentPolyline)}return r}skipCode(e,t){switch(e[t]){case 0:break;case 1:break;case 2:break;case 3:case 4:t++;break;case 5:break;case 6:break;case 7:switch(this.fontData.header.fontType){case hn.SHAPES:t++;break;case hn.BIGFONT:t++,e[t]===0&&(t+=this.fontData.content.isExtended?6:5);break;case hn.UNIFONT:t+=2;break}break;case 8:t+=2;break;case 9:for(;;){const n=e[++t],r=e[++t];if(n===0&&r===0)break}break;case 10:t+=2;break;case 11:t+=5;break;case 12:t+=3;break;case 13:for(;;){const n=e[++t],r=e[++t];if(n===0&&r===0)break;t++}break}return t}getScaledSubshapeAtInsertPoint(e,t,n,r){let i=this.shapeCache.get(e);if(!i){const l=this.fontData.content.data[e];if(!l)return;i=this.parseShape(l),this.shapeData.set(e,i),this.shapeCache.set(e,i)}const a=i.normalizeToOrigin(!0);return this.scaleShapeByHeightAndWidth(a,n,t).offset(r,!1)}handleArcSegment(e,t,n,r,i,a){t.x*=r,t.y*=r,n<-127&&(n=-127);const l=e.clone();if(i)if(n===0)a.push(l.clone().add(t));else{const c=l.clone().add(t),u=Ed.fromBulge(l,c,n/127).tessellate();a.push(...u.slice(1))}return l.add(t),l}}class q4{constructor(e){if(e instanceof ArrayBuffer){const t=new Jt(e),n=new U4().parse(t),r=$4.createParser(n.fontType).parse(t);this.fontData={header:n,content:r}}else this.fontData=e;this.shapeParser=new H4(this.fontData)}hasChar(e){return this.fontData.content.data[e]!==void 0}getCharShape(e,t){let n=this.shapeParser.getCharShape(e,t);return n&&this.fontData.header.fontType===hn.BIGFONT&&(n=n.normalizeToOrigin()),n}release(){this.shapeParser.release()}}function Y4(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function X4(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var r=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return s[n]}})}),t}var b0={exports:{}},Mh={},ll={};ll.byteLength=Q4;ll.toByteArray=e5;ll.fromByteArray=s5;var ps=[],Mn=[],Z4=typeof Uint8Array<"u"?Uint8Array:Array,Zl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var di=0,K4=Zl.length;di<K4;++di)ps[di]=Zl[di],Mn[Zl.charCodeAt(di)]=di;Mn[45]=62;Mn[95]=63;function _0(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Q4(s){var e=_0(s),t=e[0],n=e[1];return(t+n)*3/4-n}function J4(s,e,t){return(e+t)*3/4-t}function e5(s){var e,t=_0(s),n=t[0],r=t[1],i=new Z4(J4(s,n,r)),a=0,l=r>0?n-4:n,c;for(c=0;c<l;c+=4)e=Mn[s.charCodeAt(c)]<<18|Mn[s.charCodeAt(c+1)]<<12|Mn[s.charCodeAt(c+2)]<<6|Mn[s.charCodeAt(c+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return r===2&&(e=Mn[s.charCodeAt(c)]<<2|Mn[s.charCodeAt(c+1)]>>4,i[a++]=e&255),r===1&&(e=Mn[s.charCodeAt(c)]<<10|Mn[s.charCodeAt(c+1)]<<4|Mn[s.charCodeAt(c+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function t5(s){return ps[s>>18&63]+ps[s>>12&63]+ps[s>>6&63]+ps[s&63]}function n5(s,e,t){for(var n,r=[],i=e;i<t;i+=3)n=(s[i]<<16&16711680)+(s[i+1]<<8&65280)+(s[i+2]&255),r.push(t5(n));return r.join("")}function s5(s){for(var e,t=s.length,n=t%3,r=[],i=16383,a=0,l=t-n;a<l;a+=i)r.push(n5(s,a,a+i>l?l:a+i));return n===1?(e=s[t-1],r.push(ps[e>>2]+ps[e<<4&63]+"==")):n===2&&(e=(s[t-2]<<8)+s[t-1],r.push(ps[e>>10]+ps[e>>4&63]+ps[e<<2&63]+"=")),r.join("")}var Ph={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ph.read=function(s,e,t,n,r){var i,a,l=r*8-n-1,c=(1<<l)-1,u=c>>1,p=-7,g=t?r-1:0,m=t?-1:1,y=s[e+g];for(g+=m,i=y&(1<<-p)-1,y>>=-p,p+=l;p>0;i=i*256+s[e+g],g+=m,p-=8);for(a=i&(1<<-p)-1,i>>=-p,p+=n;p>0;a=a*256+s[e+g],g+=m,p-=8);if(i===0)i=1-u;else{if(i===c)return a?NaN:(y?-1:1)*(1/0);a=a+Math.pow(2,n),i=i-u}return(y?-1:1)*a*Math.pow(2,i-n)};Ph.write=function(s,e,t,n,r,i){var a,l,c,u=i*8-r-1,p=(1<<u)-1,g=p>>1,m=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=n?0:i-1,A=n?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=p):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+g>=1?e+=m/c:e+=m*Math.pow(2,1-g),e*c>=2&&(a++,c/=2),a+g>=p?(l=0,a=p):a+g>=1?(l=(e*c-1)*Math.pow(2,r),a=a+g):(l=e*Math.pow(2,g-1)*Math.pow(2,r),a=0));r>=8;s[t+y]=l&255,y+=A,l/=256,r-=8);for(a=a<<r|l,u+=r;u>0;s[t+y]=a&255,y+=A,a/=256,u-=8);s[t+y-A]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(s){var e=ll,t=Ph,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=l,s.SlowBuffer=L,s.INSPECT_MAX_BYTES=50;var r=2147483647;s.kMaxLength=r,l.TYPED_ARRAY_SUPPORT=i(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{var _=new Uint8Array(1),T={foo:function(){return 42}};return Object.setPrototypeOf(T,Uint8Array.prototype),Object.setPrototypeOf(_,T),_.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function a(_){if(_>r)throw new RangeError('The value "'+_+'" is invalid for option "size"');var T=new Uint8Array(_);return Object.setPrototypeOf(T,l.prototype),T}function l(_,T,P){if(typeof _=="number"){if(typeof T=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(_)}return c(_,T,P)}l.poolSize=8192;function c(_,T,P){if(typeof _=="string")return m(_,T);if(ArrayBuffer.isView(_))return A(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(wt(_,ArrayBuffer)||_&&wt(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(wt(_,SharedArrayBuffer)||_&&wt(_.buffer,SharedArrayBuffer)))return w(_,T,P);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var G=_.valueOf&&_.valueOf();if(G!=null&&G!==_)return l.from(G,T,P);var Y=C(_);if(Y)return Y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return l.from(_[Symbol.toPrimitive]("string"),T,P);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}l.from=function(_,T,P){return c(_,T,P)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function u(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function p(_,T,P){return u(_),_<=0?a(_):T!==void 0?typeof P=="string"?a(_).fill(T,P):a(_).fill(T):a(_)}l.alloc=function(_,T,P){return p(_,T,P)};function g(_){return u(_),a(_<0?0:E(_)|0)}l.allocUnsafe=function(_){return g(_)},l.allocUnsafeSlow=function(_){return g(_)};function m(_,T){if((typeof T!="string"||T==="")&&(T="utf8"),!l.isEncoding(T))throw new TypeError("Unknown encoding: "+T);var P=O(_,T)|0,G=a(P),Y=G.write(_,T);return Y!==P&&(G=G.slice(0,Y)),G}function y(_){for(var T=_.length<0?0:E(_.length)|0,P=a(T),G=0;G<T;G+=1)P[G]=_[G]&255;return P}function A(_){if(wt(_,Uint8Array)){var T=new Uint8Array(_);return w(T.buffer,T.byteOffset,T.byteLength)}return y(_)}function w(_,T,P){if(T<0||_.byteLength<T)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<T+(P||0))throw new RangeError('"length" is outside of buffer bounds');var G;return T===void 0&&P===void 0?G=new Uint8Array(_):P===void 0?G=new Uint8Array(_,T):G=new Uint8Array(_,T,P),Object.setPrototypeOf(G,l.prototype),G}function C(_){if(l.isBuffer(_)){var T=E(_.length)|0,P=a(T);return P.length===0||_.copy(P,0,0,T),P}if(_.length!==void 0)return typeof _.length!="number"||ve(_.length)?a(0):y(_);if(_.type==="Buffer"&&Array.isArray(_.data))return y(_.data)}function E(_){if(_>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return _|0}function L(_){return+_!=_&&(_=0),l.alloc(+_)}l.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==l.prototype},l.compare=function(_,T){if(wt(_,Uint8Array)&&(_=l.from(_,_.offset,_.byteLength)),wt(T,Uint8Array)&&(T=l.from(T,T.offset,T.byteLength)),!l.isBuffer(_)||!l.isBuffer(T))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===T)return 0;for(var P=_.length,G=T.length,Y=0,ne=Math.min(P,G);Y<ne;++Y)if(_[Y]!==T[Y]){P=_[Y],G=T[Y];break}return P<G?-1:G<P?1:0},l.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(_,T){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return l.alloc(0);var P;if(T===void 0)for(T=0,P=0;P<_.length;++P)T+=_[P].length;var G=l.allocUnsafe(T),Y=0;for(P=0;P<_.length;++P){var ne=_[P];if(wt(ne,Uint8Array))Y+ne.length>G.length?l.from(ne).copy(G,Y):Uint8Array.prototype.set.call(G,ne,Y);else if(l.isBuffer(ne))ne.copy(G,Y);else throw new TypeError('"list" argument must be an Array of Buffers');Y+=ne.length}return G};function O(_,T){if(l.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||wt(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);var P=_.length,G=arguments.length>2&&arguments[2]===!0;if(!G&&P===0)return 0;for(var Y=!1;;)switch(T){case"ascii":case"latin1":case"binary":return P;case"utf8":case"utf-8":return Re(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P*2;case"hex":return P>>>1;case"base64":return ce(_).length;default:if(Y)return G?-1:Re(_).length;T=(""+T).toLowerCase(),Y=!0}}l.byteLength=O;function F(_,T,P){var G=!1;if((T===void 0||T<0)&&(T=0),T>this.length||((P===void 0||P>this.length)&&(P=this.length),P<=0)||(P>>>=0,T>>>=0,P<=T))return"";for(_||(_="utf8");;)switch(_){case"hex":return Ee(this,T,P);case"utf8":case"utf-8":return Ge(this,T,P);case"ascii":return Xe(this,T,P);case"latin1":case"binary":return ie(this,T,P);case"base64":return Je(this,T,P);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,T,P);default:if(G)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),G=!0}}l.prototype._isBuffer=!0;function B(_,T,P){var G=_[T];_[T]=_[P],_[P]=G}l.prototype.swap16=function(){var _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var T=0;T<_;T+=2)B(this,T,T+1);return this},l.prototype.swap32=function(){var _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var T=0;T<_;T+=4)B(this,T,T+3),B(this,T+1,T+2);return this},l.prototype.swap64=function(){var _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var T=0;T<_;T+=8)B(this,T,T+7),B(this,T+1,T+6),B(this,T+2,T+5),B(this,T+3,T+4);return this},l.prototype.toString=function(){var _=this.length;return _===0?"":arguments.length===0?Ge(this,0,_):F.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(_){if(!l.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:l.compare(this,_)===0},l.prototype.inspect=function(){var _="",T=s.INSPECT_MAX_BYTES;return _=this.toString("hex",0,T).replace(/(.{2})/g,"$1 ").trim(),this.length>T&&(_+=" ... "),"<Buffer "+_+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(_,T,P,G,Y){if(wt(_,Uint8Array)&&(_=l.from(_,_.offset,_.byteLength)),!l.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(T===void 0&&(T=0),P===void 0&&(P=_?_.length:0),G===void 0&&(G=0),Y===void 0&&(Y=this.length),T<0||P>_.length||G<0||Y>this.length)throw new RangeError("out of range index");if(G>=Y&&T>=P)return 0;if(G>=Y)return-1;if(T>=P)return 1;if(T>>>=0,P>>>=0,G>>>=0,Y>>>=0,this===_)return 0;for(var ne=Y-G,Ae=P-T,ze=Math.min(ne,Ae),ct=this.slice(G,Y),ht=_.slice(T,P),vt=0;vt<ze;++vt)if(ct[vt]!==ht[vt]){ne=ct[vt],Ae=ht[vt];break}return ne<Ae?-1:Ae<ne?1:0};function Z(_,T,P,G,Y){if(_.length===0)return-1;if(typeof P=="string"?(G=P,P=0):P>2147483647?P=2147483647:P<-2147483648&&(P=-2147483648),P=+P,ve(P)&&(P=Y?0:_.length-1),P<0&&(P=_.length+P),P>=_.length){if(Y)return-1;P=_.length-1}else if(P<0)if(Y)P=0;else return-1;if(typeof T=="string"&&(T=l.from(T,G)),l.isBuffer(T))return T.length===0?-1:W(_,T,P,G,Y);if(typeof T=="number")return T=T&255,typeof Uint8Array.prototype.indexOf=="function"?Y?Uint8Array.prototype.indexOf.call(_,T,P):Uint8Array.prototype.lastIndexOf.call(_,T,P):W(_,[T],P,G,Y);throw new TypeError("val must be string, number or Buffer")}function W(_,T,P,G,Y){var ne=1,Ae=_.length,ze=T.length;if(G!==void 0&&(G=String(G).toLowerCase(),G==="ucs2"||G==="ucs-2"||G==="utf16le"||G==="utf-16le")){if(_.length<2||T.length<2)return-1;ne=2,Ae/=2,ze/=2,P/=2}function ct(Os,Ds){return ne===1?Os[Ds]:Os.readUInt16BE(Ds*ne)}var ht;if(Y){var vt=-1;for(ht=P;ht<Ae;ht++)if(ct(_,ht)===ct(T,vt===-1?0:ht-vt)){if(vt===-1&&(vt=ht),ht-vt+1===ze)return vt*ne}else vt!==-1&&(ht-=ht-vt),vt=-1}else for(P+ze>Ae&&(P=Ae-ze),ht=P;ht>=0;ht--){for(var At=!0,ns=0;ns<ze;ns++)if(ct(_,ht+ns)!==ct(T,ns)){At=!1;break}if(At)return ht}return-1}l.prototype.includes=function(_,T,P){return this.indexOf(_,T,P)!==-1},l.prototype.indexOf=function(_,T,P){return Z(this,_,T,P,!0)},l.prototype.lastIndexOf=function(_,T,P){return Z(this,_,T,P,!1)};function Q(_,T,P,G){P=Number(P)||0;var Y=_.length-P;G?(G=Number(G),G>Y&&(G=Y)):G=Y;var ne=T.length;G>ne/2&&(G=ne/2);for(var Ae=0;Ae<G;++Ae){var ze=parseInt(T.substr(Ae*2,2),16);if(ve(ze))return Ae;_[P+Ae]=ze}return Ae}function ye(_,T,P,G){return rt(Re(T,_.length-P),_,P,G)}function Se(_,T,P,G){return rt(Ls(T),_,P,G)}function ge(_,T,P,G){return rt(ce(T),_,P,G)}function Le(_,T,P,G){return rt(jr(T,_.length-P),_,P,G)}l.prototype.write=function(_,T,P,G){if(T===void 0)G="utf8",P=this.length,T=0;else if(P===void 0&&typeof T=="string")G=T,P=this.length,T=0;else if(isFinite(T))T=T>>>0,isFinite(P)?(P=P>>>0,G===void 0&&(G="utf8")):(G=P,P=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var Y=this.length-T;if((P===void 0||P>Y)&&(P=Y),_.length>0&&(P<0||T<0)||T>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");for(var ne=!1;;)switch(G){case"hex":return Q(this,_,T,P);case"utf8":case"utf-8":return ye(this,_,T,P);case"ascii":case"latin1":case"binary":return Se(this,_,T,P);case"base64":return ge(this,_,T,P);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Le(this,_,T,P);default:if(ne)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ne=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Je(_,T,P){return T===0&&P===_.length?e.fromByteArray(_):e.fromByteArray(_.slice(T,P))}function Ge(_,T,P){P=Math.min(_.length,P);for(var G=[],Y=T;Y<P;){var ne=_[Y],Ae=null,ze=ne>239?4:ne>223?3:ne>191?2:1;if(Y+ze<=P){var ct,ht,vt,At;switch(ze){case 1:ne<128&&(Ae=ne);break;case 2:ct=_[Y+1],(ct&192)===128&&(At=(ne&31)<<6|ct&63,At>127&&(Ae=At));break;case 3:ct=_[Y+1],ht=_[Y+2],(ct&192)===128&&(ht&192)===128&&(At=(ne&15)<<12|(ct&63)<<6|ht&63,At>2047&&(At<55296||At>57343)&&(Ae=At));break;case 4:ct=_[Y+1],ht=_[Y+2],vt=_[Y+3],(ct&192)===128&&(ht&192)===128&&(vt&192)===128&&(At=(ne&15)<<18|(ct&63)<<12|(ht&63)<<6|vt&63,At>65535&&At<1114112&&(Ae=At))}}Ae===null?(Ae=65533,ze=1):Ae>65535&&(Ae-=65536,G.push(Ae>>>10&1023|55296),Ae=56320|Ae&1023),G.push(Ae),Y+=ze}return Fe(G)}var Ze=4096;function Fe(_){var T=_.length;if(T<=Ze)return String.fromCharCode.apply(String,_);for(var P="",G=0;G<T;)P+=String.fromCharCode.apply(String,_.slice(G,G+=Ze));return P}function Xe(_,T,P){var G="";P=Math.min(_.length,P);for(var Y=T;Y<P;++Y)G+=String.fromCharCode(_[Y]&127);return G}function ie(_,T,P){var G="";P=Math.min(_.length,P);for(var Y=T;Y<P;++Y)G+=String.fromCharCode(_[Y]);return G}function Ee(_,T,P){var G=_.length;(!T||T<0)&&(T=0),(!P||P<0||P>G)&&(P=G);for(var Y="",ne=T;ne<P;++ne)Y+=St[_[ne]];return Y}function et(_,T,P){for(var G=_.slice(T,P),Y="",ne=0;ne<G.length-1;ne+=2)Y+=String.fromCharCode(G[ne]+G[ne+1]*256);return Y}l.prototype.slice=function(_,T){var P=this.length;_=~~_,T=T===void 0?P:~~T,_<0?(_+=P,_<0&&(_=0)):_>P&&(_=P),T<0?(T+=P,T<0&&(T=0)):T>P&&(T=P),T<_&&(T=_);var G=this.subarray(_,T);return Object.setPrototypeOf(G,l.prototype),G};function Me(_,T,P){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+T>P)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(_,T,P){_=_>>>0,T=T>>>0,P||Me(_,T,this.length);for(var G=this[_],Y=1,ne=0;++ne<T&&(Y*=256);)G+=this[_+ne]*Y;return G},l.prototype.readUintBE=l.prototype.readUIntBE=function(_,T,P){_=_>>>0,T=T>>>0,P||Me(_,T,this.length);for(var G=this[_+--T],Y=1;T>0&&(Y*=256);)G+=this[_+--T]*Y;return G},l.prototype.readUint8=l.prototype.readUInt8=function(_,T){return _=_>>>0,T||Me(_,1,this.length),this[_]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(_,T){return _=_>>>0,T||Me(_,2,this.length),this[_]|this[_+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(_,T){return _=_>>>0,T||Me(_,2,this.length),this[_]<<8|this[_+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},l.prototype.readIntLE=function(_,T,P){_=_>>>0,T=T>>>0,P||Me(_,T,this.length);for(var G=this[_],Y=1,ne=0;++ne<T&&(Y*=256);)G+=this[_+ne]*Y;return Y*=128,G>=Y&&(G-=Math.pow(2,8*T)),G},l.prototype.readIntBE=function(_,T,P){_=_>>>0,T=T>>>0,P||Me(_,T,this.length);for(var G=T,Y=1,ne=this[_+--G];G>0&&(Y*=256);)ne+=this[_+--G]*Y;return Y*=128,ne>=Y&&(ne-=Math.pow(2,8*T)),ne},l.prototype.readInt8=function(_,T){return _=_>>>0,T||Me(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},l.prototype.readInt16LE=function(_,T){_=_>>>0,T||Me(_,2,this.length);var P=this[_]|this[_+1]<<8;return P&32768?P|4294901760:P},l.prototype.readInt16BE=function(_,T){_=_>>>0,T||Me(_,2,this.length);var P=this[_+1]|this[_]<<8;return P&32768?P|4294901760:P},l.prototype.readInt32LE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},l.prototype.readInt32BE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},l.prototype.readFloatLE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),t.read(this,_,!0,23,4)},l.prototype.readFloatBE=function(_,T){return _=_>>>0,T||Me(_,4,this.length),t.read(this,_,!1,23,4)},l.prototype.readDoubleLE=function(_,T){return _=_>>>0,T||Me(_,8,this.length),t.read(this,_,!0,52,8)},l.prototype.readDoubleBE=function(_,T){return _=_>>>0,T||Me(_,8,this.length),t.read(this,_,!1,52,8)};function He(_,T,P,G,Y,ne){if(!l.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(T>Y||T<ne)throw new RangeError('"value" argument is out of bounds');if(P+G>_.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(_,T,P,G){if(_=+_,T=T>>>0,P=P>>>0,!G){var Y=Math.pow(2,8*P)-1;He(this,_,T,P,Y,0)}var ne=1,Ae=0;for(this[T]=_&255;++Ae<P&&(ne*=256);)this[T+Ae]=_/ne&255;return T+P},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(_,T,P,G){if(_=+_,T=T>>>0,P=P>>>0,!G){var Y=Math.pow(2,8*P)-1;He(this,_,T,P,Y,0)}var ne=P-1,Ae=1;for(this[T+ne]=_&255;--ne>=0&&(Ae*=256);)this[T+ne]=_/Ae&255;return T+P},l.prototype.writeUint8=l.prototype.writeUInt8=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,1,255,0),this[T]=_&255,T+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,2,65535,0),this[T]=_&255,this[T+1]=_>>>8,T+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,2,65535,0),this[T]=_>>>8,this[T+1]=_&255,T+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,4,4294967295,0),this[T+3]=_>>>24,this[T+2]=_>>>16,this[T+1]=_>>>8,this[T]=_&255,T+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,4,4294967295,0),this[T]=_>>>24,this[T+1]=_>>>16,this[T+2]=_>>>8,this[T+3]=_&255,T+4},l.prototype.writeIntLE=function(_,T,P,G){if(_=+_,T=T>>>0,!G){var Y=Math.pow(2,8*P-1);He(this,_,T,P,Y-1,-Y)}var ne=0,Ae=1,ze=0;for(this[T]=_&255;++ne<P&&(Ae*=256);)_<0&&ze===0&&this[T+ne-1]!==0&&(ze=1),this[T+ne]=(_/Ae>>0)-ze&255;return T+P},l.prototype.writeIntBE=function(_,T,P,G){if(_=+_,T=T>>>0,!G){var Y=Math.pow(2,8*P-1);He(this,_,T,P,Y-1,-Y)}var ne=P-1,Ae=1,ze=0;for(this[T+ne]=_&255;--ne>=0&&(Ae*=256);)_<0&&ze===0&&this[T+ne+1]!==0&&(ze=1),this[T+ne]=(_/Ae>>0)-ze&255;return T+P},l.prototype.writeInt8=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,1,127,-128),_<0&&(_=255+_+1),this[T]=_&255,T+1},l.prototype.writeInt16LE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,2,32767,-32768),this[T]=_&255,this[T+1]=_>>>8,T+2},l.prototype.writeInt16BE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,2,32767,-32768),this[T]=_>>>8,this[T+1]=_&255,T+2},l.prototype.writeInt32LE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,4,2147483647,-2147483648),this[T]=_&255,this[T+1]=_>>>8,this[T+2]=_>>>16,this[T+3]=_>>>24,T+4},l.prototype.writeInt32BE=function(_,T,P){return _=+_,T=T>>>0,P||He(this,_,T,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[T]=_>>>24,this[T+1]=_>>>16,this[T+2]=_>>>8,this[T+3]=_&255,T+4};function qe(_,T,P,G,Y,ne){if(P+G>_.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("Index out of range")}function zn(_,T,P,G,Y){return T=+T,P=P>>>0,Y||qe(_,T,P,4),t.write(_,T,P,G,23,4),P+4}l.prototype.writeFloatLE=function(_,T,P){return zn(this,_,T,!0,P)},l.prototype.writeFloatBE=function(_,T,P){return zn(this,_,T,!1,P)};function Mt(_,T,P,G,Y){return T=+T,P=P>>>0,Y||qe(_,T,P,8),t.write(_,T,P,G,52,8),P+8}l.prototype.writeDoubleLE=function(_,T,P){return Mt(this,_,T,!0,P)},l.prototype.writeDoubleBE=function(_,T,P){return Mt(this,_,T,!1,P)},l.prototype.copy=function(_,T,P,G){if(!l.isBuffer(_))throw new TypeError("argument should be a Buffer");if(P||(P=0),!G&&G!==0&&(G=this.length),T>=_.length&&(T=_.length),T||(T=0),G>0&&G<P&&(G=P),G===P||_.length===0||this.length===0)return 0;if(T<0)throw new RangeError("targetStart out of bounds");if(P<0||P>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),_.length-T<G-P&&(G=_.length-T+P);var Y=G-P;return this===_&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(T,P,G):Uint8Array.prototype.set.call(_,this.subarray(P,G),T),Y},l.prototype.fill=function(_,T,P,G){if(typeof _=="string"){if(typeof T=="string"?(G=T,T=0,P=this.length):typeof P=="string"&&(G=P,P=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!l.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(_.length===1){var Y=_.charCodeAt(0);(G==="utf8"&&Y<128||G==="latin1")&&(_=Y)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(T<0||this.length<T||this.length<P)throw new RangeError("Out of range index");if(P<=T)return this;T=T>>>0,P=P===void 0?this.length:P>>>0,_||(_=0);var ne;if(typeof _=="number")for(ne=T;ne<P;++ne)this[ne]=_;else{var Ae=l.isBuffer(_)?_:l.from(_,G),ze=Ae.length;if(ze===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(ne=0;ne<P-T;++ne)this[ne+T]=Ae[ne%ze]}return this};var pt=/[^+/0-9A-Za-z-_]/g;function pn(_){if(_=_.split("=")[0],_=_.trim().replace(pt,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function Re(_,T){T=T||1/0;for(var P,G=_.length,Y=null,ne=[],Ae=0;Ae<G;++Ae){if(P=_.charCodeAt(Ae),P>55295&&P<57344){if(!Y){if(P>56319){(T-=3)>-1&&ne.push(239,191,189);continue}else if(Ae+1===G){(T-=3)>-1&&ne.push(239,191,189);continue}Y=P;continue}if(P<56320){(T-=3)>-1&&ne.push(239,191,189),Y=P;continue}P=(Y-55296<<10|P-56320)+65536}else Y&&(T-=3)>-1&&ne.push(239,191,189);if(Y=null,P<128){if((T-=1)<0)break;ne.push(P)}else if(P<2048){if((T-=2)<0)break;ne.push(P>>6|192,P&63|128)}else if(P<65536){if((T-=3)<0)break;ne.push(P>>12|224,P>>6&63|128,P&63|128)}else if(P<1114112){if((T-=4)<0)break;ne.push(P>>18|240,P>>12&63|128,P>>6&63|128,P&63|128)}else throw new Error("Invalid code point")}return ne}function Ls(_){for(var T=[],P=0;P<_.length;++P)T.push(_.charCodeAt(P)&255);return T}function jr(_,T){for(var P,G,Y,ne=[],Ae=0;Ae<_.length&&!((T-=2)<0);++Ae)P=_.charCodeAt(Ae),G=P>>8,Y=P%256,ne.push(Y),ne.push(G);return ne}function ce(_){return e.toByteArray(pn(_))}function rt(_,T,P,G){for(var Y=0;Y<G&&!(Y+P>=T.length||Y>=_.length);++Y)T[Y+P]=_[Y];return Y}function wt(_,T){return _ instanceof T||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===T.name}function ve(_){return _!==_}var St=function(){for(var _="0123456789abcdef",T=new Array(256),P=0;P<16;++P)for(var G=P*16,Y=0;Y<16;++Y)T[G+Y]=_[P]+_[Y];return T}()})(Mh);var Uo=Mh,Ii=Uo.Buffer,Pn={},Ln;for(Ln in Uo)Uo.hasOwnProperty(Ln)&&(Ln==="SlowBuffer"||Ln==="Buffer"||(Pn[Ln]=Uo[Ln]));var Ci=Pn.Buffer={};for(Ln in Ii)Ii.hasOwnProperty(Ln)&&(Ln==="allocUnsafe"||Ln==="allocUnsafeSlow"||(Ci[Ln]=Ii[Ln]));Pn.Buffer.prototype=Ii.prototype;(!Ci.from||Ci.from===Uint8Array.from)&&(Ci.from=function(s,e,t){if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type '+typeof s);if(s&&typeof s.length>"u")throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);return Ii(s,e,t)});Ci.alloc||(Ci.alloc=function(s,e,t){if(typeof s!="number")throw new TypeError('The "size" argument must be of type number. Received type '+typeof s);if(s<0||s>=2*(1<<30))throw new RangeError('The value "'+s+'" is invalid for option "size"');var n=Ii(s);return!e||e.length===0?n.fill(0):typeof t=="string"?n.fill(e,t):n.fill(e),n});if(!Pn.kStringMaxLength)try{Pn.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch{}Pn.constants||(Pn.constants={MAX_LENGTH:Pn.kMaxLength},Pn.kStringMaxLength&&(Pn.constants.MAX_STRING_LENGTH=Pn.kStringMaxLength));var mr=Pn,Lh={},x0="\uFEFF";Lh.PrependBOM=Oh;function Oh(s,e){this.encoder=s,this.addBOM=!0}Oh.prototype.write=function(s){return this.addBOM&&(s=x0+s,this.addBOM=!1),this.encoder.write(s)};Oh.prototype.end=function(){return this.encoder.end()};Lh.StripBOM=Dh;function Dh(s,e){this.decoder=s,this.pass=!1,this.options=e||{}}Dh.prototype.write=function(s){var e=this.decoder.write(s);return this.pass||!e||(e[0]===x0&&(e=e.slice(1),typeof this.options.stripBOM=="function"&&this.options.stripBOM()),this.pass=!0),e};Dh.prototype.end=function(){return this.decoder.end()};var r5=typeof Object.hasOwn>"u"?Function.call.bind(Object.prototype.hasOwnProperty):Object.hasOwn;function i5(s,e){for(var t in e)r5(e,t)&&(s[t]=e[t])}var w0=i5,Td={},Kl={},Ql={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Id;function a5(){return Id||(Id=1,function(s,e){var t=Mh,n=t.Buffer;function r(a,l){for(var c in a)l[c]=a[c]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?s.exports=t:(r(t,e),e.Buffer=i);function i(a,l,c){return n(a,l,c)}i.prototype=Object.create(n.prototype),r(n,i),i.from=function(a,l,c){if(typeof a=="number")throw new TypeError("Argument must not be a number");return n(a,l,c)},i.alloc=function(a,l,c){if(typeof a!="number")throw new TypeError("Argument must be a number");var u=n(a);return l!==void 0?typeof c=="string"?u.fill(l,c):u.fill(l):u.fill(0),u},i.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n(a)},i.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(a)}}(Ql,Ql.exports)),Ql.exports}var Cd;function o5(){if(Cd)return Kl;Cd=1;var s=a5().Buffer,e=s.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(E){if(!E)return"utf8";for(var L;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(L)return;E=(""+E).toLowerCase(),L=!0}}function n(E){var L=t(E);if(typeof L!="string"&&(s.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return L||E}Kl.StringDecoder=r;function r(E){this.encoding=n(E);var L;switch(this.encoding){case"utf16le":this.text=g,this.end=m,L=4;break;case"utf8":this.fillLast=c,L=4;break;case"base64":this.text=y,this.end=A,L=3;break;default:this.write=w,this.end=C;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(L)}r.prototype.write=function(E){if(E.length===0)return"";var L,O;if(this.lastNeed){if(L=this.fillLast(E),L===void 0)return"";O=this.lastNeed,this.lastNeed=0}else O=0;return O<E.length?L?L+this.text(E,O):this.text(E,O):L||""},r.prototype.end=p,r.prototype.text=u,r.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function i(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function a(E,L,O){var F=L.length-1;if(F<O)return 0;var B=i(L[F]);return B>=0?(B>0&&(E.lastNeed=B-1),B):--F<O||B===-2?0:(B=i(L[F]),B>=0?(B>0&&(E.lastNeed=B-2),B):--F<O||B===-2?0:(B=i(L[F]),B>=0?(B>0&&(B===2?B=0:E.lastNeed=B-3),B):0))}function l(E,L,O){if((L[0]&192)!==128)return E.lastNeed=0,"";if(E.lastNeed>1&&L.length>1){if((L[1]&192)!==128)return E.lastNeed=1,"";if(E.lastNeed>2&&L.length>2&&(L[2]&192)!==128)return E.lastNeed=2,""}}function c(E){var L=this.lastTotal-this.lastNeed,O=l(this,E);if(O!==void 0)return O;if(this.lastNeed<=E.length)return E.copy(this.lastChar,L,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,L,0,E.length),this.lastNeed-=E.length}function u(E,L){var O=a(this,E,L);if(!this.lastNeed)return E.toString("utf8",L);this.lastTotal=O;var F=E.length-(O-this.lastNeed);return E.copy(this.lastChar,0,F),E.toString("utf8",L,F)}function p(E){var L=E&&E.length?this.write(E):"";return this.lastNeed?L+"":L}function g(E,L){if((E.length-L)%2===0){var O=E.toString("utf16le",L);if(O){var F=O.charCodeAt(O.length-1);if(F>=55296&&F<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],O.slice(0,-1)}return O}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",L,E.length-1)}function m(E){var L=E&&E.length?this.write(E):"";if(this.lastNeed){var O=this.lastTotal-this.lastNeed;return L+this.lastChar.toString("utf16le",0,O)}return L}function y(E,L){var O=(E.length-L)%3;return O===0?E.toString("base64",L):(this.lastNeed=3-O,this.lastTotal=3,O===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",L,E.length-O))}function A(E){var L=E&&E.length?this.write(E):"";return this.lastNeed?L+this.lastChar.toString("base64",0,3-this.lastNeed):L}function w(E){return E.toString(this.encoding)}function C(E){return E&&E.length?this.write(E):""}return Kl}var Jl,kd;function l5(){if(kd)return Jl;kd=1;var s=mr.Buffer;Jl={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:e};function e(u,p){this.enc=u.encodingName,this.bomAware=u.bomAware,this.enc==="base64"?this.encoder=i:this.enc==="utf8"?this.encoder=c:this.enc==="cesu8"&&(this.enc="utf8",this.encoder=a,s.from("eda0bdedb2a9","hex").toString()!==""&&(this.decoder=l,this.defaultCharUnicode=p.defaultCharUnicode))}e.prototype.encoder=r,e.prototype.decoder=n;var t=o5().StringDecoder;function n(u,p){this.decoder=new t(p.enc)}n.prototype.write=function(u){return s.isBuffer(u)||(u=s.from(u)),this.decoder.write(u)},n.prototype.end=function(){return this.decoder.end()};function r(u,p){this.enc=p.enc}r.prototype.write=function(u){return s.from(u,this.enc)},r.prototype.end=function(){};function i(u,p){this.prevStr=""}i.prototype.write=function(u){u=this.prevStr+u;var p=u.length-u.length%4;return this.prevStr=u.slice(p),u=u.slice(0,p),s.from(u,"base64")},i.prototype.end=function(){return s.from(this.prevStr,"base64")};function a(u,p){}a.prototype.write=function(u){for(var p=s.alloc(u.length*3),g=0,m=0;m<u.length;m++){var y=u.charCodeAt(m);y<128?p[g++]=y:y<2048?(p[g++]=192+(y>>>6),p[g++]=128+(y&63)):(p[g++]=224+(y>>>12),p[g++]=128+(y>>>6&63),p[g++]=128+(y&63))}return p.slice(0,g)},a.prototype.end=function(){};function l(u,p){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=p.defaultCharUnicode}l.prototype.write=function(u){for(var p=this.acc,g=this.contBytes,m=this.accBytes,y="",A=0;A<u.length;A++){var w=u[A];(w&192)!==128?(g>0&&(y+=this.defaultCharUnicode,g=0),w<128?y+=String.fromCharCode(w):w<224?(p=w&31,g=1,m=1):w<240?(p=w&15,g=2,m=1):y+=this.defaultCharUnicode):g>0?(p=p<<6|w&63,g--,m++,g===0&&(m===2&&p<128&&p>0?y+=this.defaultCharUnicode:m===3&&p<2048?y+=this.defaultCharUnicode:y+=String.fromCharCode(p))):y+=this.defaultCharUnicode}return this.acc=p,this.contBytes=g,this.accBytes=m,y},l.prototype.end=function(){var u=0;return this.contBytes>0&&(u+=this.defaultCharUnicode),u};function c(u,p){this.highSurrogate=""}return c.prototype.write=function(u){if(this.highSurrogate&&(u=this.highSurrogate+u,this.highSurrogate=""),u.length>0){var p=u.charCodeAt(u.length-1);p>=55296&&p<56320&&(this.highSurrogate=u[u.length-1],u=u.slice(0,u.length-1))}return s.from(u,this.enc)},c.prototype.end=function(){if(this.highSurrogate){var u=this.highSurrogate;return this.highSurrogate="",s.from(u,this.enc)}},Jl}var Is={},Md;function c5(){if(Md)return Is;Md=1;var s=mr.Buffer;Is._utf32=e;function e(u,p){this.iconv=p,this.bomAware=!0,this.isLE=u.isLE}Is.utf32le={type:"_utf32",isLE:!0},Is.utf32be={type:"_utf32",isLE:!1},Is.ucs4le="utf32le",Is.ucs4be="utf32be",e.prototype.encoder=t,e.prototype.decoder=n;function t(u,p){this.isLE=p.isLE,this.highSurrogate=0}t.prototype.write=function(u){for(var p=s.from(u,"ucs2"),g=s.alloc(p.length*2),m=this.isLE?g.writeUInt32LE:g.writeUInt32BE,y=0,A=0;A<p.length;A+=2){var w=p.readUInt16LE(A),C=w>=55296&&w<56320,E=w>=56320&&w<57344;if(this.highSurrogate)if(C||!E)m.call(g,this.highSurrogate,y),y+=4;else{var L=(this.highSurrogate-55296<<10|w-56320)+65536;m.call(g,L,y),y+=4,this.highSurrogate=0;continue}C?this.highSurrogate=w:(m.call(g,w,y),y+=4,this.highSurrogate=0)}return y<g.length&&(g=g.slice(0,y)),g},t.prototype.end=function(){if(this.highSurrogate){var u=s.alloc(4);return this.isLE?u.writeUInt32LE(this.highSurrogate,0):u.writeUInt32BE(this.highSurrogate,0),this.highSurrogate=0,u}};function n(u,p){this.isLE=p.isLE,this.badChar=p.iconv.defaultCharUnicode.charCodeAt(0),this.overflow=[]}n.prototype.write=function(u){if(u.length===0)return"";var p=0,g=0,m=s.alloc(u.length+4),y=0,A=this.isLE,w=this.overflow,C=this.badChar;if(w.length>0){for(;p<u.length&&w.length<4;p++)w.push(u[p]);w.length===4&&(A?g=w[p]|w[p+1]<<8|w[p+2]<<16|w[p+3]<<24:g=w[p+3]|w[p+2]<<8|w[p+1]<<16|w[p]<<24,w.length=0,y=r(m,y,g,C))}for(;p<u.length-3;p+=4)A?g=u[p]|u[p+1]<<8|u[p+2]<<16|u[p+3]<<24:g=u[p+3]|u[p+2]<<8|u[p+1]<<16|u[p]<<24,y=r(m,y,g,C);for(;p<u.length;p++)w.push(u[p]);return m.slice(0,y).toString("ucs2")};function r(u,p,g,m){if((g<0||g>1114111)&&(g=m),g>=65536){g-=65536;var y=55296|g>>10;u[p++]=y&255,u[p++]=y>>8;var g=56320|g&1023}return u[p++]=g&255,u[p++]=g>>8,p}n.prototype.end=function(){this.overflow.length=0},Is.utf32=i,Is.ucs4="utf32";function i(u,p){this.iconv=p}i.prototype.encoder=a,i.prototype.decoder=l;function a(u,p){u=u||{},u.addBOM===void 0&&(u.addBOM=!0),this.encoder=p.iconv.getEncoder(u.defaultEncoding||"utf-32le",u)}a.prototype.write=function(u){return this.encoder.write(u)},a.prototype.end=function(){return this.encoder.end()};function l(u,p){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=u||{},this.iconv=p.iconv}l.prototype.write=function(u){if(!this.decoder){if(this.initialBufs.push(u),this.initialBufsLen+=u.length,this.initialBufsLen<32)return"";var p=c(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(p,this.options);for(var g="",m=0;m<this.initialBufs.length;m++)g+=this.decoder.write(this.initialBufs[m]);return this.initialBufs.length=this.initialBufsLen=0,g}return this.decoder.write(u)},l.prototype.end=function(){if(!this.decoder){var u=c(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(u,this.options);for(var p="",g=0;g<this.initialBufs.length;g++)p+=this.decoder.write(this.initialBufs[g]);var m=this.decoder.end();return m&&(p+=m),this.initialBufs.length=this.initialBufsLen=0,p}return this.decoder.end()};function c(u,p){var g=[],m=0,y=0,A=0,w=0,C=0;e:for(var E=0;E<u.length;E++)for(var L=u[E],O=0;O<L.length;O++)if(g.push(L[O]),g.length===4){if(m===0){if(g[0]===255&&g[1]===254&&g[2]===0&&g[3]===0)return"utf-32le";if(g[0]===0&&g[1]===0&&g[2]===254&&g[3]===255)return"utf-32be"}if((g[0]!==0||g[1]>16)&&A++,(g[3]!==0||g[2]>16)&&y++,g[0]===0&&g[1]===0&&(g[2]!==0||g[3]!==0)&&C++,(g[0]!==0||g[1]!==0)&&g[2]===0&&g[3]===0&&w++,g.length=0,m++,m>=100)break e}return C-A>w-y?"utf-32be":C-A<w-y?"utf-32le":p||"utf-32le"}return Is}var xo={},Pd;function h5(){if(Pd)return xo;Pd=1;var s=mr.Buffer;xo.utf16be=e;function e(){}e.prototype.encoder=t,e.prototype.decoder=n,e.prototype.bomAware=!0;function t(){}t.prototype.write=function(c){for(var u=s.from(c,"ucs2"),p=0;p<u.length;p+=2){var g=u[p];u[p]=u[p+1],u[p+1]=g}return u},t.prototype.end=function(){};function n(){this.overflowByte=-1}n.prototype.write=function(c){if(c.length==0)return"";var u=s.alloc(c.length+1),p=0,g=0;for(this.overflowByte!==-1&&(u[0]=c[0],u[1]=this.overflowByte,p=1,g=2);p<c.length-1;p+=2,g+=2)u[g]=c[p+1],u[g+1]=c[p];return this.overflowByte=p==c.length-1?c[c.length-1]:-1,u.slice(0,g).toString("ucs2")},n.prototype.end=function(){this.overflowByte=-1},xo.utf16=r;function r(c,u){this.iconv=u}r.prototype.encoder=i,r.prototype.decoder=a;function i(c,u){c=c||{},c.addBOM===void 0&&(c.addBOM=!0),this.encoder=u.iconv.getEncoder("utf-16le",c)}i.prototype.write=function(c){return this.encoder.write(c)},i.prototype.end=function(){return this.encoder.end()};function a(c,u){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=c||{},this.iconv=u.iconv}a.prototype.write=function(c){if(!this.decoder){if(this.initialBufs.push(c),this.initialBufsLen+=c.length,this.initialBufsLen<16)return"";var u=l(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(u,this.options);for(var p="",g=0;g<this.initialBufs.length;g++)p+=this.decoder.write(this.initialBufs[g]);return this.initialBufs.length=this.initialBufsLen=0,p}return this.decoder.write(c)},a.prototype.end=function(){if(!this.decoder){var c=l(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(c,this.options);for(var u="",p=0;p<this.initialBufs.length;p++)u+=this.decoder.write(this.initialBufs[p]);var g=this.decoder.end();return g&&(u+=g),this.initialBufs.length=this.initialBufsLen=0,u}return this.decoder.end()};function l(c,u){var p=[],g=0,m=0,y=0;e:for(var A=0;A<c.length;A++)for(var w=c[A],C=0;C<w.length;C++)if(p.push(w[C]),p.length===2){if(g===0){if(p[0]===255&&p[1]===254)return"utf-16le";if(p[0]===254&&p[1]===255)return"utf-16be"}if(p[0]===0&&p[1]!==0&&y++,p[0]!==0&&p[1]===0&&m++,p.length=0,g++,g>=100)break e}return y>m?"utf-16be":y<m?"utf-16le":u||"utf-16le"}return xo}var ta={},Ld;function u5(){if(Ld)return ta;Ld=1;var s=mr.Buffer;ta.utf7=e,ta.unicode11utf7="utf7";function e(w,C){this.iconv=C}e.prototype.encoder=n,e.prototype.decoder=r,e.prototype.bomAware=!0;var t=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function n(w,C){this.iconv=C.iconv}n.prototype.write=function(w){return s.from(w.replace(t,(function(C){return"+"+(C==="+"?"":this.iconv.encode(C,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}).bind(this)))},n.prototype.end=function(){};function r(w,C){this.iconv=C.iconv,this.inBase64=!1,this.base64Accum=""}for(var i=/[A-Za-z0-9\/+]/,a=[],l=0;l<256;l++)a[l]=i.test(String.fromCharCode(l));var c=43,u=45,p=38;r.prototype.write=function(w){for(var C="",E=0,L=this.inBase64,O=this.base64Accum,F=0;F<w.length;F++)if(!L)w[F]==c&&(C+=this.iconv.decode(w.slice(E,F),"ascii"),E=F+1,L=!0);else if(!a[w[F]]){if(F==E&&w[F]==u)C+="+";else{var B=O+this.iconv.decode(w.slice(E,F),"ascii");C+=this.iconv.decode(s.from(B,"base64"),"utf16-be")}w[F]!=u&&F--,E=F+1,L=!1,O=""}if(!L)C+=this.iconv.decode(w.slice(E),"ascii");else{var B=O+this.iconv.decode(w.slice(E),"ascii"),Z=B.length-B.length%8;O=B.slice(Z),B=B.slice(0,Z),C+=this.iconv.decode(s.from(B,"base64"),"utf16-be")}return this.inBase64=L,this.base64Accum=O,C},r.prototype.end=function(){var w="";return this.inBase64&&this.base64Accum.length>0&&(w=this.iconv.decode(s.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",w},ta.utf7imap=g;function g(w,C){this.iconv=C}g.prototype.encoder=m,g.prototype.decoder=y,g.prototype.bomAware=!0;function m(w,C){this.iconv=C.iconv,this.inBase64=!1,this.base64Accum=s.alloc(6),this.base64AccumIdx=0}m.prototype.write=function(w){for(var C=this.inBase64,E=this.base64Accum,L=this.base64AccumIdx,O=s.alloc(w.length*5+10),F=0,B=0;B<w.length;B++){var Z=w.charCodeAt(B);Z>=32&&Z<=126?(C&&(L>0&&(F+=O.write(E.slice(0,L).toString("base64").replace(/\//g,",").replace(/=+$/,""),F),L=0),O[F++]=u,C=!1),C||(O[F++]=Z,Z===p&&(O[F++]=u))):(C||(O[F++]=p,C=!0),C&&(E[L++]=Z>>8,E[L++]=Z&255,L==E.length&&(F+=O.write(E.toString("base64").replace(/\//g,","),F),L=0)))}return this.inBase64=C,this.base64AccumIdx=L,O.slice(0,F)},m.prototype.end=function(){var w=s.alloc(10),C=0;return this.inBase64&&(this.base64AccumIdx>0&&(C+=w.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),C),this.base64AccumIdx=0),w[C++]=u,this.inBase64=!1),w.slice(0,C)};function y(w,C){this.iconv=C.iconv,this.inBase64=!1,this.base64Accum=""}var A=a.slice();return A[44]=!0,y.prototype.write=function(w){for(var C="",E=0,L=this.inBase64,O=this.base64Accum,F=0;F<w.length;F++)if(!L)w[F]==p&&(C+=this.iconv.decode(w.slice(E,F),"ascii"),E=F+1,L=!0);else if(!A[w[F]]){if(F==E&&w[F]==u)C+="&";else{var B=O+this.iconv.decode(w.slice(E,F),"ascii").replace(/,/g,"/");C+=this.iconv.decode(s.from(B,"base64"),"utf16-be")}w[F]!=u&&F--,E=F+1,L=!1,O=""}if(!L)C+=this.iconv.decode(w.slice(E),"ascii");else{var B=O+this.iconv.decode(w.slice(E),"ascii").replace(/,/g,"/"),Z=B.length-B.length%8;O=B.slice(Z),B=B.slice(0,Z),C+=this.iconv.decode(s.from(B,"base64"),"utf16-be")}return this.inBase64=L,this.base64Accum=O,C},y.prototype.end=function(){var w="";return this.inBase64&&this.base64Accum.length>0&&(w=this.iconv.decode(s.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",w},ta}var ec={},Od;function d5(){if(Od)return ec;Od=1;var s=mr.Buffer;ec._sbcs=e;function e(r,i){if(!r)throw new Error("SBCS codec is called without the data.");if(!r.chars||r.chars.length!==128&&r.chars.length!==256)throw new Error("Encoding '"+r.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(r.chars.length===128){for(var a="",l=0;l<128;l++)a+=String.fromCharCode(l);r.chars=a+r.chars}this.decodeBuf=s.from(r.chars,"ucs2");for(var c=s.alloc(65536,i.defaultCharSingleByte.charCodeAt(0)),l=0;l<r.chars.length;l++)c[r.chars.charCodeAt(l)]=l;this.encodeBuf=c}e.prototype.encoder=t,e.prototype.decoder=n;function t(r,i){this.encodeBuf=i.encodeBuf}t.prototype.write=function(r){for(var i=s.alloc(r.length),a=0;a<r.length;a++)i[a]=this.encodeBuf[r.charCodeAt(a)];return i},t.prototype.end=function(){};function n(r,i){this.decodeBuf=i.decodeBuf}return n.prototype.write=function(r){for(var i=this.decodeBuf,a=s.alloc(r.length*2),l=0,c=0,u=0;u<r.length;u++)l=r[u]*2,c=u*2,a[c]=i[l],a[c+1]=i[l+1];return a.toString("ucs2")},n.prototype.end=function(){},ec}var Dd,Bd;function p5(){return Bd||(Bd=1,Dd={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},mik:{type:"_sbcs",chars:""},cp720:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",1e4:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}),Dd}var Nd,Rd;function f5(){return Rd||(Rd=1,Nd={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\uFEFF"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}~`},iso646cn:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_\`abcdefghijklmnopqrstuvwxyz{|}`},iso646jp:{type:"_sbcs",chars:`\0\x07\b	
\v\f\r\x1B !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_\`abcdefghijklmnopqrstuvwxyz{|}`},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}),Nd}var tc={},Fd;function g5(){if(Fd)return tc;Fd=1;var s=mr.Buffer;tc._dbcs=c;for(var e=-1,t=-2,n=-10,r=-1e3,i=new Array(256),a=-1,l=0;l<256;l++)i[l]=e;function c(m,y){if(this.encodingName=m.encodingName,!m)throw new Error("DBCS codec is called without the data.");if(!m.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var A=m.table();this.decodeTables=[],this.decodeTables[0]=i.slice(0),this.decodeTableSeq=[];for(var w=0;w<A.length;w++)this._addDecodeChunk(A[w]);if(typeof m.gb18030=="function"){this.gb18030=m.gb18030();var C=this.decodeTables.length;this.decodeTables.push(i.slice(0));var E=this.decodeTables.length;this.decodeTables.push(i.slice(0));for(var L=this.decodeTables[0],w=129;w<=254;w++)for(var O=this.decodeTables[r-L[w]],F=48;F<=57;F++){if(O[F]===e)O[F]=r-C;else if(O[F]>r)throw new Error("gb18030 decode tables conflict at byte 2");for(var B=this.decodeTables[r-O[F]],Z=129;Z<=254;Z++){if(B[Z]===e)B[Z]=r-E;else{if(B[Z]===r-E)continue;if(B[Z]>r)throw new Error("gb18030 decode tables conflict at byte 3")}for(var W=this.decodeTables[r-B[Z]],Q=48;Q<=57;Q++)W[Q]===e&&(W[Q]=t)}}}this.defaultCharUnicode=y.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var ye={};if(m.encodeSkipVals)for(var w=0;w<m.encodeSkipVals.length;w++){var Se=m.encodeSkipVals[w];if(typeof Se=="number")ye[Se]=!0;else for(var F=Se.from;F<=Se.to;F++)ye[F]=!0}if(this._fillEncodeTable(0,0,ye),m.encodeAdd)for(var ge in m.encodeAdd)Object.prototype.hasOwnProperty.call(m.encodeAdd,ge)&&this._setEncodeChar(ge.charCodeAt(0),m.encodeAdd[ge]);this.defCharSB=this.encodeTable[0][y.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===e&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===e&&(this.defCharSB=63)}c.prototype.encoder=u,c.prototype.decoder=p,c.prototype._getDecodeTrieNode=function(m){for(var y=[];m>0;m>>>=8)y.push(m&255);y.length==0&&y.push(0);for(var A=this.decodeTables[0],w=y.length-1;w>0;w--){var C=A[y[w]];if(C==e)A[y[w]]=r-this.decodeTables.length,this.decodeTables.push(A=i.slice(0));else if(C<=r)A=this.decodeTables[r-C];else throw new Error("Overwrite byte in "+this.encodingName+", addr: "+m.toString(16))}return A},c.prototype._addDecodeChunk=function(m){var y=parseInt(m[0],16),A=this._getDecodeTrieNode(y);y=y&255;for(var w=1;w<m.length;w++){var C=m[w];if(typeof C=="string")for(var E=0;E<C.length;){var L=C.charCodeAt(E++);if(L>=55296&&L<56320){var O=C.charCodeAt(E++);if(O>=56320&&O<57344)A[y++]=65536+(L-55296)*1024+(O-56320);else throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+m[0])}else if(L>4080&&L<=4095){for(var F=4095-L+2,B=[],Z=0;Z<F;Z++)B.push(C.charCodeAt(E++));A[y++]=n-this.decodeTableSeq.length,this.decodeTableSeq.push(B)}else A[y++]=L}else if(typeof C=="number")for(var W=A[y-1]+1,E=0;E<C;E++)A[y++]=W++;else throw new Error("Incorrect type '"+typeof C+"' given in "+this.encodingName+" at chunk "+m[0])}if(y>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+m[0]+": too long"+y)},c.prototype._getEncodeBucket=function(m){var y=m>>8;return this.encodeTable[y]===void 0&&(this.encodeTable[y]=i.slice(0)),this.encodeTable[y]},c.prototype._setEncodeChar=function(m,y){var A=this._getEncodeBucket(m),w=m&255;A[w]<=n?this.encodeTableSeq[n-A[w]][a]=y:A[w]==e&&(A[w]=y)},c.prototype._setEncodeSequence=function(m,y){var A=m[0],w=this._getEncodeBucket(A),C=A&255,E;w[C]<=n?E=this.encodeTableSeq[n-w[C]]:(E={},w[C]!==e&&(E[a]=w[C]),w[C]=n-this.encodeTableSeq.length,this.encodeTableSeq.push(E));for(var L=1;L<m.length-1;L++){var O=E[A];typeof O=="object"?E=O:(E=E[A]={},O!==void 0&&(E[a]=O))}A=m[m.length-1],E[A]=y},c.prototype._fillEncodeTable=function(m,y,A){for(var w=this.decodeTables[m],C=!1,E={},L=0;L<256;L++){var O=w[L],F=y+L;if(!A[F])if(O>=0)this._setEncodeChar(O,F),C=!0;else if(O<=r){var B=r-O;if(!E[B]){var Z=F<<8>>>0;this._fillEncodeTable(B,Z,A)?C=!0:E[B]=!0}}else O<=n&&(this._setEncodeSequence(this.decodeTableSeq[n-O],F),C=!0)}return C};function u(m,y){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=y.encodeTable,this.encodeTableSeq=y.encodeTableSeq,this.defaultCharSingleByte=y.defCharSB,this.gb18030=y.gb18030}u.prototype.write=function(m){for(var y=s.alloc(m.length*(this.gb18030?4:3)),A=this.leadSurrogate,w=this.seqObj,C=-1,E=0,L=0;;){if(C===-1){if(E==m.length)break;var O=m.charCodeAt(E++)}else{var O=C;C=-1}if(O>=55296&&O<57344)if(O<56320)if(A===-1){A=O;continue}else A=O,O=e;else A!==-1?(O=65536+(A-55296)*1024+(O-56320),A=-1):O=e;else A!==-1&&(C=O,O=e,A=-1);var F=e;if(w!==void 0&&O!=e){var B=w[O];if(typeof B=="object"){w=B;continue}else typeof B=="number"?F=B:B==null&&(B=w[a],B!==void 0&&(F=B,C=O));w=void 0}else if(O>=0){var Z=this.encodeTable[O>>8];if(Z!==void 0&&(F=Z[O&255]),F<=n){w=this.encodeTableSeq[n-F];continue}if(F==e&&this.gb18030){var W=g(this.gb18030.uChars,O);if(W!=-1){var F=this.gb18030.gbChars[W]+(O-this.gb18030.uChars[W]);y[L++]=129+Math.floor(F/12600),F=F%12600,y[L++]=48+Math.floor(F/1260),F=F%1260,y[L++]=129+Math.floor(F/10),F=F%10,y[L++]=48+F;continue}}}F===e&&(F=this.defaultCharSingleByte),F<256?y[L++]=F:F<65536?(y[L++]=F>>8,y[L++]=F&255):F<16777216?(y[L++]=F>>16,y[L++]=F>>8&255,y[L++]=F&255):(y[L++]=F>>>24,y[L++]=F>>>16&255,y[L++]=F>>>8&255,y[L++]=F&255)}return this.seqObj=w,this.leadSurrogate=A,y.slice(0,L)},u.prototype.end=function(){if(!(this.leadSurrogate===-1&&this.seqObj===void 0)){var m=s.alloc(10),y=0;if(this.seqObj){var A=this.seqObj[a];A!==void 0&&(A<256?m[y++]=A:(m[y++]=A>>8,m[y++]=A&255)),this.seqObj=void 0}return this.leadSurrogate!==-1&&(m[y++]=this.defaultCharSingleByte,this.leadSurrogate=-1),m.slice(0,y)}},u.prototype.findIdx=g;function p(m,y){this.nodeIdx=0,this.prevBytes=[],this.decodeTables=y.decodeTables,this.decodeTableSeq=y.decodeTableSeq,this.defaultCharUnicode=y.defaultCharUnicode,this.gb18030=y.gb18030}p.prototype.write=function(m){for(var y=s.alloc(m.length*2),A=this.nodeIdx,w=this.prevBytes,C=this.prevBytes.length,E=-this.prevBytes.length,L,O=0,F=0;O<m.length;O++){var B=O>=0?m[O]:w[O+C],L=this.decodeTables[A][B];if(!(L>=0))if(L===e)L=this.defaultCharUnicode.charCodeAt(0),O=E;else if(L===t){if(O>=3)var Z=(m[O-3]-129)*12600+(m[O-2]-48)*1260+(m[O-1]-129)*10+(B-48);else var Z=(w[O-3+C]-129)*12600+((O-2>=0?m[O-2]:w[O-2+C])-48)*1260+((O-1>=0?m[O-1]:w[O-1+C])-129)*10+(B-48);var W=g(this.gb18030.gbChars,Z);L=this.gb18030.uChars[W]+Z-this.gb18030.gbChars[W]}else if(L<=r){A=r-L;continue}else if(L<=n){for(var Q=this.decodeTableSeq[n-L],ye=0;ye<Q.length-1;ye++)L=Q[ye],y[F++]=L&255,y[F++]=L>>8;L=Q[Q.length-1]}else throw new Error("iconv-lite internal error: invalid decoding table value "+L+" at "+A+"/"+B);if(L>=65536){L-=65536;var Se=55296|L>>10;y[F++]=Se&255,y[F++]=Se>>8,L=56320|L&1023}y[F++]=L&255,y[F++]=L>>8,A=0,E=O+1}return this.nodeIdx=A,this.prevBytes=E>=0?Array.prototype.slice.call(m,E):w.slice(E+C).concat(Array.prototype.slice.call(m)),y.slice(0,F).toString("ucs2")},p.prototype.end=function(){for(var m="";this.prevBytes.length>0;){m+=this.defaultCharUnicode;var y=this.prevBytes.slice(1);this.prevBytes=[],this.nodeIdx=0,y.length>0&&(m+=this.write(y))}return this.prevBytes=[],this.nodeIdx=0,m};function g(m,y){if(m[0]>y)return-1;for(var A=0,w=m.length;A<w-1;){var C=A+(w-A+1>>1);m[C]<=y?A=C:w=C}return A}return tc}const m5=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]],y5=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]],nc=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]],zd=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93],["8135f437",""]],v5=[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],b5=[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3],_5={uChars:v5,gbChars:b5},x5=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]],Ud=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]],w5=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]];var Gd,Vd;function S5(){return Vd||(Vd=1,Gd={shiftjis:{type:"_dbcs",table:function(){return m5},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return y5},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return nc}},gbk:{type:"_dbcs",table:function(){return nc.concat(zd)}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return nc.concat(zd)},gb18030:function(){return _5},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return x5}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return Ud}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return Ud.concat(w5)},encodeSkipVals:[36457,36463,36478,36523,36532,36557,36560,36695,36713,36718,36811,36862,36973,36986,37060,37084,37105,37311,37551,37552,37553,37554,37585,37959,38090,38361,38652,39285,39798,39800,39803,39878,39902,39916,39926,40002,40019,40034,40040,40043,40055,40124,40125,40144,40279,40282,40388,40431,40443,40617,40687,40701,40800,40907,41079,41180,41183,36812,37576,38468,38637,41636,41637,41639,41638,41676,41678]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"}),Gd}var jd;function A5(){return jd||(jd=1,function(s){for(var e=w0,t=[l5(),c5(),h5(),u5(),d5(),p5(),f5(),g5(),S5()],n=0;n<t.length;n++){var r=t[n];e(s,r)}}(Td)),Td}var sc,$d;function E5(){if($d)return sc;$d=1;var s=mr.Buffer;return sc=function(e){var t=e.Transform;function n(i,a){this.conv=i,a=a||{},a.decodeStrings=!1,t.call(this,a)}n.prototype=Object.create(t.prototype,{constructor:{value:n}}),n.prototype._transform=function(i,a,l){if(typeof i!="string")return l(new Error("Iconv encoding stream needs strings as its input."));try{var c=this.conv.write(i);c&&c.length&&this.push(c),l()}catch(u){l(u)}},n.prototype._flush=function(i){try{var a=this.conv.end();a&&a.length&&this.push(a),i()}catch(l){i(l)}},n.prototype.collect=function(i){var a=[];return this.on("error",i),this.on("data",function(l){a.push(l)}),this.on("end",function(){i(null,s.concat(a))}),this};function r(i,a){this.conv=i,a=a||{},a.encoding=this.encoding="utf8",t.call(this,a)}return r.prototype=Object.create(t.prototype,{constructor:{value:r}}),r.prototype._transform=function(i,a,l){if(!s.isBuffer(i)&&!(i instanceof Uint8Array))return l(new Error("Iconv decoding stream needs buffers as its input."));try{var c=this.conv.write(i);c&&c.length&&this.push(c,this.encoding),l()}catch(u){l(u)}},r.prototype._flush=function(i){try{var a=this.conv.end();a&&a.length&&this.push(a,this.encoding),i()}catch(l){i(l)}},r.prototype.collect=function(i){var a="";return this.on("error",i),this.on("data",function(l){a+=l}),this.on("end",function(){i(null,a)}),this},{IconvLiteEncoderStream:n,IconvLiteDecoderStream:r}},sc}const T5={},I5=Object.freeze(Object.defineProperty({__proto__:null,default:T5},Symbol.toStringTag,{value:"Module"})),C5=X4(I5);(function(s){var e=mr.Buffer,t=Lh,n=w0,r=s.exports;r.encodings=null,r.defaultCharUnicode="",r.defaultCharSingleByte="?",r.encode=function(a,l,c){a=""+(a||"");var u=r.getEncoder(l,c),p=u.write(a),g=u.end();return g&&g.length>0?e.concat([p,g]):p},r.decode=function(a,l,c){typeof a=="string"&&(r.skipDecodeWarning||(console.error("Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding"),r.skipDecodeWarning=!0),a=e.from(""+(a||""),"binary"));var u=r.getDecoder(l,c),p=u.write(a),g=u.end();return g?p+g:p},r.encodingExists=function(a){try{return r.getCodec(a),!0}catch{return!1}},r.toEncoding=r.encode,r.fromEncoding=r.decode,r._codecDataCache={__proto__:null},r.getCodec=function(a){if(!r.encodings){var l=A5();r.encodings={__proto__:null},n(r.encodings,l)}for(var c=r._canonicalizeEncoding(a),u={};;){var p=r._codecDataCache[c];if(p)return p;var g=r.encodings[c];switch(typeof g){case"string":c=g;break;case"object":for(var m in g)u[m]=g[m];u.encodingName||(u.encodingName=c),c=g.type;break;case"function":return u.encodingName||(u.encodingName=c),p=new g(u,r),r._codecDataCache[u.encodingName]=p,p;default:throw new Error("Encoding not recognized: '"+a+"' (searched as: '"+c+"')")}}},r._canonicalizeEncoding=function(a){return(""+a).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g,"")},r.getEncoder=function(a,l){var c=r.getCodec(a),u=new c.encoder(l,c);return c.bomAware&&l&&l.addBOM&&(u=new t.PrependBOM(u,l)),u},r.getDecoder=function(a,l){var c=r.getCodec(a),u=new c.decoder(l,c);return c.bomAware&&!(l&&l.stripBOM===!1)&&(u=new t.StripBOM(u,l)),u},r.enableStreamingAPI=function(a){if(!r.supportsStreams){var l=E5()(a);r.IconvLiteEncoderStream=l.IconvLiteEncoderStream,r.IconvLiteDecoderStream=l.IconvLiteDecoderStream,r.encodeStream=function(c,u){return new r.IconvLiteEncoderStream(r.getEncoder(c,u),u)},r.decodeStream=function(c,u){return new r.IconvLiteDecoderStream(r.getDecoder(c,u),u)},r.supportsStreams=!0}};var i;try{i=C5}catch{}i&&i.Transform?r.enableStreamingAPI(i):r.encodeStream=r.decodeStream=function(){throw new Error("iconv-lite Streaming API is not enabled. Use iconv.enableStreamingAPI(require('stream')); to enable it.")}})(b0);var k5=b0.exports;const M5=Y4(k5);class Bh extends xm{constructor(e,t,n,r){super(),this.fontSize=t,this.shape=n,this.font=r,this.code=e,this.width=this.calcWidth()}calcWidth(){const e=this.shape.bbox;return e.maxX-e.minX}offset(e){return new Bh(this.code,this.fontSize,this.shape.offset(e),this.font)}toGeometry(){let e=this.font.cache.getGeometry(this.code,this.fontSize);if(e==null){const t=this.shape.polylines,n=[],r=[];let i=0;e=new It;for(let a=0;a<t.length;a++){const l=t[a];for(let c=0;c<l.length;c++){const u=l[c];n.push(u.x,u.y,0),c===l.length-1||r.push(i,i+1),i++}}e.setAttribute("position",new _a(n,3)),e.setIndex(r)}return e}}class P5 extends _m{constructor(e){super(e),this.type="shx",this.font=new q4(e.data),this.data=this.font.fontData}hasChar(e){const t=this.getCode(e);return this.font.hasChar(t)}hasCode(e){return this.font.hasChar(e)}generateShapes(e,t){const n=[];let r=0;for(let i=0;i<e.length;i++){const a=e[i];if(a===" "){r+=t;continue}const l=this.getCharShape(a,t);if(!l){r+=t,this.addUnsupportedChar(a);continue}n.push(l.offset(new Dt(r,0))),r+=l.width}return n}getScaleFactor(){return 1}getCharShape(e,t){return this.getCodeShape(this.getCode(e),t)}getCodeShape(e,t){const n=this.font.getCharShape(e,t);return n?new Bh(e,t,n,this):void 0}getNotFoundTextShape(e){const t=this.font.fontData.header.fontType===hn.BIGFONT?"":"?";return this.getCharShape(t,e)}getCode(e){if(this.font.fontData.header.fontType===hn.BIGFONT&&this.encoding){const t=M5.encode(e[0],this.encoding);return t.length===1?t[0]:t[0]<<8|t[1]}else return e.charCodeAt(0)}}class ar{constructor(){}static get instance(){return ar._instance||(ar._instance=new ar),ar._instance}createFont(e){if(e.type==="shx")return new P5(e);if(e.type==="mesh")return new z4(e);throw new Error("Unsupported font data type")}}class un{constructor(){this.fontMapping={},this.loadedFontMap=new Map,this.unsupportedChars={},this.missedFonts={},this.enableFontCache=!0,this.defaultFont="simkai",this.events={fontNotFound:new Cu,fontLoaded:new Cu},this.loader=new J0,this.loader.setResponseType("arraybuffer"),this.fileNames=[],this.fontLoader=new S0}static get instance(){return un._instance||(un._instance=new un),un._instance}get baseUrl(){return this.fontLoader.baseUrl}set baseUrl(e){this.fontLoader.baseUrl=e}setFontMapping(e){this.fontMapping=e}setFontLoader(e){this.fontLoader=e}async getAvailableFonts(){return await this.fontLoader.getAvailableFonts()}isDefaultFontLoaded(){return this.loadedFontMap.get(this.defaultFont.toLowerCase())!=null}async loadDefaultFont(){return await this.loadFontsByNames(this.defaultFont)}async loadFontsByNames(e){return e=Array.isArray(e)?e:[e],await this.fontLoader.load(e)}async loadFonts(e){e=Array.isArray(e)?e:[e];const t=[];for(let r=0;r<e.length;r++)t.push(this.loadFont(e[r]));const n=[];return await Promise.allSettled(t).then(r=>{r.forEach((i,a)=>{const l=i.status==="fulfilled",c=e[a].url,u=Du(c.toLowerCase());n.push({fontName:u,url:c,status:l?"Success":"FailedToLoad"}),l&&this.fileNames.push(u)})}),n}findAndReplaceFont(e){let t=this.loadedFontMap.get(e.toLowerCase());if(t==null){const n=this.fontMapping[e];if(n)return t=this.loadedFontMap.get(n.toLowerCase()),n}return t?e:this.defaultFont}getFontByName(e,t=!0){if(this.loadedFontMap.size===0)return;e==null&&(e="");const n=e.lastIndexOf(".");(n>0&&n==e.length-4||n==e.length-5)&&(e=e.substring(0,n));const r=this.loadedFontMap.get(e.toLowerCase());if(!r){t&&this.recordMissedFonts(e);return}return r}getFontByChar(e){for(const[,t]of this.loadedFontMap)if(t.hasChar(e))return t}getCharShape(e,t,n){let r=this.getFontByName(t);return r||(r=this.getFontByChar(e)),r==null?void 0:r.getCharShape(e,n)}getFontScaleFactor(e){const t=this.loadedFontMap.get(e.toLowerCase());return t?t.getScaleFactor():1}getFontType(e){const t=this.loadedFontMap.get(e.toLowerCase());return t==null?void 0:t.type}getNotFoundTextShape(e){for(const[,t]of this.loadedFontMap){const n=t.getNotFoundTextShape(e);if(n)return n}}isFontLoaded(e){return this.loadedFontMap.has(e.toLowerCase())}recordMissedFonts(e){e&&(this.missedFonts[e]||(this.missedFonts[e]=0),this.missedFonts[e]++,this.events.fontNotFound.dispatch({fontName:e,count:this.missedFonts[e]}))}async loadFont(e){if(!Am(e.file))throw new Error(`Invalid font file name: ${e.file}`);const t=this.fontInfoToFontData(e),n=t.name;if(this.isFontLoaded(t.name))return;const r=await zl.instance.get(n);if(r){const i=ar.instance.createFont(r);this.loadedFontMap.set(n,i)}else{const i=await this.loader.loadAsync(e.url);t.data=i;const a=ar.instance.createFont(t);a&&(e.name.forEach(l=>a.names.add(l)),this.loadedFontMap.set(n,a),this.enableFontCache&&await zl.instance.set(n,t))}this.events.fontLoaded.dispatch({fontName:n})}fontInfoToFontData(e){const t=Du(e.file).toLowerCase(),n=["ttf","otf","woff"].includes(e.type)?"mesh":e.type;return{name:t,alias:e.name,type:n,encoding:e.encoding}}async getAllFontsFromCache(){if(this.loadedFontMap.size!==0)return;const e=await zl.instance.getAll();for(const t of e){const{name:n}=t;if(this.fileNames&&!this.fileNames.includes(n))continue;const r=ar.instance.createFont(t);this.loadedFontMap.set(n,r)}}getUnsupportedChar(){for(const[,e]of this.loadedFontMap)Object.assign(this.unsupportedChars,e.unsupportedChars);return this.unsupportedChars}release(e){return e==null?(this.loadedFontMap.clear(),!0):this.loadedFontMap.delete(e)}}class S0{constructor(){this._avaiableFonts=[],this._avaiableFontMap=new Map,this._baseUrl="https://mlightcad.gitlab.io/cad-data/fonts/"}get baseUrl(){return this._baseUrl}set baseUrl(e){this._baseUrl=e,this.onFontUrlChanged(e)}get avaiableFonts(){return this._avaiableFonts}onFontUrlChanged(e){}async getAvailableFonts(){if(this._avaiableFonts.length==0){const e=this._baseUrl+"fonts.json";try{const t=await fetch(e);this._avaiableFonts=await t.json()}catch(t){throw new Error(`Filed to get avaiable font from '${e}' due to ${t}!`)}this._avaiableFonts.forEach(t=>{t.url=this._baseUrl+t.file})}return this.buildFontMap(),this._avaiableFonts}async load(e){if(e==null||e.length===0)return[];await this.getAvailableFonts();const t=[],n=[];e.forEach(a=>{const l=a.toLowerCase(),c=this._avaiableFontMap.get(l);c&&(un.instance.isFontLoaded(l)&&t.push({fontName:l,url:c.url,status:"Success"}),n.push(c))});const r=await un.instance.loadFonts(n),i={};return[...t,...r].forEach(a=>{i[a.fontName]=a}),e.map(a=>{const l=a.toLowerCase();return i[l]||{fontName:l,url:"",status:"NotFound"}})}buildFontMap(){const e=this._avaiableFontMap;this._avaiableFonts.forEach(t=>{t.name.forEach(n=>{e.set(n.toLocaleLowerCase(),t)})})}}var wi=(s=>(s[s.NONE=0]="NONE",s[s.WORD=1]="WORD",s[s.STACK=2]="STACK",s[s.SPACE=3]="SPACE",s[s.NBSP=4]="NBSP",s[s.TABULATOR=5]="TABULATOR",s[s.NEW_PARAGRAPH=6]="NEW_PARAGRAPH",s[s.NEW_COLUMN=7]="NEW_COLUMN",s[s.WRAP_AT_DIMLINE=8]="WRAP_AT_DIMLINE",s[s.PROPERTIES_CHANGED=9]="PROPERTIES_CHANGED",s))(wi||{}),la=(s=>(s[s.BOTTOM=0]="BOTTOM",s[s.MIDDLE=1]="MIDDLE",s[s.TOP=2]="TOP",s))(la||{}),Xn=(s=>(s[s.DEFAULT=0]="DEFAULT",s[s.LEFT=1]="LEFT",s[s.RIGHT=2]="RIGHT",s[s.CENTER=3]="CENTER",s[s.JUSTIFIED=4]="JUSTIFIED",s[s.DISTRIBUTED=5]="DISTRIBUTED",s))(Xn||{});const L5={c:"",d:"",p:""},O5={l:1,r:2,c:3,j:4,d:5};function D5(s,e=!1){const t=new Set,n=/\\[fF](.*?)[;|]/g;return[...s.matchAll(n)].forEach(r=>{let i=r[1].toLowerCase();e&&(i=i.replace(/\.(ttf|otf|woff|shx)$/,"")),t.add(i)}),t}class B5{constructor(e){this.stack=[],this.stack.push(e)}push(e){this.stack.push(e)}pop(){if(this.stack.length<=1)return;const e=this.stack.pop(),t=this.stack[this.stack.length-1];return JSON.stringify(t.paragraph)!==JSON.stringify(e.paragraph)&&(t.paragraph={...e.paragraph}),e}get current(){return this.stack[this.stack.length-1]}get depth(){return this.stack.length-1}get root(){return this.stack[0]}setCurrent(e){this.stack[this.stack.length-1]=e}}class N5{constructor(e,t,n={}){this.continueStroke=!1,this.inStackContext=!1,this.scanner=new rc(e);const r=t??new ja;this.ctxStack=new B5(r),this.yieldPropertyCommands=n.yieldPropertyCommands??!1,this.resetParagraphParameters=n.resetParagraphParameters??!1,this.mifDecoder=n.mifDecoder??this.decodeMultiByteChar.bind(this),this.mifCodeLength=n.mifCodeLength??"auto"}decodeMultiByteChar(e){try{if(e.length===5){const t=e[0];let n="gbk";t==="1"?n="shift-jis":t==="2"&&(n="big5");const r=new Uint8Array([parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16)]);return new TextDecoder(n).decode(r)}else if(e.length===4){const t=new Uint8Array([parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16)]),n=new TextDecoder("gbk").decode(t);if(n!=="")return n;const r=new TextDecoder("big5").decode(t);if(r!=="")return r}return""}catch{return""}}extractMifCode(e){var t,n,r;return e==="auto"?((t=this.scanner.tail.match(/^[0-9A-Fa-f]{5}/))==null?void 0:t[0])||((n=this.scanner.tail.match(/^[0-9A-Fa-f]{4}/))==null?void 0:n[0])||null:((r=this.scanner.tail.match(new RegExp(`^[0-9A-Fa-f]{${e}}`)))==null?void 0:r[0])||null}pushCtx(){this.ctxStack.push(this.ctxStack.current)}popCtx(){this.ctxStack.pop()}parseStacking(){const e=new rc(this.extractExpression(!0));let t="",n="",r="";const i=()=>{let c=e.peek(),u=!1;return c.charCodeAt(0)<32&&(c=" "),c==="\\"&&(u=!0,e.consume(1),c=e.peek()),e.consume(1),[c,u]},a=()=>{let c="";for(;e.hasData;){const[u,p]=i();if(!p&&(u==="/"||u==="#"||u==="^"))return[c,u];c+=u}return[c,""]},l=c=>{let u="",p=c;for(;e.hasData;){const[g,m]=i();if(!(p&&g===" ")){if(p=!1,!m&&g===";")break;u+=g}}return u};return[t,r]=a(),r&&(n=l(r==="^")),t===""&&n.includes("I/")?[2,[" "," ","/"]]:r==="^"?[2,[t,n,"^"]]:[2,[t,n,r]]}parseProperties(e){const t=this.ctxStack.current.copy(),n=this.ctxStack.current.copy();switch(e){case"L":n.underline=!0,this.continueStroke=!0;break;case"l":n.underline=!1,n.hasAnyStroke||(this.continueStroke=!1);break;case"O":n.overline=!0,this.continueStroke=!0;break;case"o":n.overline=!1,n.hasAnyStroke||(this.continueStroke=!1);break;case"K":n.strikeThrough=!0,this.continueStroke=!0;break;case"k":n.strikeThrough=!1,n.hasAnyStroke||(this.continueStroke=!1);break;case"A":this.parseAlign(n);break;case"C":this.parseAciColor(n);break;case"c":this.parseRgbColor(n);break;case"H":this.parseHeight(n);break;case"W":this.parseWidth(n);break;case"Q":this.parseOblique(n);break;case"T":this.parseCharTracking(n);break;case"p":this.parseParagraphProperties(n);break;case"f":case"F":this.parseFontProperties(n);break;default:throw new Error(`Unknown command: ${e}`)}if(this.continueStroke=n.hasAnyStroke,n.continueStroke=this.continueStroke,this.ctxStack.setCurrent(n),this.yieldPropertyCommands){const r=this.getPropertyChanges(t,n);if(Object.keys(r).length>0)return{command:e,changes:r,depth:this.ctxStack.depth}}}getPropertyChanges(e,t){const n={};if(e.underline!==t.underline&&(n.underline=t.underline),e.overline!==t.overline&&(n.overline=t.overline),e.strikeThrough!==t.strikeThrough&&(n.strikeThrough=t.strikeThrough),e.color.aci!==t.color.aci&&(n.aci=t.color.aci),e.color.rgbValue!==t.color.rgbValue&&(n.rgb=t.color.rgb),e.align!==t.align&&(n.align=t.align),JSON.stringify(e.fontFace)!==JSON.stringify(t.fontFace)&&(n.fontFace=t.fontFace),(e.capHeight.value!==t.capHeight.value||e.capHeight.isRelative!==t.capHeight.isRelative)&&(n.capHeight=t.capHeight),(e.widthFactor.value!==t.widthFactor.value||e.widthFactor.isRelative!==t.widthFactor.isRelative)&&(n.widthFactor=t.widthFactor),(e.charTrackingFactor.value!==t.charTrackingFactor.value||e.charTrackingFactor.isRelative!==t.charTrackingFactor.isRelative)&&(n.charTrackingFactor=t.charTrackingFactor),e.oblique!==t.oblique&&(n.oblique=t.oblique),JSON.stringify(e.paragraph)!==JSON.stringify(t.paragraph)){const r={};e.paragraph.indent!==t.paragraph.indent&&(r.indent=t.paragraph.indent),e.paragraph.align!==t.paragraph.align&&(r.align=t.paragraph.align),e.paragraph.left!==t.paragraph.left&&(r.left=t.paragraph.left),e.paragraph.right!==t.paragraph.right&&(r.right=t.paragraph.right),JSON.stringify(e.paragraph.tabs)!==JSON.stringify(t.paragraph.tabs)&&(r.tabs=t.paragraph.tabs),Object.keys(r).length>0&&(n.paragraph=r)}return n}parseAlign(e){const t=this.scanner.get();"012".includes(t)?e.align=parseInt(t):e.align=0,this.consumeOptionalTerminator()}parseHeight(e){const t=this.extractFloatExpression(!0);if(t)try{t.endsWith("x")?e.capHeight={value:parseFloat(t.slice(0,-1)),isRelative:!0}:e.capHeight={value:parseFloat(t),isRelative:!1}}catch{this.scanner.consume(-t.length);return}this.consumeOptionalTerminator()}parseWidth(e){const t=this.extractFloatExpression(!0);if(t)try{t.endsWith("x")?e.widthFactor={value:parseFloat(t.slice(0,-1)),isRelative:!0}:e.widthFactor={value:parseFloat(t),isRelative:!1}}catch{this.scanner.consume(-t.length);return}this.consumeOptionalTerminator()}parseCharTracking(e){const t=this.extractFloatExpression(!0);if(t)try{t.endsWith("x")?e.charTrackingFactor={value:Math.abs(parseFloat(t.slice(0,-1))),isRelative:!0}:e.charTrackingFactor={value:Math.abs(parseFloat(t)),isRelative:!1}}catch{this.scanner.consume(-t.length);return}this.consumeOptionalTerminator()}parseFloatValueOrFactor(e){const t=this.extractFloatExpression(!0);if(t)if(t.endsWith("x")){const n=parseFloat(t.slice(0,-1));e*=n}else e=parseFloat(t);return e}parseOblique(e){const t=this.extractFloatExpression(!1);t&&(e.oblique=parseFloat(t)),this.consumeOptionalTerminator()}parseAciColor(e){const t=this.extractIntExpression();if(t){const n=parseInt(t);n<257&&(e.color.aci=n)}this.consumeOptionalTerminator()}parseRgbColor(e){const t=this.extractIntExpression();if(t){const n=parseInt(t)&16777215;e.color.rgbValue=n}this.consumeOptionalTerminator()}extractFloatExpression(e=!1){const t=e?/^[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?x?/:/^[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?/,n=this.scanner.tail.match(t);if(n){const r=n[0];return this.scanner.consume(r.length),r}return""}extractIntExpression(){const e=this.scanner.tail.match(/^\d+/);if(e){const t=e[0];return this.scanner.consume(t.length),t}return""}extractExpression(e=!1){const t=this.scanner.find(";",e);if(t<0){const i=this.scanner.tail;return this.scanner.consume(i.length),i}const n=this.scanner.peek(t-this.scanner.currentIndex-1)==="\\",r=this.scanner.tail.slice(0,t-this.scanner.currentIndex+(n?1:0));return this.scanner.consume(r.length+1),r}parseFontProperties(e){const t=this.extractExpression().split("|");if(t.length>0&&t[0]){const n=t[0];let r="Regular",i=400;for(const a of t.slice(1))a.startsWith("b1")?i=700:a==="i"||a.startsWith("i1")?r="Italic":(a==="i0"||a.startsWith("i0"))&&(r="Regular");e.fontFace={family:n,style:r,weight:i}}}parseParagraphProperties(e){const t=new rc(this.extractExpression());let n=e.paragraph.indent,r=e.paragraph.left,i=e.paragraph.right,a=e.paragraph.align,l=[];const c=()=>{const u=t.tail.match(/^[+-]?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/);if(u){const p=parseFloat(u[0]);for(t.consume(u[0].length);t.peek()===",";)t.consume(1);return p}return 0};for(;t.hasData;)switch(t.get()){case"i":n=c();break;case"l":r=c();break;case"r":i=c();break;case"x":break;case"q":{const u=t.get();for(a=O5[u]||0;t.peek()===",";)t.consume(1);break}case"t":for(l=[];t.hasData;){const u=t.peek();if(u==="r"||u==="c"){t.consume(1);const p=c();l.push(u+p.toString())}else{const p=c();isNaN(p)?t.consume(1):l.push(p)}}break}e.paragraph={indent:n,left:r,right:i,align:a,tabs:l}}consumeOptionalTerminator(){this.scanner.peek()===";"&&this.scanner.consume(1)}*parse(){let e=null;function t(r){const i={...r.paragraph};r.paragraph={indent:0,left:0,right:0,align:0,tabs:[]};const a={};return i.indent!==0&&(a.indent=0),i.left!==0&&(a.left=0),i.right!==0&&(a.right=0),i.align!==0&&(a.align=0),JSON.stringify(i.tabs)!==JSON.stringify([])&&(a.tabs=[]),a}const n=()=>{let r="";for(;this.scanner.hasData;){let i=!1,a=this.scanner.peek();const l=this.scanner.currentIndex;if(a.charCodeAt(0)<32){if(this.scanner.consume(1),a==="	")return[5,null];if(a===`
`)return[6,null];a=" "}if(a==="\\")if("\\{}".includes(this.scanner.peek(1)))i=!0,this.scanner.consume(1),a=this.scanner.peek();else{if(r)return[1,r];this.scanner.consume(1);const c=this.scanner.get();switch(c){case"~":return[4,null];case"P":return[6,null];case"N":return[7,null];case"X":return[8,null];case"S":{this.inStackContext=!0;const u=this.parseStacking();return this.inStackContext=!1,u}case"m":case"M":if(this.scanner.peek()==="+"){this.scanner.consume(1);const u=this.extractMifCode(this.mifCodeLength);if(u){this.scanner.consume(u.length);const p=this.mifDecoder(u);return r?[1,r]:[1,p]}this.scanner.consume(-1)}r+="\\M";continue;case"U":if(this.scanner.peek()==="+"){this.scanner.consume(1);const u=this.scanner.tail.match(/^[0-9A-Fa-f]{4,8}/);if(u){const p=u[0];this.scanner.consume(p.length);const g=parseInt(p,16);let m="";try{m=String.fromCodePoint(g)}catch{m=""}return r?[1,r]:[1,m]}this.scanner.consume(-1)}r+="\\U";continue;default:if(c)try{const u=this.parseProperties(c);if(this.yieldPropertyCommands&&u)return[9,u];continue}catch{const u=this.scanner.tail.slice(l,this.scanner.currentIndex);r+=u}}continue}if(a==="%"&&this.scanner.peek(1)==="%"){const c=this.scanner.peek(2).toLowerCase(),u=L5[c];if(u){this.scanner.consume(3),r+=u;continue}else{this.scanner.consume(3);continue}}if(a===" ")return r?(this.scanner.consume(1),e=3,[1,r]):(this.scanner.consume(1),[3,null]);if(!i){if(a==="{"){if(r)return[1,r];this.scanner.consume(1),this.pushCtx();continue}else if(a==="}"){if(r)return[1,r];if(this.scanner.consume(1),this.yieldPropertyCommands){const c=this.ctxStack.current;this.popCtx();const u=this.getPropertyChanges(c,this.ctxStack.current);if(Object.keys(u).length>0)return[9,{command:void 0,changes:u,depth:this.ctxStack.depth}]}else this.popCtx();continue}}if(!this.inStackContext&&a==="^"){const c=this.scanner.peek(1);if(c){const u=c.charCodeAt(0);if(this.scanner.consume(2),u===32)r+="^";else{if(u===73)return r?[1,r]:[5,null];if(u===74)return r?[1,r]:[6,null];if(u===77)continue;r+=""}continue}}this.scanner.consume(1),a.charCodeAt(0)>=32&&(r+=a)}return r?[1,r]:[0,null]};for(;;){const[r,i]=n.call(this);if(r){if(yield new ic(r,this.ctxStack.current.copy(),i),r===6&&this.resetParagraphParameters){const a=this.ctxStack.current,l=t(a);this.yieldPropertyCommands&&Object.keys(l).length>0&&(yield new ic(9,a.copy(),{command:void 0,changes:{paragraph:l},depth:this.ctxStack.depth}))}e&&(yield new ic(e,this.ctxStack.current.copy(),null),e=null)}else break}}}class rc{constructor(e){this.text=e,this.textLen=e.length,this._index=0}get currentIndex(){return this._index}get isEmpty(){return this._index>=this.textLen}get hasData(){return this._index<this.textLen}get(){if(this.isEmpty)return"";const e=this.text[this._index];return this._index++,e}consume(e=1){this._index=Math.max(0,Math.min(this._index+e,this.textLen))}peek(e=0){const t=this._index+e;return t>=this.textLen||t<0?"":this.text[t]}find(e,t=!1){let n=this._index;for(;n<this.textLen;){if(t&&this.text[n]==="\\"){if(n+1<this.textLen){if(this.text[n+1]===e)return n+1;n+=2;continue}n++;continue}if(this.text[n]===e)return n;n++}return-1}get tail(){return this.text.slice(this._index)}isNextSpace(){return this.peek()===" "}consumeSpaces(){let e=0;for(;this.isNextSpace();)this.consume(),e++;return e}}class Nh{constructor(e){this._aci=256,this._rgbValue=null,Array.isArray(e)?this.rgb=e:typeof e=="number"?this.aci=e:this.aci=256}get aci(){return this._aci}set aci(e){if(e===null)this._aci=null;else if(e>=0&&e<=256)this._aci=e,this._rgbValue=null;else throw new Error("ACI not in range [0, 256]")}get rgb(){if(this._rgbValue===null)return null;const e=this._rgbValue>>16&255,t=this._rgbValue>>8&255,n=this._rgbValue&255;return[e,t,n]}set rgb(e){if(e){const[t,n,r]=e;this._rgbValue=(t&255)<<16|(n&255)<<8|r&255,this._aci=null}else this._rgbValue=null}get isRgb(){return this._rgbValue!==null}get isAci(){return this._rgbValue===null&&this._aci!==null}get rgbValue(){return this._rgbValue}set rgbValue(e){e===null?this._rgbValue=null:(this._rgbValue=e&16777215,this._aci=null)}copy(){const e=new Nh;return e._aci=this._aci,e._rgbValue=this._rgbValue,e}toObject(){return{aci:this._aci,rgb:this.rgb,rgbValue:this._rgbValue}}equals(e){return this._aci===e._aci&&this._rgbValue===e._rgbValue}}class ja{constructor(){this._stroke=0,this.continueStroke=!1,this.color=new Nh,this.align=0,this.fontFace={family:"",style:"Regular",weight:400},this._capHeight={value:1,isRelative:!1},this._widthFactor={value:1,isRelative:!1},this._charTrackingFactor={value:1,isRelative:!1},this.oblique=0,this.paragraph={indent:0,left:0,right:0,align:0,tabs:[]}}get capHeight(){return this._capHeight}set capHeight(e){this._capHeight={value:Math.abs(e.value),isRelative:e.isRelative}}get widthFactor(){return this._widthFactor}set widthFactor(e){this._widthFactor={value:Math.abs(e.value),isRelative:e.isRelative}}get charTrackingFactor(){return this._charTrackingFactor}set charTrackingFactor(e){this._charTrackingFactor={value:Math.abs(e.value),isRelative:e.isRelative}}get aci(){return this.color.aci}set aci(e){this.color.aci=e}get rgb(){return this.color.rgb}set rgb(e){this.color.rgb=e}get italic(){return this.fontFace.style==="Italic"}set italic(e){this.fontFace.style=e?"Italic":"Regular"}get bold(){return(this.fontFace.weight||400)>=700}set bold(e){this.fontFace.weight=e?700:400}get underline(){return!!(this._stroke&1)}set underline(e){this._setStrokeState(1,e)}get strikeThrough(){return!!(this._stroke&4)}set strikeThrough(e){this._setStrokeState(4,e)}get overline(){return!!(this._stroke&2)}set overline(e){this._setStrokeState(2,e)}get hasAnyStroke(){return!!this._stroke}_setStrokeState(e,t=!0){t?this._stroke|=e:this._stroke&=~e}copy(){const e=new ja;return e._stroke=this._stroke,e.continueStroke=this.continueStroke,e.color=this.color.copy(),e.align=this.align,e.fontFace={...this.fontFace},e._capHeight={...this._capHeight},e._widthFactor={...this._widthFactor},e._charTrackingFactor={...this._charTrackingFactor},e.oblique=this.oblique,e.paragraph={...this.paragraph},e}}class ic{constructor(e,t,n){this.type=e,this.ctx=t,this.data=n}}var Ca=(s=>(s[s.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",s[s.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT",s[s.TOP_TO_BOTTOM=3]="TOP_TO_BOTTOM",s[s.BOTTOM_TO_TOP=4]="BOTTOM_TO_TOP",s[s.BY_STYLE=5]="BY_STYLE",s))(Ca||{});const R5=new jt,F5=1.666666;class Rh extends ja{constructor(e){super(),this.fontScaleFactor=1,this.fontSize=1,this.fontSizeScaleFactor=1,this.blankWidth=0,e&&Object.assign(this,e)}clone(){const e=new Rh;return e.continueStroke=this.continueStroke,e.color=this.color.copy(),e.align=this.align,e.fontFace={...this.fontFace},e.capHeight={...this.capHeight},e.widthFactor={...this.widthFactor},e.charTrackingFactor={...this.charTrackingFactor},e.oblique=this.oblique,e.paragraph={...this.paragraph},e.fontScaleFactor=this.fontScaleFactor,e.fontSize=this.fontSize,e.fontSizeScaleFactor=this.fontSizeScaleFactor,e.blankWidth=this.blankWidth,e}getColorAsHex(){return this.color.isRgb&&this.color.rgbValue!==null?this.color.rgbValue:this.color.isAci&&this.color.aci!==null?l_(this.color.aci):16777215}setColorFromHex(e){const t=e>>16&255,n=e>>8&255,r=e&255;this.color.rgb=[t,n,r]}}class z5{constructor(e,t,n,r){this._contextStack=[],this._maxFontSize=0,this._currentIndent=0,this._currentLeftMargin=0,this._currentRightMargin=0,this._style=e,this._styleManager=t,this._fontManager=n,this._options=r,this._totalHeight=0,this._hOffset=0,this._vOffset=0,this._lineCount=1,this._currentLineObjects=[],this._currentContext=new Rh({fontScaleFactor:this.fontManager.getFontScaleFactor(this.textStyle.font.toLowerCase()),fontSize:r.fontSize,fontSizeScaleFactor:1,italic:!1,bold:!1,blankWidth:this.calculateBlankWidthForFont(this.textStyle.font.toLowerCase(),r.fontSize)}),this._currentContext.setColorFromHex(e.color),this._currentContext.fontFace.family=this.textStyle.font.toLowerCase(),this._currentContext.widthFactor={value:r.widthFactor,isRelative:!0},this._currentContext.oblique=e.obliqueAngle||0,this._maxFontSize=0,this._currentHorizontalAlignment=r.horizontalAlignment,this._currentIndent=0,this._currentLeftMargin=0,this._currentRightMargin=0,this.initLineParams()}get fontManager(){return this._fontManager}get styleManager(){return this._styleManager}get textStyle(){return this._style}get totalHeight(){return this._lineCount==1?this.currentMaxFontSize:this._totalHeight+this.currentLineHeight}get maxWidth(){return this._options.maxWidth}get flowDirection(){return this._options.flowDirection}get defaultHorizontalAlignment(){return this._options.horizontalAlignment}get defaultWidthFactor(){return this._options.widthFactor}get defaultFontSize(){return this._options.fontSize}get defaultLineSpaceFactor(){return this._options.lineSpaceFactor}get currentFont(){return this._currentContext.fontFace.family}get currentHorizontalAlignment(){return this._currentHorizontalAlignment}get currentFontSize(){return this._currentContext.fontSize}get currentLineHeight(){return this.defaultLineSpaceFactor*this.currentFontSize*F5+this.currentMaxFontSize}get currentMaxFontSize(){return this._maxFontSize}get currentWordSpace(){return this._currentContext.charTrackingFactor.value}get currentWidthFactor(){return this._currentContext.widthFactor.value}get currentLineObjects(){return this._currentLineObjects}get hOffset(){return this._hOffset}set hOffset(e){this._hOffset=e}get vOffset(){return this._vOffset}set vOffset(e){this._vOffset=e}get currentIndent(){return this._currentIndent}get currentLeftMargin(){return this._currentLeftMargin}get currentRightMargin(){return this._currentRightMargin}get maxLineWidth(){return this.maxWidth-this._currentLeftMargin-this._currentRightMargin}processFormat(e){switch(e.command){case"f":case"F":e.changes.fontFace&&(this.changeFont(e.changes.fontFace.family),this.fontManager.getFontType(this._currentContext.fontFace.family)==="mesh"?(this._currentContext.italic=e.changes.fontFace.style==="Italic",this._currentContext.bold=(e.changes.fontFace.weight||400)>=700,this._currentContext.oblique=this.textStyle.obliqueAngle||0):(this._currentContext.italic=!1,this._currentContext.bold=!1,e.changes.fontFace.style==="Italic"?this._currentContext.oblique=15:this._currentContext.oblique=this.textStyle.obliqueAngle||0));break;case"c":case"C":e.changes.aci?e.changes.aci===0?this._currentContext.setColorFromHex(this._options.byBlockColor):e.changes.aci===256?this._currentContext.setColorFromHex(this._options.byLayerColor):this._currentContext.color.aci=e.changes.aci:e.changes.rgb&&(this._currentContext.color.rgb=e.changes.rgb);break;case"W":e.changes.widthFactor&&(e.changes.widthFactor.isRelative?this._currentContext.widthFactor={value:e.changes.widthFactor.value*this.maxWidth,isRelative:!1}:this._currentContext.widthFactor={value:e.changes.widthFactor.value*.93,isRelative:!1});break;case"H":e.changes.capHeight&&(e.changes.capHeight.isRelative?this.changeFontSizeScaleFactor(e.changes.capHeight.value):this.changeFontHeight(e.changes.capHeight.value));break;case"T":e.changes.charTrackingFactor&&(e.changes.charTrackingFactor.isRelative?this._currentContext.charTrackingFactor={value:e.changes.charTrackingFactor.value+1,isRelative:!1}:this._currentContext.charTrackingFactor={value:e.changes.charTrackingFactor.value,isRelative:!1});break;case"p":e.changes.paragraph&&(e.changes.paragraph.align&&(this._currentHorizontalAlignment=e.changes.paragraph.align),typeof e.changes.paragraph.indent=="number"&&(this._currentIndent=e.changes.paragraph.indent*this.defaultFontSize,this._hOffset+=this._currentIndent),typeof e.changes.paragraph.left=="number"&&(this._currentLeftMargin=e.changes.paragraph.left*this.defaultFontSize),typeof e.changes.paragraph.right=="number"&&(this._currentRightMargin=e.changes.paragraph.right*this.defaultFontSize));break;case"L":this._currentContext.underline=!0;break;case"l":this._currentContext.underline=!1;break;case"O":this._currentContext.overline=!0;break;case"o":this._currentContext.overline=!1;break;case"K":this._currentContext.strikeThrough=!0;break;case"k":this._currentContext.strikeThrough=!1;break;case"Q":e.changes.oblique!==void 0&&(this._currentContext.oblique=e.changes.oblique);break}}resetParagraphProperties(){this._currentIndent=0,this._currentLeftMargin=0,this._currentRightMargin=0,this._currentHorizontalAlignment=this._options.horizontalAlignment}startNewParagraph(e,t,n){this.processGeometries(e,t,n),this.startNewLine(),this.resetParagraphProperties()}processText(e){const t=[],n=[],r=new lr;for(const i of e)if(i.type===wi.NEW_PARAGRAPH)this.startNewParagraph(t,n,r);else if(i.type===wi.WORD){const a=i.data;Array.isArray(a)?a.forEach(l=>this.processWord(l,t,n)):typeof a=="string"&&a.length>0&&this.processWord(a,t,n)}else if(i.type===wi.SPACE)this.processBlank();else if(i.type===wi.PROPERTIES_CHANGED){this.processGeometries(t,n,r);const a=i.data;a.command===void 0?this._contextStack.length>0&&(this._currentContext=this._contextStack.pop()):(a.depth>0&&this._contextStack.push(this._currentContext.clone()),this.processFormat(a))}else i.type===wi.STACK&&(this.processStack(i.data,t,n),this.processGeometries(t,n,r));return(t.length>0||n.length>0)&&this.processGeometries(t,n,r),this.processLastLine(),r}processGeometries(e,t,n){if(e.length>0||t.length>0){const r=this.toThreeObject(e,t);n.add(r),this._currentLineObjects.push(r),e.length=0,t.length=0}}processWord(e,t,n){let r=0;for(let i=0;i<e.length;i++){const a=this.getCharShape(e[i]);a?this.currentHorizontalAlignment==Xn.DISTRIBUTED?r+=a.width*this.currentWidthFactor:r+=a.width*this.currentWordSpace*this.currentWidthFactor:r+=this._currentContext.blankWidth}this.hOffset+r>(this.maxLineWidth||1/0)&&this.startNewLine();for(let i=0;i<e.length;i++)this.processChar(e[i],t,n)}processStack(e,t,n){const[r,i,a]=e,l=this._hOffset,c=this._vOffset,u=this._currentContext.charTrackingFactor.value,p=this._currentContext.fontSize,g=this._currentContext.fontSizeScaleFactor;this._hOffset=l,this._currentContext.charTrackingFactor={value:1,isRelative:!1};let m=0;for(let E=0;E<r.length;E++){const L=this.getCharShape(r[E]);L&&(m+=L.width*this.currentWidthFactor)}this._hOffset=l;let y=0;for(let E=0;E<i.length;E++){const L=this.getCharShape(i[E]);L&&(y+=L.width*this.currentWidthFactor)}const A=Math.max(m,y),w=(A-m)/2,C=(A-y)/2;if(a==="^"){if(this._currentContext.fontSizeScaleFactor=g*.7,this.calcuateLineParams(),r&&!i){const E=[],L=[];this._hOffset=l,this._vOffset=c+p*.1;for(let O=0;O<r.length;O++)this.processChar(r[O],E,L);t.push(...E),n.push(...L),this._hOffset=l+m}else if(!r&&i){const E=[],L=[];this._hOffset=l,this._vOffset=c-p*.6;for(let O=0;O<i.length;O++)this.processChar(i[O],E,L);t.push(...E),n.push(...L),this._hOffset=l+y}this._currentContext.fontSizeScaleFactor=g,this.calcuateLineParams()}else{const E=[],L=[];this._hOffset=l+w,this._vOffset=c+this.currentFontSize*.3;for(let B=0;B<r.length;B++)this.processChar(r[B],E,L);t.push(...E),n.push(...L);const O=[],F=[];this._hOffset=l+C,this._vOffset=c-this.currentFontSize*.6;for(let B=0;B<i.length;B++)this.processChar(i[B],O,F);if(t.push(...O),n.push(...F),a==="/"||a==="#"){const B=new It,Z=new Float32Array([l,c-this.currentFontSize*.8,0,l+A,c-this.currentFontSize*.8,0]);B.setAttribute("position",new Rt(Z,3)),B.setIndex(null),n.push(B)}this._hOffset=l+A}this._vOffset=c,this._currentContext.charTrackingFactor={value:u,isRelative:!1}}processBlank(){this._hOffset+=this._currentContext.blankWidth}processChar(e,t,n){const r=this.getCharShape(e);if(!r){this.processBlank();return}const i=r.toGeometry();i.scale(this.currentWidthFactor,1,1);let a=this._currentContext.oblique;if(this._currentContext.italic&&(a+=15),a){const A=a*Math.PI/180,w=new Ma;w.set(1,Math.tan(A),0,0,0,1,0,0,0,0,1,0,0,0,0,1),i.applyMatrix4(w)}const l=this.fontManager.getFontType(this.currentFont);this._currentContext.bold&&l==="mesh"&&i.scale(1.06,1.06,1),this.hOffset>(this.maxLineWidth||1/0)&&this.startNewLine();const c=this.hOffset,u=this.flowDirection==Ca.BOTTOM_TO_TOP?this.vOffset:this.vOffset-this.currentFontSize,p=r.width*this.currentWidthFactor,g=this.currentFontSize;i.translate(c,u,0),this.currentHorizontalAlignment==Xn.DISTRIBUTED?this._hOffset+=r.width*this.currentWidthFactor:this._hOffset+=r.width*this.currentWordSpace*this.currentWidthFactor,t.push(i);const m=g*.05,y=.001;if(this._currentContext.underline){const A=new It,w=u-m;A.setAttribute("position",new Rt(new Float32Array([c,w,y,c+p,w,y]),3)),A.setIndex(null),n.push(A)}if(this._currentContext.overline){const A=new It,w=u+g+m;A.setAttribute("position",new Rt(new Float32Array([c,w,y,c+p,w,y]),3)),A.setIndex(null),n.push(A)}if(this._currentContext.strikeThrough){const A=new It,w=u+g/2-g*.2;A.setAttribute("position",new Rt(new Float32Array([c,w,y,c+p,w,y]),3)),A.setIndex(null),n.push(A)}}processLastLine(){this.processAlignment()}initLineParams(){this.calcuateLineParams()}changeFont(e){let t=e;this._options.removeFontExtension&&(t=e.replace(/\.(ttf|otf|woff|shx)$/,"")),this._currentContext.fontFace.family=this.fontManager.findAndReplaceFont(t),this._currentContext.blankWidth=this.calculateBlankWidthForFont(this._currentContext.fontFace.family,this._currentContext.fontSize),this.calcuateLineParams()}calcuateLineParams(e){this._currentContext.fontScaleFactor=this.fontManager.getFontScaleFactor(this.currentFont);const t=e||this.defaultFontSize||this.textStyle.fixedTextHeight;this._currentContext.fontSize=t*this._currentContext.fontScaleFactor*this._currentContext.fontSizeScaleFactor}getCharShape(e){let t=this.fontManager.getCharShape(e,this.currentFont,this.currentFontSize);return this.textStyle.bigFont&&!t&&(t=this.fontManager.getCharShape(e,this.textStyle.bigFont,this.currentFontSize)),t||(t=this.fontManager.getCharShape(e,"",this.currentFontSize)),t||(t=this.fontManager.getNotFoundTextShape(this.currentFontSize)),this.currentFontSize>this._maxFontSize&&(this._maxFontSize=this.currentFontSize),t}startNewLine(){this._hOffset=0,this.flowDirection==Ca.BOTTOM_TO_TOP?this._vOffset+=this.currentLineHeight:this._vOffset-=this.currentLineHeight,this._lineCount++,this.processAlignment(),this._currentLineObjects=[],this._lineCount==2?this._totalHeight=this.currentMaxFontSize:this._totalHeight=this._totalHeight+this.currentLineHeight,this._maxFontSize=0}processAlignment(){const e=[];if(this.currentLineObjects.forEach(n=>n.traverse(r=>{"geometry"in r&&e.push(r.geometry)})),e.length==0)return;let t;if(e.forEach((n,r)=>{n.boundingBox||n.computeBoundingBox(),r===0?t=n.boundingBox:t.union(n.boundingBox)}),t){const n=t.getSize(R5);switch(this.currentHorizontalAlignment){case Xn.LEFT:e.forEach(r=>r.translate(this._currentLeftMargin-t.min.x,0,0));break;case Xn.CENTER:e.forEach(r=>r.translate(this._currentLeftMargin+(this.maxLineWidth-n.x)/2-t.min.x,0,0));break;case Xn.RIGHT:e.forEach(r=>r.translate(this._currentLeftMargin+this.maxLineWidth-n.x-t.min.x,0,0));break;case Xn.DISTRIBUTED:if(e.length>1){const r=(this.maxLineWidth-n.x)/(e.length-1);for(let i=1;i<e.length;i++)e[i].translate(r*i,0,0)}e.forEach(r=>r.translate(this._currentLeftMargin-t.min.x,0,0));break}}}calculateBlankWidthForFont(e,t){return this.fontManager.getFontType(e)==="shx"?t*.5:t*.3}toThreeObject(e,t){const n=new lr,r=this._currentContext.getColorAsHex(),i=e.filter(l=>l instanceof ba);if(i.length>0){const l=new Zn;l.geometry=_d(i),l.material=this.styleManager.getMeshBasicMaterial(r),l.userData.bboxIntersectionCheck=!0,n.add(l)}const a=[...t,...e.filter(l=>!(l instanceof ba))];if(a.length>0){const l=new ms;l.geometry=_d(a),l.material=this.styleManager.getLineBasicMaterial(r),l.userData.bboxIntersectionCheck=!0,n.add(l)}return n.children.length===1?n.children[0]:n}changeFontSizeScaleFactor(e){this._currentContext.fontSizeScaleFactor*=e,this.calcuateLineParams()}changeFontHeight(e){this._currentContext.fontSize=e*this._currentContext.fontScaleFactor*this._currentContext.fontSizeScaleFactor,this.calcuateLineParams()}}const ac=new jt,Ar=new jt,oc=new jt,lc=new o1,cc=new Ma,Wd=new Ma,Hd=new jt(1,0,0);class Ko extends Yc{static getFonts(e,t=!1){return D5(e,t)}constructor(e,t,n,r,i={byLayerColor:16777215,byBlockColor:16777215}){super(),this._style=t,this._styleManager=n,this._fontManager=r,this._colorSettings={byLayerColor:i.byLayerColor,byBlockColor:i.byBlockColor},this._box=new Ft,this._boxes=[],this._mtextData=e,this._fontsInStyleLoaded=!1}get fontManager(){return this._fontManager}dispose(){this.disposeThreeObject(this)}async asyncDraw(){const e=Array.from(Ko.getFonts(this._mtextData.text||"",!0));if(!this._fontsInStyleLoaded){if(this._style.font){const t=this.getFontName(this._style.font);t&&e.push(t)}if(this._style.bigFont){const t=this.getFontName(this._style.bigFont);t&&e.push(t)}if(this._style.extendedFont){const t=this.getFontName(this._style.extendedFont);t&&e.push(t)}}e.length>0&&(await this._fontManager.loadFontsByNames(e),this._fontsInStyleLoaded=!0),this.syncDraw()}syncDraw(){const e=this.loadMText(this._mtextData,this._style);e&&(this.getBoxes(e,this._boxes),this._boxes.forEach(t=>this.box.union(t)),this.add(e))}get styleManager(){return this._styleManager}get textStyle(){return this._style}get box(){return this._box}set box(e){this._box.copy(e)}raycast(e,t){this._boxes.forEach(n=>{if(e.ray.intersectBox(n,ac)){const r=e.ray.origin.distanceTo(ac);t.push({distance:r,point:ac.clone(),object:this,face:null,faceIndex:void 0,uv:void 0})}})}loadMText(e,t){const{object:n,height:r}=this.createMTextGroup(e,t);if(!n)return;n.matrix.decompose(Ar,lc,oc),e.position&&(Ar.x+=e.position.x,Ar.y+=e.position.y,n.matrix.compose(Ar,lc,oc));const i=e.width,a=this.calculateAnchorPoint(i,r,e.attachmentPoint,e.drawingDirection);n.traverse(u=>{"geometry"in u&&u.geometry.translate(a.x,a.y,0),u.layers.enableAll()});let l=e.rotation||0;if(e.directionVector){const u=e.directionVector,p=new jt(u.x,u.y,u.z),g=p.clone().cross(Hd),m=Hd.angleTo(p);l=g.z>0?-m:m}n.matrix.compose(Ar,lc,oc);const c=e.position?Ar.clone().sub(e.position):Ar;return cc.makeTranslation(-c.x,-c.y,0),Wd.makeRotationZ(l),n.matrix.multiply(cc),n.matrix.multiply(Wd),n.matrix.multiply(cc.invert()),n.matrix.decompose(n.position,n.quaternion,n.scale),n}createMTextGroup(e,t){if(t&&t.font&&t.font.endsWith(".shx")){const y=`${t.font}_${t.name}`;this.styleManager.unsupportedTextStyles[y]||(this.styleManager.unsupportedTextStyles[y]=0),this.styleManager.unsupportedTextStyles[y]++}const n=e.width||0;let r=Xn.LEFT;e.width&&e.attachmentPoint&&([1,4,7].includes(e.attachmentPoint)?r=Xn.LEFT:[2,5,8].includes(e.attachmentPoint)?r=Xn.CENTER:[3,6,9].includes(e.attachmentPoint)&&(r=Xn.RIGHT));let i=la.BOTTOM;e.attachmentPoint&&([1,2,3].includes(e.attachmentPoint)?i=la.TOP:[4,5,6].includes(e.attachmentPoint)?i=la.MIDDLE:[7,8,9].includes(e.attachmentPoint)&&(i=la.BOTTOM));const a=e.height||0,l=e.lineSpaceFactor||.3,c=e.drawingDirection??Ca.LEFT_TO_RIGHT,u={fontSize:a,widthFactor:e.widthFactor??1,lineSpaceFactor:l,horizontalAlignment:r,maxWidth:n,flowDirection:c,byBlockColor:this._colorSettings.byBlockColor,byLayerColor:this._colorSettings.byLayerColor,removeFontExtension:!0},p=new ja;p.fontFace.family=t.font,p.capHeight={value:e.height||1,isRelative:!0},p.widthFactor={value:e.widthFactor??1,isRelative:!0},p.align=i,p.paragraph.align=r;const g=new z5(t,this.styleManager,this.fontManager,u),m=new N5(e.text,p,{resetParagraphParameters:!0,yieldPropertyCommands:!0}).parse();return{object:g.processText(m),height:g.totalHeight}}calculateAnchorPoint(e,t,n,r){let i=0,a=0;switch(n){case void 0:case 1:i=0,a=0;break;case 2:i-=e/2,a=0;break;case 3:i-=e,a=0;break;case 4:i=0,a+=t/2;break;case 5:i-=e/2,a+=t/2;break;case 6:i-=e,a+=t/2;break;case 7:i=0,a+=t;break;case 8:i-=e/2,a+=t;break;case 9:i-=e,a+=t;break}return r==Ca.BOTTOM_TO_TOP&&(a-=t),{x:i,y:a}}getBoxes(e,t){if(e.updateWorldMatrix(!1,!1),e instanceof fc||e instanceof Zn){const r=e.geometry;r.boundingBox===null&&r.computeBoundingBox();const i=new Ft().copy(r.boundingBox);i.applyMatrix4(e.matrixWorld),t.push(i)}const n=e.children;for(let r=0,i=n.length;r<i;r++)this.getBoxes(n[r],t)}disposeThreeObject(e){e.traverse(t=>{if(t.geometry&&typeof t.geometry.dispose=="function")try{t.geometry.dispose()}catch{}if(t.material){const n=r=>{if(r&&typeof r.dispose=="function")try{r.dispose()}catch{}};Array.isArray(t.material)?t.material.forEach(n):n(t.material)}})}getFontName(e){if(e){const t=e.lastIndexOf(".");return t>=0?e.substring(0,t).toLowerCase():e.toLowerCase()}}}class A0{constructor(){this.lineBasicMaterials={},this.meshBasicMaterials={},this.unsupportedTextStyles={}}getMeshBasicMaterial(e){return this.meshBasicMaterials[e]||(this.meshBasicMaterials[e]=new qc({color:e})),this.meshBasicMaterials[e]}getLineBasicMaterial(e){return this.lineBasicMaterials[e]||(this.lineBasicMaterials[e]=new Pa({color:e})),this.lineBasicMaterials[e]}}class U5{constructor(e={}){this.workers=[],this.inFlightPerWorker=[],this.pendingRequests=new Map,this.requestId=0,this.readyPromise=null,this.poolSize=e.poolSize??Math.max(1,navigator.hardwareConcurrency?Math.min(4,navigator.hardwareConcurrency):2),this.styleManager=new A0;const t=e.workerUrl??"./mtext-renderer-worker.js";this.timeOut=e.timeOut??12e4;for(let n=0;n<this.poolSize;n++){const r=new Worker(new URL(t,import.meta.url),{type:"module"});this.attachWorkerHandlers(r,n),this.workers.push(r),this.inFlightPerWorker.push(0)}this.isInitialized=!1}async ensureInitialized(){this.isInitialized||(await this.loadFonts([un.instance.defaultFont]),this.isInitialized=!0)}handleWorkerMessage(e,t){const{id:n,success:r,data:i,error:a}=e,l=this.pendingRequests.get(n);l?(this.pendingRequests.delete(n),this.inFlightPerWorker[t]=Math.max(0,this.inFlightPerWorker[t]-1),r?l.resolve(i):l.reject(new Error(a||"Unknown worker error"))):console.warn(`No pending request found for worker response id=${n}`)}attachWorkerHandlers(e,t){e.onmessage=n=>{this.handleWorkerMessage(n.data,t)},e.onerror=n=>{console.error(`Worker ${t} error:`,n);const r=[];this.pendingRequests.forEach((i,a)=>{i.workerIndex===t&&r.push(a)}),r.forEach(i=>{const a=this.pendingRequests.get(i);a&&(a.reject(new Error("Worker error occurred")),this.pendingRequests.delete(i))}),this.inFlightPerWorker[t]=0}}pickLeastLoadedWorker(){let e=0,t=this.inFlightPerWorker[0]??0;for(let n=1;n<this.inFlightPerWorker.length;n++){const r=this.inFlightPerWorker[n]??0;r<t&&(t=r,e=n)}return e}sendMessageToAllWorkers(e){return Promise.all(this.workers.map((t,n)=>this.sendMessageToOneWorker(e,n)))}sendMessageToOneWorker(e,t){const n=t??this.pickLeastLoadedWorker(),r=this.workers[n];return new Promise((i,a)=>{const l=`req_${++this.requestId}`,c={...e,id:l};this.pendingRequests.set(l,{resolve:u=>i(u),reject:a,workerIndex:n}),this.inFlightPerWorker[n]=(this.inFlightPerWorker[n]??0)+1,r.postMessage(c),setTimeout(()=>{this.pendingRequests.get(l)&&(this.pendingRequests.delete(l),this.inFlightPerWorker[n]=Math.max(0,this.inFlightPerWorker[n]-1),a(new Error("Worker request timeout")))},this.timeOut)})}ensureTasksFinished(){return this.readyPromise?this.readyPromise:this.workers.length===0?Promise.resolve():(this.readyPromise=Promise.all(this.workers.map((e,t)=>new Promise((n,r)=>{const i=`req_${++this.requestId}`;this.pendingRequests.set(i,{resolve:()=>n(),reject:r,workerIndex:t}),this.inFlightPerWorker[t]=(this.inFlightPerWorker[t]??0)+1,e.postMessage({type:"getAvailableFonts",id:i}),setTimeout(()=>{this.pendingRequests.get(i)&&(this.pendingRequests.delete(i),this.inFlightPerWorker[t]=Math.max(0,this.inFlightPerWorker[t]-1),r(new Error("Worker init timeout")))},this.timeOut)}))).then(()=>{}),this.readyPromise)}async setFontUrl(e){await this.sendMessageToAllWorkers({type:"setFontUrl",data:{url:e}})}async asyncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){await this.ensureInitialized();const r=await this.sendMessageToOneWorker({type:"render",data:{mtextContent:e,textStyle:t,colorSettings:n}});return this.reconstructMText(r)}syncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){throw new Error("Fuction 'syncRenderMText' isn't supported in 'WebWorkerRenderer'!")}async loadFonts(e){await this.ensureTasksFinished();const t=await this.sendMessageToAllWorkers({type:"loadFonts",data:{fonts:e}}),n=new Set;return t.forEach(r=>{var i;return(i=r==null?void 0:r.loaded)==null?void 0:i.forEach(a=>n.add(a))}),{loaded:Array.from(n)}}async getAvailableFonts(){return(await this.sendMessageToAllWorkers({type:"getAvailableFonts"}))[0]??{fonts:[]}}reconstructMText(e){const t=new lr;return e.children.forEach(n=>{const r=new It;if(Object.keys(n.geometry.attributes).forEach(l=>{const c=n.geometry.attributes[l],u=new Float32Array(c.arrayBuffer,c.byteOffset,c.length),p=new Rt(u,c.itemSize,c.normalized);r.setAttribute(l,p)}),n.geometry.index)if(n.geometry.index.componentType==="uint32"){const l=new Uint32Array(n.geometry.index.arrayBuffer,n.geometry.index.byteOffset,n.geometry.index.length);r.setIndex(new K0(l,1))}else{const l=new Uint16Array(n.geometry.index.arrayBuffer,n.geometry.index.byteOffset,n.geometry.index.length);r.setIndex(new op(l,1))}let i;n.type==="mesh"?(i=this.styleManager.getMeshBasicMaterial(n.material.color),n.material.transparent!==void 0&&(i.transparent=n.material.transparent),n.material.opacity!==void 0&&(i.opacity=n.material.opacity),n.material.side!==void 0&&(i.side=n.material.side)):(i=this.styleManager.getLineBasicMaterial(n.material.color),n.material.transparent!==void 0&&(i.transparent=n.material.transparent),n.material.opacity!==void 0&&(i.opacity=n.material.opacity),n.material.linewidth!==void 0&&(i.linewidth=n.material.linewidth));let a;n.type==="mesh"?a=new Zn(r,i):a=new ms(r,i),r.boundingBox||r.computeBoundingBox(),r.boundingSphere||r.computeBoundingSphere(),a.position.set(n.position.x,n.position.y,n.position.z),a.quaternion.set(n.rotation.x,n.rotation.y,n.rotation.z,n.rotation.w),a.scale.set(n.scale.x,n.scale.y,n.scale.z),t.add(a)}),t.box=new Ft(new jt(e.box.min.x,e.box.min.y,e.box.min.z),new jt(e.box.max.x,e.box.max.y,e.box.max.z)),t}terminate(){this.workers.forEach(e=>e.terminate()),this.workers=[],this.inFlightPerWorker=[],this.readyPromise=null,this.pendingRequests.forEach(({reject:e})=>{e(new Error("Renderer terminated"))}),this.pendingRequests.clear()}destroy(){this.terminate()}}class G5{constructor(){this.fontManager=un.instance,this.styleManager=new A0,this.isInitialized=!1}async setFontUrl(e){this.fontManager.baseUrl=e}async asyncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){await this.ensureInitialized();const r=new Ko(e,t,this.styleManager,this.fontManager,n);return await r.asyncDraw(),r.updateMatrixWorld(!0),r}syncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){const r=new Ko(e,t,this.styleManager,this.fontManager,n);return r.syncDraw(),r.updateMatrixWorld(!0),r}async loadFonts(e){return await this.fontManager.loadFontsByNames(e),{loaded:e}}async getAvailableFonts(){return{fonts:await this.fontManager.getAvailableFonts()}}destroy(){}async ensureInitialized(){this.isInitialized||(await this.loadFonts([un.instance.defaultFont]),this.isInitialized=!0)}}class V5{constructor(e="main",t={}){this.defaultMode=e,this.mainThreadRenderer=new G5,this.webWorkerRenderer=new U5(t),this.renderer=this.mainThreadRenderer,e==="worker"&&(this.renderer=this.webWorkerRenderer)}setDefaultMode(e){this.defaultMode!==e&&(this.defaultMode=e,e==="worker"?this.renderer=this.webWorkerRenderer:this.renderer=this.mainThreadRenderer)}setFontUrl(e){return this.renderer.setFontUrl(e)}getDefaultMode(){return this.defaultMode}async asyncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215},r){return r?(r==="worker"?this.webWorkerRenderer:this.mainThreadRenderer).asyncRenderMText(e,t,n):this.renderer.asyncRenderMText(e,t,n)}syncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){return this.mainThreadRenderer.syncRenderMText(e,t,n)}async loadFonts(e){return this.renderer.loadFonts(e)}async getAvailableFonts(){return this.renderer.getAvailableFonts()}destroy(){this.webWorkerRenderer&&this.webWorkerRenderer.terminate(),this.mainThreadRenderer.destroy()}}var tn;(function(s){s[s.BeforeStart=0]="BeforeStart",s[s.EqualStart=1]="EqualStart",s[s.BetweenStartAndEnd=2]="BetweenStartAndEnd",s[s.EqualEnd=3]="EqualEnd",s[s.AfterEnd=4]="AfterEnd"})(tn||(tn={}));class j5{pointsSame(e,t){return this.pointsSameX(e,t)&&this.pointsSameY(e,t)}pointsCompare(e,t){return this.pointsSameX(e,t)?this.pointsSameY(e,t)?0:e[1]<t[1]?-1:1:e[0]<t[0]?-1:1}}class E0 extends j5{constructor(e=1e-10){super(),this.epsilon=e}pointAboveOrOnLine(e,t,n){const r=t[0],i=t[1],a=n[0],l=n[1],c=e[0],u=e[1];return(a-r)*(u-i)-(l-i)*(c-r)>=-this.epsilon}pointBetween(e,t,n){const r=e[1]-t[1],i=n[0]-t[0],a=e[0]-t[0],l=n[1]-t[1],c=a*i+r*l;if(c<this.epsilon)return!1;const u=i*i+l*l;return!(c-u>-this.epsilon)}pointsSameX(e,t){return Math.abs(e[0]-t[0])<this.epsilon}pointsSameY(e,t){return Math.abs(e[1]-t[1])<this.epsilon}pointsCollinear(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],a=t[0]-n[0],l=t[1]-n[1];return Math.abs(r*l-a*i)<this.epsilon}linesIntersect(e,t,n,r){const i=t[0]-e[0],a=t[1]-e[1],l=r[0]-n[0],c=r[1]-n[1],u=i*c-a*l;if(Math.abs(u)<this.epsilon)return null;const p=e[0]-n[0],g=e[1]-n[1],m=(l*g-c*p)/u,y=(i*g-a*p)/u,A=C=>C<=-this.epsilon?tn.BeforeStart:C<this.epsilon?tn.EqualStart:C-1<=-this.epsilon?tn.BetweenStartAndEnd:C-1<this.epsilon?tn.EqualEnd:tn.AfterEnd,w=[e[0]+m*i,e[1]+m*a];return{alongA:A(m),alongB:A(y),p:w}}}class qd{constructor(){this.nodes=[]}remove(e){const t=this.nodes.indexOf(e);t>=0&&this.nodes.splice(t,1)}getIndex(e){return this.nodes.indexOf(e)}isEmpty(){return this.nodes.length<=0}getHead(){return this.nodes[0]}removeHead(){this.nodes.shift()}insertBefore(e,t){this.findTransition(e,t).insert(e)}findTransition(e,t){var n,r;const i=(c,u)=>t(u)-t(c);let a=0,l=this.nodes.length;for(;a<l;){const c=a+l>>1;i(this.nodes[c],e)>0?l=c:a=c+1}return{before:a<=0?null:(n=this.nodes[a-1])!==null&&n!==void 0?n:null,after:(r=this.nodes[a])!==null&&r!==void 0?r:null,insert:c=>(this.nodes.splice(a,0,c),c)}}}class ki{constructor(e,t,n,r){var i;this.otherFill=null,this.id=(i=r==null?void 0:r.segmentId())!==null&&i!==void 0?i:-1,this.start=e,this.end=t,this.myFill={above:n?n.myFill.above:null,below:n?n.myFill.below:null}}}class Yd{constructor(e,t,n,r){this.status=null,this.isStart=e,this.p=t,this.seg=n,this.primary=r}}class Xd{constructor(e,t,n=null){this.events=new qd,this.status=new qd,this.selfIntersection=e,this.geo=t,this.log=n}compareEvents(e,t,n,r,i,a){const l=this.geo.pointsCompare(t,i);return l!==0?l:this.geo.pointsSame(n,a)?0:e!==r?e?1:-1:this.geo.pointAboveOrOnLine(n,r?i:a,r?a:i)?1:-1}addEvent(e){this.events.insertBefore(e,t=>t===e?0:this.compareEvents(e.isStart,e.p,e.other.p,t.isStart,t.p,t.other.p))}divideEvent(e,t){var n;const r=new ki(t,e.seg.end,e.seg,this.log);return(n=this.log)===null||n===void 0||n.segmentChop(e.seg,t),this.events.remove(e.other),e.seg.end=t,e.other.p=t,this.addEvent(e.other),this.addSegment(r,e.primary)}newSegment(e,t){const n=this.geo.pointsCompare(e,t);return n===0?null:n<0?new ki(e,t,null,this.log):new ki(t,e,null,this.log)}addSegment(e,t){const n=new Yd(!0,e.start,e,t),r=new Yd(!1,e.end,e,t);return n.other=r,r.other=n,this.addEvent(n),this.addEvent(r),n}addRegion(e){let t,n=e[e.length-1];for(let r=0;r<e.length;r++){t=n,n=e[r];const i=this.newSegment(t,n);i&&this.addSegment(i,!0)}}compareStatus(e,t){const n=e.seg.start,r=e.seg.end,i=t.seg.start,a=t.seg.end;return this.geo.pointsCollinear(n,i,a)?this.geo.pointsCollinear(r,i,a)||this.geo.pointAboveOrOnLine(r,i,a)?1:-1:this.geo.pointAboveOrOnLine(n,i,a)?1:-1}statusFindSurrounding(e){return this.status.findTransition(e,t=>t===e?0:-this.compareStatus(e,t))}checkIntersection(e,t){var n;const r=e.seg,i=t.seg,a=r.start,l=r.end,c=i.start,u=i.end;(n=this.log)===null||n===void 0||n.checkIntersection(r,i);const p=this.geo.linesIntersect(a,l,c,u);if(p===null){if(!this.geo.pointsCollinear(a,l,c)||this.geo.pointsSame(a,u)||this.geo.pointsSame(l,c))return null;const g=this.geo.pointsSame(a,c),m=this.geo.pointsSame(l,u);if(g&&m)return t;const y=!g&&this.geo.pointBetween(a,c,u),A=!m&&this.geo.pointBetween(l,c,u);if(g)return A?this.divideEvent(t,l):this.divideEvent(e,u),t;y&&(m||(A?this.divideEvent(t,l):this.divideEvent(e,u)),this.divideEvent(t,a))}else p.alongA===tn.BetweenStartAndEnd&&(p.alongB===tn.EqualStart?this.divideEvent(e,c):p.alongB===tn.BetweenStartAndEnd?this.divideEvent(e,p.p):p.alongB===tn.EqualEnd&&this.divideEvent(e,u)),p.alongB===tn.BetweenStartAndEnd&&(p.alongA===tn.EqualStart?this.divideEvent(t,a):p.alongA===tn.BetweenStartAndEnd?this.divideEvent(t,p.p):p.alongA===tn.EqualEnd&&this.divideEvent(t,l));return null}calculate(e,t){var n,r,i,a,l,c,u,p;const g=[];for(;!this.events.isEmpty();){const m=this.events.getHead();if((n=this.log)===null||n===void 0||n.vert(m.p[0]),m.isStart){(r=this.log)===null||r===void 0||r.segmentNew(m.seg,m.primary);const y=this.statusFindSurrounding(m),A=y.before,w=y.after;(i=this.log)===null||i===void 0||i.tempStatus(m.seg,A?A.seg:!1,w?w.seg:!1);const C=(()=>{if(A){const E=this.checkIntersection(m,A);if(E)return E}return w?this.checkIntersection(m,w):null})();if(C){if(this.selfIntersection){let E;m.seg.myFill.below===null?E=!0:E=m.seg.myFill.above!==m.seg.myFill.below,E&&(C.seg.myFill.above=!C.seg.myFill.above)}else C.seg.otherFill=m.seg.myFill;(a=this.log)===null||a===void 0||a.segmentUpdate(C.seg),this.events.remove(m.other),this.events.remove(m)}if(this.events.getHead()!==m){(l=this.log)===null||l===void 0||l.rewind(m.seg);continue}if(this.selfIntersection){let E;m.seg.myFill.below===null?E=!0:E=m.seg.myFill.above!==m.seg.myFill.below,w?m.seg.myFill.below=w.seg.myFill.above:m.seg.myFill.below=e,E?m.seg.myFill.above=!m.seg.myFill.below:m.seg.myFill.above=m.seg.myFill.below}else if(m.seg.otherFill===null){let E;if(!w)E=m.primary?t:e;else if(m.primary===w.primary){if(w.seg.otherFill===null)throw new Error("otherFill is null");E=w.seg.otherFill.above}else E=w.seg.myFill.above;m.seg.otherFill={above:E,below:E}}(c=this.log)===null||c===void 0||c.status(m.seg,A?A.seg:!1,w?w.seg:!1),m.other.status=y.insert(m)}else{const y=m.status;if(y===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");const A=this.status.getIndex(y);if(A>0&&A<this.status.nodes.length-1){const w=this.status.nodes[A-1],C=this.status.nodes[A+1];this.checkIntersection(w,C)}if((u=this.log)===null||u===void 0||u.statusRemove(y.seg),this.status.remove(y),!m.primary){if(!m.seg.otherFill)throw new Error("otherFill is null");const w=m.seg.myFill;m.seg.myFill=m.seg.otherFill,m.seg.otherFill=w}g.push(m.seg)}this.events.removeHead()}return(p=this.log)===null||p===void 0||p.done(),g}}function na(s,e,t){const n=[];for(const r of s){const i=(r.myFill.above?8:0)+(r.myFill.below?4:0)+(r.otherFill&&r.otherFill.above?2:0)+(r.otherFill&&r.otherFill.below?1:0);if(e[i]!==0){const a=new ki(r.start,r.end,null,t);a.myFill.above=e[i]===1,a.myFill.below=e[i]===2,n.push(a)}}return t==null||t.selected(n),n}class sa{static union(e,t){return na(e,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],t)}static intersect(e,t){return na(e,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],t)}static difference(e,t){return na(e,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],t)}static differenceRev(e,t){return na(e,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],t)}static xor(e,t){return na(e,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],t)}}function $5(s,e,t){const n=[],r=[];for(const i of s){let a=function(E,L,O){return y&&(y.index=E,y.matches_head=L,y.matches_pt1=O),y===g?(y=m,!1):(y=null,!0)},l=function(E){t==null||t.chainReverse(E),n[E].reverse()},c=function(E,L){const O=n[E],F=n[L];let B=O[O.length-1];const Z=O[O.length-2],W=F[0],Q=F[1];e.pointsCollinear(Z,B,W)&&(t==null||t.chainRemoveTail(E,B),O.pop(),B=Z),e.pointsCollinear(B,W,Q)&&(t==null||t.chainRemoveHead(L,W),F.shift()),t==null||t.chainJoin(E,L),n[E]=O.concat(F),n.splice(L,1)};const u=i.start,p=i.end;if(e.pointsSame(u,p)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");continue}t==null||t.chainStart(i);const g={index:0,matches_head:!1,matches_pt1:!1},m={index:0,matches_head:!1,matches_pt1:!1};let y=g;for(let E=0;E<n.length;E++){const L=n[E],O=L[0],F=L[L.length-1];if(e.pointsSame(O,u)){if(a(E,!0,!0))break}else if(e.pointsSame(O,p)){if(a(E,!0,!1))break}else if(e.pointsSame(F,u)){if(a(E,!1,!0))break}else if(e.pointsSame(F,p)&&a(E,!1,!1))break}if(y===g){n.push([u,p]),t==null||t.chainNew(u,p);continue}if(y===m){t==null||t.chainMatch(g.index);const E=g.index,L=g.matches_pt1?p:u,O=g.matches_head,F=n[E];let B=O?F[0]:F[F.length-1];const Z=O?F[1]:F[F.length-2],W=O?F[F.length-1]:F[0],Q=O?F[F.length-2]:F[1];if(e.pointsCollinear(Z,B,L)&&(O?(t==null||t.chainRemoveHead(g.index,L),F.shift()):(t==null||t.chainRemoveTail(g.index,L),F.pop()),B=Z),e.pointsSame(W,L)){n.splice(E,1),e.pointsCollinear(Q,W,B)&&(O?(t==null||t.chainRemoveTail(g.index,B),F.pop()):(t==null||t.chainRemoveHead(g.index,B),F.shift())),t==null||t.chainClose(g.index),r.push(F);continue}O?(t==null||t.chainAddHead(g.index,L),F.unshift(L)):(t==null||t.chainAddTail(g.index,L),F.push(L));continue}const A=g.index,w=m.index;t==null||t.chainConnect(A,w);const C=n[A].length<n[w].length;g.matches_head?m.matches_head?C?(l(A),c(A,w)):(l(w),c(w,A)):c(w,A):m.matches_head?c(A,w):C?(l(A),c(w,A)):(l(w),c(A,w))}return r}class W5{constructor(){this.list=[],this.nextSegmentId=0,this.curVert=NaN}push(e,t){this.list.push({type:e,data:JSON.parse(JSON.stringify(t))})}segmentId(){return this.nextSegmentId++}checkIntersection(e,t){this.push("check",{seg1:e,seg2:t})}segmentChop(e,t){this.push("div_seg",{seg:e,p:t}),this.push("chop",{seg:e,p:t})}statusRemove(e){this.push("pop_seg",{seg:e})}segmentUpdate(e){this.push("seg_update",{seg:e})}segmentNew(e,t){this.push("new_seg",{seg:e,primary:t})}tempStatus(e,t,n){this.push("temp_status",{seg:e,above:t,below:n})}rewind(e){this.push("rewind",{seg:e})}status(e,t,n){this.push("status",{seg:e,above:t,below:n})}vert(e){e!==this.curVert&&(this.push("vert",{x:e}),this.curVert=e)}selected(e){this.push("selected",{segs:e})}chainStart(e){this.push("chain_start",{seg:e})}chainRemoveHead(e,t){this.push("chain_rem_head",{index:e,p:t})}chainRemoveTail(e,t){this.push("chain_rem_tail",{index:e,p:t})}chainNew(e,t){this.push("chain_new",{p1:e,p2:t})}chainMatch(e){this.push("chain_match",{index:e})}chainClose(e){this.push("chain_close",{index:e})}chainAddHead(e,t){this.push("chain_add_head",{index:e,p:t})}chainAddTail(e,t){this.push("chain_add_tail",{index:e,p:t})}chainConnect(e,t){this.push("chain_con",{index1:e,index2:t})}chainReverse(e){this.push("chain_rev",{index:e})}chainJoin(e,t){this.push("chain_join",{index1:e,index2:t})}done(){this.push("done",null)}}class T0{constructor(e){this.log=null,this.geo=e}buildLog(e){var t;return this.log=e?new W5:null,(t=this.log)===null||t===void 0?void 0:t.list}segments(e){const t=new Xd(!0,this.geo,this.log);for(const n of e.regions)t.addRegion(n);return{segments:t.calculate(e.inverted,!1),inverted:e.inverted}}combine(e,t){const n=new Xd(!1,this.geo,this.log);for(const r of e.segments)n.addSegment(new ki(r.start,r.end,r,this.log),!0);for(const r of t.segments)n.addSegment(new ki(r.start,r.end,r,this.log),!1);return{combined:n.calculate(e.inverted,t.inverted),inverted1:e.inverted,inverted2:t.inverted}}selectUnion(e){return{segments:sa.union(e.combined,this.log),inverted:e.inverted1||e.inverted2}}selectIntersect(e){return{segments:sa.intersect(e.combined,this.log),inverted:e.inverted1&&e.inverted2}}selectDifference(e){return{segments:sa.difference(e.combined,this.log),inverted:e.inverted1&&!e.inverted2}}selectDifferenceRev(e){return{segments:sa.differenceRev(e.combined,this.log),inverted:!e.inverted1&&e.inverted2}}selectXor(e){return{segments:sa.xor(e.combined,this.log),inverted:e.inverted1!==e.inverted2}}polygon(e){return{regions:$5(e.segments,this.geo,this.log),inverted:e.inverted}}union(e,t){const n=this.segments(e),r=this.segments(t),i=this.combine(n,r),a=this.selectUnion(i);return this.polygon(a)}intersect(e,t){const n=this.segments(e),r=this.segments(t),i=this.combine(n,r),a=this.selectIntersect(i);return this.polygon(a)}difference(e,t){const n=this.segments(e),r=this.segments(t),i=this.combine(n,r),a=this.selectDifference(i);return this.polygon(a)}differenceRev(e,t){const n=this.segments(e),r=this.segments(t),i=this.combine(n,r),a=this.selectDifferenceRev(i);return this.polygon(a)}xor(e,t){const n=this.segments(e),r=this.segments(t),i=this.combine(n,r),a=this.selectXor(i);return this.polygon(a)}}new T0(new E0);const cs=[.5,0,0,.48429158056431554,-.1243449435824274,0,.4381533400219318,-.24087683705085766,0,.3644843137107058,-.3422735529643443,0,.2679133974894983,-.42216396275100754,0,.15450849718747373,-.47552825814757677,0,.03139525976465676,-.4990133642141358,0,-.09369065729286241,-.4911436253643443,0,-.21288964578253636,-.45241352623300973,0,-.3187119948743449,-.3852566213878946,0,-.40450849718747367,-.2938926261462366,0,-.4648882429441257,-.18406227634233907,0,-.4960573506572389,-.06266661678215227,0,-.49605735065723894,.06266661678215214,0,-.4648882429441256,.18406227634233915,0,-.4045084971874738,.2938926261462365,0,-.31871199487434476,.3852566213878947,0,-.21288964578253608,.4524135262330099,0,-.09369065729286231,.49114362536434436,0,.031395259764656416,.4990133642141358,0,.15450849718747361,.4755282581475768,0,.267913397489498,.42216396275100776,0,.3644843137107056,.3422735529643445,0,.4381533400219318,.24087683705085766,0,.4842915805643155,.12434494358242767,0,.5,0,0],hs=[0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,14,14,15,15,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25],H5=new Map([[2,{position:new Float32Array([-1,0,0,1,0,0,0,-1,0,0,1,0]),indices:new Uint16Array([0,1,2,3])}],[3,{position:new Float32Array([-Math.SQRT1_2,Math.SQRT1_2,0,Math.SQRT1_2,-Math.SQRT1_2,0,-Math.SQRT1_2,-Math.SQRT1_2,0,Math.SQRT1_2,Math.SQRT1_2,0]),indices:new Uint16Array([0,1,2,3])}],[4,{position:new Float32Array([0,0,0,0,.5,0]),indices:new Uint16Array([0,1,2,3])}],[32,{position:new Float32Array(cs),indices:new Uint16Array(hs)}],[33,{position:new Float32Array(cs),indices:new Uint16Array(hs)}],[34,{position:new Float32Array([...cs,-1,0,0,1,0,0,0,-1,0,0,1,0]),indices:new Uint16Array([...hs,26,27,28,29])}],[35,{position:new Float32Array([...cs,-Math.SQRT1_2,Math.SQRT1_2,0,Math.SQRT1_2,-Math.SQRT1_2,0,-Math.SQRT1_2,-Math.SQRT1_2,0,Math.SQRT1_2,Math.SQRT1_2,0]),indices:new Uint16Array([...hs,26,27,28,29])}],[36,{position:new Float32Array([...cs,0,0,0,0,.5,0]),indices:new Uint16Array([...hs,26,27])}],[64,{position:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0]),indices:new Uint16Array([0,1,1,2,2,3,3,4])}],[65,{position:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0]),indices:new Uint16Array([0,1,1,2,2,3,3,4])}],[66,{position:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,-1,0,0,1,0,0,0,-1,0,0,1,0]),indices:new Uint16Array([0,1,1,2,2,3,3,4,5,6,7,8])}],[67,{position:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-Math.SQRT1_2,Math.SQRT1_2,0,Math.SQRT1_2,-Math.SQRT1_2,0,-Math.SQRT1_2,-Math.SQRT1_2,0,Math.SQRT1_2,Math.SQRT1_2,0]),indices:new Uint16Array([0,1,1,2,2,3,3,0,4,5,6,7])}],[68,{position:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,0,0,0,0,.5,0]),indices:new Uint16Array([0,1,1,2,2,3,3,4,5,6])}],[96,{position:new Float32Array([...cs,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0]),indices:new Uint16Array([...hs,26,27,27,28,28,29,29,26])}],[97,{position:new Float32Array([...cs,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0]),indices:new Uint16Array([...hs,26,27,27,28,28,29,29,30])}],[98,{position:new Float32Array([...cs,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,-1,0,0,1,0,0,0,-1,0,0,1,0]),indices:new Uint16Array([...hs,26,27,27,28,28,29,29,30,31,32,33,34])}],[99,{position:new Float32Array([...cs,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-Math.SQRT1_2,Math.SQRT1_2,0,Math.SQRT1_2,-Math.SQRT1_2,0,-Math.SQRT1_2,-Math.SQRT1_2,0,Math.SQRT1_2,Math.SQRT1_2,0]),indices:new Uint16Array([...hs,26,27,27,28,28,29,29,26,30,31,32,33])}],[100,{position:new Float32Array([...cs,-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,0,0,0,0,.5,0]),indices:new Uint16Array([...hs,26,27,27,28,28,29,29,30,31,32])}]]);class or{constructor(){this._symbols=this.initialize()}static get instance(){return or._instance||(or._instance=new or),or._instance}isShowPoint(e=null){return e==null||e==0||e==32||e==64||e==96}create(e=null,t={x:0,y:0,z:0}){const n={};if(e==null||e==0)ra.copy(t),n.point=new It().setFromPoints([ra]);else if(e!=1){const r=this._symbols.get(e);if(r==null)throw new Error(`[AcTrPointSymbolCreator] Invalid point type value: '${e}'!`);ra.copy(t),Zd.identity().makeTranslation(ra),n.line=r.clone().applyMatrix4(Zd),(e==32||e==64||e==96)&&(n.point=new It().setFromPoints([ra]))}return n}initialize(){const e=new Map;return H5.forEach((t,n)=>{const r=new It;r.setAttribute("position",new Rt(t.position,3)),r.setIndex(new Rt(t.indices,1)),e.set(n,r)}),e}}const Zd=new Ma,ra=new jt,q5=new Dr(583902);class Qo{static cloneMaterial(e){if(!e)return e;if(Array.isArray(e)){const t=[];return e.forEach(n=>{t.push(n.clone())}),t}return e.clone()}static setMaterialColor(e,t=q5){if(Array.isArray(e)){e.forEach(n=>this.setMaterialColor(n,t));return}this.hasColorProperty(e)&&(e.color.set(t),this.hasEmissiveProperty(e)&&e.emissive.set(t)),this.hasUniformsProperty(e)&&e.uniforms.u_color&&e.uniforms.u_color.value.set(t)}static hasColorProperty(e){return"color"in e&&e.color instanceof Dr}static hasEmissiveProperty(e){return"emissive"in e&&e.emissive instanceof Dr}static hasUniformsProperty(e){return"uniforms"in e&&e.uniforms!==void 0}}class $a{static getExtension(e){return e.substring(e.lastIndexOf(".")+1)}static estimateObjectSize(e){const t=new WeakSet;function n(r){if(r==null)return 0;const i=typeof r;if(i==="boolean")return 4;if(i==="number")return 8;if(i==="string")return r.length*2;if(i==="symbol"||i==="function"||t.has(r))return 0;if(t.add(r),Array.isArray(r))return r.map(n).reduce((a,l)=>a+l,0);if(i==="object"){let a=0;for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&(a+=l.length*2,a+=n(r[l]));return a}return 0}return n(e)}static getFileName(e){return e.split("/").pop()}static getFileNameWithoutExtension(e){const t=$a.getFileName(e);if(t){const n=t.lastIndexOf(".");return n===-1?t:t.substring(0,n)}return e}}function Fh(s,e){return s-e}function zh(s,e,t=0){const n=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const r=s.count;for(let i=0;i<r;i++)for(let a=0;a<n;a++)e.setComponent(i+t,a,s.getComponent(i,a))}else e.array.set(s.array,t*n);e.needsUpdate=!0}function Pi(s,e){if(s.constructor!==e.constructor){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++)e[n]=s[n]}else{const t=Math.min(s.length,e.length);e.set(new s.constructor(s.buffer,0,t))}}const Kd=new Ft,pi=new jt,fi=new ms,wo=[];class Y5 extends ms{constructor(e=1e3,t=e*2,n){super(new It,n),this.boundingBox=null,this.boundingSphere=null,this._geometryInfo=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._geometryInitialized=!1,this.frustumCulled=!1,this._maxVertexCount=e,this._maxIndexCount=t}get geometryCount(){return this._geometryCount}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}get mappingStats(){const e=this._geometryInfo.length;let t=0;return e>0&&(t=$a.estimateObjectSize(this._geometryInfo[0])),{count:e,size:e*t}}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const i in e.attributes){const a=e.getAttribute(i),{array:l,itemSize:c,normalized:u}=a,p=new l.constructor(n*c),g=new Rt(p,c,u);t.setAttribute(i,g)}if(e.getIndex()!==null){const i=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Rt(i,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('AcTrBatchedLine: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`AcTrBatchedLine: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("AcTrBatchedLine: All attributes must have a consistent itemSize and normalized value.")}}_resizeSpaceIfNeeded(e){const t=e.getIndex(),n=t!==null;let r=this._maxIndexCount;n&&this.unusedIndexCount<t.count&&(r=(this._maxIndexCount+t.count)*1.5);const i=e.getAttribute("position");let a=this._maxVertexCount;i&&this.unusedVertexCount<i.count&&(a=(this._maxVertexCount+i.count)*1.5),(r>this._maxIndexCount||a>this._maxVertexCount)&&this.setGeometrySize(a,r)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`AcTrBatchedLine: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}reset(){this.boundingBox=null,this.boundingSphere=null,this._geometryInfo=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._geometryInfo.length=0,this._geometryInitialized=!1,this.geometry.dispose()}getUserData(){const e=[];return this._geometryInfo.forEach(t=>{e.push({position:t.position,objectId:t.objectId,bboxIntersectionCheck:t.bboxIntersectionCheck})}),e}resetGeometry(e){const t=this.getUserData();this.reset();const n=or.instance;t.forEach(r=>{if(r.position){const i=n.create(e,r.position);if(i.line){const a=this.addGeometry(i.line);this.setGeometryInfo(a,r)}}})}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ft);const e=this.boundingBox,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingBox!=null&&e.union(i.boundingBox)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ms);const e=this.boundingSphere,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingSphere!=null&&e.union(i.boundingSphere)}}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e),e.boundingBox==null&&e.computeBoundingBox(),e.boundingSphere==null&&e.computeBoundingSphere(),this._resizeSpaceIfNeeded(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere,active:!0,visible:!0},i=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=n===-1?a.count:n),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("AcTrBatchedLine: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Fh),l=this._availableGeometryIds.shift(),i[l]=r):(l=this._geometryCount,this._geometryCount++,i.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryInfo(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedLine: Maximum geometry count reached.");const n=this._geometryInfo[e],r=t.position;r&&(n.position={...r}),n.objectId=t.objectId,n.bboxIntersectionCheck=t.bboxIntersectionCheck}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedLine: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,i=n.getIndex(),a=t.getIndex(),l=this._geometryInfo[e];if(r&&a.count>l.reservedIndexCount||t.attributes.position.count>l.reservedVertexCount)throw new Error("AcTrBatchedLine: Reserved space not large enough for provided geometry.");const c=l.vertexStart,u=l.reservedVertexCount;l.vertexCount=t.getAttribute("position").count;for(const p in n.attributes){const g=t.getAttribute(p),m=n.getAttribute(p);zh(g,m,c);const y=g.itemSize;for(let A=g.count,w=u;A<w;A++){const C=c+A;for(let E=0;E<y;E++)m.setComponent(C,E,0)}m.needsUpdate=!0,m.addUpdateRange(c*y,u*y)}if(r&&i){const p=l.indexStart,g=l.reservedIndexCount;l.indexCount=t.getIndex().count;for(let m=0;m<a.count;m++)i.setX(p+m,c+a.getX(m));for(let m=a.count,y=g;m<y;m++)i.setX(p+m,c);i.needsUpdate=!0,i.addUpdateRange(p,l.reservedIndexCount)}return l.start=r?l.indexStart:l.vertexStart,l.count=r?l.indexCount:l.vertexCount,l.boundingBox=null,t.boundingBox!==null&&(l.boundingBox=t.boundingBox.clone()),l.boundingSphere=null,t.boundingSphere!==null&&(l.boundingSphere=t.boundingSphere.clone()),e}deleteGeometry(e){const t=this._geometryInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableGeometryIds.push(e),this)}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((a,l)=>l).sort((a,l)=>n[a].vertexStart-n[l].vertexStart),i=this.geometry;for(let a=0,l=n.length;a<l;a++){const c=r[a],u=n[c];if(u.active!==!1){if(i.index!==null){if(u.indexStart!==t){const{indexStart:p,vertexStart:g,reservedIndexCount:m}=u,y=i.index,A=y.array,w=e-g;for(let C=p;C<p+m;C++)A[C]=A[C]+w;y.array.copyWithin(t,p,p+m),y.addUpdateRange(t,m),u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:p,reservedVertexCount:g}=u,m=i.attributes;for(const y in m){const A=m[y],{array:w,itemSize:C}=A;w.copyWithin(e*C,p*C,(p+g)*C),A.addUpdateRange(e*C,g*C)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=i.index?u.indexStart:u.vertexStart,this._nextIndexStart=i.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const i=new Ft,a=n.index,l=n.attributes.position;for(let c=r.start,u=r.start+r.count;c<u;c++){let p=c;a&&(p=a.getX(p)),i.expandByPoint(pi.fromBufferAttribute(l,p))}r.boundingBox=i}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const i=new Ms;this.getBoundingBoxAt(e,Kd),Kd.getCenter(i.center);const a=n.index,l=n.attributes.position;let c=0;for(let u=r.start,p=r.start+r.count;u<p;u++){let g=u;a&&(g=a.getX(g)),pi.fromBufferAttribute(l,g),c=Math.max(c,i.center.distanceToSquared(pi))}i.radius=Math.sqrt(c),r.boundingSphere=i}return t.copy(r.boundingSphere),t}setVisibleAt(e,t){return this.validateGeometryId(e),this._geometryInfo[e].visible===t?this:(this._geometryInfo[e].visible=t,this)}getVisibleAt(e){return this.validateGeometryId(e),this._geometryInfo[e].visible}getGeometryAt(e){return this.validateGeometryId(e),this._geometryInfo[e]}setGeometrySize(e,t){const n=this.geometry;n.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new It,this._initializeGeometry(n));const r=this.geometry;n.index&&Pi(n.index.array,r.index.array);for(const i in n.attributes)Pi(n.attributes[i].array,r.attributes[i].array)}getObjectAt(e){const t=new ms;this._initializeRaycastObject(t);const n=this._geometryInfo[e];return this._setRaycastObjectInfo(t,e,n.start,n.count),t}_initializeRaycastObject(e){const t=this.geometry;return e.material=this.material,e.geometry.index=t.index,e.geometry.attributes=t.attributes,e.geometry.boundingBox===null&&(e.geometry.boundingBox=new Ft),e.geometry.boundingSphere===null&&(e.geometry.boundingSphere=new Ms),e}_setRaycastObjectInfo(e,t,n,r){e.geometry.setDrawRange(n,r),this.getBoundingBoxAt(t,e.geometry.boundingBox),this.getBoundingSphereAt(t,e.geometry.boundingSphere)}_resetRaycastObjectInfo(e){e.geometry.index=null,e.geometry.attributes={},e.geometry.setDrawRange(0,1/0)}intersectWith(e,t,n){this._initializeRaycastObject(fi),this._intersectWith(e,t,n),this._resetRaycastObjectInfo(fi)}_intersectWith(e,t,n){const r=this._geometryInfo[e];if(!(!r.visible||!r.active))if(r.bboxIntersectionCheck){const i=r.boundingBox;if(t.ray.intersectBox(i,pi)){const a=t.ray.origin.distanceTo(pi);n.push({distance:a,point:pi.clone(),object:this,face:null,faceIndex:void 0,uv:void 0,batchId:e,objectId:r.objectId})}}else{this._setRaycastObjectInfo(fi,e,r.start,r.count),fi.raycast(t,wo);for(let i=0,a=wo.length;i<a;i++){const l=wo[i];l.object=this,l.batchId=e,l.objectId=r.objectId,n.push(l)}wo.length=0}}raycast(e,t){const n=this._geometryInfo;this._initializeRaycastObject(fi);for(let r=0,i=n.length;r<i;r++)this._intersectWith(r,e,t);this._resetRaycastObjectInfo(fi)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this}dispose(){return this.geometry.dispose(),this}}const Qd=new Ft,gi=new jt,mi=new Zn,So=[];class X5 extends Zn{constructor(e=1e3,t=e*2,n){super(new It,n),this.boundingBox=null,this.boundingSphere=null,this._geometryInfo=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._geometryInitialized=!1,this.frustumCulled=!1,this._maxVertexCount=e,this._maxIndexCount=t}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}get mappingStats(){const e=this._geometryInfo.length;let t=0;return e>0&&(t=$a.estimateObjectSize(this._geometryInfo[0])),{count:e,size:e*t}}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const i in e.attributes){const a=e.getAttribute(i),{array:l,itemSize:c,normalized:u}=a,p=new l.constructor(n*c),g=new Rt(p,c,u);t.setAttribute(i,g)}if(e.getIndex()!==null){const i=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Rt(i,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('AcTrBatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`AcTrBatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("AcTrBatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}_resizeSpaceIfNeeded(e){const t=e.getIndex(),n=t!==null;let r=this._maxIndexCount;n&&this.unusedIndexCount<t.count&&(r=(this._maxIndexCount+t.count)*1.5);const i=e.getAttribute("position");let a=this._maxVertexCount;i&&this.unusedVertexCount<i.count&&(a=(this._maxVertexCount+i.count)*1.5),(r>this._maxIndexCount||a>this._maxVertexCount)&&this.setGeometrySize(a,r)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`AcTrBatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ft);const e=this.boundingBox,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingBox!=null&&e.union(i.boundingBox)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ms);const e=this.boundingSphere,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingSphere!=null&&e.union(i.boundingSphere)}}addGeometry(e,t=-1,n=-1){e.hasAttribute("uv")&&e.deleteAttribute("uv"),e.hasAttribute("normal")&&e.deleteAttribute("normal"),this._initializeGeometry(e),this._validateGeometry(e),e.boundingBox==null&&e.computeBoundingBox(),e.boundingSphere==null&&e.computeBoundingSphere(),this._resizeSpaceIfNeeded(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere,active:!0,visible:!0},i=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=n===-1?a.count:n),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("AcTrBatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Fh),l=this._availableGeometryIds.shift(),i[l]=r):(l=this._geometryCount,this._geometryCount++,i.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryInfo(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedMesh: Maximum geometry count reached.");const n=this._geometryInfo[e];n.objectId=t.objectId,n.bboxIntersectionCheck=t.bboxIntersectionCheck}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,i=n.getIndex(),a=t.getIndex(),l=this._geometryInfo[e];if(r&&a.count>l.reservedIndexCount||t.attributes.position.count>l.reservedVertexCount)throw new Error("AcTrBatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,u=l.reservedVertexCount;l.vertexCount=t.getAttribute("position").count;for(const p in n.attributes){const g=t.getAttribute(p),m=n.getAttribute(p);zh(g,m,c);const y=g.itemSize;for(let A=g.count,w=u;A<w;A++){const C=c+A;for(let E=0;E<y;E++)m.setComponent(C,E,0)}m.needsUpdate=!0,m.addUpdateRange(c*y,u*y)}if(r&&i){const p=l.indexStart,g=l.reservedIndexCount;l.indexCount=t.getIndex().count;for(let m=0;m<a.count;m++)i.setX(p+m,c+a.getX(m));for(let m=a.count,y=g;m<y;m++)i.setX(p+m,c);i.needsUpdate=!0,i.addUpdateRange(p,l.reservedIndexCount)}return l.start=r?l.indexStart:l.vertexStart,l.count=r?l.indexCount:l.vertexCount,l.boundingBox=null,t.boundingBox!==null&&(l.boundingBox=t.boundingBox.clone()),l.boundingSphere=null,t.boundingSphere!==null&&(l.boundingSphere=t.boundingSphere.clone()),e}deleteGeometry(e){const t=this._geometryInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableGeometryIds.push(e),this)}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((a,l)=>l).sort((a,l)=>n[a].vertexStart-n[l].vertexStart),i=this.geometry;for(let a=0,l=n.length;a<l;a++){const c=r[a],u=n[c];if(u.active!==!1){if(i.index!==null){if(u.indexStart!==t){const{indexStart:p,vertexStart:g,reservedIndexCount:m}=u,y=i.index,A=y.array,w=e-g;for(let C=p;C<p+m;C++)A[C]=A[C]+w;y.array.copyWithin(t,p,p+m),y.addUpdateRange(t,m),u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:p,reservedVertexCount:g}=u,m=i.attributes;for(const y in m){const A=m[y],{array:w,itemSize:C}=A;w.copyWithin(e*C,p*C,(p+g)*C),A.addUpdateRange(e*C,g*C)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=i.index?u.indexStart:u.vertexStart,this._nextIndexStart=i.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const i=new Ft,a=n.index,l=n.attributes.position;for(let c=r.start,u=r.start+r.count;c<u;c++){let p=c;a&&(p=a.getX(p)),i.expandByPoint(gi.fromBufferAttribute(l,p))}r.boundingBox=i}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const i=new Ms;this.getBoundingBoxAt(e,Qd),Qd.getCenter(i.center);const a=n.index,l=n.attributes.position;let c=0;for(let u=r.start,p=r.start+r.count;u<p;u++){let g=u;a&&(g=a.getX(g)),gi.fromBufferAttribute(l,g),c=Math.max(c,i.center.distanceToSquared(gi))}i.radius=Math.sqrt(c),r.boundingSphere=i}return t.copy(r.boundingSphere),t}setVisibleAt(e,t){return this.validateGeometryId(e),this._geometryInfo[e].visible===t?this:(this._geometryInfo[e].visible=t,this)}getVisibleAt(e){return this.validateGeometryId(e),this._geometryInfo[e].visible}getGeometryRangeAt(e){return this.validateGeometryId(e),this._geometryInfo[e]}setGeometrySize(e,t){const n=this.geometry;n.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new It,this._initializeGeometry(n));const r=this.geometry;n.index&&Pi(n.index.array,r.index.array);for(const i in n.attributes)Pi(n.attributes[i].array,r.attributes[i].array)}getObjectAt(e){const t=new Zn;this._initializeRaycastObject(t);const n=this._geometryInfo[e];return this._setRaycastObjectInfo(t,e,n.start,n.count),t}_initializeRaycastObject(e){const t=this.geometry;return e.material=this.material,e.geometry.index=t.index,e.geometry.attributes=t.attributes,e.geometry.boundingBox===null&&(e.geometry.boundingBox=new Ft),e.geometry.boundingSphere===null&&(e.geometry.boundingSphere=new Ms),e}_setRaycastObjectInfo(e,t,n,r){e.geometry.setDrawRange(n,r),this.getBoundingBoxAt(t,e.geometry.boundingBox),this.getBoundingSphereAt(t,e.geometry.boundingSphere)}_resetRaycastObjectInfo(e){e.geometry.index=null,e.geometry.attributes={},e.geometry.setDrawRange(0,1/0)}intersectWith(e,t,n){this._initializeRaycastObject(mi),this._intersectWith(e,t,n),this._resetRaycastObjectInfo(mi)}_intersectWith(e,t,n){const r=this._geometryInfo[e];if(!(!r.visible||!r.active))if(r.bboxIntersectionCheck){const i=r.boundingBox;if(t.ray.intersectBox(i,gi)){const a=t.ray.origin.distanceTo(gi);n.push({distance:a,point:gi.clone(),object:this,face:null,faceIndex:void 0,uv:void 0,batchId:e,objectId:r.objectId})}}else{this._setRaycastObjectInfo(mi,e,r.start,r.count),mi.raycast(t,So);for(let i=0,a=So.length;i<a;i++){const l=So[i];l.object=this,l.batchId=e,l.objectId=r.objectId,n.push(l)}So.length=0}}raycast(e,t){const n=this._geometryInfo;this._initializeRaycastObject(mi);for(let r=0,i=n.length;r<i;r++)this._intersectWith(r,e,t);this._resetRaycastObjectInfo(mi)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this}dispose(){return this.geometry.dispose(),this}}const Jd=new Ft,yi=new jt,vi=new Br,Ao=[];class Z5 extends Br{constructor(e=1e3,t){super(new It,t),this.boundingBox=null,this.boundingSphere=null,this._geometryInfo=[],this._availableGeometryIds=[],this._nextVertexStart=0,this._geometryCount=0,this._geometryInitialized=!1,this.frustumCulled=!1,this._maxVertexCount=e}get geometryCount(){return this._geometryCount}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get mappingStats(){const e=this._geometryInfo.length;let t=0;return e>0&&(t=$a.estimateObjectSize(this._geometryInfo[0])),{count:e,size:e*t}}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const i=e.getAttribute(r),{array:a,itemSize:l,normalized:c}=i,u=new a.constructor(n*l),p=new Rt(u,l,c);t.setAttribute(r,p)}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`AcTrBatchedLine: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("AcTrBatchedLine: All attributes must have a consistent itemSize and normalized value.")}}_resizeSpaceIfNeeded(e){const t=e.getAttribute("position");let n=this._maxVertexCount;t&&this.unusedVertexCount<t.count&&(n=(this._maxVertexCount+t.count)*1.5),n>this._maxVertexCount&&this.setGeometrySize(n)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`AcTrBatchedLine: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}reset(){this.boundingBox=null,this.boundingSphere=null,this._geometryInfo=[],this._availableGeometryIds=[],this._nextVertexStart=0,this._geometryCount=0,this._geometryInfo.length=0,this._geometryInitialized=!1,this.geometry.dispose()}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ft);const e=this.boundingBox,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingBox!=null&&e.union(i.boundingBox)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ms);const e=this.boundingSphere,t=this._geometryInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){const i=t[n];i.active!==!1&&i.boundingSphere!=null&&e.union(i.boundingSphere)}}addGeometry(e,t=-1){this._initializeGeometry(e),this._validateGeometry(e),e.boundingBox==null&&e.computeBoundingBox(),e.boundingSphere==null&&e.computeBoundingSphere(),this._resizeSpaceIfNeeded(e);const n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere,active:!0,visible:!0},r=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=t===-1?e.getAttribute("position").count:t;let i;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Fh),i=this._availableGeometryIds.shift(),r[i]=n):(i=this._geometryCount,this._geometryCount++,r.push(n)),this.setGeometryAt(i,e),this._nextVertexStart=n.vertexStart+n.reservedVertexCount,this.geometry.setDrawRange(0,this._nextVertexStart),i}setGeometryInfo(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedLine: Maximum geometry count reached.");const n=this._geometryInfo[e],r=t.position;r&&(n.position={...r}),n.objectId=t.objectId,n.bboxIntersectionCheck=t.bboxIntersectionCheck}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("AcTrBatchedLine: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=this._geometryInfo[e],i=r.vertexStart,a=r.reservedVertexCount;r.vertexCount=t.getAttribute("position").count;for(const l in n.attributes){const c=t.getAttribute(l),u=n.getAttribute(l);zh(c,u,i);const p=c.itemSize;for(let g=c.count,m=a;g<m;g++){const y=i+g;for(let A=0;A<p;A++)u.setComponent(y,A,0)}u.needsUpdate=!0,u.addUpdateRange(i*p,a*p)}return r.boundingBox=null,t.boundingBox!==null&&(r.boundingBox=t.boundingBox.clone()),r.boundingSphere=null,t.boundingSphere!==null&&(r.boundingSphere=t.boundingSphere.clone()),e}deleteGeometry(e){const t=this._geometryInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableGeometryIds.push(e),this)}optimize(){let e=0;const t=this._geometryInfo,n=t.map((i,a)=>a).sort((i,a)=>t[i].vertexStart-t[a].vertexStart),r=this.geometry;for(let i=0,a=t.length;i<a;i++){const l=n[i],c=t[l];if(c.active!==!1){if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:p}=c,g=r.attributes;for(const m in g){const y=g[m],{array:A,itemSize:w}=y;A.copyWithin(e*w,u*w,(u+p)*w),y.addUpdateRange(e*w,p*w)}c.vertexStart=e}e+=c.reservedVertexCount,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const i=new Ft,a=n.index,l=n.attributes.position;for(let c=r.vertexStart,u=r.vertexStart+r.vertexCount;c<u;c++){let p=c;a&&(p=a.getX(p)),i.expandByPoint(yi.fromBufferAttribute(l,p))}r.boundingBox=i}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const i=new Ms;this.getBoundingBoxAt(e,Jd),Jd.getCenter(i.center);const a=n.index,l=n.attributes.position;let c=0;for(let u=r.vertexStart,p=r.vertexStart+r.vertexCount;u<p;u++){let g=u;a&&(g=a.getX(g)),yi.fromBufferAttribute(l,g),c=Math.max(c,i.center.distanceToSquared(yi))}i.radius=Math.sqrt(c),r.boundingSphere=i}return t.copy(r.boundingSphere),t}setVisibleAt(e,t){return this.validateGeometryId(e),this._geometryInfo[e].visible===t?this:(this._geometryInfo[e].visible=t,this)}getVisibleAt(e){return this.validateGeometryId(e),this._geometryInfo[e].visible}getGeometryAt(e){return this.validateGeometryId(e),this._geometryInfo[e]}setGeometrySize(e){const t=this.geometry;t.dispose(),this._maxVertexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new It,this._initializeGeometry(t));const n=this.geometry;t.index&&Pi(t.index.array,n.index.array);for(const r in t.attributes)Pi(t.attributes[r].array,n.attributes[r].array)}getObjectAt(e){const t=new Br;this._initializeRaycastObject(t);const n=this._geometryInfo[e];return this._setRaycastObjectInfo(t,e,n.vertexStart,n.vertexCount),t}_initializeRaycastObject(e){const t=this.geometry;return e.material=this.material,e.geometry.index=t.index,e.geometry.attributes=t.attributes,e.geometry.boundingBox===null&&(e.geometry.boundingBox=new Ft),e.geometry.boundingSphere===null&&(e.geometry.boundingSphere=new Ms),e}_setRaycastObjectInfo(e,t,n,r){e.geometry.setDrawRange(n,r),this.getBoundingBoxAt(t,e.geometry.boundingBox),this.getBoundingSphereAt(t,e.geometry.boundingSphere)}_resetRaycastObjectInfo(e){e.geometry.index=null,e.geometry.attributes={},e.geometry.setDrawRange(0,1/0)}intersectWith(e,t,n){this._initializeRaycastObject(vi),this._intersectWith(e,t,n),this._resetRaycastObjectInfo(vi)}_intersectWith(e,t,n){const r=this._geometryInfo[e];if(!(!r.visible||!r.active))if(r.bboxIntersectionCheck){const i=r.boundingBox;if(t.ray.intersectBox(i,yi)){const a=t.ray.origin.distanceTo(yi);n.push({distance:a,point:yi.clone(),object:this,face:null,faceIndex:void 0,uv:void 0,batchId:e,objectId:r.objectId})}}else{this._setRaycastObjectInfo(vi,e,r.vertexStart,r.vertexCount),vi.raycast(t,Ao);for(let i=0,a=Ao.length;i<a;i++){const l=Ao[i];l.object=this,l.batchId=e,l.objectId=r.objectId,n.push(l)}Ao.length=0}}raycast(e,t){const n=this._geometryInfo;this._initializeRaycastObject(vi);for(let r=0,i=n.length;r<i;r++)this._intersectWith(r,e,t);this._resetRaycastObjectInfo(vi)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._maxVertexCount=e._maxVertexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this}dispose(){return this.geometry.dispose(),this}}class K5 extends lr{constructor(){super(),this._pointBatches=new Map,this._pointSymbolBatches=new Map,this._lineBatches=new Map,this._lineWithIndexBatches=new Map,this._meshBatches=new Map,this._meshWithIndexBatches=new Map,this._entitiesMap=new Map,this._selectedObjects=new lr,this._hoverObjects=new lr,this.add(this._selectedObjects),this.add(this._hoverObjects)}get entityCount(){return this._entitiesMap.size}get stats(){const e={summary:{entityCount:this._entitiesMap.size,totalGeometrySize:0,totalMappingSize:0},mesh:{indexed:{count:this._meshWithIndexBatches.size,geometrySize:this.getBatchedGeometrySize(this._meshWithIndexBatches),mappingSize:this.getBatchedGeometryMappingSize(this._meshWithIndexBatches)},nonIndexed:{count:this._meshBatches.size,geometrySize:this.getBatchedGeometrySize(this._meshBatches),mappingSize:this.getBatchedGeometryMappingSize(this._meshBatches)}},line:{indexed:{count:this._lineWithIndexBatches.size,geometrySize:this.getBatchedGeometrySize(this._lineWithIndexBatches),mappingSize:this.getBatchedGeometryMappingSize(this._lineWithIndexBatches)},nonIndexed:{count:this._lineBatches.size,geometrySize:this.getBatchedGeometrySize(this._lineBatches),mappingSize:this.getBatchedGeometryMappingSize(this._lineBatches)}},point:{indexed:{count:this._pointSymbolBatches.size,geometrySize:this.getBatchedGeometrySize(this._pointSymbolBatches),mappingSize:this.getBatchedGeometryMappingSize(this._pointSymbolBatches)},nonIndexed:{count:this._pointBatches.size,geometrySize:this.getBatchedGeometrySize(this._pointBatches),mappingSize:this.getBatchedGeometryMappingSize(this._pointBatches)}}};return e.summary.totalGeometrySize=e.line.indexed.geometrySize+e.line.nonIndexed.geometrySize+e.mesh.indexed.geometrySize+e.mesh.nonIndexed.geometrySize+e.point.indexed.geometrySize+e.point.nonIndexed.geometrySize,e.summary.totalMappingSize=e.line.indexed.mappingSize+e.line.nonIndexed.mappingSize+e.mesh.indexed.mappingSize+e.mesh.nonIndexed.mappingSize+e.point.indexed.mappingSize+e.point.nonIndexed.mappingSize,e}rerenderPoints(e){const t=or.instance.create(e);t.line&&this._pointSymbolBatches.forEach(r=>{r.resetGeometry(e)});const n=t.point!=null;this._pointBatches.forEach(r=>{r.visible=n})}clear(){return this.clearPoint(),this.clearLine(),this.clearMesh(),this}clearPoint(){this.clearBatch(this._pointBatches),this.clearBatch(this._pointSymbolBatches)}clearLine(){this.clearBatch(this._lineBatches),this.clearBatch(this._lineWithIndexBatches)}clearMesh(){this.clearBatch(this._meshBatches),this.clearBatch(this._meshWithIndexBatches)}hasEntity(e){return this._entitiesMap.has(e)}addEntity(e){const t=[];this._entitiesMap.set(e.objectId,t),e.updateMatrixWorld(!0),e.traverse(n=>{const r=!!n.userData.bboxIntersectionCheck;n instanceof ms?t.push(this.addLine(n,{position:n.userData.position,objectId:e.objectId,bboxIntersectionCheck:r})):n instanceof Zn?t.push(this.addMesh(n,{objectId:e.objectId,bboxIntersectionCheck:r})):n instanceof Br&&t.push(this.addPoint(n,{objectId:e.objectId,bboxIntersectionCheck:r}))})}isIntersectWith(e,t){const n=this._entitiesMap.get(e);if(n){const r=[];for(let i=0,a=n.length;i<a;i++){const l=n[i];if(this.getObjectById(l.batchedObjectId).intersectWith(l.batchId,t,r),r.length>0)return!0}}return!1}hover(e){this.highlight(e,this._hoverObjects)}unhover(e){this.unhighlight(e,this._hoverObjects)}select(e){this.highlight(e,this._selectedObjects)}unselect(e){this.unhighlight(e,this._selectedObjects)}highlight(e,t){const n=this._entitiesMap.get(e);n&&n.forEach(r=>{const i=this.getObjectById(r.batchedObjectId).getObjectAt(r.batchId),a=Qo.cloneMaterial(i.material);Qo.setMaterialColor(a),i.material=a,i.userData.objectId=e,t.add(i)})}unhighlight(e,t){const n=[];t.children.forEach(r=>{r.userData.objectId===e&&n.push(r)}),t.remove(...n)}addLine(e,t){const n=e.material,r=this.getMatchedLineBatches(e);let i=r.get(n.id);i==null&&(i=new Y5(1e3,2e3,n),r.set(n.id,i),this.add(i)),e.geometry.applyMatrix4(e.matrixWorld);const a=i.addGeometry(e.geometry);return i.setGeometryInfo(a,t),{batchedObjectId:i.id,batchId:a}}addMesh(e,t){const n=e.material,r=this.getMatchedMeshBatches(e);let i=r.get(n.id);i==null&&(i=new X5(1e3,2e3,n),r.set(n.id,i),this.add(i)),e.geometry.applyMatrix4(e.matrixWorld);const a=i.addGeometry(e.geometry);return i.setGeometryInfo(a,t),{batchedObjectId:i.id,batchId:a}}addPoint(e,t){const n=e.material;let r=this._pointBatches.get(n.id);r==null&&(r=new Z5(100,n),r.visible=e.visible,this._pointBatches.set(n.id,r),this.add(r)),e.geometry.applyMatrix4(e.matrixWorld);const i=r.addGeometry(e.geometry);return r.setGeometryInfo(i,t),{batchedObjectId:r.id,batchId:i}}getMatchedLineBatches(e){if(e.userData.isPoint)return this._pointSymbolBatches;{const t=e.geometry.getIndex()!==null;let n=this._lineBatches;return t&&(n=this._lineWithIndexBatches),n}}getMatchedMeshBatches(e){const t=e.geometry.getIndex()!==null;let n=this._meshBatches;return t&&(n=this._meshWithIndexBatches),n}clearBatch(e){e.forEach(t=>{t.dispose()}),e.clear()}getBatchedGeometrySize(e){let t=0;return e.forEach(n=>{t+=this.getGeometrySize(n)}),t}getBatchedGeometryMappingSize(e){let t=0;return e.forEach(n=>{t+=n.mappingStats.size}),t}getGeometrySize(e){let t=0;if("geometry"in e){const n=e.geometry;n.attributes.position&&(t+=n.attributes.position.array.byteLength),n.attributes.normal&&(t+=n.attributes.normal.array.byteLength),n.attributes.uv&&(t+=n.attributes.uv.array.byteLength),n.index&&(t+=n.index.array.byteLength)}return t}}class I0 extends Yc{constructor(e){super(),this._styleManager=e}get styleManager(){return this._styleManager}copy(e,t){return this._styleManager=e._styleManager,super.copy(e,t)}}class nn extends I0{constructor(e){super(e),this._box=new Ft}get box(){return this._box}set box(e){this._box.copy(e)}get basePoint(){return this._basePoint}set basePoint(e){e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e)}get objectId(){return this.userData.objectId}set objectId(e){this.userData.objectId=e}get ownerId(){return this.userData.ownerId}set ownerId(e){this.userData.ownerId=e}get layerName(){return this.userData.layerName}set layerName(e){this.userData.layerName=e}static flattenObject(e){const t=[];function n(i){i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),i.matrix.identity()}function r(i,a){const l=[...i.children];for(const c of l)!c.userData.layerName&&i.userData.layerName&&(c.userData.layerName=i.userData.layerName),c.applyMatrix4(a),n(c),c.children.length>0?r(c,c.matrixWorld):t.push(c);i.children=[]}e.updateMatrixWorld(!0),r(e,e.matrixWorld);for(const i of t)"geometry"in i&&(i.geometry.applyMatrix4(i.matrixWorld),i.matrixWorld.identity(),i.matrixWorldNeedsUpdate=!1,e.add(i));n(e),e.matrixWorld.identity(),e.matrixWorldNeedsUpdate=!1}static disposeObject(e,t=!0){t&&e.removeFromParent(),(e instanceof Zn||e instanceof fc||e instanceof Br)&&e.geometry&&e.geometry.dispose(),(e instanceof Zn||e instanceof fc||e instanceof Br)&&(Array.isArray(e.material)?e.material:[e.material]).forEach(n=>{var r,i,a,l,c,u,p,g;n.dispose(),(r=n.map)==null||r.dispose(),(i=n.envMap)==null||i.dispose(),(a=n.lightMap)==null||a.dispose(),(l=n.bumpMap)==null||l.dispose(),(c=n.normalMap)==null||c.dispose(),(u=n.roughnessMap)==null||u.dispose(),(p=n.metalnessMap)==null||p.dispose(),(g=n.alphaMap)==null||g.dispose()}),e.children.forEach(n=>this.disposeObject(n)),"geometry"in e&&(e.geometry=null),"material"in e&&(e.material=null),e.children=[]}flatten(){nn.flattenObject(this)}dispose(){nn.disposeObject(this)}async draw(){}applyMatrix(e){const t=e.elements,n=new Ma(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]);this.applyMatrix4(n),this.updateMatrixWorld(!0),this._box.applyMatrix4(n)}highlight(){this.highlightObject(this)}highlightObject(e){if("material"in e){const t=e.material;if(e.userData.originalMaterial==null){const n=Qo.cloneMaterial(t);Qo.setMaterialColor(n),e.userData.originalMaterial=e.material,e.material=n}}else e.children.length>0&&e.children.forEach(t=>{this.highlightObject(t)})}unhighlight(){this.unhighlightObject(this)}fastDeepClone(){const e=new nn(this.styleManager);return e.copy(this,!1),this.copyGeometry(this,e),e}copy(e,t){return this.objectId=e.objectId,this.ownerId=e.ownerId,this.layerName=e.layerName,this.box=e.box,super.copy(e,t)}copyGeometry(e,t){for(let n=0;n<e.children.length;n++){const r=e.children[n].clone(!1);"geometry"in r&&(r.geometry=r.geometry.clone()),t.add(r)}}unhighlightObject(e){if("material"in e){const t=e.material;e.material=e.userData.originalMaterial,delete e.userData.originalMaterial,Array.isArray(t)?t.forEach(n=>n.dispose()):t instanceof Z0&&t.dispose()}else e.children.length>0&&e.children.forEach(t=>{this.unhighlightObject(t)})}createColorArray(e,t){const n=(e>>16&255)/256,r=(e>>8&255)/256,i=(e&255)/256,a=new Float32Array(t*3);for(let l=0,c=0;l<t;l++)a[c]=n,a[c+1]=r,a[c+2]=i,c+=3;return a}}class cl extends nn{constructor(e,t){super(t),e.forEach(i=>{if(Array.isArray(i)){const a=new nn(t);this.add(a),this.box.union(a.box)}else this.add(i),this.box.union(i.box)}),this.flatten();let n=!1;const r=this.children;for(let i=0;i<r.length;++i){const a=r[i];if(a.userData.layerName!=null&&a.userData.layerName!=="0"){n=!0;break}}this._isOnTheSameLayer=!n}get isOnTheSameLayer(){return this._isOnTheSameLayer}copy(e,t){return this._isOnTheSameLayer=e._isOnTheSameLayer,super.copy(e,t)}fastDeepClone(){const e=new cl([],this.styleManager);return e.copy(this,!1),this.copyGeometry(this,e),e}}class ep{constructor(e){this.scene=e,this.transientGroup=new lr,this.transientGroup.name="Transient_Object_Group",this.scene.add(this.transientGroup),this.entities=new Map}clear(){for(const e of this.entities.values())e.dispose();this.entities.clear(),this.transientGroup.clear()}add(e){const t=e.objectId,n=this.entities.get(t);n&&(this.transientGroup.remove(n),n.dispose()),this.entities.set(t,e),this.transientGroup.add(e)}update(e){const t=this.entities.get(e.objectId);t&&(this.transientGroup.remove(t),t.dispose()),this.entities.set(e.objectId,e),this.transientGroup.add(e)}remove(e){const t=this.entities.get(e);t&&(this.transientGroup.remove(t),nn.disposeObject(t),this.entities.delete(e))}get(e){return this.entities.get(e)}has(e){return this.entities.has(e)}setVisible(e){this.transientGroup.visible=e}dispose(){this.clear(),this.scene.remove(this.transientGroup)}}const C0=class ca{constructor(){}static getInstance(){return ca._instance||(ca._instance=new ca),ca._instance}setFontUrl(e){this._renderer&&this._renderer.setFontUrl(e),this._fontUrl=e}setRenderMode(e){this._renderer&&this._renderer.setDefaultMode(e),this._renderMode=e}async asyncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){if(!this._renderer)throw new Error("AcTrMTextRenderer not initialized!");return await this._renderer.asyncRenderMText(e,t,n)}syncRenderMText(e,t,n={byLayerColor:16777215,byBlockColor:16777215}){if(this.ensureRendererCreated(),!this._renderer)throw new Error("AcTrMTextRenderer not initialized!");return this._renderer.syncRenderMText(e,t,n)}initialize(e){this._workerUrl=e,this._renderer=new V5("worker",{workerUrl:e}),this._fontUrl&&this._renderer.setFontUrl(this._fontUrl),this._renderMode&&this._renderer.setDefaultMode(this._renderMode)}dispose(){this._renderer&&(this._renderer.destroy(),this._renderer=void 0)}ensureRendererCreated(){!this._renderer&&this._workerUrl&&this.initialize(this._workerUrl)}};C0._instance=null;let Ur=C0;class Q5 extends S0{onFontUrlChanged(e){Ur.getInstance().setFontUrl(e)}}class J5 extends nn{constructor(e,t,n){super(n);const r=URL.createObjectURL(e),i=new t1().load(r);i.colorSpace=n1;const a=new qc({side:s1,map:i}),l=new va(t.boundary),c=new ba(l);this.generateUVs(c);const u=new Zn(c,a);this.add(u)}generateUVs(e){const t=e.attributes.position.array,n=new Float32Array(t.length/3*2),r=Math.min(...t.filter((p,g)=>g%3===0)),i=Math.max(...t.filter((p,g)=>g%3===0)),a=Math.min(...t.filter((p,g)=>g%3===1)),l=Math.max(...t.filter((p,g)=>g%3===1)),c=i-r,u=l-a;for(let p=0;p<t.length;p+=3){const g=t[p],m=t[p+1];n[p/3*2]=(g-r)/c,n[p/3*2+1]=(m-a)/u}e.setAttribute("uv",new Rt(n,2))}}const Eo=new jt,To=new jt;class ka{static release(e){e.index=null,e.attributes={}}static toNonIndexed(e){if(!e.index)return e;const t=new It,n=e.index;for(const r in e.attributes)t.setAttribute(r,ka.createGeometryAttributeByIndex(e.attributes[r],n));return t}static createGeometryAttributeByIndex(e,t){const n=t.count,r=e.itemSize,i=e.array.constructor,a=new i(n*r);for(let l=0;l<n;l++){const c=t.getX(l)*r;for(let u=0;u<r;u++)a[l*r+u]=e.array[c+u]}return new Rt(a,r,e.normalized)}static tryConvertInterleavedBufferAttributes(e){!e||!e.attributes||Object.keys(e.attributes).forEach(t=>{const n=e.attributes[t];if(n instanceof h1){const r=n.clone();e.attributes[t]=r}})}static createBufferGeometryByPoints(e){const t=new It,n=new Float32Array(e.length*3),r=new Uint16Array((e.length-1)*2);return e.forEach((i,a)=>{let l=a*3;n[l]=i.x,n[l+1]=i.y,n[l+2]=i.z,a>0&&(l=(a-1)*2,r[l]=a-1,r[l+1]=a)}),t.setAttribute("position",new _a(n,3)),t.setIndex(new op(r,1)),t}static computeLineDistance(e){const t=e.isLineSegments===!0;let n=e.geometry;const r=e.matrixWorld;if(n.index&&(n=ka.toNonIndexed(n)),n.index===null){const i=n.attributes.position;if(!i||i.count===0)return;const a=[];if(t)for(let l=0,c=i.count;l<c;l+=2)Eo.fromBufferAttribute(i,l).applyMatrix4(r),To.fromBufferAttribute(i,l+1).applyMatrix4(r),a[l]=l===0?0:a[l-1],a[l+1]=a[l]+Eo.distanceTo(To);else{a[0]=0;for(let l=1,c=i.count;l<c;l++)Eo.fromBufferAttribute(i,l-1).applyMatrix4(r),To.fromBufferAttribute(i,l).applyMatrix4(r),a[l]=a[l-1],a[l]+=Eo.distanceTo(To)}n.setAttribute("lineDistance",new _a(a,1)),e.geometry.dispose(),e.geometry=n}}static computeLineDistances(e){e.traverse(t=>{let n=t;n.isLine&&n.material instanceof Xc&&this.computeLineDistance(n)})}static apply2dTransform(e,t,n=0,r=1){const i=e.attributes.position,a=i.itemSize,l=i.array;if(n!=0){const c=Math.cos(n),u=Math.sin(n);for(let p=0;p<l.length;p+=a){const g=l[p],m=l[p+1],y=g*c-m*u,A=g*u+m*c;l[p]=y*r+t.x,l[p+1]=A*r+t.y}}else for(let c=0;c<l.length;c+=a)l[c]=l[c]*r+t.x,l[c+1]+=l[c+1]*r+t.y;return i.needsUpdate=!0,e}static apply3dTransform(e,t,n){const r=e.attributes.position,i=r.itemSize,a=r.array,l=Math.cos(n.x),c=Math.sin(n.x),u=Math.cos(n.y),p=Math.sin(n.y),g=Math.cos(n.z),m=Math.sin(n.z);for(let y=0;y<a.length;y+=i){let A=a[y],w=a[y+1],C=a[y+2],E=w*l-C*c,L=w*c+C*l;w=E,C=L;let O=A*u+C*p;L=-A*p+C*u,A=O,C=L,O=A*g-w*m,E=A*m+w*g,A=O,w=E,a[y]=A+t.x,a[y+1]=w+t.y,a[y+2]=C+t.z}return r.needsUpdate=!0,e}}class e6 extends nn{constructor(e,t,n){super(n);let r;const i=t?t.color:16777215;t?r=this.styleManager.getLineShaderMaterial(t,1):r=new Pa({color:i});const a=e.length,l=new Float32Array(a*3),c=a*2>65535?new Uint32Array(a*2):new Uint16Array(a*2);for(let g=0,m=0;g<a;g++){const y=e[g];l[m++]=y.x,l[m++]=y.y,l[m++]=y.z??0}for(let g=0,m=0;g<a-1;g++)c[m++]=g,c[m++]=g+1;const u=new It;u.setAttribute("position",new Rt(l,3)),u.setIndex(new Rt(c,1)),this.setBoundingBox(u),this.geometry=u;const p=new ms(u,r);ka.computeLineDistances(p),this.add(p)}setBoundingBox(e){e.computeBoundingBox(),this.box=e.boundingBox}}class t6 extends nn{constructor(e,t,n,r,i){super(i);let a;r?a=this.styleManager.getLineShaderMaterial(r,1):a=new Pa({color:16777215});const l=new It;l.setAttribute("position",new Rt(e,t)),l.setIndex(new Rt(n,1)),l.computeBoundingBox(),this.box=l.boundingBox;const c=new ms(l,a);ka.computeLineDistances(c),this.add(c)}}class n6 extends nn{constructor(e,t,n,r=!1){super(n),this._text=e,this._style=t,r||this.syncDraw()}async syncDraw(){const e=Ur.getInstance();if(e)try{const t=this._style;this._mtext=e.syncRenderMText(this._text,t,{byLayerColor:t.byLayerColor,byBlockColor:t.byBlockColor}),this.add(this._mtext),this.flatten(),this.traverse(n=>{n.userData.bboxIntersectionCheck=!0}),this.box=this._mtext.box}catch(t){console.log(`Failed to render mtext '${this._text.text}' with the following error:
`,t)}}async draw(){const e=Ur.getInstance();if(e)try{const t=this._style;this._mtext=await e.asyncRenderMText(this._text,t,{byLayerColor:t.byLayerColor,byBlockColor:t.byBlockColor}).then(n=>{this._mtext=n,this.add(this._mtext),this.flatten(),this.traverse(r=>{r.userData.bboxIntersectionCheck=!0}),this.box=this._mtext.box})}catch(t){console.log(`Failed to render mtext '${this._text.text}' with the following error:
`,t)}}raycast(e,t){var n;(n=this._mtext)==null||n.raycast(e,t)}}const s6=new jt;class r6 extends nn{constructor(e,t,n){super(n);const r=or.instance.create(t.displayMode,e);this.isShowPoint=r.point!=null;const i=r.point??new It().setFromPoints([s6.copy(e)]);i.computeBoundingBox(),i.boundingBox&&this.box.union(i.boundingBox);const a=this.styleManager.getPointsMaterial(t.color),l=new Br(i,a);if(l.userData.bboxIntersectionCheck=!0,l.visible=this.isShowPoint,this.add(l),r.line){const c=r.line;c.computeBoundingBox(),c.boundingBox&&this.box.union(c.boundingBox);const u=this.styleManager.getLineBasicMaterial(t.color),p=new ms(c,u);p.userData.bboxIntersectionCheck=!0,p.userData.isPoint=!0,p.userData.position={x:e.x,y:e.y,z:e.z},this.add(p)}}}class i6 extends nn{constructor(e,t,n){var r;super(n);const i=e.getPoints(100),a=e.buildHierarchy(),l=[];this.buildHatchGeometry(i,a,l);let c;if(l.length>0&&(c=e1(l)),!c||!c.getIndex()||((r=c.getIndex())==null?void 0:r.count)===0)console.warn("Failed to convert hatch boundaries!");else{c.computeBoundingBox(),this.box=c.boundingBox;const u=this.styleManager.getHatchShaderMaterial(t,new en(0,0));this.add(new Zn(c,u))}}buildHatchGeometry(e,t,n){if(t.children.length===0)return;const r=[],i=new Map;t.children.forEach(c=>{c.children.length===0?r.push(c.index):i.set(c.index,c.children.map(u=>u.index))});const a=c=>{try{const u=new ba(c);u.hasAttribute("uv")&&u.deleteAttribute("uv"),u.hasAttribute("normal")&&u.deleteAttribute("normal"),n.push(u)}catch{console.warn(`Triangulate shape error: ${c.getPoints().map(u=>u.toArray()).toString()}`)}};r.forEach(c=>{const u=e[c];if(u.length===0)return;const p=new va(u);a(p)});const l=c=>c.map(u=>u.toArray());for(const c of i){const u=new va(e[c[0]]);let p={regions:[],inverted:!1};const g=this.findIntersectHole(e,c[1]);g.forEach(y=>{let A={segments:[],inverted:!1},w=1e-6;try{y.forEach((C,E)=>{w=Math.min(e[C][0].relativeEps(),1e-6);const L=new T0(new E0(w));if(E===0)A=L.segments({regions:[l(e[C])],inverted:!1});else{const O=L.segments({regions:[l(e[C])],inverted:!1}),F=L.combine(A,O);p=L.polygon(L.selectUnion(F)),p.regions.length>0?p.regions.forEach(B=>{if(B.length===0)return;const Z=B.map(W=>new en(W[0],W[1]));u.holes.push(new su(Z))}):console.warn("mergedHoles.regions is empty!")}})}catch(C){console.warn(`Polybool error: ${C}, epsilon is ${w}`)}});const m=g.flat(2);for(let y=0;y<c[1].length;y++){const A=c[1][y];m.includes(A)||u.holes.push(new su(e[A]))}a(u)}t.children.forEach(c=>{c.children.forEach(u=>{this.buildHatchGeometry(e,u,n)})})}findIntersectHole(e,t){const n=t.length,r=[];for(let i=0;i<n;i++){const a=e[t[i]];let l=!1;const c=[];for(let u=i+1;u<n;u++){const p=e[t[u]];Mp.isPolygonIntersect(a,p)&&(l=!0,c.push(t[u]))}l&&(c.push(t[i]),r.push(c))}return r}}function a6(s,e,t,n,r=0){const i={u_cameraZoom:t,u_patternLines:{value:s},u_patternAngle:{value:e},u_color:{value:n}},a=`
        varying vec3 v_pos;

        #include <clipping_planes_pars_vertex>
        void main() {
            //vec4 worldPosition = modelMatrix * vec4(position, 1.0);
            v_pos = position;

            #include <begin_vertex>
            #include <project_vertex>
            #include <clipping_planes_vertex>
        }`,l=`
        uniform mat4 modelMatrix;
        uniform float u_cameraZoom;
        uniform vec3 u_color;
        varying vec3 v_pos;

        struct PatternLine {
            vec2 origin;
            vec2 delta;
            float angle;
            float pattern[MAX_PATTERN_SEGMENT_COUNT];
            float patternSum[MAX_PATTERN_SEGMENT_COUNT+1];
            float patternLength;
        };

        uniform PatternLine u_patternLines[${s.length}];
        uniform float u_patternAngle;

        #include <clipping_planes_pars_fragment>

        // Clamp [0..1] range
        #define saturate(a) clamp(a, 0.0, 1.0)

        const float EPS = 1000.0;

        vec2 getWorldScale() {
            return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));
        }

        vec2 rotate(vec2 st, float rotation) {
            const float PI = 3.1415926;
            float angle = rotation * PI/180.0;
            float sine = sin(angle), cosine = cos(angle);
            return vec2(cosine * st.x - sine * st.y, cosine * st.y + sine * st.x);
        }

        vec2 translate(vec2 samplePosition, vec2 offset) {
            //move sample point in the opposite direction that we want to move shapes in
            return samplePosition - offset;
        }

        vec2 scale(vec2 samplePosition, float scale) {
            return samplePosition / scale;
        }

        float sdfLine(vec2 st, vec2 a, vec2 b) {
            vec2 ap = st - a;
            vec2 ab = b - a;
            return abs(((ap.x * ab.y) - (ab.x * ap.y))) / length(ab);
        }

        float drawSpaceLine(vec2 st, float distanceBetweenLines, float thick) {
            float dist = sdfLine(st , vec2(0.0, 0.0) , vec2(1.0, 0.0));

            //vec2 tt = dFdy(st);
            //float scale = (abs(tt.x)+abs(tt.y))/2.0;
            //float scale = length(fwidth(st)) * 0.5;
            // close to a pixel
            //float thick = 2.0;
            //thick = (thick * 0.5 - 0.5) * scale;

            float lineDistance = abs(fract(dist / distanceBetweenLines + 0.5) - 0.5) * distanceBetweenLines;
            //float lineDistance = fract(dist / distanceBetweenLines);
            //float distanceChange = fwidth(dist) * 0.5;
            //float threshold = smoothstep(thick - distanceChange, thick + distanceChange, lineDistance);
            //float threshold = step(thick, lineDistance);
            // remove gradient
            //float threshold = step(0.001, lineDistance);
            float threshold = step(thick, lineDistance);

            return threshold;
        }

        float drawSolidLine(PatternLine patternLine, float thick) {
            vec2 origin = patternLine.origin;
            vec2 delta = patternLine.delta;
            float distanceBetweenLines = length(delta);

            origin = rotate(origin,u_patternAngle);
            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));

            return drawSpaceLine(st, distanceBetweenLines , thick);
        }

        int getPatternIndex(PatternLine patternLine, float u, out float distance ) {
            //u = mod(u, patternLine.patternLength);
            float y = floor(u/patternLine.patternLength);
            u = u - patternLine.patternLength * y;
            //float distance = 0.0;

            #pragma unroll_loop_start
            for(int i = 1; i < patternLine.patternSum.length(); i++){
                if(u <= patternLine.patternSum[i]) {
                    distance = u - patternLine.patternSum[i-1];
                    return i - 1;
                }
            }
            #pragma unroll_loop_end

            return -1;
        }

        float drawDashedLine(PatternLine patternLine, float thick){
            float threshold = 1.0;
            vec2 origin = patternLine.origin;
            vec2 delta = patternLine.delta;        
            float distanceBetweenLines = abs(delta.y);

            origin = rotate(origin, u_patternAngle);
            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));

            float offsetX = st.y * delta.x/delta.y;
            float u = st.x - offsetX;
            float distance = 0.0;
            int index = getPatternIndex(patternLine, u, distance);
            if(index < 0) {
                return threshold;
            }

            float size = patternLine.pattern[index];
            if(size >= 0.0) {
                threshold = drawSpaceLine(st, distanceBetweenLines , thick);
                // Try to solve the problem caused by the precision after zooming out by drawing a part of the dashed line
            } else if (distance < thick) {
                //threshold = 0.8;
                threshold = drawSpaceLine(st, distanceBetweenLines , thick);
            }

            return threshold;
        }

        float drawLine(PatternLine patternLine, float thick) {
            float t = 0.0;
            if(patternLine.patternLength > 0.0) {
                t = drawDashedLine(patternLine, thick);
            } else {
                t = drawSolidLine(patternLine, thick);
            }
            return t;
        }

        void main() {
            #include <clipping_planes_fragment>

            // Idealy, the thickness of lines in hatch pattern should always be 1 pixel.
            // In Viewer2d, it uses orthographic camera and always in top view,
            // so we adjust thickness by cameraZoom (and also consider worldScale).
            // While 3d view is more complex, it can use perspective camera,
            // its camera position and direction is flexible. We cannot keep line thickness
            // in a fixed pixel any more, and there is no proper way to adjust thickness as camera
            // position changes. So, we need to use a fixed thickness in world coordinates.
#if ${r} > 0
            float thick = float(${r});
#else
            vec2 worldScale = getWorldScale();
            float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;
            // possible size of a pixel 
            float thick = (0.7 / averageScale) / u_cameraZoom;
#endif

            if(thick > EPS) {
                gl_FragColor = vec4(u_color, 1.0);
                #include <colorspace_fragment>
                return;
            }

            float total = 0.0;

#if ${s.length} > 1
            #pragma unroll_loop_start
            for (int i = 0; i < u_patternLines.length(); i++) {
                PatternLine pl = u_patternLines[i];
                float t = drawLine(pl, thick);
                total += (1.0 - t);
            }
            #pragma unroll_loop_end
#else
            float t = drawLine(u_patternLines[0], thick);
            total += (1.0 - t);
#endif

            total = saturate(total);
            if (total < 0.001) {
                discard;
            }

            gl_FragColor = vec4(u_color * total, 1.0);
            #include <colorspace_fragment>
        }
        `;return new Xc({uniforms:i,vertexShader:a,fragmentShader:l,clipping:!0})}class o6{static createLineShaderMaterial(e,t,n,r,i){let a=0;const l=[];for(let g=0;g<e.length;g++)l[g]=e[g].elementLength*n,a+=Math.abs(l[g]);for(let g=0;g<l.length;g++)l[g]===0&&(l[g]=a*.01*n,a+=l[g]);const c=l1.merge([c1.common,{pattern:{value:l},patternLength:{value:a},u_color:{value:new Dr(t)}}]);c.u_viewportScale=r,c.u_cameraZoom=i;const u=`
            attribute float lineDistance;
            varying float vLineDistance;

            #include <clipping_planes_pars_vertex>

            void main() {
                vLineDistance = lineDistance;

                #include <begin_vertex>
                #include <project_vertex>
                #include <clipping_planes_vertex>
            }`,p=`
            uniform mat4 modelMatrix;
            uniform vec3 diffuse;
            uniform vec3 u_color;
            uniform float opacity;
            uniform float pattern[${e.length}];
            uniform float patternLength;
            uniform float u_viewportScale;
            uniform float u_cameraZoom;
            varying float vLineDistance;

            #include <clipping_planes_pars_fragment>

            vec2 getWorldScale() {
                return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));
            }

            void main() {

                #include <clipping_planes_fragment>

                // vec2 worldScale = getWorldScale();
                // float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;
                // When zoomed out to a certain extent, it is displayed as a solid line.
                if(patternLength * u_viewportScale * u_cameraZoom/1.5 < 1.0){
                    gl_FragColor = vec4(u_color, opacity);
                    #include <colorspace_fragment>
                    return;
                }

                float pos = mod(vLineDistance, patternLength * u_viewportScale);

                for ( int i = 0; i < ${e.length}; i++ ) {
                    pos = pos - abs(pattern[i] * u_viewportScale);
                    if ( pos < 0.0 ) {
                        if ( pattern[i] > 0.0 ) {
                            gl_FragColor = vec4(u_color, opacity);
                            break;
                        }
                        discard;
                    }
                }
                #include <colorspace_fragment>
            }`;return new Xc({uniforms:c,vertexShader:u,fragmentShader:p,clipping:!0})}}const Go=class ha{constructor(){this.pointMaterials={},this.lineShaderMaterials={},this.lineBasicMaterials={},this.hatchShaderMaterials=[],this.meshBasicMaterials={},this.unsupportedTextStyles={}}getPointsMaterial(e,t=2){const n=`${e}_${t}`;return this.pointMaterials[n]||(this.pointMaterials[n]=new Q0({size:t,color:e})),this.pointMaterials[n]}getMeshBasicMaterial(e){return this.meshBasicMaterials[e]||(this.meshBasicMaterials[e]=new qc({color:e})),this.meshBasicMaterials[e]}getLineBasicMaterial(e){return this.lineBasicMaterials[e]||(this.lineBasicMaterials[e]=new Pa({color:e})),this.lineBasicMaterials[e]}getLineShaderMaterial(e,t){if(e.pattern&&e.pattern.length!==0){const n=`${e.name}_${e.color}_${t}`;return this.lineShaderMaterials[n]||(this.lineShaderMaterials[n]=o6.createLineShaderMaterial(e.pattern,e.color,t,ha.ViewportScaleUniform,ha.CameraZoomUniform)),this.lineShaderMaterials[n]}else return this.getLineBasicMaterial(e.color)}getHatchShaderMaterial(e,t){if(!e.patternLines||e.patternLines.length<1)return this.getMeshBasicMaterial(e.color);let n=!1;if(e.patternLines.forEach(m=>{m.dashPattern||(n=!0,console.log("Invalid dash pattern: ",e))}),n)return;const r=this.findMatchedHatchShaderMaterial(e);if(r)return r;const i=.005,a=.05;let l=2;e.patternLines.forEach(m=>{l=Math.max(m.dashPattern.length,l)});let c=0;const u=[],p=new en;for(const m of e.patternLines){const y=new en(m.origin.x,m.origin.y).sub(t).rotateAround(p,-nu.degToRad(e.patternAngle)),A=new en(m.delta.x,m.delta.y).rotateAround(p,-nu.degToRad(m.angle));if(A.y===0){console.warn("delta.y is equal to zero!");return}const w=m.dashPattern.length;let C=!0,E=0;for(let W=0;W<w;++W){const Q=m.dashPattern[W];Q>0&&(C=!1),E+=Math.abs(Q)}const L=C?a:i,O=[],F=[];let B=0;F[0]=B;for(let W=0;W<w;++W)O[W]=m.dashPattern[W],O[W]===0&&(O[W]=L*E),B+=Math.abs(O[W]),F[W+1]=B;for(let W=w;W<l;++W)O[W]=0;for(let W=F.length;W<l+1;++W)F[W]=B;const Z={origin:y,delta:A,angle:m.angle-e.patternAngle,pattern:O,patternSum:F,patternLength:B};if(c+=4,c+=l,c+=l+1,c>ha.MaxFragmentUniforms){console.warn("There will be warning in fragment shader when number of uniforms exceeds 1024, so extra hatch line patterns are ignored here!");break}u.push(Z)}const g=a6(u,e.patternAngle,ha.CameraZoomUniform,new Dr(e.color));return g.defines={MAX_PATTERN_SEGMENT_COUNT:l},this.hatchShaderMaterials.push({patternLines:e.patternLines,patternAngle:e.patternAngle,color:e.color,material:g}),g}findMatchedHatchShaderMaterial(e){const t=e.patternLines;if(!t||t.length<1)return;const n=(c,u)=>Math.abs(c-u)<1e-5,r=(c,u)=>{if(c.length!==u.length)return!1;for(let p=0;p<c.length;++p)if(!n(c[p],u[p]))return!1;return!0},i=(c,u)=>n(c.angle,u.angle)&&n(c.delta.x,u.delta.x)&&n(c.delta.y,u.delta.y)&&n(c.origin.x,u.origin.x)&&n(c.origin.y,u.origin.y)&&r(c.dashPattern,u.dashPattern),a=(c,u)=>{if(c.length!==u.length)return!1;for(let p=0;p<c.length;++p)if(!i(c[p],u[p]))return!1;return!0},l=this.hatchShaderMaterials.find(c=>c.color===e.color&&c.patternAngle===e.patternAngle&&a(c.patternLines,t));return l==null?void 0:l.material}};Go.CameraZoomUniform={value:1},Go.ViewportScaleUniform={value:1},Go.MaxFragmentUniforms=1024;let l6=Go;class c6{constructor(e){this.events={fontNotFound:new lt},this._renderer=e,this._styleManager=new l6,un.instance.events.fontNotFound.addEventListener(t=>{this.events.fontNotFound.dispatch(t)})}get autoClear(){return this._renderer.autoClear}set autoClear(e){this._renderer.autoClear=e}get domElement(){return this._renderer.domElement}get basePoint(){return this._basePoint}set basePoint(e){e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e)}setSize(e,t){this._renderer.setSize(e,t)}getViewport(e){return this._renderer.getViewport(e)}setViewport(e,t,n,r){this._renderer.setViewport(e,t,n,r)}clear(){this._renderer.clear()}clearDepth(){this._renderer.clearDepth()}render(e,t){this._renderer.render(e,t.internalCamera)}setClearColor(e,t){this._renderer.setClearColor(e,t)}getClearColor(){const e=new Dr;return this._renderer.getClearColor(e),e.getHex()}setClearAlpha(e){this._renderer.setClearAlpha(e)}getClearAlpha(){return this._renderer.getClearAlpha()}get internalRenderer(){return this._renderer}setFontMapping(e){un.instance.setFontMapping(e)}get missedFonts(){return un.instance.missedFonts}clearMissedFonts(){un.instance.missedFonts={}}createObject(){return new I0(this._styleManager)}createEntity(){return new nn(this._styleManager)}group(e){return new cl(e,this._styleManager)}point(e,t){return new r6(e,t,this._styleManager)}circularArc(e,t){return this.linePoints(e.getPoints(100),t)}ellipticalArc(e,t){return this.linePoints(e.getPoints(100),t)}lines(e,t){return this.linePoints(e,t)}lineSegments(e,t,n,r){return new t6(e,t,n,r,this._styleManager)}area(e,t){return new i6(e,t,this._styleManager)}mtext(e,t,n){return new n6(e,t,this._styleManager,n)}image(e,t){return new J5(e,t,this._styleManager)}linePoints(e,t=void 0){return new e6(e,t,this._styleManager)}}class h6{constructor(e){this._camera=e}get position(){return this._camera.position}get left(){return this._camera.left}set left(e){this._camera.left=e}get right(){return this._camera.right}set right(e){this._camera.right=e}get top(){return this._camera.top}set top(e){this._camera.top=e}get bottom(){return this._camera.bottom}set bottom(e){this._camera.bottom=e}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e}get internalCamera(){return this._camera}lookAt(e){this._camera.lookAt(e)}setRotationFromEuler(e){this._camera.setRotationFromEuler(e)}updateProjectionMatrix(){this._camera.updateProjectionMatrix()}cwcs2Wcs(e,t,n){const r=new jt(e.x,e.y,0);r.x=e.x/t*2-1,r.y=-(e.y/n)*2+1;const i=r.unproject(this._camera);return new je(i.x,i.y)}wcs2Cwcs(e,t,n){const r=new jt(e.x,e.y,0).project(this._camera);return new je((r.x+1)/2*t,(-r.y+1)/2*n)}wcs2Ndc(e,t,n){const r=this.wcs2Cwcs(e,t,n);return this.cwcs2Ndc(r,t,n)}cwcs2Ndc(e,t,n){return new je(e.x/t*2-1,-(e.y/n)*2+1)}}class k0{constructor(e,t,n){this._frustum=400,this.events={viewChanged:new lt},this._renderer=e,this._width=t,this._height=n;const r=this.createCamera();this._camera=new h6(r),this._cameraControls=this.createCameraControls(),this._cameraControls.addEventListener("change",()=>{this.events.viewChanged.dispatch({view:this})}),this._raycaster=new r1}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get enabled(){return this._cameraControls.enabled}set enabled(e){this._cameraControls.enabled=e}get center(){return this._camera.cwcs2Wcs({x:this._width/2,y:this._height/2},this._width,this._height)}set center(e){this._camera.position.set(e.x,e.y,this._camera.position.z),this._camera.updateProjectionMatrix()}cwcs2Wcs(e){return this._camera.cwcs2Wcs(e,this._width,this._height)}wcs2Cwcs(e){return this._camera.wcs2Cwcs(e,this._width,this._height)}pointToBox(e,t){const n=this.wcs2Cwcs(e),r=this.cwcs2Wcs({x:n.x+t,y:n.y+t}),i=this.cwcs2Wcs({x:n.x-t,y:n.y-t});return new Ct().setFromPoints([r,i])}resetRaycaster(e,t){const n=this._camera.wcs2Ndc(e,this._width,this._height);return this._raycaster.setFromCamera(new en(n.x,n.y),this._camera.internalCamera),this._raycaster.params.Line.threshold=t,this._raycaster.params.Points.threshold=t,this._raycaster}zoomTo(e,t=1.1){const n=new xt;e.getSize(n);const r=new xt;e.getCenter(r);const i=new jt(r.x,r.y,0);this._camera.position.set(r.x,r.y,this._camera.position.z),this._camera.lookAt(i),this._camera.setRotationFromEuler(new i1(0,0,0));const a=n.x*t,l=n.y*t,c=this._width/a,u=this._height/l;this._camera.zoom=Math.min(c,u),this._cameraControls.target=i,this.updateCameraFrustum()}updateCameraFrustum(e,t){const n=(e??this._width)/(t??this._height);this._camera.left=-n*this._frustum,this._camera.right=n*this._frustum,this._camera.top=this._frustum,this._camera.bottom=-this._frustum,this._camera.updateProjectionMatrix(),this._cameraControls.update()}createCamera(){const e=new lp(-this._width/2,this._width/2,this._height/2,-this._height/2,.1,1e3);return e.position.set(0,0,500),e.up.set(0,1,0),e.updateProjectionMatrix(),e}createCameraControls(){const e=new a1(this._camera.internalCamera,this._renderer.domElement);return e.enableDamping=!1,e.autoRotate=!1,e.enableRotate=!1,e.zoomSpeed=5,e.mouseButtons={MIDDLE:pc.PAN},e.update(),e}}class Jo extends k0{static calculateViewportWindowBox(e,t){const n=t.box,r=new Ct;return r.expandByPoint(e.wcs2Cwcs(n.min)),r.expandByPoint(e.wcs2Cwcs(n.max)),r}constructor(e,t,n){const r=Jo.calculateViewportWindowBox(e,t).size;super(n,r.width,r.height),this._parentView=e,this._viewport=t.clone(),this._frustum*=t.height/e.height,this.zoomTo(this._viewport.viewBox),this.enabled=!1}get viewport(){return this._viewport}update(){this.zoomTo(this._viewport.viewBox)}render(e){const t=Jo.calculateViewportWindowBox(this._parentView,this._viewport);if(!t.isEmpty()){const n=this._parentView.height-t.min.y-t.size.height;this._renderer.setViewport(t.min.x,n,t.size.width,t.size.height),this._renderer.internalRenderer.setScissor(t.min.x,n,t.size.width,t.size.height),this._renderer.internalRenderer.setScissorTest(!0),this._renderer.render(e,this._camera),this._renderer.internalRenderer.setScissorTest(!1)}}}class u6 extends bm{constructor(e,t){super(e),this._circle=new el(t,0)}get entity(){return this._circle}update(e){this._circle.radius=e}}class d6 extends Rn{async execute(e){const t=new Sa(dn.t("jig.circle.center")),n=await Nt.instance.editor.getPoint(t),r=new Fb(dn.t("jig.circle.radius"));r.jig=new u6(e.view,n);const i=await Nt.instance.editor.getDistance(r),a=e.doc.database,l=new el(n,i);a.tables.blockTable.modelSpace.appendEntity(l)}}class hl{constructor(){this._objectId="",this._ownerId="",this._layerName="",this._visible=!0,this._userData={},this._box=new Ct,this._svg=""}get box(){return this._box}set box(e){this._box.copy(e)}get basePoint(){return this._basePoint}set basePoint(e){e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e)}get svg(){return this._svg}set svg(e){this._svg=e}get objectId(){return this._objectId}set objectId(e){this._objectId=e}get ownerId(){return this._ownerId}set ownerId(e){this._ownerId=e}get layerName(){return this._layerName}set layerName(e){this._layerName=e}get visible(){return this._visible}set visible(e){this._visible=e}get userData(){return this._userData}set userData(e){this._userData=e}applyMatrix(e){}recomputeBoundingBox(){}highlight(){}unhighlight(){}fastDeepClone(){return this}}class p6 extends hl{constructor(e){if(super(),e.closed)this.svg=`
<circle cx="${e.center.x}" cy="${e.center.y}" r="${e.radius}"/>`;else{const n=e.startPoint,r=e.endPoint,i=e.clockwise?0:1;this.svg=`
<path d="M${n.x},${n.y} A${e.radius},${e.radius} 0 ${e.isLargeArc},${i} ${r.x},${r.y}"/>`}const t=e.box;this._box.min.copy(t.min),this._box.max.copy(t.max)}}class f6 extends hl{constructor(e){if(super(),e.closed)this.svg=`
<epllise cx="${e.center.x}" cy="${e.center.y}" rx="${e.majorAxisRadius}" ry="${e.minorAxisRadius}"/>`;else{const n=e.startPoint,r=e.endPoint,i=st.radToDeg(e.majorAxis.angleTo(oe.X_AXIS)),a=e.clockwise?0:1;this.svg=`
<path d="M${n.x},${n.y} A${e.majorAxisRadius},${e.minorAxisRadius} ${i} ${e.isLargeArc},${a} ${r.x},${r.y}"/>`}const t=e.box;this._box.min.copy(t.min),this._box.max.copy(t.max)}}class g6 extends hl{constructor(e){super();const t=e.reduce((n,r,i)=>(n+=i===0?"M":"L",n+=r.x+","+r.y,this.box.expandByPoint(r),n),"");t&&(this.svg=`<path d="${t}" />`)}}class m6{constructor(){this._container=new Array,this._bbox=new Ct}get basePoint(){return this._basePoint}set basePoint(e){e==null?this._basePoint=e:this._basePoint=this._basePoint?this._basePoint.copy(e):new te(e)}setFontMapping(e){}group(e){return bi}point(e){return bi}circularArc(e){const t=new p6(e);return this._container.push(t.svg),this._bbox.union(t.box),t}ellipticalArc(e){const t=new f6(e);return this._container.push(t.svg),this._bbox.union(t.box),t}lines(e,t){const n=new g6(e);return this._container.push(n.svg),this._bbox.union(n.box),n}lineSegments(e,t,n,r){return bi}area(e){return bi}mtext(e,t,n){return bi}image(e,t){return bi}export(){const e=this._container.join(`
`),t=this._bbox.isEmpty()?{x:0,y:0,width:0,height:0}:{x:this._bbox.min.x,y:-this._bbox.max.y,width:this._bbox.max.x-this._bbox.min.x,height:this._bbox.max.y-this._bbox.min.y};return`<?xml version="1.0"?>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
      preserveAspectRatio="xMinYMin meet"
      viewBox="${t.x} ${t.y} ${t.width} ${t.height}"
      width="100%" height="100%"
    >
      <g stroke="#000000" stroke-width="0.1%" fill="none" transform="matrix(1,0,0,-1,0,0)">
        ${e}
      </g>
    </svg>`}}const bi=new hl;class y6{convert(){const e=Nt.instance.curDocument.database.tables.blockTable.modelSpace.newIterator(),t=new m6;for(const n of e)n.draw(t);this.createFileAndDownloadIt(t.export())}createFileAndDownloadIt(e){const t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="example.svg",document.body.appendChild(r),r.click()}}class v6 extends Rn{execute(e){new y6().convert()}}class b6 extends bm{constructor(e,t,n){super(e),this._db=t,this._dim=new oh(n,n,n),this._dim.rotation=0}get entity(){return this._dim}update(e){this._dim.xLine2Point=e,this._dim.rotation=this.calculateAngle(this._dim.xLine2Point,this._dim.xLine1Point),this._dim.dimLinePoint=this.calculateDimPoint(100);const t="*UDIM";this.updateBlock(t),this._dim.dimBlockId=t}updateBlock(e){this._db.tables.blockTable.remove(e);const t=new Zt;return t.name=e,this.createLines().forEach(n=>t.appendEntity(new sh(n.startPoint,n.endPoint))),this._db.tables.blockTable.add(t),t}calculateDimPoint(e){const t=this._dim.rotation+Math.PI/2;return{...this.findPointOnLine(this._dim.xLine1Point,t,e),z:0}}calculateAngle(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)}adjustExtensionLine(e){e.extend(10),e.extend(-10,!0)}createLines(){const e=[],t=this.createExtensionLine(this._dim.xLine1Point),n=this.createExtensionLine(this._dim.xLine2Point),r=this.findIntersectionPoint(t,this._dim.dimLinePoint),i=this.findIntersectionPoint(n,this._dim.dimLinePoint),a=new wa(r,i);return e.push(a),t.endPoint=r,this.adjustExtensionLine(t),e.push(t),n.endPoint=i,this.adjustExtensionLine(n),e.push(n),e}findPointOnLine(e,t,n){const r=e.x+n*Math.cos(t),i=e.y+n*Math.sin(t);return{x:r,y:i}}createExtensionLine(e){const t=this._dim.rotation+Math.PI/2,n=this.findPointOnLine(e,t,200);return new wa(e,{...n,z:e.z})}findIntersectionPoint(e,t){const n=e.startPoint,r=e.endPoint,i=new oe().subVectors(r,n).normalize(),a=new oe().subVectors(t,n).dot(i),l=new oe().copy(i).multiplyScalar(a);return new oe().addVectors(n,l)}}class _6 extends Rn{async execute(e){const t=new Sa(dn.t("jig.circle.center")),n=await Nt.instance.editor.getPoint(t),r=new Sa(dn.t("jig.circle.center"));r.jig=new b6(e.view,e.doc.database,n),await Nt.instance.editor.getPoint(r)}}class x6 extends Rn{execute(e){this.printSelectionSet(e),this.printStats(e),this.printPerformanceData()}printSelectionSet(e){const t=e.doc.database.tables.blockTable.modelSpace;e.view.selectionSet.ids.forEach(n=>{const r=t.getIdAt(n);r&&console.log(r)})}printStats(e){const t=e.view.stats.layouts;console.log("Geometry information in current drawing:");for(let n=0;n<t.length;++n){console.group(`Layout: ${n}`);const r=t[n],i=[0,0,0,0,0,0],a=[0,0,0,0,0,0],l=r.layers.map(c=>(i[0]=c.line.indexed.geometrySize/1024,i[1]=c.line.nonIndexed.geometrySize/1024,i[2]=c.mesh.indexed.geometrySize/1024,i[3]=c.mesh.nonIndexed.geometrySize/1024,i[4]=c.point.indexed.geometrySize/1024,i[5]=c.point.nonIndexed.geometrySize/1024,a[0]+=i[0],a[1]+=i[1],a[2]+=i[2],a[3]+=i[3],a[4]+=i[4],a[5]+=i[5],{name:c.name,"idx line (KB)":i[0].toFixed(1),"line (KB)":i[1].toFixed(1),"idx mesh (KB)":i[2].toFixed(1),"mesh (KB)":i[3].toFixed(1),"idx point (KB)":i[4].toFixed(1),"point (KB)":i[5].toFixed(1),"total geo (KB)":(c.summary.totalGeometrySize/1024).toFixed(1),"total mapping (KB)":(c.summary.totalMappingSize/1024).toFixed(1)}));l.push({name:"total","idx line (KB)":a[0].toFixed(1),"line (KB)":a[1].toFixed(1),"idx mesh (KB)":a[2].toFixed(1),"mesh (KB)":a[3].toFixed(1),"idx point (KB)":a[4].toFixed(1),"point (KB)":a[5].toFixed(1),"total geo (KB)":(r.summary.totalSize.geometry/1024).toFixed(1),"total mapping (KB)":(r.summary.totalSize.mapping/1024).toFixed(1)}),console.table(l),console.groupEnd()}}printPerformanceData(){Zc.getInstance().printAll()}}class w6 extends Rn{execute(e){Fr.emit("open-file",{})}}class S6 extends Rn{execute(e){const t=Nt.instance.baseUrl;Nt.instance.openUrl(t+"templates/acadiso.dxf")}}class A6 extends Rn{execute(){Nt.instance.regen()}}class E6 extends Rn{execute(e){e.view.mode=hr.SELECTION,e.view.setCursor(Ra.Crosshair)}}class T6 extends Rn{async execute(e){const t=new zb(dn.t("jig.sysvar.prompt")),n=await Nt.instance.editor.getString(t),r=fh.instance();r.getDescriptor(this.globalName)&&r.setVar(this.globalName,n)}}class I6 extends Rn{execute(e){e.view.zoomToFit()}}class C6 extends Rn{async execute(e){const t=await Nt.instance.editor.getSelection();return e.view.zoomTo(t,1)}}class k6 extends Rn{execute(e){e.view.mode=hr.PAN,e.view.setCursor(Ra.Grab)}}const M6=s=>new at(s.min,s.max),P6=s=>new Ct(s.min,s.max),L6=s=>new Ft(s.min,s.max),O6=s=>new Ct(s.min,s.max),D6=s=>new ip(s.min,s.max),B6=s=>new Ct(s.min,s.max),N6=s=>{const e=new Ft;return e.min.set(s.min.x,s.min.y,0),e.max.set(s.max.x,s.max.y,0),e},R6={threeBo2dToGeBox2d:O6,geBox2dToThreeBox2d:D6,threeBox3dToGeBox3d:M6,geBox3dToThreeBox3d:L6,goBox3dToGeBox2d:P6,threeBox3dToGeBox2d:B6,geBox2dToThreeBox3d:N6};var ul=(s=>(s[s.LEFT_BOTTOM=0]="LEFT_BOTTOM",s[s.LEFT_TOP=1]="LEFT_TOP",s[s.RIGHT_TOP=2]="RIGHT_TOP",s[s.RIGHT_BOTTOM=4]="RIGHT_BOTTOM",s))(ul||{});class F6 extends Yc{constructor(e,t,n=150,r=2){super(),this.camera=e,this.renderer=t,this.gizmoCamera=new lp(-2,2,2,-2,0,4),this.gizmoCamera.position.set(0,0,2),this.gizmoDim=n,this.gizmoPos=r,this.initialize()}initialize(){}update(){this.updateOrientation();const e=this.renderer.autoClear;this.renderer.autoClear=!1,this.renderer.clearDepth();const t=new ap;this.renderer.getViewport(t);const n=this.calculateViewportPos();this.renderer.setViewport(n.x,n.y,this.gizmoDim,this.gizmoDim),this.renderer.render(this,this.gizmoCamera),this.renderer.setViewport(t.x,t.y,t.z,t.w),this.renderer.autoClear=e}dispose(){}updateOrientation(){this.quaternion.copy(this.camera.quaternion).invert(),this.updateMatrixWorld()}calculatePosInViewport(e,t,n){const r=(e-n.min.x)/this.gizmoDim*2-1,i=-((t-n.min.y)/this.gizmoDim)*2+1;return{x:r,y:i}}calculateViewportPos(){const e=this.renderer.domElement,t=e.offsetWidth,n=e.offsetHeight,r=this.gizmoPos,i=this.gizmoDim;let a=t-i,l=n-i;switch(r){case 0:a=0,l=0;break;case 1:a=0;break;case 4:l=0;break}return{x:a,y:l}}calculateViewportBbox(){const e=this.renderer.domElement,t=e.offsetWidth,n=e.offsetHeight,r=this.gizmoPos,i=this.gizmoDim,a=new ip(new en(t-i,0),new en(t,i));switch(r){case 0:a.set(new en(0,n-i),new en(i,n));break;case 1:a.set(new en(0,0),new en(i,i));break;case 4:a.set(new en(t-i,n-i),new en(t,n));break}return a}}function z6(s,e){const t=e.font||"Helvetica",n=e.fontSize||30,r=e.width||200,i=e.height||200,a=e.bgColor?e.bgColor.join(", "):"255, 255, 255, 1.0",l=e.color?e.color.join(", "):"0, 0, 0, 1.0",c=document.createElement("canvas");c.width=r,c.height=i;const u=c.getContext("2d");if(u){u.font=`bold ${n}px ${t}`,u.fillStyle=`rgba(${a})`,u.fillRect(0,0,r,i);const g=u.measureText(s).width;u.fillStyle=`rgba(${l})`,u.fillText(s,r/2-g/2,i/2+n/2-2)}const p=new p1(c);return p.minFilter=f1,p.needsUpdate=!0,p}function hc(s){const e=z6(s,{fontSize:100,font:"Arial Narrow, sans-serif",color:[255,255,255,1],bgColor:[0,0,0,0]}),t=new u1({map:e,transparent:!0});return new d1(t)}ul.RIGHT_TOP;const U6={pos:ul.LEFT_BOTTOM,size:100,hasZAxis:!0};class G6 extends F6{constructor(e,t,n){const r={...U6,...n};super(e,t,r.size,n.pos),this.hasZAxis=r.hasZAxis;const i=[0,0,0,2,0,0,0,0,0,0,2,0],a=[1,0,0,1,.6,0,0,1,0,.6,1,0];this.hasZAxis&&(i.push(0,0,0,0,0,2),a.push(0,0,1,0,.6,1));const l=new It;l.setAttribute("position",new _a(i,3)),l.setAttribute("color",new _a(a,3));const c=new Pa({vertexColors:!0,toneMapped:!1});this.axes=new ms(l,c),this.axes.position.set(-1,-1,-1),this.add(this.axes),this.xText=hc("X"),this.xText.position.set(1.5,-1,-1),this.add(this.xText),this.yText=hc("Y"),this.yText.position.set(-1,1.5,-1),this.add(this.yText),this.hasZAxis&&(this.zText=hc("Z"),this.zText.position.set(-1,-1,1.5),this.add(this.zText))}setLineColors(e,t){const n=new Dr,r=this.axes.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),this.axes.geometry.attributes.color.needsUpdate=!0,this}setTextColor(e){this.xText.material.color=e,this.yText.material.color=e}dispose(){var e,t;this.axes.geometry.dispose(),this.axes.material.dispose(),this.xText.geometry.dispose(),this.xText.material.dispose(),this.yText.geometry.dispose(),this.yText.material.dispose(),this.hasZAxis&&((e=this.zText)==null||e.geometry.dispose(),(t=this.zText)==null||t.material.dispose())}}class V6 extends k0{constructor(e,t,n,r){super(e,n,r),this._layoutBtrId=t,this._mode=hr.SELECTION,this._axesGizmo=this.createAxesGizmo(),this._viewportViews=new Map}get layoutBtrId(){return this._layoutBtrId}get mode(){return this._mode}set mode(e){e==hr.SELECTION?this._cameraControls.mouseButtons={MIDDLE:pc.PAN}:e==hr.PAN&&(this._cameraControls.mouseButtons={LEFT:pc.PAN}),this._cameraControls.update(),this._mode=e}get viewportCount(){return this._viewportViews.size}addViewport(e){this._viewportViews.set(e.viewport.id,e)}removeViewport(e){this._viewportViews.delete(e)}resize(e,t){this._height=t,this._width=e,this.updateCameraFrustum(),this._viewportViews.forEach(n=>{n.update()})}render(e){var t;this._renderer.clear(),this._renderer.render(e.internalScene,this._camera);const n=e.modelSpaceLayout;n&&this.drawViewports(n.internalObject),(t=this._axesGizmo)==null||t.update()}createAxesGizmo(){return new G6(this._camera.internalCamera,this._renderer.internalRenderer,{hasZAxis:!1,pos:ul.LEFT_BOTTOM})}drawViewports(e){if(this._viewportViews.size>0){const t=this._renderer.autoClear;this._renderer.autoClear=!1;const n=new ap;this._renderer.getViewport(n),this._renderer.clearDepth();const r=e.visible;e.visible=!0,this._viewportViews.forEach(i=>{i.render(e)}),e.visible=r,this._renderer.setViewport(n.x,n.y,n.z,n.w),this._renderer.autoClear=t}}}class j6{constructor(){this._activeLayoutBtrId="",this._layoutViews=new Map}get activeLayoutBtrId(){return this._activeLayoutBtrId}set activeLayoutBtrId(e){this._activeLayoutBtrId=e,this._layoutViews.forEach(t=>{t.enabled=t.layoutBtrId==e})}get activeLayoutView(){return this._layoutViews.get(this._activeLayoutBtrId)}has(e){return this._layoutViews.has(e)}getAt(e){return this._layoutViews.get(e)}resize(e,t){this._layoutViews.forEach(n=>{n.resize(e,t)})}add(e){this._layoutViews.set(e.layoutBtrId,e)}render(e){var t;(t=this.activeLayoutView)==null||t.render(e)}}function M0(s,e,t=0,n=s.length-1,r=$6){for(;n>t;){if(n-t>600){const c=n-t+1,u=e-t+1,p=Math.log(c),g=.5*Math.exp(2*p/3),m=.5*Math.sqrt(p*g*(c-g)/c)*(u-c/2<0?-1:1),y=Math.max(t,Math.floor(e-u*g/c+m)),A=Math.min(n,Math.floor(e+(c-u)*g/c+m));M0(s,e,y,A,r)}const i=s[e];let a=t,l=n;for(ia(s,t,e),r(s[n],i)>0&&ia(s,t,n);a<l;){for(ia(s,a,l),a++,l--;r(s[a],i)<0;)a++;for(;r(s[l],i)>0;)l--}r(s[t],i)===0?ia(s,t,l):(l++,ia(s,l,n)),l<=e&&(t=l+1),e<=l&&(n=l-1)}}function ia(s,e,t){const n=s[e];s[e]=s[t],s[t]=n}function $6(s,e){return s<e?-1:s>e?1:0}class W6{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!Co(e,t))return n;const r=this.toBBox,i=[];for(;t;){for(let a=0;a<t.children.length;a++){const l=t.children[a],c=t.leaf?r(l):l;Co(e,c)&&(t.leaf?n.push(l):dc(e,c)?this._all(l,n):i.push(l))}t=i.pop()}return n}collides(e){let t=this.data;if(!Co(e,t))return!1;const n=[];for(;t;){for(let r=0;r<t.children.length;r++){const i=t.children[r],a=t.leaf?this.toBBox(i):i;if(Co(e,a)){if(t.leaf||dc(e,a))return!0;n.push(i)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Si([]),this}remove(e,t){if(!e)return this;let n=this.data;const r=this.toBBox(e),i=[],a=[];let l,c,u;for(;n||i.length;){if(n||(n=i.pop(),c=i[i.length-1],l=a.pop(),u=!0),n.leaf){const p=H6(e,n.children,t);if(p!==-1)return n.children.splice(p,1),i.push(n),this._condense(i),this}!u&&!n.leaf&&dc(n,r)?(i.push(n),a.push(l),l=0,c=n,n=n.children[0]):c?(l++,n=c.children[l],u=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){const i=n-t+1;let a=this._maxEntries,l;if(i<=a)return l=Si(e.slice(t,n+1)),_i(l,this.toBBox),l;r||(r=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,r-1))),l=Si([]),l.leaf=!1,l.height=r;const c=Math.ceil(i/a),u=c*Math.ceil(Math.sqrt(a));tp(e,t,n,u,this.compareMinX);for(let p=t;p<=n;p+=u){const g=Math.min(p+u-1,n);tp(e,p,g,c,this.compareMinY);for(let m=p;m<=g;m+=c){const y=Math.min(m+c-1,g);l.children.push(this._build(e,m,y,r-1))}}return _i(l,this.toBBox),l}_chooseSubtree(e,t,n,r){for(;r.push(t),!(t.leaf||r.length-1===n);){let i=1/0,a=1/0,l;for(let c=0;c<t.children.length;c++){const u=t.children[c],p=uc(u),g=X6(e,u)-p;g<a?(a=g,i=p<i?p:i,l=u):g===a&&p<i&&(i=p,l=u)}t=l||t.children[0]}return t}_insert(e,t,n){const r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),da(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}_split(e,t){const n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);const a=this._chooseSplitIndex(n,i,r),l=Si(n.children.splice(a,n.children.length-a));l.height=n.height,l.leaf=n.leaf,_i(n,this.toBBox),_i(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(n,l)}_splitRoot(e,t){this.data=Si([e,t]),this.data.height=e.height+1,this.data.leaf=!1,_i(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r,i=1/0,a=1/0;for(let l=t;l<=n-t;l++){const c=ua(e,0,l,this.toBBox),u=ua(e,l,n,this.toBBox),p=Z6(c,u),g=uc(c)+uc(u);p<i?(i=p,r=l,a=g<a?g:a):p===i&&g<a&&(a=g,r=l)}return r||n-t}_chooseSplitAxis(e,t,n){const r=e.leaf?this.compareMinX:q6,i=e.leaf?this.compareMinY:Y6,a=this._allDistMargin(e,t,n,r),l=this._allDistMargin(e,t,n,i);a<l&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);const i=this.toBBox,a=ua(e,0,t,i),l=ua(e,n-t,n,i);let c=Io(a)+Io(l);for(let u=t;u<n-t;u++){const p=e.children[u];da(a,e.leaf?i(p):p),c+=Io(a)}for(let u=n-t-1;u>=t;u--){const p=e.children[u];da(l,e.leaf?i(p):p),c+=Io(l)}return c}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)da(t[r],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():_i(e[t],this.toBBox)}}function H6(s,e,t){if(!t)return e.indexOf(s);for(let n=0;n<e.length;n++)if(t(s,e[n]))return n;return-1}function _i(s,e){ua(s,0,s.children.length,e,s)}function ua(s,e,t,n,r){r||(r=Si(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let i=e;i<t;i++){const a=s.children[i];da(r,s.leaf?n(a):a)}return r}function da(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function q6(s,e){return s.minX-e.minX}function Y6(s,e){return s.minY-e.minY}function uc(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function Io(s){return s.maxX-s.minX+(s.maxY-s.minY)}function X6(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function Z6(s,e){const t=Math.max(s.minX,e.minX),n=Math.max(s.minY,e.minY),r=Math.min(s.maxX,e.maxX),i=Math.min(s.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,i-n)}function dc(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function Co(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function Si(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function tp(s,e,t,n,r){const i=[e,t];for(;i.length;){if(t=i.pop(),e=i.pop(),t-e<=n)continue;const a=e+Math.ceil((t-e)/n/2)*n;M0(s,a,e,t,r),i.push(e,a,a,t)}}class K6{constructor(e){this._group=new K5,this._name=e}get name(){return this._name}set name(e){this._name=e}get visible(){return this._group.visible}set visible(e){this._group.visible=e}get internalObject(){return this._group}get stats(){const e=this._group.stats;return{name:this._name,...e}}get entityCount(){return this._group.entityCount}rerenderPoints(e){this._group.rerenderPoints(e)}hasEntity(e){return this._group.hasEntity(e)}addEntity(e){this._group.addEntity(e)}isIntersectWith(e,t){return this._group.isIntersectWith(e,t)}remove(e){throw new Error("Not implemented yet!")}update(e){return this._group.add(e),!0}hover(e){e.forEach(t=>{this._group.hover(t)})}unhover(e){e.forEach(t=>{this._group.unhover(t)})}select(e){e.forEach(t=>{this._group.select(t)})}unselect(e){e.forEach(t=>{this._group.unselect(t)})}}class Q6{constructor(){this._group=new lr,this._indexTree=new W6,this._box=new Ft,this._layers=new Map}get internalObject(){return this._group}get layers(){return this._layers}get box(){return this._box}get visible(){return this._group.visible}set visible(e){this._group.visible=e}get entityCount(){let e=0;return this._layers.forEach(t=>e+=t.entityCount),e}get stats(){const e=[];let t=0,n=0,r=0,i=0,a=0;return this._layers.forEach(l=>{const c=l.stats;e.push(c),r+=c.line.indexed.geometrySize+c.line.nonIndexed.geometrySize,i+=c.mesh.indexed.geometrySize+c.mesh.nonIndexed.geometrySize,a+=c.point.indexed.geometrySize+c.point.nonIndexed.geometrySize,t+=c.summary.totalGeometrySize,n+=c.summary.totalMappingSize}),{layers:e,summary:{entityCount:this.entityCount,totalSize:{line:r,mesh:i,point:a,geometry:t,mapping:n}}}}clear(){return this._layers.forEach(e=>{this._group.remove(e.internalObject)}),this._layers.clear(),this._box.makeEmpty(),this._indexTree.clear(),this}rerenderPoints(e){this._layers.forEach(t=>{t.rerenderPoints(e)})}isIntersectWith(e,t){const n=this.getLayerByObjectId(e);return n&&n.isIntersectWith(e,t)}addEntity(e,t=!0){if(!e.objectId)throw new Error("Object id is required to add one entity!");if(!e.layerName)throw new Error("Layer name is required to add one entity!");const n=this._layers.get(e.layerName);if(!n)throw new Error(`layer '${e.layerName}' doesn't exist!`);n.addEntity(e);const r=e.box;return t&&this._box.union(r),this._indexTree.insert({minX:r.min.x,minY:r.min.y,maxX:r.max.x,maxY:r.max.y,id:e.objectId}),this}remove(e){for(const[t,n]of this._layers)if(n.remove(e))return!0;return!1}updateEntity(e){for(const[t,n]of this._layers)if(n.update(e))return!0;return!1}addLayer(e){const t=e.name;let n=this._layers.get(t);return n===void 0&&(n=new K6(t),n.visible=!(e.isFrozen||e.isOff),this._layers.set(t,n),this._group.add(n.internalObject)),e}updateLayer(e){const t=this._layers.get(e.name);return t&&(t.visible=!(e.isFrozen||e.isOff)),t}hover(e){e.forEach(t=>{const n=this.getLayerByObjectId(t);n&&n.hover([t])})}unhover(e){e.forEach(t=>{const n=this.getLayerByObjectId(t);n&&n.unhover([t])})}select(e){e.forEach(t=>{const n=this.getLayerByObjectId(t);n&&n.select([t])})}unselect(e){e.forEach(t=>{const n=this.getLayerByObjectId(t);n&&n.unselect([t])})}setSnapObject(e){this._snapPointsObject&&this._group.remove(this._snapPointsObject),this._snapPointsObject=e,this._group.add(e)}search(e){return this._indexTree.search({minX:e.min.x,minY:e.min.y,maxX:e.max.x,maxY:e.max.y})}getLayerByObjectId(e){for(const[t,n]of this._layers)if(n.hasEntity(e))return n}}class J6{constructor(){this._scene=new X0,this._transientManager=new ep(this._scene),this._layers=new Map,this._layouts=new Map,this._activeLayoutBtrId="",this._modelSpaceBtrId=""}get layers(){return this._layers}get layouts(){return this._layouts}get box(){var e;return(e=this.activeLayout)==null?void 0:e.box}get internalScene(){return this._scene}get modelSpaceBtrId(){return this._modelSpaceBtrId}set modelSpaceBtrId(e){if(this._modelSpaceBtrId=e,!this._layouts.has(e))throw new Error(`[AcTrScene] No layout assiciated with the specified block table record id '${e}'!`)}get activeLayoutBtrId(){return this._activeLayoutBtrId}set activeLayoutBtrId(e){this._activeLayoutBtrId=e,this._layouts.forEach((t,n)=>{t.visible=e==n})}get activeLayout(){if(this._activeLayoutBtrId&&this._layouts.has(this._activeLayoutBtrId))return this._layouts.get(this._activeLayoutBtrId)}get modelSpaceLayout(){if(this._modelSpaceBtrId&&this._layouts.has(this._modelSpaceBtrId))return this._layouts.get(this._modelSpaceBtrId)}get stats(){const e=[];return this._layouts.forEach(t=>e.push(t.stats)),{layouts:e}}addEmptyLayout(e){const t=new Q6;return this._layouts.set(e,t),this._scene.add(t.internalObject),t.visible=e==this._activeLayoutBtrId,this._layers.forEach(n=>{t.addLayer(n)}),t}clear(){return this._layouts.forEach(e=>{this._scene.remove(e.internalObject),e.clear()}),this._layouts.clear(),this._layers.clear(),this._transientManager.clear(),this._scene.clear(),this._transientManager=new ep(this._scene),this}hover(e){return this.activeLayout?(this.activeLayout.hover(e),!0):!1}unhover(e){return this.activeLayout?(this.activeLayout.unhover(e),!0):!1}select(e){return this.activeLayout?(this.activeLayout.select(e),!0):!1}unselect(e){return this.activeLayout?(this.activeLayout.unselect(e),!0):!1}search(e){const t=this.activeLayout;return t?t==null?void 0:t.search(e):[]}addLayer(e){this._layers.set(e.name,e),this._layouts.forEach(t=>{t.addLayer(e)})}updateLayer(e){this._layers.set(e.name,e),this._layouts.forEach(t=>{t.updateLayer(e)})}addTransientEntity(e){this._transientManager.update(e)}removeTransientEntity(e){this._transientManager.remove(e)}addEntity(e,t=!0){const n=e.ownerId;if(n){let r=this._layouts.get(n);r||(r=this.addEmptyLayout(n)),r.addEntity(e,t)}else console.warn("[AcTrSecene] The owner id of one entity cannot be empty!");return this}removeEntity(e){for(const[t,n]of this._layouts)if(n.remove(e))return!0;return!1}updateEntity(e){for(const[t,n]of this._layouts)if(n.updateEntity(e))return!0;return!1}setSnapObject(e){return this._layouts.forEach(t=>{t.setSnapObject(e)}),this}}const np={background:0};class e8 extends Hb{constructor(e=np){const t={...np,...e},n=new q0({antialias:!0,alpha:!0,canvas:e.canvas});t.canvas==null&&(t.canvas=n.domElement),super(t.canvas),e.calculateSizeCallback&&this.setCalculateSizeCallback(e.calculateSizeCallback),n.setPixelRatio(Math.min(window.devicePixelRatio,2)),n.setSize(this.width,this.height),this._renderer=new c6(n);const r=dr.instance.fontMapping;this._renderer.setFontMapping(r),this._renderer.events.fontNotFound.addEventListener(i=>{Fr.emit("font-not-found",{fontName:i.fontName,count:i.count??0})}),this._scene=this.createScene(),this._renderer.setClearColor(t.background||0),this._stats=this.createStats(dr.instance.isShowStats),dr.instance.events.modified.addEventListener(i=>{i.key=="isShowStats"&&this.toggleStatsVisibility(this._stats,i.value)}),this.canvas.addEventListener("click",()=>{this.mode==hr.SELECTION&&this.select()}),document.addEventListener("keydown",i=>{i.code==="Escape"&&this.selectionSet.clear()}),Na().layoutManager.events.layoutSwitched.addEventListener(i=>{this.activeLayoutBtrId=i.layout.blockTableRecordId}),this._missedImages=new Map,this._layoutViewManager=new j6,this.initialize(),this.onWindowResize(),this.animate(),this._isDirty=!0,this._numOfEntitiesToProcess=0}initialize(){this.setCursor(Ra.Crosshair)}get mode(){const e=this.activeLayoutView;return e?e.mode:hr.SELECTION}set mode(e){this.activeLayoutView.mode=e}get renderer(){return this._renderer}get isDirty(){return this._isDirty}set isDirty(e){this._isDirty=e}get missedData(){return{fonts:this._renderer.missedFonts,images:this._missedImages}}get center(){return this.activeLayoutView.center}set center(e){this.activeLayoutView.center=e}get backgroundColor(){return this._renderer.getClearColor()}set backgroundColor(e){this._renderer.setClearColor(e),this._isDirty=!0}get modelSpaceBtrId(){return this._scene.modelSpaceBtrId}set modelSpaceBtrId(e){this._scene.modelSpaceBtrId=e}get activeLayoutBtrId(){return this._scene.activeLayoutBtrId}set activeLayoutBtrId(e){this._layoutViewManager.activeLayoutBtrId=e,this._scene.activeLayoutBtrId=e,this._isDirty=!0}get activeLayoutView(){return this._layoutViewManager.activeLayoutView}get stats(){return this._scene.stats}animate(){var e;requestAnimationFrame(this.animate.bind(this)),this._isDirty&&(this._layoutViewManager.render(this._scene),(e=this._stats)==null||e.update(),this._isDirty=!1)}cwcs2Wcs(e){const t=this.activeLayoutView;return t?t.cwcs2Wcs(e):new je(e)}wcs2Cwcs(e){const t=this.activeLayoutView;return t?t.wcs2Cwcs(e):new je(e)}zoomTo(e,t=1.1){this.activeLayoutView.zoomTo(e,t),this._isDirty=!0}rerenderPoints(e){const t=this._scene.activeLayout;t&&(t.rerenderPoints(e),this._isDirty=!0)}zoomToFit(e=0){new _b(()=>this._numOfEntitiesToProcess<=0,()=>{if(this._scene.box){const t=R6.threeBox3dToGeBox2d(this._scene.box);this.zoomTo(t),this._isDirty=!0}},300,e).start()}pick(e,t){e==null&&(e=this.curPos);const n=[],r=this._scene.activeLayout;if(r){const i=this.activeLayoutView,a=i.pointToBox(e,t??this.selectionBoxSize),l=this._scene.search(a),c=Math.max(a.size.width/2,a.size.height/2),u=i.resetRaycaster(e,c);l.forEach(p=>{const g=p.id;r.isIntersectWith(g,u)&&n.push(g)})}return n}search(e){return this._scene.search(e)}select(e){const t=[];this.pick(e).forEach(n=>t.push(n)),t.length>0&&this.selectionSet.add(t)}selectByBox(e){const t=[];this._scene.search(e).forEach(n=>t.push(n.id)),this.selectionSet.add(t)}addLayer(e){this._scene.addLayer({name:e.name,isFrozen:e.isFrozen,isOff:e.isOff}),this._isDirty=!0}updateLayer(e){this._scene.updateLayer({name:e.name,isFrozen:e.isFrozen,isOff:e.isOff}),this._isDirty=!0}addTransientEntity(e){const t=Array.isArray(e)?e:[e];for(let n=0;n<t.length;++n){const r=t[n],i=r.draw(this._renderer,!0);i&&(i.objectId=r.objectId,this._scene.addTransientEntity(i),this._isDirty=!0)}}removeTransientEntity(e){this._scene.removeTransientEntity(e),this._isDirty=!0}addEntity(e){const t=Array.isArray(e)?e:[e];this._numOfEntitiesToProcess+=t.length,setTimeout(async()=>{await this.batchConvert(t)})}removeEntity(e){this._scene.removeEntity(e)}updateEntity(e){let t=[];Array.isArray(e)?t=e:t.push(e);for(let n=0;n<t.length;++n){const r=t[n],i=r.draw(this._renderer);i&&(i.objectId=r.objectId,i.ownerId=r.ownerId,i.layerName=r.layer,i.visible=r.visibility,this._scene.updateEntity(i))}this._isDirty=!0,setTimeout(()=>{this._isDirty=!0},100)}addLayout(e){this._scene.addEmptyLayout(e.blockTableRecordId),this.createLayoutViewIfNeeded(e.blockTableRecordId),this._isDirty=!0}clear(){this._scene.clear(),this._isDirty=!0,this._missedImages.clear(),this._renderer.clearMissedFonts()}highlight(e){this._isDirty=this._scene.select(e)}unhighlight(e){this._isDirty=this._scene.unselect(e)}onHover(e){this._isDirty=this._scene.hover([e])}onUnhover(e){this._isDirty=this._scene.unhover([e])}createScene(){const e=new J6;return e.layouts.forEach(t=>{t.setSnapObject(this.renderer.createObject())}),e}createStats(e){const t=new Y0;document.body.appendChild(t.dom);const n=t.dom;return n.style.position="fixed",n.style.inset="unset",n.style.bottom="30px",n.style.right="0px",this.toggleStatsVisibility(t,e),t}onWindowResize(){super.onWindowResize(),this._renderer.setSize(this.width,this.height),this._layoutViewManager.resize(this.width,this.height),this._isDirty=!0}createLayoutViewIfNeeded(e){let t=this._layoutViewManager.getAt(e);return t==null&&(t=new V6(this._renderer,e,this.width,this.height),t.events.viewChanged.addEventListener(()=>{this._isDirty=!0}),this._layoutViewManager.add(t)),t}toggleStatsVisibility(e,t){t?e.dom.style.display="block":e.dom.style.display="none"}async batchConvert(e){for(let t=0;t<e.length;++t){const n=e[t],r=n.draw(this._renderer,!0);if(r){if(r.objectId=n.objectId,r.ownerId=n.ownerId,r.layerName=n.layer,r.visible=n.visibility,r instanceof cl&&!r.isOnTheSameLayer)this.handleGroup(r),this.decreaseNumOfEntitiesToProcess();else{const i=!(n instanceof rh||n instanceof ah);await r.draw().then(()=>{this._scene.addEntity(r,i),r.dispose(),this._isDirty=!0}).finally(()=>{this.decreaseNumOfEntitiesToProcess()})}if(n instanceof ih){if(n.number>1){const i=this._layoutViewManager.getAt(n.ownerId);if(i){const a=new Jo(i,n.toGiViewport(),this._renderer);i.addViewport(a)}}}else if(n instanceof tl){const i=n.imageFileName;i&&this._missedImages.set(n.objectId,i)}}else this.decreaseNumOfEntitiesToProcess()}}handleGroup(e){const t=e.children,n=new Map;t.forEach(c=>{var u;const p=c.userData.layerName;n.has(p)||n.set(p,[]),(u=n.get(p))==null||u.push(c)}),e.children=[];for(const c of t)c.parent=null;const r=e.styleManager,i=e.objectId,a=e.layerName,l=e.box;n.forEach((c,u)=>{const p=new nn(r);p.applyMatrix4(e.matrix),p.objectId=i,p.ownerId=e.ownerId,p.layerName=u==="0"?a:u,p.box=l;for(let g=0;g<c.length;g++)p.add(c[g]);this._scene.addEntity(p,!0),p.dispose()}),this._isDirty=!0}decreaseNumOfEntitiesToProcess(){this._numOfEntitiesToProcess--,this._numOfEntitiesToProcess<0&&(this._numOfEntitiesToProcess=0,console.warn("Something wrong! The number of entities to process should not be less than 0."))}}class t8{constructor(){this._loader=new Q5}get baseUrl(){return this._loader.baseUrl}set baseUrl(e){this._loader.baseUrl=e}get avaiableFonts(){return this._loader.avaiableFonts}async getAvaiableFonts(){return await this._loader.getAvailableFonts()}async load(e){const t=await this._loader.load(e),n=[],r=[];t.forEach(i=>{i.status==="NotFound"?n.push(i.fontName):i.status==="FailedToLoad"&&r.push({fontName:i.fontName,url:i.url})}),n.length>0&&Fr.emit("fonts-not-found",{fonts:n}),r.length>0&&Fr.emit("fonts-not-loaded",{fonts:r})}}class sp{convert(e){const t=this.createEntity(e);return t&&this.processCommonAttrs(e,t),t}createEntity(e){return e.type=="3DFACE"?this.convertFace(e):e.type=="ARC"?this.convertArc(e):e.type=="CIRCLE"?this.convertCirle(e):e.type=="DIMENSION"?this.convertDimension(e):e.type=="ELLIPSE"?this.convertEllipse(e):e.type=="HATCH"?this.convertHatch(e):e.type=="IMAGE"?this.convertImage(e):e.type=="LEADER"?this.convertLeader(e):e.type=="LINE"?this.convertLine(e):e.type=="LWPOLYLINE"?this.convertLWPolyline(e):e.type=="MTEXT"?this.convertMText(e):e.type=="POINT"?this.convertPoint(e):e.type=="POLYLINE2D"?this.convertPolyline2d(e):e.type=="POLYLINE3D"?this.convertPolyline3d(e):e.type=="RAY"?this.convertRay(e):e.type=="SPLINE"?this.convertSpline(e):e.type=="ACAD_TABLE"?this.convertTable(e):e.type=="TEXT"?this.convertText(e):e.type=="SOLID"?this.convertSolid(e):e.type=="VIEWPORT"?this.convertViewport(e):e.type=="WIPEOUT"?this.convertWipeout(e):e.type=="XLINE"?this.convertXline(e):e.type=="INSERT"?this.convertBlockReference(e):null}convertFace(e){const t=new uf;return e.corner1&&t.setVertexAt(0,e.corner1),e.corner2&&t.setVertexAt(1,e.corner2),e.corner3&&t.setVertexAt(2,e.corner3),e.corner4&&t.setVertexAt(3,e.corner4),t.setEdgeInvisibilities(e.flag),t}convertArc(e){return new rf(e.center,e.radius,e.startAngle,e.endAngle,e.extrusionDirection??oe.Z_AXIS)}convertCirle(e){return new el(e.center,e.radius,e.extrusionDirection??oe.Z_AXIS)}convertEllipse(e){const t=new oe(e.majorAxisEndPoint),n=t.length();return new cf(e.center,e.extrusionDirection??oe.Z_AXIS,t,n,n*e.axisRatio,e.startAngle,e.endAngle)}convertLine(e){const t=e.startPoint,n=e.endPoint;return new sh(new te(t.x,t.y,t.z),new te(n.x,n.y,n.z))}convertSpline(e){try{if(e.numberOfControlPoints>0&&e.numberOfKnots>0)return new jo(e.controlPoints,e.knots,e.weights,e.degree,!!(e.flag&1));if(e.numberOfFitPoints>0)return new jo(e.fitPoints,"Uniform",e.degree,!!(e.flag&1))}catch(t){console.log(`Failed to convert spline with error: ${t}`)}return null}convertPoint(e){const t=new Of;return t.position=e.position,t}convertSolid(e){const t=new kf;return t.setPointAt(0,{...e.corner1,z:0}),t.setPointAt(1,{...e.corner2,z:0}),t.setPointAt(2,{...e.corner3,z:0}),t.setPointAt(3,e.corner4?{...e.corner4,z:0}:{...e.corner3,z:0}),t.thickness=e.thickness,t}convertLWPolyline(e){const t=new Pf;return t.closed=!!(e.flag&512),e.vertices.forEach((n,r)=>{t.addVertexAt(r,new je(n.x,n.y),n.bulge,n.startWidth,n.endWidth)}),t}convertPolyline2d(e){const t=!!(e.flag&1),n=[],r=[];e.vertices.map(a=>{a.flag&16||(n.push({x:a.x,y:a.y,z:a.z}),r.push(a.bulge??0))});let i=Cs.SimplePoly;return e.flag&2?i=Cs.FitCurvePoly:e.flag&4&&(e.smoothType==6?i=Cs.CubicSplinePoly:e.smoothType==5&&(i=Cs.QuadSplinePoly)),new ef(i,n,0,t,e.startWidth,e.endWidth,r)}convertPolyline3d(e){const t=!!(e.flag&1),n=[];e.vertices.map(i=>{i.flag&16||n.push({x:i.x,y:i.y,z:i.z})});let r=Pr.SimplePoly;return e.flag&4&&(e.smoothType==6?r=Pr.CubicSplinePoly:e.smoothType==5&&(r=Pr.QuadSplinePoly)),new nf(r,n,t)}convertHatch(e){var t;const n=new nh;return(t=e.definitionLines)==null||t.forEach(r=>{n.definitionLines.push({angle:r.angle,origin:r.base,delta:r.offset,dashPattern:r.numberOfDashLengths>0?r.dashLengths:[]})}),n.hatchStyle=e.hatchStyle,n.patternName=e.patternName,n.patternType=e.patternType,n.patternAngle=e.patternAngle==null?0:e.patternAngle,n.patternScale=e.patternScale==null?0:e.patternScale,e.boundaryPaths.forEach(r=>{if(r.boundaryPathTypeFlag&2){const i=r,a=new Gr;a.closed=i.isClosed,i.vertices.forEach((l,c)=>{a.addVertexAt(c,{x:l.x,y:l.y,bulge:l.bulge})}),n.add(a)}else{const i=r,a=new eh;i.edges.forEach(l=>{if(l!=null){if(l.type==1){const c=l;a.add(new ga(c.start,c.end))}else if(l.type==2){const c=l;a.add(new Vo(c.center,c.radius,c.startAngle,c.endAngle,!c.isCCW))}else if(l.type==3){const c=l;new xt().subVectors(c.end,c.center);const u=Math.sqrt(Math.pow(c.end.x,2)+Math.pow(c.end.y,2)),p=u*c.lengthOfMinorAxis;let g=c.startAngle,m=c.endAngle;const y=Math.atan2(c.end.y,c.end.x);c.isCCW||(g=Math.PI*2-g,m=Math.PI*2-m),a.add(new $p({...c.center,z:0},u,p,g,m,!c.isCCW,y))}else if(l.type==4){const c=l;if(c.numberOfControlPoints>0&&c.numberOfKnots>0){const u=c.controlPoints.map(m=>({x:m.x,y:m.y,z:0}));let p=!0;const g=c.controlPoints.map(m=>(m.weight==null&&(p=!1),m.weight||1));a.add(new Rr(u,c.knots,p?g:void 0))}else if(c.numberOfFitData>0){const u=c.fitDatum.map(p=>({x:p.x,y:p.y,z:0}));a.add(new Rr(u,"Uniform"))}}}}),n.add(a)}}),n}convertTable(e){const t=new Ef(e.name,e.rowCount,e.columnCount);return t.attachmentPoint=e.attachmentPoint,t.position.copy(e.startPoint),e.columnWidthArr.forEach((n,r)=>t.setColumnWidth(r,n)),e.rowHeightArr.forEach((n,r)=>t.setRowHeight(r,n)),e.cells.forEach((n,r)=>{t.setCell(r,n)}),t}convertText(e){const t=new If;return t.textString=e.text,t.styleName=e.styleName,t.height=e.textHeight,t.position.copy(e.startPoint),t.rotation=e.rotation,t.oblique=e.obliqueAngle??0,t.thickness=e.thickness,t.horizontalMode=e.halign,t.verticalMode=e.valign,t.widthFactor=e.xScale??1,t}convertMText(e){const t=new wf;return t.contents=e.text,e.styleName!=null&&(t.styleName=e.styleName),t.height=e.textHeight,t.width=e.rectWidth,t.rotation=e.rotation||0,t.location=e.insertionPoint,t.attachmentPoint=e.attachmentPoint,e.direction&&(t.direction=new oe(e.direction)),t.drawingDirection=e.drawingDirection,t}convertLeader(e){const t=new ff;return e.vertices.forEach(n=>{t.appendVertex(n)}),t.hasArrowHead=e.isArrowheadEnabled,t.hasHookLine=e.isHooklineExists,t.isSplined=e.isSpline,t.dimensionStyle=e.styleName,t.annoType=e.leaderCreationFlag,t}convertDimension(e){if(e.subclassMarker=="AcDbAlignedDimension"||e.subclassMarker=="AcDbRotatedDimension"){const t=e,n=new oh(t.subDefinitionPoint1,t.subDefinitionPoint2,t.definitionPoint);return t.insertionPoint&&(n.dimBlockPosition={x:t.insertionPoint.x,y:t.insertionPoint.y,z:0}),n.rotation=t.rotationAngle,this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDb3PointAngularDimension"){const t=e,n=new Vf(t.centerPoint,t.subDefinitionPoint1,t.subDefinitionPoint2,t.definitionPoint);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbOrdinateDimension"){const t=e,n=new qf(t.subDefinitionPoint1,t.subDefinitionPoint2);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbRadialDimension"){const t=e,n=new Xf(t.definitionPoint,t.centerPoint,t.leaderLength);return this.processDimensionCommonAttrs(e,n),n}else if(e.subclassMarker=="AcDbDiametricDimension"){const t=e,n=new Wf(t.definitionPoint,t.centerPoint,t.leaderLength);return this.processDimensionCommonAttrs(e,n),n}return null}processImage(e,t){t.position.copy(e.position),t.brightness=e.brightness,t.contrast=e.contrast,t.fade=e.fade,t.imageDefId=e.imageDefHandle.toString(),t.isClipped=e.clipping>0,t.isShownClipped=(e.flags|4)>0,t.isImageShown=(e.flags|3)>0,t.isImageTransparent=(e.flags|8)>0,e.clippingBoundaryPath.forEach(n=>{t.clipBoundary.push(new je(n))}),t.clipBoundaryType=e.clippingBoundaryType,t.width=Math.sqrt(e.uPixel.x**2+e.uPixel.y**2+e.uPixel.z**2)*e.imageSize.x,t.height=Math.sqrt(e.vPixel.x**2+e.vPixel.y**2+e.vPixel.z**2)*e.imageSize.y,t.rotation=Math.atan2(e.uPixel.y,e.uPixel.x)}convertImage(e){const t=new tl;return this.processImage(e,t),t}convertWipeout(e){const t=new Ff;return this.processImage(e,t),t}convertViewport(e){const t=new ih;return t.number=e.viewportId,t.centerPoint.copy(e.viewportCenter),t.height=e.height,t.width=e.width,t.viewCenter.copy(e.displayCenter),t.viewHeight=e.viewHeight,t}convertRay(e){const t=new rh;return t.basePoint.copy(e.firstPoint),t.unitDir.copy(e.unitDirection),t}convertXline(e){const t=new ah;return t.basePoint.copy(e.firstPoint),t.unitDir.copy(e.unitDirection),t}convertBlockReference(e){const t=new th(e.name);return e.insertionPoint&&t.position.copy(e.insertionPoint),t.scaleFactors.x=e.xScale,t.scaleFactors.y=e.yScale,t.scaleFactors.z=e.zScale,t.rotation=e.rotation,t.normal.copy(e.extrusionDirection),t}processDimensionCommonAttrs(e,t){t.dimBlockId=e.name,t.textPosition.copy(e.textPoint),t.textRotation=e.textRotation||0,e.textLineSpacingFactor&&(t.textLineSpacingFactor=e.textLineSpacingFactor),e.textLineSpacingStyle&&(t.textLineSpacingStyle=e.textLineSpacingStyle),t.dimensionStyleName=e.styleName,t.dimensionText=e.text||"",t.measurement=e.measurement}processCommonAttrs(e,t){t.layer=e.layer||"0",t.objectId=e.handle.toString(),t.ownerId=e.ownerBlockRecordSoftId.toString(),e.lineType!=null&&(t.lineType=e.lineType),e.lineweight!=null&&(t.lineWeight=e.lineweight),e.lineTypeScale!=null&&(t.linetypeScale=e.lineTypeScale),e.color!=null&&(t.color.color=e.color),e.colorIndex!=null&&(t.color.colorIndex=e.colorIndex),e.colorName!=null&&(t.color.colorName=e.colorName),e.isVisible!=null&&(t.visibility=e.isVisible),e.transparency!=null&&(t.transparency=e.transparency)}}class n8 extends ch{constructor(e={}){super(e),e.useWorker=!0,e.parserWorkerUrl||(e.parserWorkerUrl="/assets/libredwg-parser-worker.js")}async parse(e){if(this.config.useWorker&&this.config.parserWorkerUrl){const t=cm({workerUrl:this.config.parserWorkerUrl,maxConcurrentWorkers:1}),n=await t.execute(e);return t.destroy(),n.data}else throw new Error("dwg converter can run in web worker only!")}getFonts(e){const t=new Map;e.tables.BLOCK_RECORD.entries.forEach(a=>{t.set(a.name,a)});const n=new Map,r=a=>{if(a){const l=a.lastIndexOf(".");return l>=0?a.substring(0,l).toLowerCase():a.toLowerCase()}};e.tables.STYLE.entries.forEach(a=>{const l=[];let c=r(a.font);c&&l.push(c),c=r(a.bigFont),c&&l.push(c),n.set(a.name,l)});const i=new Set;return this.getFontsInBlock(e.entities,t,n,i),Array.from(i)}getFontsInBlock(e,t,n,r){const i=/\\f(.*?)\|/g;e.forEach(a=>{if(a.type=="MTEXT"){const l=a;[...l.text.matchAll(i)].forEach(u=>{r.add(u[1].toLowerCase())});const c=n.get(l.styleName);c==null||c.forEach(u=>r.add(u))}else if(a.type=="TEXT"){const l=a,c=n.get(l.styleName);c==null||c.forEach(u=>r.add(u))}else if(a.type=="INSERT"){const l=a,c=t.get(l.name);c&&this.getFontsInBlock(c.entities,t,n,r)}})}processLineTypes(e,t){e.tables.LTYPE.entries.forEach(n=>{const r={name:n.name,description:n.description,standardFlag:n.standardFlag,totalPatternLength:n.totalPatternLength,pattern:n.pattern},i=new ma(r);this.processCommonTableEntryAttrs(n,i),i.name=n.name,t.tables.linetypeTable.add(i)})}processTextStyles(e,t){e.tables.STYLE.entries.forEach(n=>{const r=new gh(n);this.processCommonTableEntryAttrs(n,r),t.tables.textStyleTable.add(r)})}processDimStyles(e,t){e.tables.DIMSTYLE.entries.forEach(n=>{const r={name:n.name,ownerId:n.ownerHandle.toString(),dimpost:n.DIMPOST||"",dimapost:n.DIMAPOST||"",dimscale:n.DIMSCALE,dimasz:n.DIMASZ,dimexo:n.DIMEXO,dimdli:n.DIMDLI,dimexe:n.DIMEXE,dimrnd:n.DIMRND,dimdle:n.DIMDLE,dimtp:n.DIMTP,dimtm:n.DIMTM,dimtxt:n.DIMTXT,dimcen:n.DIMCEN,dimtsz:n.DIMTSZ,dimaltf:n.DIMALTF,dimlfac:n.DIMLFAC,dimtvp:n.DIMTVP,dimtfac:n.DIMTFAC,dimgap:n.DIMGAP,dimaltrnd:n.DIMALTRND,dimtol:n.DIMTOL==null||n.DIMTOL==0?0:1,dimlim:n.DIMLIM==null||n.DIMLIM==0?0:1,dimtih:n.DIMTIH==null||n.DIMTIH==0?0:1,dimtoh:n.DIMTOH==null||n.DIMTOH==0?0:1,dimse1:n.DIMSE1==null||n.DIMSE1==0?0:1,dimse2:n.DIMSE2==null||n.DIMSE2==0?0:1,dimtad:n.DIMTAD,dimzin:n.DIMZIN,dimazin:n.DIMAZIN,dimalt:n.DIMALT,dimaltd:n.DIMALTD,dimtofl:n.DIMTOFL,dimsah:n.DIMSAH,dimtix:n.DIMTIX,dimsoxd:n.DIMSOXD,dimclrd:n.DIMCLRD,dimclre:n.DIMCLRE,dimclrt:n.DIMCLRT,dimadec:n.DIMADEC||0,dimunit:n.DIMUNIT||2,dimdec:n.DIMDEC,dimtdec:n.DIMTDEC,dimaltu:n.DIMALTU,dimalttd:n.DIMALTTD,dimaunit:n.DIMAUNIT,dimfrac:n.DIMFRAC,dimlunit:n.DIMLUNIT,dimdsep:n.DIMDSEP,dimtmove:n.DIMTMOVE||0,dimjust:n.DIMJUST,dimsd1:n.DIMSD1,dimsd2:n.DIMSD2,dimtolj:n.DIMTOLJ,dimtzin:n.DIMTZIN,dimaltz:n.DIMALTZ,dimalttz:n.DIMALTTZ,dimfit:n.DIMFIT||0,dimupt:n.DIMUPT,dimatfit:n.DIMATFIT,dimtxsty:"Standard",dimldrblk:"",dimblk:n.DIMBLK||"",dimblk1:n.DIMBLK1||"",dimblk2:n.DIMBLK2||"",dimlwd:n.DIMLWD,dimlwe:n.DIMLWE},i=new rl(r);this.processCommonTableEntryAttrs(n,i),t.tables.dimStyleTable.add(i)})}processLayers(e,t){e.tables.LAYER.entries.forEach(n=>{const r=new fr;r.colorIndex=n.colorIndex;const i=new sl({name:n.name,standardFlags:n.standardFlag,linetype:n.lineType,lineWeight:n.lineweight,isOff:n.off,color:r,isPlottable:n.plotFlag!=0});this.processCommonTableEntryAttrs(n,i),t.tables.layerTable.add(i)})}processViewports(e,t){e.tables.VPORT.entries.forEach(n=>{const r=new gm;this.processCommonTableEntryAttrs(n,r),n.circleSides&&(r.circleSides=n.circleSides),r.standardFlag=n.standardFlag,r.center.copy(n.center),r.lowerLeftCorner.copy(n.lowerLeftCorner),r.upperRightCorner.copy(n.upperRightCorner),n.snapBasePoint&&r.snapBase.copy(n.snapBasePoint),n.snapRotationAngle&&(r.snapAngle=n.snapRotationAngle),n.snapSpacing&&r.snapIncrements.copy(n.snapSpacing),n.majorGridLines&&(r.gridMajor=n.majorGridLines),n.gridSpacing&&r.gridIncrements.copy(n.gridSpacing),n.backgroundObjectId&&(r.backgroundObjectId=n.backgroundObjectId),r.gsView.center.copy(n.center),r.gsView.viewDirectionFromTarget.copy(n.viewDirectionFromTarget),r.gsView.viewTarget.copy(n.viewTarget),n.lensLength&&(r.gsView.lensLength=n.lensLength),n.frontClippingPlane&&(r.gsView.frontClippingPlane=n.frontClippingPlane),n.backClippingPlane&&(r.gsView.backClippingPlane=n.backClippingPlane),n.viewHeight&&(r.gsView.viewHeight=n.viewHeight),n.viewTwistAngle&&(r.gsView.viewTwistAngle=n.viewTwistAngle),n.frozenLayers&&(r.gsView.frozenLayers=n.frozenLayers),n.styleSheet&&(r.gsView.styleSheet=n.styleSheet),n.renderMode&&(r.gsView.renderMode=n.renderMode),n.viewMode&&(r.gsView.viewMode=n.viewMode),n.ucsIconSetting&&(r.gsView.ucsIconSetting=n.ucsIconSetting),n.ucsOrigin&&r.gsView.ucsOrigin.copy(n.ucsOrigin),n.ucsXAxis&&r.gsView.ucsXAxis.copy(n.ucsXAxis),n.ucsYAxis&&r.gsView.ucsYAxis.copy(n.ucsYAxis),n.orthographicType&&(r.gsView.orthographicType=n.orthographicType),n.shadePlotSetting&&(r.gsView.shadePlotSetting=n.shadePlotSetting),n.shadePlotObjectId&&(r.gsView.shadePlotObjectId=n.shadePlotObjectId),n.visualStyleObjectId&&(r.gsView.visualStyleObjectId=n.visualStyleObjectId),n.isDefaultLightingOn&&(r.gsView.isDefaultLightingOn=n.isDefaultLightingOn),n.defaultLightingType&&(r.gsView.defaultLightingType=n.defaultLightingType),n.brightness&&(r.gsView.brightness=n.brightness),n.contrast&&(r.gsView.contrast=n.contrast),n.ambientColor&&(r.gsView.ambientColor=n.ambientColor),t.tables.viewportTable.add(r)})}processBlockTables(e,t){e.tables.BLOCK_RECORD.entries.forEach(n=>{let r=t.tables.blockTable.getAt(n.name);r||(r=new Zt,r.objectId=n.handle.toString(),r.name=n.name,r.ownerId=n.ownerHandle.toString(),r.origin.copy(n.basePoint),r.layoutId=n.layout.toString(),t.tables.blockTable.add(r)),!r.isModelSapce&&!r.isPaperSapce&&n.entities&&n.entities.length>0&&this.processEntitiesInBlock(n.entities,r)})}processBlocks(e,t){}async processEntitiesInBlock(e,t){const n=new sp,r=e.length,i=[];for(let a=0;a<r;a++){const l=e[a],c=n.convert(l);c&&i.push(c)}t.appendEntity(i)}async processEntities(e,t,n,r,i){const a=new sp;let l=e.entities;const c=l.length,u=new Kc(c,100-r.value,n);this.config.convertByEntityType&&(l=this.groupAndFlattenByType(l));const p=t.tables.blockTable.modelSpace;await u.processChunk(async(g,m)=>{const y=[];for(let A=g;A<m;A++){const w=l[A],C=a.convert(w);C&&y.push(C)}if(p.appendEntity(y),i){let A=r.value+m/c*(100-r.value);A>100&&(A=100),await i(A,"ENTITY","IN-PROGRESS")}})}processHeader(e,t){const n=e.header;t.cecolor.colorIndex=n.CECOLOR||256,t.angBase=n.ANGBASE??0,t.angDir=n.ANGDIR??0,t.aunits=n.AUNITS??0,n.EXTMAX&&(t.extmax=n.EXTMAX),n.EXTMIN&&(t.extmin=n.EXTMIN),t.insunits=n.INSUNITS??1,t.pdmode=n.PDMODE??0,t.pdsize=n.PDSIZE??0}processCommonTableEntryAttrs(e,t){t.name=e.name,t.objectId=e.handle.toString(),t.ownerId=e.ownerHandle.toString()}processObjects(e,t){this.processLayouts(e,t),this.processImageDefs(e,t)}processLayouts(e,t){const n=t.dictionaries.layouts;e.objects.LAYOUT.forEach(r=>{const i=new Ba;i.layoutName=r.layoutName,i.tabOrder=r.tabOrder;const a=t.tables.blockTable.newIterator();i.objectId=r.handle.toString();for(const l of a)if(l.layoutId===i.objectId){i.blockTableRecordId=l.objectId;break}i.blockTableRecordId||r.layoutName==="Model"&&(i.blockTableRecordId=t.tables.blockTable.modelSpace.objectId),i.limits.min.copy(r.minLimit),i.limits.max.copy(r.maxLimit),i.extents.min.copy(r.minExtent),i.extents.max.copy(r.maxExtent),this.processCommonObjectAttrs(r,i),n.setAt(i.layoutName,i)})}processImageDefs(e,t){const n=t.dictionaries.imageDefs;e.objects.IMAGEDEF.forEach(r=>{const i=new Kf;i.sourceFileName=r.fileName,this.processCommonObjectAttrs(r,i),n.setAt(i.objectId,i)})}processCommonObjectAttrs(e,t){t.objectId=e.handle.toString(),t.ownerId=e.ownerHandle.toString()}groupAndFlattenByType(e){const t={},n=[];for(const r of e)t[r.type]||(t[r.type]=[],n.push(r.type)),t[r.type].push(r);return n.flatMap(r=>t[r])}}function s8(){try{const s=new hm({convertByEntityType:!1,useWorker:!0,parserWorkerUrl:"./assets/dxf-parser-worker.js"});Ac.instance.register(cr.DXF,s)}catch(s){console.error("Failed to register dxf converter: ",s)}try{const s=new n8({convertByEntityType:!1,useWorker:!0,parserWorkerUrl:"./assets/libredwg-parser-worker.js"});Ac.instance.register(cr.DWG,s)}catch(s){console.error("Failed to register dwg converter: ",s)}}function r8(){s8(),typeof window<"u"&&window.location&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?Ur.getInstance().initialize("./mtext-renderer-worker.js"):Ur.getInstance().initialize("./mtext-renderer-worker.js")}const Hc=class Ai{constructor(e={}){this.options={size:e.size??"48px",borderWidth:e.borderWidth??"5px",color:e.color??"#0b84ff",overlay:e.overlay??!0,overlayColor:e.overlayColor??"rgba(0,0,0,0.5)",message:e.message??""},Ai.stylesInjected||this.injectStyles(),this.createDom()}show(){return this.root.style.display="flex",this}hide(){return this.root.style.display="none",this}setMessage(e=""){return this.messageEl.textContent=e,this.messageEl.style.display=e?"block":"none",this}destroy(){var e;(e=this.root)!=null&&e.parentNode&&this.root.parentNode.removeChild(this.root)}createDom(){const e=document.createElement("div");e.className="ml-ccl-overlay",e.style.display="flex",e.style.background=this.options.overlay?this.options.overlayColor:"transparent";const t=document.createElement("div");t.className="ml-ccl-spinner",t.style.width=this.options.size,t.style.height=this.options.size,t.style.borderWidth=this.options.borderWidth,t.style.borderTopColor=this.options.color;const n=document.createElement("div");n.className="ml-ccl-message",n.textContent=this.options.message,n.style.display=this.options.message?"block":"none";const r=document.createElement("div");r.className="ml-ccl-wrapper",r.appendChild(t),r.appendChild(n),e.appendChild(r),document.body.appendChild(e),this.root=e,this.spinner=t,this.messageEl=n}injectStyles(){if(document.getElementById(Ai.styleId)){Ai.stylesInjected=!0;return}const e=`
  .ml-ccl-overlay {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    pointer-events: auto;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  }
  
  .ml-ccl-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .ml-ccl-spinner {
    border-radius: 50%;
    border-style: solid;
    border-color: rgba(0,0,0,0.25);
    border-top-color: #0b84ff;
    animation: ml-ccl-rotate 0.85s linear infinite;
    box-sizing: border-box;
  }
  
  .ml-ccl-message {
    margin-top: 12px;
    font-size: 14px;
    color: #FFF;
    text-align: center;
    user-select: none;
  }
  
  @keyframes ml-ccl-rotate {
    to { transform: rotate(360deg); }
  }
      `.trim(),t=document.createElement("style");t.id=Ai.styleId,t.textContent=e,document.head.appendChild(t),Ai.stylesInjected=!0}};Hc.styleId="ml-ccl-loader-styles",Hc.stylesInjected=!1;let i8=Hc;const a8={isDebug:!1,isShowCommandLine:!0,isShowCoordinate:!0,isShowEntityInfo:!1,isShowLanguageSelector:!0,isShowMainMenu:!0,isShowToolbar:!0,isShowStats:!1,fontMapping:{}},rp="settings";class dr{constructor(){this.events={modified:new lt}}static get instance(){return this._instance||(this._instance=new dr),this._instance}set(e,t){const n=this.settings;n[e]=t,localStorage.setItem(rp,JSON.stringify(n)),this.events.modified.dispatch({key:e,value:t})}get(e){return this.settings[e]}toggle(e){const t=this.get(e);this.set(e,!t)}get isDebug(){return this.get("isDebug")}set isDebug(e){this.set("isDebug",e)}get isShowCommandLine(){return this.get("isShowCommandLine")}set isShowCommandLine(e){this.set("isShowCommandLine",e)}get isShowCoordinate(){return this.get("isShowCoordinate")}set isShowCoordinate(e){this.set("isShowCoordinate",e)}get isShowEntityInfo(){return this.get("isShowEntityInfo")}set isShowEntityInfo(e){this.set("isShowEntityInfo",e)}get isShowLanguageSelector(){return this.get("isShowLanguageSelector")}set isShowLanguageSelector(e){this.set("isShowLanguageSelector",e)}get isShowMainMenu(){return this.get("isShowMainMenu")}set isShowMainMenu(e){this.set("isShowMainMenu",e)}get isShowToolbar(){return this.get("isShowToolbar")}set isShowToolbar(e){this.set("isShowToolbar",e)}get isShowStats(){return this.get("isShowStats")}set isShowStats(e){this.set("isShowStats",e)}get fontMapping(){return this.get("fontMapping")}set fontMapping(e){this.set("fontMapping",e)}setFontMapping(e,t){const n=this.get("fontMapping");n[e]=t,this.set("fontMapping",n)}get settings(){const e=localStorage.getItem(rp),t=e==null?{}:JSON.parse(e);return g1(t,a8)}}const o8="https://mlightcad.gitlab.io/cad-data/";class Nt{constructor(e={}){this.events={documentCreated:new lt,documentActivated:new lt},this._baseUrl=e.baseUrl??o8,e.useMainThreadDraw?Ur.getInstance().setRenderMode("main"):Ur.getInstance().setRenderMode("worker");const t=new qb;t.database.events.openProgress.addEventListener(i=>{const a={database:t.database,percentage:i.percentage,stage:i.stage,subStage:i.subStage,subStageStatus:i.subStageStatus,data:i.data};Fr.emit("open-file-progress",a),this.updateProgress(a)});const n=()=>({width:window.innerWidth,height:window.innerHeight-30}),r=new e8({canvas:e.canvas,calculateSizeCallback:n});this._context=new yb(r,t),this._fontLoader=new t8,this._fontLoader.baseUrl=this._baseUrl+"fonts/",Na().workingDatabase=t.database,this.registerCommands(),this._progress=new i8,this._progress.hide(),e.notLoadDefaultFonts||this.loadDefaultFonts(),r8(),this.createCommandLine()}static createInstance(e={}){return Nt._instance==null&&(Nt._instance=new Nt(e)),this._instance}static get instance(){return Nt._instance||(Nt._instance=new Nt),Nt._instance}get context(){return this._context}get curDocument(){return this._context.doc}get mdiActiveDocument(){return this._context.doc}get curView(){return this._context.view}get editor(){return this._context.view.editor}get baseUrl(){return this._baseUrl}get avaiableFonts(){return this._fontLoader.avaiableFonts}async loadFonts(e){await this._fontLoader.load(e)}async loadDefaultFonts(e){e==null?await this._fontLoader.load(["simkai"]):await this._fontLoader.load(e)}async openUrl(e,t){this.onBeforeOpenDocument(),t=this.setOptions(t);const n=await this.context.doc.openUri(e,t);return this.onAfterOpenDocument(n),n}async openDocument(e,t,n){this.onBeforeOpenDocument(),n=this.setOptions(n);const r=await this.context.doc.openDocument(e,t,n);return this.onAfterOpenDocument(r),r}regen(){this.curView.clear(),this.context.doc.database.regen()}registerCommands(){const e=Gt.instance;e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"circle","circle",new d6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"csvg","csvg",new v6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"dim","dim",new _6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"log","log",new x6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"open","open",new w6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"pan","pan",new k6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"qnew","qnew",new S6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"regen","regen",new A6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"select","select",new E6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"zoom","zoom",new I6),e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,"zoomw","zoomw",new C6),fh.instance().getAllDescriptors().forEach(t=>{e.addCommand(Gt.SYSTEMT_COMMAND_GROUP_NAME,t.name,t.name,new T6)})}sendStringToExecute(e){const t=Gt.instance.lookupGlobalCmd(e);t==null||t.execute(this.context)}setActiveLayout(){const e=this.curView;e.activeLayoutBtrId=this.curDocument.database.currentSpaceId,e.modelSpaceBtrId=this.curDocument.database.currentSpaceId}onBeforeOpenDocument(){this.curView.clear()}onAfterOpenDocument(e){if(e){const t=this.context.doc;this.events.documentActivated.dispatch({doc:t}),this.setActiveLayout();const n=t.database;n.extents.isEmpty()?this.curView.zoomToFit():this.curView.zoomTo(new Ct(n.extmin,n.extmax))}}setOptions(e){return e==null?e={fontLoader:this._fontLoader}:e.fontLoader==null&&(e.fontLoader=this._fontLoader),e}updateProgress(e){if(e.stage==="CONVERSION"){if(e.subStage){const t="main.progress."+e.subStage.replace(/_/g,"").toLowerCase();this._progress.setMessage(dn.t(t))}}else e.stage==="FETCH_FILE"&&this._progress.setMessage(dn.t("main.message.fetchingDrawingFile"));e.percentage>=100?this._progress.hide():this._progress.show()}createCommandLine(){const e=new Cb(document.body);e.visible=dr.instance.isShowCommandLine,dr.instance.events.modified.addEventListener(()=>{e.visible=dr.instance.isShowCommandLine})}}export{Nt as a,hr as i};
