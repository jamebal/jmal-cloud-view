var c=Object.defineProperty;var d=(a,t,e)=>t in a?c(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var s=(a,t,e)=>d(a,typeof t!="symbol"?t+"":t,e);import{a as n,i as l}from"./mlightcad-engine-67Yin7gY.js";import"./three-render-D_rTpM3Q.js";import"./vendor-bxYKFQ3X.js";class u{constructor(){s(this,"canvas");s(this,"statusText");s(this,"loadingOverlay");s(this,"btnZoomFit");s(this,"isInitialized",!1);this.canvas=document.getElementById("canvas"),this.statusText=document.getElementById("statusText"),this.loadingOverlay=document.getElementById("loading-overlay"),this.btnZoomFit=document.getElementById("btnZoomFit"),this.initAndLoadUrl()}initialize(){if(!this.isInitialized)try{n.createInstance({canvas:this.canvas,baseUrl:"https://cdn.jsdelivr.net/gh/mlightcad/cad-data@main/"}),this.btnZoomFit.addEventListener("click",()=>{const t=n.instance;t&&t.curView&&t.curView.zoomToFit()}),this.isInitialized=!0}catch(t){console.error("Failed to initialize CAD viewer:",t),this.updateStatus("初始化引擎失败: "+t,!0)}}async initAndLoadUrl(){this.initialize();const e=new URLSearchParams(window.location.search).get("url");if(!e){this.updateStatus("请在 URL 中提供 ?url=xxx 参数",!0);return}await this.loadRemoteFile(e)}async loadRemoteFile(t){this.updateStatus("正在下载图纸...");try{const e=await fetch(t);if(!e.ok)throw new Error(`下载失败: ${e.status} ${e.statusText}`);const r=await e.arrayBuffer();let i=t.substring(t.lastIndexOf("/")+1);i.indexOf("?")>-1&&(i=i.substring(0,i.indexOf("?"))),i||(i="drawing.dwg"),this.updateStatus("正在解析 CAD 数据...");const o={minimumChunkSize:1e3,readOnly:!0};if(await n.instance.openDocument(i,r,o))this.loadingOverlay.style.display="none",setTimeout(async()=>{n.instance.curView.zoomToFit(),n.instance.curView.mode=l.PAN},100);else throw new Error("文档解析失败 (Unknown Error)")}catch(e){console.error("Error loading file:",e),this.updateStatus(`加载错误: ${e.message||e}`,!0)}}updateStatus(t,e=!1){this.statusText&&(this.statusText.textContent=t,e&&this.statusText.classList.add("error-text"))}}new u;
